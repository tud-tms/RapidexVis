function nO(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const c in r)if(c!=="default"&&!(c in t)){const h=Object.getOwnPropertyDescriptor(r,c);h&&Object.defineProperty(t,c,h.get?h:{enumerable:!0,get:()=>r[c]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const h of c)if(h.type==="childList")for(const p of h.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function n(c){const h={};return c.integrity&&(h.integrity=c.integrity),c.referrerpolicy&&(h.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?h.credentials="include":c.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function r(c){if(c.ep)return;c.ep=!0;const h=n(c);fetch(c.href,h)}})();function A1(t,e){const n=Object.create(null),r=t.split(",");for(let c=0;c<r.length;c++)n[r[c]]=!0;return e?c=>!!n[c.toLowerCase()]:c=>!!n[c]}function oy(t){if(On(t)){const e={};for(let n=0;n<t.length;n++){const r=t[n],c=wr(r)?oO(r):oy(r);if(c)for(const h in c)e[h]=c[h]}return e}else{if(wr(t))return t;if(Wi(t))return t}}const iO=/;(?![^(]*\))/g,rO=/:([^]+)/,sO=/\/\*.*?\*\//gs;function oO(t){const e={};return t.replace(sO,"").split(iO).forEach(n=>{if(n){const r=n.split(rO);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function vh(t){let e="";if(wr(t))e=t;else if(On(t))for(let n=0;n<t.length;n++){const r=vh(t[n]);r&&(e+=r+" ")}else if(Wi(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}function aO(t){if(!t)return null;let{class:e,style:n}=t;return e&&!wr(e)&&(t.class=vh(e)),n&&(t.style=oy(n)),t}const lO="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",cO=A1(lO);function OM(t){return!!t||t===""}function uO(t,e){if(t.length!==e.length)return!1;let n=!0;for(let r=0;n&&r<t.length;r++)n=xp(t[r],e[r]);return n}function xp(t,e){if(t===e)return!0;let n=RT(t),r=RT(e);if(n||r)return n&&r?t.getTime()===e.getTime():!1;if(n=Wd(t),r=Wd(e),n||r)return t===e;if(n=On(t),r=On(e),n||r)return n&&r?uO(t,e):!1;if(n=Wi(t),r=Wi(e),n||r){if(!n||!r)return!1;const c=Object.keys(t).length,h=Object.keys(e).length;if(c!==h)return!1;for(const p in t){const s=t.hasOwnProperty(p),v=e.hasOwnProperty(p);if(s&&!v||!s&&v||!xp(t[p],e[p]))return!1}}return String(t)===String(e)}function S1(t,e){return t.findIndex(n=>xp(n,e))}const pl=t=>wr(t)?t:t==null?"":On(t)||Wi(t)&&(t.toString===BM||!Yn(t.toString))?JSON.stringify(t,DM,2):String(t),DM=(t,e)=>e&&e.__v_isRef?DM(t,e.value):fh(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((n,[r,c])=>(n[`${r} =>`]=c,n),{})}:jh(e)?{[`Set(${e.size})`]:[...e.values()]}:Wi(e)&&!On(e)&&!FM(e)?String(e):e,Qi={},hh=[],Io=()=>{},hO=()=>!1,fO=/^on[^a-z]/,ay=t=>fO.test(t),M1=t=>t.startsWith("onUpdate:"),gs=Object.assign,P1=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},dO=Object.prototype.hasOwnProperty,yi=(t,e)=>dO.call(t,e),On=Array.isArray,fh=t=>bp(t)==="[object Map]",jh=t=>bp(t)==="[object Set]",RT=t=>bp(t)==="[object Date]",Yn=t=>typeof t=="function",wr=t=>typeof t=="string",Wd=t=>typeof t=="symbol",Wi=t=>t!==null&&typeof t=="object",zM=t=>Wi(t)&&Yn(t.then)&&Yn(t.catch),BM=Object.prototype.toString,bp=t=>BM.call(t),pO=t=>bp(t).slice(8,-1),FM=t=>bp(t)==="[object Object]",I1=t=>wr(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Yg=A1(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ly=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},mO=/-(\w)/g,ca=ly(t=>t.replace(mO,(e,n)=>n?n.toUpperCase():"")),gO=/\B([A-Z])/g,Gh=ly(t=>t.replace(gO,"-$1").toLowerCase()),cy=ly(t=>t.charAt(0).toUpperCase()+t.slice(1)),Kg=ly(t=>t?`on${cy(t)}`:""),qd=(t,e)=>!Object.is(t,e),Jg=(t,e)=>{for(let n=0;n<t.length;n++)t[n](e)},g_=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})},Zd=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let OT;const _O=()=>OT||(OT=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let js;class yO{constructor(e=!1){this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=js,!e&&js&&(this.index=(js.scopes||(js.scopes=[])).push(this)-1)}run(e){if(this.active){const n=js;try{return js=this,e()}finally{js=n}}}on(){js=this}off(){js=this.parent}stop(e){if(this.active){let n,r;for(n=0,r=this.effects.length;n<r;n++)this.effects[n].stop();for(n=0,r=this.cleanups.length;n<r;n++)this.cleanups[n]();if(this.scopes)for(n=0,r=this.scopes.length;n<r;n++)this.scopes[n].stop(!0);if(!this.detached&&this.parent&&!e){const c=this.parent.scopes.pop();c&&c!==this&&(this.parent.scopes[this.index]=c,c.index=this.index)}this.parent=void 0,this.active=!1}}}function vO(t,e=js){e&&e.active&&e.effects.push(t)}function xO(){return js}function bO(t){js&&js.cleanups.push(t)}const C1=t=>{const e=new Set(t);return e.w=0,e.n=0,e},NM=t=>(t.w&Ol)>0,UM=t=>(t.n&Ol)>0,wO=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=Ol},EO=t=>{const{deps:e}=t;if(e.length){let n=0;for(let r=0;r<e.length;r++){const c=e[r];NM(c)&&!UM(c)?c.delete(t):e[n++]=c,c.w&=~Ol,c.n&=~Ol}e.length=n}},ox=new WeakMap;let Sd=0,Ol=1;const ax=30;let To;const Vc=Symbol(""),lx=Symbol("");class L1{constructor(e,n=null,r){this.fn=e,this.scheduler=n,this.active=!0,this.deps=[],this.parent=void 0,vO(this,r)}run(){if(!this.active)return this.fn();let e=To,n=Ll;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=To,To=this,Ll=!0,Ol=1<<++Sd,Sd<=ax?wO(this):DT(this),this.fn()}finally{Sd<=ax&&EO(this),Ol=1<<--Sd,To=this.parent,Ll=n,this.parent=void 0,this.deferStop&&this.stop()}}stop(){To===this?this.deferStop=!0:this.active&&(DT(this),this.onStop&&this.onStop(),this.active=!1)}}function DT(t){const{deps:e}=t;if(e.length){for(let n=0;n<e.length;n++)e[n].delete(t);e.length=0}}let Ll=!0;const VM=[];function $h(){VM.push(Ll),Ll=!1}function Hh(){const t=VM.pop();Ll=t===void 0?!0:t}function Xs(t,e,n){if(Ll&&To){let r=ox.get(t);r||ox.set(t,r=new Map);let c=r.get(n);c||r.set(n,c=C1()),jM(c)}}function jM(t,e){let n=!1;Sd<=ax?UM(t)||(t.n|=Ol,n=!NM(t)):n=!t.has(To),n&&(t.add(To),To.deps.push(t))}function ka(t,e,n,r,c,h){const p=ox.get(t);if(!p)return;let s=[];if(e==="clear")s=[...p.values()];else if(n==="length"&&On(t)){const v=Zd(r);p.forEach((E,M)=>{(M==="length"||M>=v)&&s.push(E)})}else switch(n!==void 0&&s.push(p.get(n)),e){case"add":On(t)?I1(n)&&s.push(p.get("length")):(s.push(p.get(Vc)),fh(t)&&s.push(p.get(lx)));break;case"delete":On(t)||(s.push(p.get(Vc)),fh(t)&&s.push(p.get(lx)));break;case"set":fh(t)&&s.push(p.get(Vc));break}if(s.length===1)s[0]&&cx(s[0]);else{const v=[];for(const E of s)E&&v.push(...E);cx(C1(v))}}function cx(t,e){const n=On(t)?t:[...t];for(const r of n)r.computed&&zT(r);for(const r of n)r.computed||zT(r)}function zT(t,e){(t!==To||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const TO=A1("__proto__,__v_isRef,__isVue"),GM=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Wd)),AO=k1(),SO=k1(!1,!0),MO=k1(!0),BT=PO();function PO(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...n){const r=Oi(this);for(let h=0,p=this.length;h<p;h++)Xs(r,"get",h+"");const c=r[e](...n);return c===-1||c===!1?r[e](...n.map(Oi)):c}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...n){$h();const r=Oi(this)[e].apply(this,n);return Hh(),r}}),t}function k1(t=!1,e=!1){return function(r,c,h){if(c==="__v_isReactive")return!t;if(c==="__v_isReadonly")return t;if(c==="__v_isShallow")return e;if(c==="__v_raw"&&h===(t?e?$O:ZM:e?qM:WM).get(r))return r;const p=On(r);if(!t&&p&&yi(BT,c))return Reflect.get(BT,c,h);const s=Reflect.get(r,c,h);return(Wd(c)?GM.has(c):TO(c))||(t||Xs(r,"get",c),e)?s:Qr(s)?p&&I1(c)?s:s.value:Wi(s)?t?XM(s):ua(s):s}}const IO=$M(),CO=$M(!0);function $M(t=!1){return function(n,r,c,h){let p=n[r];if(xh(p)&&Qr(p)&&!Qr(c))return!1;if(!t&&(!__(c)&&!xh(c)&&(p=Oi(p),c=Oi(c)),!On(n)&&Qr(p)&&!Qr(c)))return p.value=c,!0;const s=On(n)&&I1(r)?Number(r)<n.length:yi(n,r),v=Reflect.set(n,r,c,h);return n===Oi(h)&&(s?qd(c,p)&&ka(n,"set",r,c):ka(n,"add",r,c)),v}}function LO(t,e){const n=yi(t,e);t[e];const r=Reflect.deleteProperty(t,e);return r&&n&&ka(t,"delete",e,void 0),r}function kO(t,e){const n=Reflect.has(t,e);return(!Wd(e)||!GM.has(e))&&Xs(t,"has",e),n}function RO(t){return Xs(t,"iterate",On(t)?"length":Vc),Reflect.ownKeys(t)}const HM={get:AO,set:IO,deleteProperty:LO,has:kO,ownKeys:RO},OO={get:MO,set(t,e){return!0},deleteProperty(t,e){return!0}},DO=gs({},HM,{get:SO,set:CO}),R1=t=>t,uy=t=>Reflect.getPrototypeOf(t);function gg(t,e,n=!1,r=!1){t=t.__v_raw;const c=Oi(t),h=Oi(e);n||(e!==h&&Xs(c,"get",e),Xs(c,"get",h));const{has:p}=uy(c),s=r?R1:n?B1:Xd;if(p.call(c,e))return s(t.get(e));if(p.call(c,h))return s(t.get(h));t!==c&&t.get(e)}function _g(t,e=!1){const n=this.__v_raw,r=Oi(n),c=Oi(t);return e||(t!==c&&Xs(r,"has",t),Xs(r,"has",c)),t===c?n.has(t):n.has(t)||n.has(c)}function yg(t,e=!1){return t=t.__v_raw,!e&&Xs(Oi(t),"iterate",Vc),Reflect.get(t,"size",t)}function FT(t){t=Oi(t);const e=Oi(this);return uy(e).has.call(e,t)||(e.add(t),ka(e,"add",t,t)),this}function NT(t,e){e=Oi(e);const n=Oi(this),{has:r,get:c}=uy(n);let h=r.call(n,t);h||(t=Oi(t),h=r.call(n,t));const p=c.call(n,t);return n.set(t,e),h?qd(e,p)&&ka(n,"set",t,e):ka(n,"add",t,e),this}function UT(t){const e=Oi(this),{has:n,get:r}=uy(e);let c=n.call(e,t);c||(t=Oi(t),c=n.call(e,t)),r&&r.call(e,t);const h=e.delete(t);return c&&ka(e,"delete",t,void 0),h}function VT(){const t=Oi(this),e=t.size!==0,n=t.clear();return e&&ka(t,"clear",void 0,void 0),n}function vg(t,e){return function(r,c){const h=this,p=h.__v_raw,s=Oi(p),v=e?R1:t?B1:Xd;return!t&&Xs(s,"iterate",Vc),p.forEach((E,M)=>r.call(c,v(E),v(M),h))}}function xg(t,e,n){return function(...r){const c=this.__v_raw,h=Oi(c),p=fh(h),s=t==="entries"||t===Symbol.iterator&&p,v=t==="keys"&&p,E=c[t](...r),M=n?R1:e?B1:Xd;return!e&&Xs(h,"iterate",v?lx:Vc),{next(){const{value:I,done:R}=E.next();return R?{value:I,done:R}:{value:s?[M(I[0]),M(I[1])]:M(I),done:R}},[Symbol.iterator](){return this}}}}function ml(t){return function(...e){return t==="delete"?!1:this}}function zO(){const t={get(h){return gg(this,h)},get size(){return yg(this)},has:_g,add:FT,set:NT,delete:UT,clear:VT,forEach:vg(!1,!1)},e={get(h){return gg(this,h,!1,!0)},get size(){return yg(this)},has:_g,add:FT,set:NT,delete:UT,clear:VT,forEach:vg(!1,!0)},n={get(h){return gg(this,h,!0)},get size(){return yg(this,!0)},has(h){return _g.call(this,h,!0)},add:ml("add"),set:ml("set"),delete:ml("delete"),clear:ml("clear"),forEach:vg(!0,!1)},r={get(h){return gg(this,h,!0,!0)},get size(){return yg(this,!0)},has(h){return _g.call(this,h,!0)},add:ml("add"),set:ml("set"),delete:ml("delete"),clear:ml("clear"),forEach:vg(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(h=>{t[h]=xg(h,!1,!1),n[h]=xg(h,!0,!1),e[h]=xg(h,!1,!0),r[h]=xg(h,!0,!0)}),[t,n,e,r]}const[BO,FO,NO,UO]=zO();function O1(t,e){const n=e?t?UO:NO:t?FO:BO;return(r,c,h)=>c==="__v_isReactive"?!t:c==="__v_isReadonly"?t:c==="__v_raw"?r:Reflect.get(yi(n,c)&&c in r?n:r,c,h)}const VO={get:O1(!1,!1)},jO={get:O1(!1,!0)},GO={get:O1(!0,!1)},WM=new WeakMap,qM=new WeakMap,ZM=new WeakMap,$O=new WeakMap;function HO(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function WO(t){return t.__v_skip||!Object.isExtensible(t)?0:HO(pO(t))}function ua(t){return xh(t)?t:z1(t,!1,HM,VO,WM)}function D1(t){return z1(t,!1,DO,jO,qM)}function XM(t){return z1(t,!0,OO,GO,ZM)}function z1(t,e,n,r,c){if(!Wi(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const h=c.get(t);if(h)return h;const p=WO(t);if(p===0)return t;const s=new Proxy(t,p===2?r:n);return c.set(t,s),s}function dh(t){return xh(t)?dh(t.__v_raw):!!(t&&t.__v_isReactive)}function xh(t){return!!(t&&t.__v_isReadonly)}function __(t){return!!(t&&t.__v_isShallow)}function YM(t){return dh(t)||xh(t)}function Oi(t){const e=t&&t.__v_raw;return e?Oi(e):t}function Cd(t){return g_(t,"__v_skip",!0),t}const Xd=t=>Wi(t)?ua(t):t,B1=t=>Wi(t)?XM(t):t;function KM(t){Ll&&To&&(t=Oi(t),jM(t.dep||(t.dep=C1())))}function JM(t,e){t=Oi(t),t.dep&&cx(t.dep)}function Qr(t){return!!(t&&t.__v_isRef===!0)}function $r(t){return QM(t,!1)}function hy(t){return QM(t,!0)}function QM(t,e){return Qr(t)?t:new qO(t,e)}class qO{constructor(e,n){this.__v_isShallow=n,this.dep=void 0,this.__v_isRef=!0,this._rawValue=n?e:Oi(e),this._value=n?e:Xd(e)}get value(){return KM(this),this._value}set value(e){const n=this.__v_isShallow||__(e)||xh(e);e=n?e:Oi(e),qd(e,this._rawValue)&&(this._rawValue=e,this._value=n?e:Xd(e),JM(this))}}function hr(t){return Qr(t)?t.value:t}const ZO={get:(t,e,n)=>hr(Reflect.get(t,e,n)),set:(t,e,n,r)=>{const c=t[e];return Qr(c)&&!Qr(n)?(c.value=n,!0):Reflect.set(t,e,n,r)}};function eP(t){return dh(t)?t:new Proxy(t,ZO)}class XO{constructor(e,n,r){this._object=e,this._key=n,this._defaultValue=r,this.__v_isRef=!0}get value(){const e=this._object[this._key];return e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}}function Eo(t,e,n){const r=t[e];return Qr(r)?r:new XO(t,e,n)}var tP;class YO{constructor(e,n,r,c){this._setter=n,this.dep=void 0,this.__v_isRef=!0,this[tP]=!1,this._dirty=!0,this.effect=new L1(e,()=>{this._dirty||(this._dirty=!0,JM(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!c,this.__v_isReadonly=r}get value(){const e=Oi(this);return KM(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}tP="__v_isReadonly";function KO(t,e,n=!1){let r,c;const h=Yn(t);return h?(r=t,c=Io):(r=t.get,c=t.set),new YO(r,c,h||!c,n)}function kl(t,e,n,r){let c;try{c=r?t(...r):t()}catch(h){fy(h,e,n)}return c}function Co(t,e,n,r){if(Yn(t)){const h=kl(t,e,n,r);return h&&zM(h)&&h.catch(p=>{fy(p,e,n)}),h}const c=[];for(let h=0;h<t.length;h++)c.push(Co(t[h],e,n,r));return c}function fy(t,e,n,r=!0){const c=e?e.vnode:null;if(e){let h=e.parent;const p=e.proxy,s=n;for(;h;){const E=h.ec;if(E){for(let M=0;M<E.length;M++)if(E[M](t,p,s)===!1)return}h=h.parent}const v=e.appContext.config.errorHandler;if(v){kl(v,null,10,[t,p,s]);return}}JO(t,n,c,r)}function JO(t,e,n,r=!0){console.error(t)}let Yd=!1,ux=!1;const ls=[];let ia=0;const ph=[];let Ca=null,kc=0;const nP=Promise.resolve();let F1=null;function iP(t){const e=F1||nP;return t?e.then(this?t.bind(this):t):e}function QO(t){let e=ia+1,n=ls.length;for(;e<n;){const r=e+n>>>1;Kd(ls[r])<t?e=r+1:n=r}return e}function N1(t){(!ls.length||!ls.includes(t,Yd&&t.allowRecurse?ia+1:ia))&&(t.id==null?ls.push(t):ls.splice(QO(t.id),0,t),rP())}function rP(){!Yd&&!ux&&(ux=!0,F1=nP.then(oP))}function eD(t){const e=ls.indexOf(t);e>ia&&ls.splice(e,1)}function tD(t){On(t)?ph.push(...t):(!Ca||!Ca.includes(t,t.allowRecurse?kc+1:kc))&&ph.push(t),rP()}function jT(t,e=Yd?ia+1:0){for(;e<ls.length;e++){const n=ls[e];n&&n.pre&&(ls.splice(e,1),e--,n())}}function sP(t){if(ph.length){const e=[...new Set(ph)];if(ph.length=0,Ca){Ca.push(...e);return}for(Ca=e,Ca.sort((n,r)=>Kd(n)-Kd(r)),kc=0;kc<Ca.length;kc++)Ca[kc]();Ca=null,kc=0}}const Kd=t=>t.id==null?1/0:t.id,nD=(t,e)=>{const n=Kd(t)-Kd(e);if(n===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return n};function oP(t){ux=!1,Yd=!0,ls.sort(nD);const e=Io;try{for(ia=0;ia<ls.length;ia++){const n=ls[ia];n&&n.active!==!1&&kl(n,null,14)}}finally{ia=0,ls.length=0,sP(),Yd=!1,F1=null,(ls.length||ph.length)&&oP()}}function iD(t,e,...n){if(t.isUnmounted)return;const r=t.vnode.props||Qi;let c=n;const h=e.startsWith("update:"),p=h&&e.slice(7);if(p&&p in r){const M=`${p==="modelValue"?"model":p}Modifiers`,{number:I,trim:R}=r[M]||Qi;R&&(c=n.map(N=>wr(N)?N.trim():N)),I&&(c=n.map(Zd))}let s,v=r[s=Kg(e)]||r[s=Kg(ca(e))];!v&&h&&(v=r[s=Kg(Gh(e))]),v&&Co(v,t,6,c);const E=r[s+"Once"];if(E){if(!t.emitted)t.emitted={};else if(t.emitted[s])return;t.emitted[s]=!0,Co(E,t,6,c)}}function aP(t,e,n=!1){const r=e.emitsCache,c=r.get(t);if(c!==void 0)return c;const h=t.emits;let p={},s=!1;if(!Yn(t)){const v=E=>{const M=aP(E,e,!0);M&&(s=!0,gs(p,M))};!n&&e.mixins.length&&e.mixins.forEach(v),t.extends&&v(t.extends),t.mixins&&t.mixins.forEach(v)}return!h&&!s?(Wi(t)&&r.set(t,null),null):(On(h)?h.forEach(v=>p[v]=null):gs(p,h),Wi(t)&&r.set(t,p),p)}function dy(t,e){return!t||!ay(e)?!1:(e=e.slice(2).replace(/Once$/,""),yi(t,e[0].toLowerCase()+e.slice(1))||yi(t,Gh(e))||yi(t,e))}let es=null,py=null;function y_(t){const e=es;return es=t,py=t&&t.type.__scopeId||null,e}function rD(t){py=t}function sD(){py=null}function hx(t,e=es,n){if(!e||t._n)return t;const r=(...c)=>{r._d&&JT(-1);const h=y_(e);let p;try{p=t(...c)}finally{y_(h),r._d&&JT(1)}return p};return r._n=!0,r._c=!0,r._d=!0,r}function nv(t){const{type:e,vnode:n,proxy:r,withProxy:c,props:h,propsOptions:[p],slots:s,attrs:v,emit:E,render:M,renderCache:I,data:R,setupState:N,ctx:$,inheritAttrs:Z}=t;let ne,me;const we=y_(t);try{if(n.shapeFlag&4){const Pe=c||r;ne=na(M.call(Pe,Pe,I,h,N,R,$)),me=v}else{const Pe=e;ne=na(Pe.length>1?Pe(h,{attrs:v,slots:s,emit:E}):Pe(h,null)),me=e.props?v:oD(v)}}catch(Pe){Rd.length=0,fy(Pe,t,1),ne=gr(Dl)}let he=ne;if(me&&Z!==!1){const Pe=Object.keys(me),{shapeFlag:ge}=he;Pe.length&&ge&7&&(p&&Pe.some(M1)&&(me=aD(me,p)),he=bh(he,me))}return n.dirs&&(he=bh(he),he.dirs=he.dirs?he.dirs.concat(n.dirs):n.dirs),n.transition&&(he.transition=n.transition),ne=he,y_(we),ne}const oD=t=>{let e;for(const n in t)(n==="class"||n==="style"||ay(n))&&((e||(e={}))[n]=t[n]);return e},aD=(t,e)=>{const n={};for(const r in t)(!M1(r)||!(r.slice(9)in e))&&(n[r]=t[r]);return n};function lD(t,e,n){const{props:r,children:c,component:h}=t,{props:p,children:s,patchFlag:v}=e,E=h.emitsOptions;if(e.dirs||e.transition)return!0;if(n&&v>=0){if(v&1024)return!0;if(v&16)return r?GT(r,p,E):!!p;if(v&8){const M=e.dynamicProps;for(let I=0;I<M.length;I++){const R=M[I];if(p[R]!==r[R]&&!dy(E,R))return!0}}}else return(c||s)&&(!s||!s.$stable)?!0:r===p?!1:r?p?GT(r,p,E):!0:!!p;return!1}function GT(t,e,n){const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!0;for(let c=0;c<r.length;c++){const h=r[c];if(e[h]!==t[h]&&!dy(n,h))return!0}return!1}function cD({vnode:t,parent:e},n){for(;e&&e.subTree===t;)(t=e.vnode).el=n,e=e.parent}const uD=t=>t.__isSuspense;function hD(t,e){e&&e.pendingBranch?On(t)?e.effects.push(...t):e.effects.push(t):tD(t)}function Qg(t,e){if(Gr){let n=Gr.provides;const r=Gr.parent&&Gr.parent.provides;r===n&&(n=Gr.provides=Object.create(r)),n[t]=e}}function Lo(t,e,n=!1){const r=Gr||es;if(r){const c=r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides;if(c&&t in c)return c[t];if(arguments.length>1)return n&&Yn(e)?e.call(r.proxy):e}}const bg={};function nr(t,e,n){return lP(t,e,n)}function lP(t,e,{immediate:n,deep:r,flush:c,onTrack:h,onTrigger:p}=Qi){const s=Gr;let v,E=!1,M=!1;if(Qr(t)?(v=()=>t.value,E=__(t)):dh(t)?(v=()=>t,r=!0):On(t)?(M=!0,E=t.some(he=>dh(he)||__(he)),v=()=>t.map(he=>{if(Qr(he))return he.value;if(dh(he))return Bc(he);if(Yn(he))return kl(he,s,2)})):Yn(t)?e?v=()=>kl(t,s,2):v=()=>{if(!(s&&s.isUnmounted))return I&&I(),Co(t,s,3,[R])}:v=Io,e&&r){const he=v;v=()=>Bc(he())}let I,R=he=>{I=me.onStop=()=>{kl(he,s,4)}},N;if(Qd)if(R=Io,e?n&&Co(e,s,3,[v(),M?[]:void 0,R]):v(),c==="sync"){const he=sz();N=he.__watcherHandles||(he.__watcherHandles=[])}else return Io;let $=M?new Array(t.length).fill(bg):bg;const Z=()=>{if(!!me.active)if(e){const he=me.run();(r||E||(M?he.some((Pe,ge)=>qd(Pe,$[ge])):qd(he,$)))&&(I&&I(),Co(e,s,3,[he,$===bg?void 0:M&&$[0]===bg?[]:$,R]),$=he)}else me.run()};Z.allowRecurse=!!e;let ne;c==="sync"?ne=Z:c==="post"?ne=()=>Ss(Z,s&&s.suspense):(Z.pre=!0,s&&(Z.id=s.uid),ne=()=>N1(Z));const me=new L1(v,ne);e?n?Z():$=me.run():c==="post"?Ss(me.run.bind(me),s&&s.suspense):me.run();const we=()=>{me.stop(),s&&s.scope&&P1(s.scope.effects,me)};return N&&N.push(we),we}function fD(t,e,n){const r=this.proxy,c=wr(t)?t.includes(".")?cP(r,t):()=>r[t]:t.bind(r,r);let h;Yn(e)?h=e:(h=e.handler,n=e);const p=Gr;wh(this);const s=lP(c,h.bind(r),n);return p?wh(p):jc(),s}function cP(t,e){const n=e.split(".");return()=>{let r=t;for(let c=0;c<n.length&&r;c++)r=r[n[c]];return r}}function Bc(t,e){if(!Wi(t)||t.__v_skip||(e=e||new Set,e.has(t)))return t;if(e.add(t),Qr(t))Bc(t.value,e);else if(On(t))for(let n=0;n<t.length;n++)Bc(t[n],e);else if(jh(t)||fh(t))t.forEach(n=>{Bc(n,e)});else if(FM(t))for(const n in t)Bc(t[n],e);return t}function U1(t){return Yn(t)?{setup:t,name:t.name}:t}const Ld=t=>!!t.type.__asyncLoader,uP=t=>t.type.__isKeepAlive;function dD(t,e){hP(t,"a",e)}function pD(t,e){hP(t,"da",e)}function hP(t,e,n=Gr){const r=t.__wdc||(t.__wdc=()=>{let c=n;for(;c;){if(c.isDeactivated)return;c=c.parent}return t()});if(my(e,r,n),n){let c=n.parent;for(;c&&c.parent;)uP(c.parent.vnode)&&mD(r,e,n,c),c=c.parent}}function mD(t,e,n,r){const c=my(e,t,r,!0);Kc(()=>{P1(r[e],c)},n)}function my(t,e,n=Gr,r=!1){if(n){const c=n[t]||(n[t]=[]),h=e.__weh||(e.__weh=(...p)=>{if(n.isUnmounted)return;$h(),wh(n);const s=Co(e,n,t,p);return jc(),Hh(),s});return r?c.unshift(h):c.push(h),h}}const Fa=t=>(e,n=Gr)=>(!Qd||t==="sp")&&my(t,(...r)=>e(...r),n),gD=Fa("bm"),qc=Fa("m"),_D=Fa("bu"),yD=Fa("u"),vD=Fa("bum"),Kc=Fa("um"),xD=Fa("sp"),bD=Fa("rtg"),wD=Fa("rtc");function ED(t,e=Gr){my("ec",t,e)}function Ma(t,e){const n=es;if(n===null)return t;const r=yy(n)||n.proxy,c=t.dirs||(t.dirs=[]);for(let h=0;h<e.length;h++){let[p,s,v,E=Qi]=e[h];p&&(Yn(p)&&(p={mounted:p,updated:p}),p.deep&&Bc(s),c.push({dir:p,instance:r,value:s,oldValue:void 0,arg:v,modifiers:E}))}return t}function Ec(t,e,n,r){const c=t.dirs,h=e&&e.dirs;for(let p=0;p<c.length;p++){const s=c[p];h&&(s.oldValue=h[p].value);let v=s.dir[r];v&&($h(),Co(v,n,8,[t.el,s,t,e]),Hh())}}const fP="components";function TD(t,e){return SD(fP,t,!0,e)||t}const AD=Symbol();function SD(t,e,n=!0,r=!1){const c=es||Gr;if(c){const h=c.type;if(t===fP){const s=nz(h,!1);if(s&&(s===e||s===ca(e)||s===cy(ca(e))))return h}const p=$T(c[t]||h[t],e)||$T(c.appContext[t],e);return!p&&r?h:p}}function $T(t,e){return t&&(t[e]||t[ca(e)]||t[cy(ca(e))])}function HT(t,e,n,r){let c;const h=n&&n[r];if(On(t)||wr(t)){c=new Array(t.length);for(let p=0,s=t.length;p<s;p++)c[p]=e(t[p],p,void 0,h&&h[p])}else if(typeof t=="number"){c=new Array(t);for(let p=0;p<t;p++)c[p]=e(p+1,p,void 0,h&&h[p])}else if(Wi(t))if(t[Symbol.iterator])c=Array.from(t,(p,s)=>e(p,s,void 0,h&&h[s]));else{const p=Object.keys(t);c=new Array(p.length);for(let s=0,v=p.length;s<v;s++){const E=p[s];c[s]=e(t[E],E,s,h&&h[s])}}else c=[];return n&&(n[r]=c),c}function MD(t,e,n={},r,c){if(es.isCE||es.parent&&Ld(es.parent)&&es.parent.isCE)return e!=="default"&&(n.name=e),gr("slot",n,r&&r());let h=t[e];h&&h._c&&(h._d=!1),Kr();const p=h&&dP(h(n)),s=G1(Hs,{key:n.key||p&&p.key||`_${e}`},p||(r?r():[]),p&&t._===1?64:-2);return!c&&s.scopeId&&(s.slotScopeIds=[s.scopeId+"-s"]),h&&h._c&&(h._d=!0),s}function dP(t){return t.some(e=>x_(e)?!(e.type===Dl||e.type===Hs&&!dP(e.children)):!0)?t:null}function PD(t,e){const n={};for(const r in t)n[e&&/[A-Z]/.test(r)?`on:${r}`:Kg(r)]=t[r];return n}const fx=t=>t?MP(t)?yy(t)||t.proxy:fx(t.parent):null,kd=gs(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>fx(t.parent),$root:t=>fx(t.root),$emit:t=>t.emit,$options:t=>V1(t),$forceUpdate:t=>t.f||(t.f=()=>N1(t.update)),$nextTick:t=>t.n||(t.n=iP.bind(t.proxy)),$watch:t=>fD.bind(t)}),iv=(t,e)=>t!==Qi&&!t.__isScriptSetup&&yi(t,e),ID={get({_:t},e){const{ctx:n,setupState:r,data:c,props:h,accessCache:p,type:s,appContext:v}=t;let E;if(e[0]!=="$"){const N=p[e];if(N!==void 0)switch(N){case 1:return r[e];case 2:return c[e];case 4:return n[e];case 3:return h[e]}else{if(iv(r,e))return p[e]=1,r[e];if(c!==Qi&&yi(c,e))return p[e]=2,c[e];if((E=t.propsOptions[0])&&yi(E,e))return p[e]=3,h[e];if(n!==Qi&&yi(n,e))return p[e]=4,n[e];dx&&(p[e]=0)}}const M=kd[e];let I,R;if(M)return e==="$attrs"&&Xs(t,"get",e),M(t);if((I=s.__cssModules)&&(I=I[e]))return I;if(n!==Qi&&yi(n,e))return p[e]=4,n[e];if(R=v.config.globalProperties,yi(R,e))return R[e]},set({_:t},e,n){const{data:r,setupState:c,ctx:h}=t;return iv(c,e)?(c[e]=n,!0):r!==Qi&&yi(r,e)?(r[e]=n,!0):yi(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(h[e]=n,!0)},has({_:{data:t,setupState:e,accessCache:n,ctx:r,appContext:c,propsOptions:h}},p){let s;return!!n[p]||t!==Qi&&yi(t,p)||iv(e,p)||(s=h[0])&&yi(s,p)||yi(r,p)||yi(kd,p)||yi(c.config.globalProperties,p)},defineProperty(t,e,n){return n.get!=null?t._.accessCache[e]=0:yi(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};let dx=!0;function CD(t){const e=V1(t),n=t.proxy,r=t.ctx;dx=!1,e.beforeCreate&&WT(e.beforeCreate,t,"bc");const{data:c,computed:h,methods:p,watch:s,provide:v,inject:E,created:M,beforeMount:I,mounted:R,beforeUpdate:N,updated:$,activated:Z,deactivated:ne,beforeDestroy:me,beforeUnmount:we,destroyed:he,unmounted:Pe,render:ge,renderTracked:nt,renderTriggered:Tt,errorCaptured:Rt,serverPrefetch:ke,expose:It,inheritAttrs:xt,components:gn,directives:an,filters:ln}=e;if(E&&LD(E,r,null,t.appContext.config.unwrapInjectedRef),p)for(const yn in p){const vn=p[yn];Yn(vn)&&(r[yn]=vn.bind(n))}if(c){const yn=c.call(n,n);Wi(yn)&&(t.data=ua(yn))}if(dx=!0,h)for(const yn in h){const vn=h[yn],Bn=Yn(vn)?vn.bind(n,n):Yn(vn.get)?vn.get.bind(n,n):Io,Wn=!Yn(vn)&&Yn(vn.set)?vn.set.bind(n):Io,pi=Ri({get:Bn,set:Wn});Object.defineProperty(r,yn,{enumerable:!0,configurable:!0,get:()=>pi.value,set:Kn=>pi.value=Kn})}if(s)for(const yn in s)pP(s[yn],r,n,yn);if(v){const yn=Yn(v)?v.call(n):v;Reflect.ownKeys(yn).forEach(vn=>{Qg(vn,yn[vn])})}M&&WT(M,t,"c");function Mn(yn,vn){On(vn)?vn.forEach(Bn=>yn(Bn.bind(n))):vn&&yn(vn.bind(n))}if(Mn(gD,I),Mn(qc,R),Mn(_D,N),Mn(yD,$),Mn(dD,Z),Mn(pD,ne),Mn(ED,Rt),Mn(wD,nt),Mn(bD,Tt),Mn(vD,we),Mn(Kc,Pe),Mn(xD,ke),On(It))if(It.length){const yn=t.exposed||(t.exposed={});It.forEach(vn=>{Object.defineProperty(yn,vn,{get:()=>n[vn],set:Bn=>n[vn]=Bn})})}else t.exposed||(t.exposed={});ge&&t.render===Io&&(t.render=ge),xt!=null&&(t.inheritAttrs=xt),gn&&(t.components=gn),an&&(t.directives=an)}function LD(t,e,n=Io,r=!1){On(t)&&(t=px(t));for(const c in t){const h=t[c];let p;Wi(h)?"default"in h?p=Lo(h.from||c,h.default,!0):p=Lo(h.from||c):p=Lo(h),Qr(p)&&r?Object.defineProperty(e,c,{enumerable:!0,configurable:!0,get:()=>p.value,set:s=>p.value=s}):e[c]=p}}function WT(t,e,n){Co(On(t)?t.map(r=>r.bind(e.proxy)):t.bind(e.proxy),e,n)}function pP(t,e,n,r){const c=r.includes(".")?cP(n,r):()=>n[r];if(wr(t)){const h=e[t];Yn(h)&&nr(c,h)}else if(Yn(t))nr(c,t.bind(n));else if(Wi(t))if(On(t))t.forEach(h=>pP(h,e,n,r));else{const h=Yn(t.handler)?t.handler.bind(n):e[t.handler];Yn(h)&&nr(c,h,t)}}function V1(t){const e=t.type,{mixins:n,extends:r}=e,{mixins:c,optionsCache:h,config:{optionMergeStrategies:p}}=t.appContext,s=h.get(e);let v;return s?v=s:!c.length&&!n&&!r?v=e:(v={},c.length&&c.forEach(E=>v_(v,E,p,!0)),v_(v,e,p)),Wi(e)&&h.set(e,v),v}function v_(t,e,n,r=!1){const{mixins:c,extends:h}=e;h&&v_(t,h,n,!0),c&&c.forEach(p=>v_(t,p,n,!0));for(const p in e)if(!(r&&p==="expose")){const s=kD[p]||n&&n[p];t[p]=s?s(t[p],e[p]):e[p]}return t}const kD={data:qT,props:Cc,emits:Cc,methods:Cc,computed:Cc,beforeCreate:fs,created:fs,beforeMount:fs,mounted:fs,beforeUpdate:fs,updated:fs,beforeDestroy:fs,beforeUnmount:fs,destroyed:fs,unmounted:fs,activated:fs,deactivated:fs,errorCaptured:fs,serverPrefetch:fs,components:Cc,directives:Cc,watch:OD,provide:qT,inject:RD};function qT(t,e){return e?t?function(){return gs(Yn(t)?t.call(this,this):t,Yn(e)?e.call(this,this):e)}:e:t}function RD(t,e){return Cc(px(t),px(e))}function px(t){if(On(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function fs(t,e){return t?[...new Set([].concat(t,e))]:e}function Cc(t,e){return t?gs(gs(Object.create(null),t),e):e}function OD(t,e){if(!t)return e;if(!e)return t;const n=gs(Object.create(null),t);for(const r in e)n[r]=fs(t[r],e[r]);return n}function DD(t,e,n,r=!1){const c={},h={};g_(h,_y,1),t.propsDefaults=Object.create(null),mP(t,e,c,h);for(const p in t.propsOptions[0])p in c||(c[p]=void 0);n?t.props=r?c:D1(c):t.type.props?t.props=c:t.props=h,t.attrs=h}function zD(t,e,n,r){const{props:c,attrs:h,vnode:{patchFlag:p}}=t,s=Oi(c),[v]=t.propsOptions;let E=!1;if((r||p>0)&&!(p&16)){if(p&8){const M=t.vnode.dynamicProps;for(let I=0;I<M.length;I++){let R=M[I];if(dy(t.emitsOptions,R))continue;const N=e[R];if(v)if(yi(h,R))N!==h[R]&&(h[R]=N,E=!0);else{const $=ca(R);c[$]=mx(v,s,$,N,t,!1)}else N!==h[R]&&(h[R]=N,E=!0)}}}else{mP(t,e,c,h)&&(E=!0);let M;for(const I in s)(!e||!yi(e,I)&&((M=Gh(I))===I||!yi(e,M)))&&(v?n&&(n[I]!==void 0||n[M]!==void 0)&&(c[I]=mx(v,s,I,void 0,t,!0)):delete c[I]);if(h!==s)for(const I in h)(!e||!yi(e,I)&&!0)&&(delete h[I],E=!0)}E&&ka(t,"set","$attrs")}function mP(t,e,n,r){const[c,h]=t.propsOptions;let p=!1,s;if(e)for(let v in e){if(Yg(v))continue;const E=e[v];let M;c&&yi(c,M=ca(v))?!h||!h.includes(M)?n[M]=E:(s||(s={}))[M]=E:dy(t.emitsOptions,v)||(!(v in r)||E!==r[v])&&(r[v]=E,p=!0)}if(h){const v=Oi(n),E=s||Qi;for(let M=0;M<h.length;M++){const I=h[M];n[I]=mx(c,v,I,E[I],t,!yi(E,I))}}return p}function mx(t,e,n,r,c,h){const p=t[n];if(p!=null){const s=yi(p,"default");if(s&&r===void 0){const v=p.default;if(p.type!==Function&&Yn(v)){const{propsDefaults:E}=c;n in E?r=E[n]:(wh(c),r=E[n]=v.call(null,e),jc())}else r=v}p[0]&&(h&&!s?r=!1:p[1]&&(r===""||r===Gh(n))&&(r=!0))}return r}function gP(t,e,n=!1){const r=e.propsCache,c=r.get(t);if(c)return c;const h=t.props,p={},s=[];let v=!1;if(!Yn(t)){const M=I=>{v=!0;const[R,N]=gP(I,e,!0);gs(p,R),N&&s.push(...N)};!n&&e.mixins.length&&e.mixins.forEach(M),t.extends&&M(t.extends),t.mixins&&t.mixins.forEach(M)}if(!h&&!v)return Wi(t)&&r.set(t,hh),hh;if(On(h))for(let M=0;M<h.length;M++){const I=ca(h[M]);ZT(I)&&(p[I]=Qi)}else if(h)for(const M in h){const I=ca(M);if(ZT(I)){const R=h[M],N=p[I]=On(R)||Yn(R)?{type:R}:Object.assign({},R);if(N){const $=KT(Boolean,N.type),Z=KT(String,N.type);N[0]=$>-1,N[1]=Z<0||$<Z,($>-1||yi(N,"default"))&&s.push(I)}}}const E=[p,s];return Wi(t)&&r.set(t,E),E}function ZT(t){return t[0]!=="$"}function XT(t){const e=t&&t.toString().match(/^\s*function (\w+)/);return e?e[1]:t===null?"null":""}function YT(t,e){return XT(t)===XT(e)}function KT(t,e){return On(e)?e.findIndex(n=>YT(n,t)):Yn(e)&&YT(e,t)?0:-1}const _P=t=>t[0]==="_"||t==="$stable",j1=t=>On(t)?t.map(na):[na(t)],BD=(t,e,n)=>{if(e._n)return e;const r=hx((...c)=>j1(e(...c)),n);return r._c=!1,r},yP=(t,e,n)=>{const r=t._ctx;for(const c in t){if(_P(c))continue;const h=t[c];if(Yn(h))e[c]=BD(c,h,r);else if(h!=null){const p=j1(h);e[c]=()=>p}}},vP=(t,e)=>{const n=j1(e);t.slots.default=()=>n},FD=(t,e)=>{if(t.vnode.shapeFlag&32){const n=e._;n?(t.slots=Oi(e),g_(e,"_",n)):yP(e,t.slots={})}else t.slots={},e&&vP(t,e);g_(t.slots,_y,1)},ND=(t,e,n)=>{const{vnode:r,slots:c}=t;let h=!0,p=Qi;if(r.shapeFlag&32){const s=e._;s?n&&s===1?h=!1:(gs(c,e),!n&&s===1&&delete c._):(h=!e.$stable,yP(e,c)),p=e}else e&&(vP(t,e),p={default:1});if(h)for(const s in c)!_P(s)&&!(s in p)&&delete c[s]};function xP(){return{app:null,config:{isNativeTag:hO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let UD=0;function VD(t,e){return function(r,c=null){Yn(r)||(r=Object.assign({},r)),c!=null&&!Wi(c)&&(c=null);const h=xP(),p=new Set;let s=!1;const v=h.app={_uid:UD++,_component:r,_props:c,_container:null,_context:h,_instance:null,version:oz,get config(){return h.config},set config(E){},use(E,...M){return p.has(E)||(E&&Yn(E.install)?(p.add(E),E.install(v,...M)):Yn(E)&&(p.add(E),E(v,...M))),v},mixin(E){return h.mixins.includes(E)||h.mixins.push(E),v},component(E,M){return M?(h.components[E]=M,v):h.components[E]},directive(E,M){return M?(h.directives[E]=M,v):h.directives[E]},mount(E,M,I){if(!s){const R=gr(r,c);return R.appContext=h,M&&e?e(R,E):t(R,E,I),s=!0,v._container=E,E.__vue_app__=v,yy(R.component)||R.component.proxy}},unmount(){s&&(t(null,v._container),delete v._container.__vue_app__)},provide(E,M){return h.provides[E]=M,v}};return v}}function gx(t,e,n,r,c=!1){if(On(t)){t.forEach((R,N)=>gx(R,e&&(On(e)?e[N]:e),n,r,c));return}if(Ld(r)&&!c)return;const h=r.shapeFlag&4?yy(r.component)||r.component.proxy:r.el,p=c?null:h,{i:s,r:v}=t,E=e&&e.r,M=s.refs===Qi?s.refs={}:s.refs,I=s.setupState;if(E!=null&&E!==v&&(wr(E)?(M[E]=null,yi(I,E)&&(I[E]=null)):Qr(E)&&(E.value=null)),Yn(v))kl(v,s,12,[p,M]);else{const R=wr(v),N=Qr(v);if(R||N){const $=()=>{if(t.f){const Z=R?yi(I,v)?I[v]:M[v]:v.value;c?On(Z)&&P1(Z,h):On(Z)?Z.includes(h)||Z.push(h):R?(M[v]=[h],yi(I,v)&&(I[v]=M[v])):(v.value=[h],t.k&&(M[t.k]=v.value))}else R?(M[v]=p,yi(I,v)&&(I[v]=p)):N&&(v.value=p,t.k&&(M[t.k]=p))};p?($.id=-1,Ss($,n)):$()}}}const Ss=hD;function jD(t){return GD(t)}function GD(t,e){const n=_O();n.__VUE__=!0;const{insert:r,remove:c,patchProp:h,createElement:p,createText:s,createComment:v,setText:E,setElementText:M,parentNode:I,nextSibling:R,setScopeId:N=Io,insertStaticContent:$}=t,Z=(ue,Me,Ve,Qe=null,st=null,St=null,Dt=!1,Pt=null,Mt=!!Me.dynamicChildren)=>{if(ue===Me)return;ue&&!pd(ue,Me)&&(Qe=yt(ue),Kn(ue,st,St,!0),ue=null),Me.patchFlag===-2&&(Mt=!1,Me.dynamicChildren=null);const{type:ht,ref:Zt,shapeFlag:jt}=Me;switch(ht){case gy:ne(ue,Me,Ve,Qe);break;case Dl:me(ue,Me,Ve,Qe);break;case rv:ue==null&&we(Me,Ve,Qe,Dt);break;case Hs:gn(ue,Me,Ve,Qe,st,St,Dt,Pt,Mt);break;default:jt&1?ge(ue,Me,Ve,Qe,st,St,Dt,Pt,Mt):jt&6?an(ue,Me,Ve,Qe,st,St,Dt,Pt,Mt):(jt&64||jt&128)&&ht.process(ue,Me,Ve,Qe,st,St,Dt,Pt,Mt,Jt)}Zt!=null&&st&&gx(Zt,ue&&ue.ref,St,Me||ue,!Me)},ne=(ue,Me,Ve,Qe)=>{if(ue==null)r(Me.el=s(Me.children),Ve,Qe);else{const st=Me.el=ue.el;Me.children!==ue.children&&E(st,Me.children)}},me=(ue,Me,Ve,Qe)=>{ue==null?r(Me.el=v(Me.children||""),Ve,Qe):Me.el=ue.el},we=(ue,Me,Ve,Qe)=>{[ue.el,ue.anchor]=$(ue.children,Me,Ve,Qe,ue.el,ue.anchor)},he=({el:ue,anchor:Me},Ve,Qe)=>{let st;for(;ue&&ue!==Me;)st=R(ue),r(ue,Ve,Qe),ue=st;r(Me,Ve,Qe)},Pe=({el:ue,anchor:Me})=>{let Ve;for(;ue&&ue!==Me;)Ve=R(ue),c(ue),ue=Ve;c(Me)},ge=(ue,Me,Ve,Qe,st,St,Dt,Pt,Mt)=>{Dt=Dt||Me.type==="svg",ue==null?nt(Me,Ve,Qe,st,St,Dt,Pt,Mt):ke(ue,Me,st,St,Dt,Pt,Mt)},nt=(ue,Me,Ve,Qe,st,St,Dt,Pt)=>{let Mt,ht;const{type:Zt,props:jt,shapeFlag:tn,transition:dn,dirs:et}=ue;if(Mt=ue.el=p(ue.type,St,jt&&jt.is,jt),tn&8?M(Mt,ue.children):tn&16&&Rt(ue.children,Mt,null,Qe,st,St&&Zt!=="foreignObject",Dt,Pt),et&&Ec(ue,null,Qe,"created"),jt){for(const G in jt)G!=="value"&&!Yg(G)&&h(Mt,G,null,jt[G],St,ue.children,Qe,st,zt);"value"in jt&&h(Mt,"value",null,jt.value),(ht=jt.onVnodeBeforeMount)&&Jo(ht,Qe,ue)}Tt(Mt,ue,ue.scopeId,Dt,Qe),et&&Ec(ue,null,Qe,"beforeMount");const J=(!st||st&&!st.pendingBranch)&&dn&&!dn.persisted;J&&dn.beforeEnter(Mt),r(Mt,Me,Ve),((ht=jt&&jt.onVnodeMounted)||J||et)&&Ss(()=>{ht&&Jo(ht,Qe,ue),J&&dn.enter(Mt),et&&Ec(ue,null,Qe,"mounted")},st)},Tt=(ue,Me,Ve,Qe,st)=>{if(Ve&&N(ue,Ve),Qe)for(let St=0;St<Qe.length;St++)N(ue,Qe[St]);if(st){let St=st.subTree;if(Me===St){const Dt=st.vnode;Tt(ue,Dt,Dt.scopeId,Dt.slotScopeIds,st.parent)}}},Rt=(ue,Me,Ve,Qe,st,St,Dt,Pt,Mt=0)=>{for(let ht=Mt;ht<ue.length;ht++){const Zt=ue[ht]=Pt?wl(ue[ht]):na(ue[ht]);Z(null,Zt,Me,Ve,Qe,st,St,Dt,Pt)}},ke=(ue,Me,Ve,Qe,st,St,Dt)=>{const Pt=Me.el=ue.el;let{patchFlag:Mt,dynamicChildren:ht,dirs:Zt}=Me;Mt|=ue.patchFlag&16;const jt=ue.props||Qi,tn=Me.props||Qi;let dn;Ve&&Tc(Ve,!1),(dn=tn.onVnodeBeforeUpdate)&&Jo(dn,Ve,Me,ue),Zt&&Ec(Me,ue,Ve,"beforeUpdate"),Ve&&Tc(Ve,!0);const et=st&&Me.type!=="foreignObject";if(ht?It(ue.dynamicChildren,ht,Pt,Ve,Qe,et,St):Dt||vn(ue,Me,Pt,null,Ve,Qe,et,St,!1),Mt>0){if(Mt&16)xt(Pt,Me,jt,tn,Ve,Qe,st);else if(Mt&2&&jt.class!==tn.class&&h(Pt,"class",null,tn.class,st),Mt&4&&h(Pt,"style",jt.style,tn.style,st),Mt&8){const J=Me.dynamicProps;for(let G=0;G<J.length;G++){const Fe=J[G],gt=jt[Fe],ct=tn[Fe];(ct!==gt||Fe==="value")&&h(Pt,Fe,gt,ct,st,ue.children,Ve,Qe,zt)}}Mt&1&&ue.children!==Me.children&&M(Pt,Me.children)}else!Dt&&ht==null&&xt(Pt,Me,jt,tn,Ve,Qe,st);((dn=tn.onVnodeUpdated)||Zt)&&Ss(()=>{dn&&Jo(dn,Ve,Me,ue),Zt&&Ec(Me,ue,Ve,"updated")},Qe)},It=(ue,Me,Ve,Qe,st,St,Dt)=>{for(let Pt=0;Pt<Me.length;Pt++){const Mt=ue[Pt],ht=Me[Pt],Zt=Mt.el&&(Mt.type===Hs||!pd(Mt,ht)||Mt.shapeFlag&70)?I(Mt.el):Ve;Z(Mt,ht,Zt,null,Qe,st,St,Dt,!0)}},xt=(ue,Me,Ve,Qe,st,St,Dt)=>{if(Ve!==Qe){if(Ve!==Qi)for(const Pt in Ve)!Yg(Pt)&&!(Pt in Qe)&&h(ue,Pt,Ve[Pt],null,Dt,Me.children,st,St,zt);for(const Pt in Qe){if(Yg(Pt))continue;const Mt=Qe[Pt],ht=Ve[Pt];Mt!==ht&&Pt!=="value"&&h(ue,Pt,ht,Mt,Dt,Me.children,st,St,zt)}"value"in Qe&&h(ue,"value",Ve.value,Qe.value)}},gn=(ue,Me,Ve,Qe,st,St,Dt,Pt,Mt)=>{const ht=Me.el=ue?ue.el:s(""),Zt=Me.anchor=ue?ue.anchor:s("");let{patchFlag:jt,dynamicChildren:tn,slotScopeIds:dn}=Me;dn&&(Pt=Pt?Pt.concat(dn):dn),ue==null?(r(ht,Ve,Qe),r(Zt,Ve,Qe),Rt(Me.children,Ve,Zt,st,St,Dt,Pt,Mt)):jt>0&&jt&64&&tn&&ue.dynamicChildren?(It(ue.dynamicChildren,tn,Ve,st,St,Dt,Pt),(Me.key!=null||st&&Me===st.subTree)&&bP(ue,Me,!0)):vn(ue,Me,Ve,Zt,st,St,Dt,Pt,Mt)},an=(ue,Me,Ve,Qe,st,St,Dt,Pt,Mt)=>{Me.slotScopeIds=Pt,ue==null?Me.shapeFlag&512?st.ctx.activate(Me,Ve,Qe,Dt,Mt):ln(Me,Ve,Qe,st,St,Dt,Mt):$t(ue,Me,Mt)},ln=(ue,Me,Ve,Qe,st,St,Dt)=>{const Pt=ue.component=KD(ue,Qe,st);if(uP(ue)&&(Pt.ctx.renderer=Jt),JD(Pt),Pt.asyncDep){if(st&&st.registerDep(Pt,Mn),!ue.el){const Mt=Pt.subTree=gr(Dl);me(null,Mt,Me,Ve)}return}Mn(Pt,ue,Me,Ve,st,St,Dt)},$t=(ue,Me,Ve)=>{const Qe=Me.component=ue.component;if(lD(ue,Me,Ve))if(Qe.asyncDep&&!Qe.asyncResolved){yn(Qe,Me,Ve);return}else Qe.next=Me,eD(Qe.update),Qe.update();else Me.el=ue.el,Qe.vnode=Me},Mn=(ue,Me,Ve,Qe,st,St,Dt)=>{const Pt=()=>{if(ue.isMounted){let{next:Zt,bu:jt,u:tn,parent:dn,vnode:et}=ue,J=Zt,G;Tc(ue,!1),Zt?(Zt.el=et.el,yn(ue,Zt,Dt)):Zt=et,jt&&Jg(jt),(G=Zt.props&&Zt.props.onVnodeBeforeUpdate)&&Jo(G,dn,Zt,et),Tc(ue,!0);const Fe=nv(ue),gt=ue.subTree;ue.subTree=Fe,Z(gt,Fe,I(gt.el),yt(gt),ue,st,St),Zt.el=Fe.el,J===null&&cD(ue,Fe.el),tn&&Ss(tn,st),(G=Zt.props&&Zt.props.onVnodeUpdated)&&Ss(()=>Jo(G,dn,Zt,et),st)}else{let Zt;const{el:jt,props:tn}=Me,{bm:dn,m:et,parent:J}=ue,G=Ld(Me);if(Tc(ue,!1),dn&&Jg(dn),!G&&(Zt=tn&&tn.onVnodeBeforeMount)&&Jo(Zt,J,Me),Tc(ue,!0),jt&&wn){const Fe=()=>{ue.subTree=nv(ue),wn(jt,ue.subTree,ue,st,null)};G?Me.type.__asyncLoader().then(()=>!ue.isUnmounted&&Fe()):Fe()}else{const Fe=ue.subTree=nv(ue);Z(null,Fe,Ve,Qe,ue,st,St),Me.el=Fe.el}if(et&&Ss(et,st),!G&&(Zt=tn&&tn.onVnodeMounted)){const Fe=Me;Ss(()=>Jo(Zt,J,Fe),st)}(Me.shapeFlag&256||J&&Ld(J.vnode)&&J.vnode.shapeFlag&256)&&ue.a&&Ss(ue.a,st),ue.isMounted=!0,Me=Ve=Qe=null}},Mt=ue.effect=new L1(Pt,()=>N1(ht),ue.scope),ht=ue.update=()=>Mt.run();ht.id=ue.uid,Tc(ue,!0),ht()},yn=(ue,Me,Ve)=>{Me.component=ue;const Qe=ue.vnode.props;ue.vnode=Me,ue.next=null,zD(ue,Me.props,Qe,Ve),ND(ue,Me.children,Ve),$h(),jT(),Hh()},vn=(ue,Me,Ve,Qe,st,St,Dt,Pt,Mt=!1)=>{const ht=ue&&ue.children,Zt=ue?ue.shapeFlag:0,jt=Me.children,{patchFlag:tn,shapeFlag:dn}=Me;if(tn>0){if(tn&128){Wn(ht,jt,Ve,Qe,st,St,Dt,Pt,Mt);return}else if(tn&256){Bn(ht,jt,Ve,Qe,st,St,Dt,Pt,Mt);return}}dn&8?(Zt&16&&zt(ht,st,St),jt!==ht&&M(Ve,jt)):Zt&16?dn&16?Wn(ht,jt,Ve,Qe,st,St,Dt,Pt,Mt):zt(ht,st,St,!0):(Zt&8&&M(Ve,""),dn&16&&Rt(jt,Ve,Qe,st,St,Dt,Pt,Mt))},Bn=(ue,Me,Ve,Qe,st,St,Dt,Pt,Mt)=>{ue=ue||hh,Me=Me||hh;const ht=ue.length,Zt=Me.length,jt=Math.min(ht,Zt);let tn;for(tn=0;tn<jt;tn++){const dn=Me[tn]=Mt?wl(Me[tn]):na(Me[tn]);Z(ue[tn],dn,Ve,null,st,St,Dt,Pt,Mt)}ht>Zt?zt(ue,st,St,!0,!1,jt):Rt(Me,Ve,Qe,st,St,Dt,Pt,Mt,jt)},Wn=(ue,Me,Ve,Qe,st,St,Dt,Pt,Mt)=>{let ht=0;const Zt=Me.length;let jt=ue.length-1,tn=Zt-1;for(;ht<=jt&&ht<=tn;){const dn=ue[ht],et=Me[ht]=Mt?wl(Me[ht]):na(Me[ht]);if(pd(dn,et))Z(dn,et,Ve,null,st,St,Dt,Pt,Mt);else break;ht++}for(;ht<=jt&&ht<=tn;){const dn=ue[jt],et=Me[tn]=Mt?wl(Me[tn]):na(Me[tn]);if(pd(dn,et))Z(dn,et,Ve,null,st,St,Dt,Pt,Mt);else break;jt--,tn--}if(ht>jt){if(ht<=tn){const dn=tn+1,et=dn<Zt?Me[dn].el:Qe;for(;ht<=tn;)Z(null,Me[ht]=Mt?wl(Me[ht]):na(Me[ht]),Ve,et,st,St,Dt,Pt,Mt),ht++}}else if(ht>tn)for(;ht<=jt;)Kn(ue[ht],st,St,!0),ht++;else{const dn=ht,et=ht,J=new Map;for(ht=et;ht<=tn;ht++){const nn=Me[ht]=Mt?wl(Me[ht]):na(Me[ht]);nn.key!=null&&J.set(nn.key,ht)}let G,Fe=0;const gt=tn-et+1;let ct=!1,sn=0;const fn=new Array(gt);for(ht=0;ht<gt;ht++)fn[ht]=0;for(ht=dn;ht<=jt;ht++){const nn=ue[ht];if(Fe>=gt){Kn(nn,st,St,!0);continue}let ei;if(nn.key!=null)ei=J.get(nn.key);else for(G=et;G<=tn;G++)if(fn[G-et]===0&&pd(nn,Me[G])){ei=G;break}ei===void 0?Kn(nn,st,St,!0):(fn[ei-et]=ht+1,ei>=sn?sn=ei:ct=!0,Z(nn,Me[ei],Ve,null,st,St,Dt,Pt,Mt),Fe++)}const $n=ct?$D(fn):hh;for(G=$n.length-1,ht=gt-1;ht>=0;ht--){const nn=et+ht,ei=Me[nn],qi=nn+1<Zt?Me[nn+1].el:Qe;fn[ht]===0?Z(null,ei,Ve,qi,st,St,Dt,Pt,Mt):ct&&(G<0||ht!==$n[G]?pi(ei,Ve,qi,2):G--)}}},pi=(ue,Me,Ve,Qe,st=null)=>{const{el:St,type:Dt,transition:Pt,children:Mt,shapeFlag:ht}=ue;if(ht&6){pi(ue.component.subTree,Me,Ve,Qe);return}if(ht&128){ue.suspense.move(Me,Ve,Qe);return}if(ht&64){Dt.move(ue,Me,Ve,Jt);return}if(Dt===Hs){r(St,Me,Ve);for(let jt=0;jt<Mt.length;jt++)pi(Mt[jt],Me,Ve,Qe);r(ue.anchor,Me,Ve);return}if(Dt===rv){he(ue,Me,Ve);return}if(Qe!==2&&ht&1&&Pt)if(Qe===0)Pt.beforeEnter(St),r(St,Me,Ve),Ss(()=>Pt.enter(St),st);else{const{leave:jt,delayLeave:tn,afterLeave:dn}=Pt,et=()=>r(St,Me,Ve),J=()=>{jt(St,()=>{et(),dn&&dn()})};tn?tn(St,et,J):J()}else r(St,Me,Ve)},Kn=(ue,Me,Ve,Qe=!1,st=!1)=>{const{type:St,props:Dt,ref:Pt,children:Mt,dynamicChildren:ht,shapeFlag:Zt,patchFlag:jt,dirs:tn}=ue;if(Pt!=null&&gx(Pt,null,Ve,ue,!0),Zt&256){Me.ctx.deactivate(ue);return}const dn=Zt&1&&tn,et=!Ld(ue);let J;if(et&&(J=Dt&&Dt.onVnodeBeforeUnmount)&&Jo(J,Me,ue),Zt&6)lt(ue.component,Ve,Qe);else{if(Zt&128){ue.suspense.unmount(Ve,Qe);return}dn&&Ec(ue,null,Me,"beforeUnmount"),Zt&64?ue.type.remove(ue,Me,Ve,st,Jt,Qe):ht&&(St!==Hs||jt>0&&jt&64)?zt(ht,Me,Ve,!1,!0):(St===Hs&&jt&384||!st&&Zt&16)&&zt(Mt,Me,Ve),Qe&&Ii(ue)}(et&&(J=Dt&&Dt.onVnodeUnmounted)||dn)&&Ss(()=>{J&&Jo(J,Me,ue),dn&&Ec(ue,null,Me,"unmounted")},Ve)},Ii=ue=>{const{type:Me,el:Ve,anchor:Qe,transition:st}=ue;if(Me===Hs){vi(Ve,Qe);return}if(Me===rv){Pe(ue);return}const St=()=>{c(Ve),st&&!st.persisted&&st.afterLeave&&st.afterLeave()};if(ue.shapeFlag&1&&st&&!st.persisted){const{leave:Dt,delayLeave:Pt}=st,Mt=()=>Dt(Ve,St);Pt?Pt(ue.el,St,Mt):Mt()}else St()},vi=(ue,Me)=>{let Ve;for(;ue!==Me;)Ve=R(ue),c(ue),ue=Ve;c(Me)},lt=(ue,Me,Ve)=>{const{bum:Qe,scope:st,update:St,subTree:Dt,um:Pt}=ue;Qe&&Jg(Qe),st.stop(),St&&(St.active=!1,Kn(Dt,ue,Me,Ve)),Pt&&Ss(Pt,Me),Ss(()=>{ue.isUnmounted=!0},Me),Me&&Me.pendingBranch&&!Me.isUnmounted&&ue.asyncDep&&!ue.asyncResolved&&ue.suspenseId===Me.pendingId&&(Me.deps--,Me.deps===0&&Me.resolve())},zt=(ue,Me,Ve,Qe=!1,st=!1,St=0)=>{for(let Dt=St;Dt<ue.length;Dt++)Kn(ue[Dt],Me,Ve,Qe,st)},yt=ue=>ue.shapeFlag&6?yt(ue.component.subTree):ue.shapeFlag&128?ue.suspense.next():R(ue.anchor||ue.el),Ft=(ue,Me,Ve)=>{ue==null?Me._vnode&&Kn(Me._vnode,null,null,!0):Z(Me._vnode||null,ue,Me,null,null,null,Ve),jT(),sP(),Me._vnode=ue},Jt={p:Z,um:Kn,m:pi,r:Ii,mt:ln,mc:Rt,pc:vn,pbc:It,n:yt,o:t};let xn,wn;return e&&([xn,wn]=e(Jt)),{render:Ft,hydrate:xn,createApp:VD(Ft,xn)}}function Tc({effect:t,update:e},n){t.allowRecurse=e.allowRecurse=n}function bP(t,e,n=!1){const r=t.children,c=e.children;if(On(r)&&On(c))for(let h=0;h<r.length;h++){const p=r[h];let s=c[h];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=c[h]=wl(c[h]),s.el=p.el),n||bP(p,s)),s.type===gy&&(s.el=p.el)}}function $D(t){const e=t.slice(),n=[0];let r,c,h,p,s;const v=t.length;for(r=0;r<v;r++){const E=t[r];if(E!==0){if(c=n[n.length-1],t[c]<E){e[r]=c,n.push(r);continue}for(h=0,p=n.length-1;h<p;)s=h+p>>1,t[n[s]]<E?h=s+1:p=s;E<t[n[h]]&&(h>0&&(e[r]=n[h-1]),n[h]=r)}}for(h=n.length,p=n[h-1];h-- >0;)n[h]=p,p=e[p];return n}const HD=t=>t.__isTeleport,Hs=Symbol(void 0),gy=Symbol(void 0),Dl=Symbol(void 0),rv=Symbol(void 0),Rd=[];let So=null;function Kr(t=!1){Rd.push(So=t?null:[])}function WD(){Rd.pop(),So=Rd[Rd.length-1]||null}let Jd=1;function JT(t){Jd+=t}function wP(t){return t.dynamicChildren=Jd>0?So||hh:null,WD(),Jd>0&&So&&So.push(t),t}function Is(t,e,n,r,c,h){return wP(en(t,e,n,r,c,h,!0))}function G1(t,e,n,r,c){return wP(gr(t,e,n,r,c,!0))}function x_(t){return t?t.__v_isVNode===!0:!1}function pd(t,e){return t.type===e.type&&t.key===e.key}const _y="__vInternal",EP=({key:t})=>t??null,e_=({ref:t,ref_key:e,ref_for:n})=>t!=null?wr(t)||Qr(t)||Yn(t)?{i:es,r:t,k:e,f:!!n}:t:null;function en(t,e=null,n=null,r=0,c=null,h=t===Hs?0:1,p=!1,s=!1){const v={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&EP(e),ref:e&&e_(e),scopeId:py,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:h,patchFlag:r,dynamicProps:c,dynamicChildren:null,appContext:null,ctx:es};return s?($1(v,n),h&128&&t.normalize(v)):n&&(v.shapeFlag|=wr(n)?8:16),Jd>0&&!p&&So&&(v.patchFlag>0||h&6)&&v.patchFlag!==32&&So.push(v),v}const gr=qD;function qD(t,e=null,n=null,r=0,c=null,h=!1){if((!t||t===AD)&&(t=Dl),x_(t)){const s=bh(t,e,!0);return n&&$1(s,n),Jd>0&&!h&&So&&(s.shapeFlag&6?So[So.indexOf(t)]=s:So.push(s)),s.patchFlag|=-2,s}if(iz(t)&&(t=t.__vccOpts),e){e=TP(e);let{class:s,style:v}=e;s&&!wr(s)&&(e.class=vh(s)),Wi(v)&&(YM(v)&&!On(v)&&(v=gs({},v)),e.style=oy(v))}const p=wr(t)?1:uD(t)?128:HD(t)?64:Wi(t)?4:Yn(t)?2:0;return en(t,e,n,r,c,p,h,!0)}function TP(t){return t?YM(t)||_y in t?gs({},t):t:null}function bh(t,e,n=!1){const{props:r,ref:c,patchFlag:h,children:p}=t,s=e?AP(r||{},e):r;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:s,key:s&&EP(s),ref:e&&e.ref?n&&c?On(c)?c.concat(e_(e)):[c,e_(e)]:e_(e):c,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:p,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==Hs?h===-1?16:h|16:h,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&bh(t.ssContent),ssFallback:t.ssFallback&&bh(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx}}function ZD(t=" ",e=0){return gr(gy,null,t,e)}function sv(t="",e=!1){return e?(Kr(),G1(Dl,null,t)):gr(Dl,null,t)}function na(t){return t==null||typeof t=="boolean"?gr(Dl):On(t)?gr(Hs,null,t.slice()):typeof t=="object"?wl(t):gr(gy,null,String(t))}function wl(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:bh(t)}function $1(t,e){let n=0;const{shapeFlag:r}=t;if(e==null)e=null;else if(On(e))n=16;else if(typeof e=="object")if(r&65){const c=e.default;c&&(c._c&&(c._d=!1),$1(t,c()),c._c&&(c._d=!0));return}else{n=32;const c=e._;!c&&!(_y in e)?e._ctx=es:c===3&&es&&(es.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Yn(e)?(e={default:e,_ctx:es},n=32):(e=String(e),r&64?(n=16,e=[ZD(e)]):n=8);t.children=e,t.shapeFlag|=n}function AP(...t){const e={};for(let n=0;n<t.length;n++){const r=t[n];for(const c in r)if(c==="class")e.class!==r.class&&(e.class=vh([e.class,r.class]));else if(c==="style")e.style=oy([e.style,r.style]);else if(ay(c)){const h=e[c],p=r[c];p&&h!==p&&!(On(h)&&h.includes(p))&&(e[c]=h?[].concat(h,p):p)}else c!==""&&(e[c]=r[c])}return e}function Jo(t,e,n,r=null){Co(t,e,7,[n,r])}const XD=xP();let YD=0;function KD(t,e,n){const r=t.type,c=(e?e.appContext:t.appContext)||XD,h={uid:YD++,vnode:t,type:r,parent:e,appContext:c,root:null,next:null,subTree:null,effect:null,update:null,scope:new yO(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(c.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:gP(r,c),emitsOptions:aP(r,c),emit:null,emitted:null,propsDefaults:Qi,inheritAttrs:r.inheritAttrs,ctx:Qi,data:Qi,props:Qi,attrs:Qi,slots:Qi,refs:Qi,setupState:Qi,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return h.ctx={_:h},h.root=e?e.root:h,h.emit=iD.bind(null,h),t.ce&&t.ce(h),h}let Gr=null;const SP=()=>Gr||es,wh=t=>{Gr=t,t.scope.on()},jc=()=>{Gr&&Gr.scope.off(),Gr=null};function MP(t){return t.vnode.shapeFlag&4}let Qd=!1;function JD(t,e=!1){Qd=e;const{props:n,children:r}=t.vnode,c=MP(t);DD(t,n,c,e),FD(t,r);const h=c?QD(t,e):void 0;return Qd=!1,h}function QD(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=Cd(new Proxy(t.ctx,ID));const{setup:r}=n;if(r){const c=t.setupContext=r.length>1?tz(t):null;wh(t),$h();const h=kl(r,t,0,[t.props,c]);if(Hh(),jc(),zM(h)){if(h.then(jc,jc),e)return h.then(p=>{QT(t,p,e)}).catch(p=>{fy(p,t,0)});t.asyncDep=h}else QT(t,h,e)}else PP(t,e)}function QT(t,e,n){Yn(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:Wi(e)&&(t.setupState=eP(e)),PP(t,n)}let e2;function PP(t,e,n){const r=t.type;if(!t.render){if(!e&&e2&&!r.render){const c=r.template||V1(t).template;if(c){const{isCustomElement:h,compilerOptions:p}=t.appContext.config,{delimiters:s,compilerOptions:v}=r,E=gs(gs({isCustomElement:h,delimiters:s},p),v);r.render=e2(c,E)}}t.render=r.render||Io}wh(t),$h(),CD(t),Hh(),jc()}function ez(t){return new Proxy(t.attrs,{get(e,n){return Xs(t,"get","$attrs"),e[n]}})}function tz(t){const e=r=>{t.exposed=r||{}};let n;return{get attrs(){return n||(n=ez(t))},slots:t.slots,emit:t.emit,expose:e}}function yy(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(eP(Cd(t.exposed)),{get(e,n){if(n in e)return e[n];if(n in kd)return kd[n](t)},has(e,n){return n in e||n in kd}}))}function nz(t,e=!0){return Yn(t)?t.displayName||t.name:t.name||e&&t.__name}function iz(t){return Yn(t)&&"__vccOpts"in t}const Ri=(t,e)=>KO(t,e,Qd);function H1(t,e,n){const r=arguments.length;return r===2?Wi(e)&&!On(e)?x_(e)?gr(t,null,[e]):gr(t,e):gr(t,null,e):(r>3?n=Array.prototype.slice.call(arguments,2):r===3&&x_(n)&&(n=[n]),gr(t,e,n))}const rz=Symbol(""),sz=()=>Lo(rz),oz="3.2.45",az="http://www.w3.org/2000/svg",Rc=typeof document<"u"?document:null,t2=Rc&&Rc.createElement("template"),lz={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,r)=>{const c=e?Rc.createElementNS(az,t):Rc.createElement(t,n?{is:n}:void 0);return t==="select"&&r&&r.multiple!=null&&c.setAttribute("multiple",r.multiple),c},createText:t=>Rc.createTextNode(t),createComment:t=>Rc.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Rc.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,n,r,c,h){const p=n?n.previousSibling:e.lastChild;if(c&&(c===h||c.nextSibling))for(;e.insertBefore(c.cloneNode(!0),n),!(c===h||!(c=c.nextSibling)););else{t2.innerHTML=r?`<svg>${t}</svg>`:t;const s=t2.content;if(r){const v=s.firstChild;for(;v.firstChild;)s.appendChild(v.firstChild);s.removeChild(v)}e.insertBefore(s,n)}return[p?p.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}};function cz(t,e,n){const r=t._vtc;r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}function uz(t,e,n){const r=t.style,c=wr(n);if(n&&!c){for(const h in n)_x(r,h,n[h]);if(e&&!wr(e))for(const h in e)n[h]==null&&_x(r,h,"")}else{const h=r.display;c?e!==n&&(r.cssText=n):e&&t.removeAttribute("style"),"_vod"in t&&(r.display=h)}}const n2=/\s*!important$/;function _x(t,e,n){if(On(n))n.forEach(r=>_x(t,e,r));else if(n==null&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const r=hz(t,e);n2.test(n)?t.setProperty(Gh(r),n.replace(n2,""),"important"):t[r]=n}}const i2=["Webkit","Moz","ms"],ov={};function hz(t,e){const n=ov[e];if(n)return n;let r=ca(e);if(r!=="filter"&&r in t)return ov[e]=r;r=cy(r);for(let c=0;c<i2.length;c++){const h=i2[c]+r;if(h in t)return ov[e]=h}return e}const r2="http://www.w3.org/1999/xlink";function fz(t,e,n,r,c){if(r&&e.startsWith("xlink:"))n==null?t.removeAttributeNS(r2,e.slice(6,e.length)):t.setAttributeNS(r2,e,n);else{const h=cO(e);n==null||h&&!OM(n)?t.removeAttribute(e):t.setAttribute(e,h?"":n)}}function dz(t,e,n,r,c,h,p){if(e==="innerHTML"||e==="textContent"){r&&p(r,c,h),t[e]=n??"";return}if(e==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=n;const v=n??"";(t.value!==v||t.tagName==="OPTION")&&(t.value=v),n==null&&t.removeAttribute(e);return}let s=!1;if(n===""||n==null){const v=typeof t[e];v==="boolean"?n=OM(n):n==null&&v==="string"?(n="",s=!0):v==="number"&&(n=0,s=!0)}try{t[e]=n}catch{}s&&t.removeAttribute(e)}function Ml(t,e,n,r){t.addEventListener(e,n,r)}function pz(t,e,n,r){t.removeEventListener(e,n,r)}function mz(t,e,n,r,c=null){const h=t._vei||(t._vei={}),p=h[e];if(r&&p)p.value=r;else{const[s,v]=gz(e);if(r){const E=h[e]=vz(r,c);Ml(t,s,E,v)}else p&&(pz(t,s,p,v),h[e]=void 0)}}const s2=/(?:Once|Passive|Capture)$/;function gz(t){let e;if(s2.test(t)){e={};let r;for(;r=t.match(s2);)t=t.slice(0,t.length-r[0].length),e[r[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Gh(t.slice(2)),e]}let av=0;const _z=Promise.resolve(),yz=()=>av||(_z.then(()=>av=0),av=Date.now());function vz(t,e){const n=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=n.attached)return;Co(xz(r,n.value),e,5,[r])};return n.value=t,n.attached=yz(),n}function xz(t,e){if(On(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(r=>c=>!c._stopped&&r&&r(c))}else return e}const o2=/^on[a-z]/,bz=(t,e,n,r,c=!1,h,p,s,v)=>{e==="class"?cz(t,r,c):e==="style"?uz(t,n,r):ay(e)?M1(e)||mz(t,e,n,r,p):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):wz(t,e,r,c))?dz(t,e,r,h,p,s,v):(e==="true-value"?t._trueValue=r:e==="false-value"&&(t._falseValue=r),fz(t,e,r,c))};function wz(t,e,n,r){return r?!!(e==="innerHTML"||e==="textContent"||e in t&&o2.test(e)&&Yn(n)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA"||o2.test(e)&&wr(n)?!1:e in t}const Eh=t=>{const e=t.props["onUpdate:modelValue"]||!1;return On(e)?n=>Jg(e,n):e};function Ez(t){t.target.composing=!0}function a2(t){const e=t.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const md={created(t,{modifiers:{lazy:e,trim:n,number:r}},c){t._assign=Eh(c);const h=r||c.props&&c.props.type==="number";Ml(t,e?"change":"input",p=>{if(p.target.composing)return;let s=t.value;n&&(s=s.trim()),h&&(s=Zd(s)),t._assign(s)}),n&&Ml(t,"change",()=>{t.value=t.value.trim()}),e||(Ml(t,"compositionstart",Ez),Ml(t,"compositionend",a2),Ml(t,"change",a2))},mounted(t,{value:e}){t.value=e??""},beforeUpdate(t,{value:e,modifiers:{lazy:n,trim:r,number:c}},h){if(t._assign=Eh(h),t.composing||document.activeElement===t&&t.type!=="range"&&(n||r&&t.value.trim()===e||(c||t.type==="number")&&Zd(t.value)===e))return;const p=e??"";t.value!==p&&(t.value=p)}},lv={deep:!0,created(t,e,n){t._assign=Eh(n),Ml(t,"change",()=>{const r=t._modelValue,c=ep(t),h=t.checked,p=t._assign;if(On(r)){const s=S1(r,c),v=s!==-1;if(h&&!v)p(r.concat(c));else if(!h&&v){const E=[...r];E.splice(s,1),p(E)}}else if(jh(r)){const s=new Set(r);h?s.add(c):s.delete(c),p(s)}else p(IP(t,h))})},mounted:l2,beforeUpdate(t,e,n){t._assign=Eh(n),l2(t,e,n)}};function l2(t,{value:e,oldValue:n},r){t._modelValue=e,On(e)?t.checked=S1(e,r.props.value)>-1:jh(e)?t.checked=e.has(r.props.value):e!==n&&(t.checked=xp(e,IP(t,!0)))}const Tz={deep:!0,created(t,{value:e,modifiers:{number:n}},r){const c=jh(e);Ml(t,"change",()=>{const h=Array.prototype.filter.call(t.options,p=>p.selected).map(p=>n?Zd(ep(p)):ep(p));t._assign(t.multiple?c?new Set(h):h:h[0])}),t._assign=Eh(r)},mounted(t,{value:e}){c2(t,e)},beforeUpdate(t,e,n){t._assign=Eh(n)},updated(t,{value:e}){c2(t,e)}};function c2(t,e){const n=t.multiple;if(!(n&&!On(e)&&!jh(e))){for(let r=0,c=t.options.length;r<c;r++){const h=t.options[r],p=ep(h);if(n)On(e)?h.selected=S1(e,p)>-1:h.selected=e.has(p);else if(xp(ep(h),e)){t.selectedIndex!==r&&(t.selectedIndex=r);return}}!n&&t.selectedIndex!==-1&&(t.selectedIndex=-1)}}function ep(t){return"_value"in t?t._value:t.value}function IP(t,e){const n=e?"_trueValue":"_falseValue";return n in t?t[n]:e}const Az=["ctrl","shift","alt","meta"],Sz={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>Az.some(n=>t[`${n}Key`]&&!e.includes(n))},Mz=(t,e)=>(n,...r)=>{for(let c=0;c<e.length;c++){const h=Sz[e[c]];if(h&&h(n,e))return}return t(n,...r)},Pz=gs({patchProp:bz},lz);let u2;function Iz(){return u2||(u2=jD(Pz))}const Cz=(...t)=>{const e=Iz().createApp(...t),{mount:n}=e;return e.mount=r=>{const c=Lz(r);if(!c)return;const h=e._component;!Yn(h)&&!h.render&&!h.template&&(h.template=c.innerHTML),c.innerHTML="";const p=n(c,!1,c instanceof SVGElement);return c instanceof Element&&(c.removeAttribute("v-cloak"),c.setAttribute("data-v-app","")),p},e};function Lz(t){return wr(t)?document.querySelector(t):t}function kz(t,e){return Kr(),Is("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[en("path",{d:"M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z"}),en("path",{d:"M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z"})])}function Rz(t,e){return Kr(),Is("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[en("path",{"fill-rule":"evenodd",d:"M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z","clip-rule":"evenodd"})])}/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const rh=typeof window<"u";function Oz(t){return t.__esModule||t[Symbol.toStringTag]==="Module"}const Ni=Object.assign;function cv(t,e){const n={};for(const r in e){const c=e[r];n[r]=Ro(c)?c.map(t):t(c)}return n}const Od=()=>{},Ro=Array.isArray,Dz=/\/$/,zz=t=>t.replace(Dz,"");function uv(t,e,n="/"){let r,c={},h="",p="";const s=e.indexOf("#");let v=e.indexOf("?");return s<v&&s>=0&&(v=-1),v>-1&&(r=e.slice(0,v),h=e.slice(v+1,s>-1?s:e.length),c=t(h)),s>-1&&(r=r||e.slice(0,s),p=e.slice(s,e.length)),r=Uz(r??e,n),{fullPath:r+(h&&"?")+h+p,path:r,query:c,hash:p}}function Bz(t,e){const n=e.query?t(e.query):"";return e.path+(n&&"?")+n+(e.hash||"")}function h2(t,e){return!e||!t.toLowerCase().startsWith(e.toLowerCase())?t:t.slice(e.length)||"/"}function Fz(t,e,n){const r=e.matched.length-1,c=n.matched.length-1;return r>-1&&r===c&&Th(e.matched[r],n.matched[c])&&CP(e.params,n.params)&&t(e.query)===t(n.query)&&e.hash===n.hash}function Th(t,e){return(t.aliasOf||t)===(e.aliasOf||e)}function CP(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!Nz(t[n],e[n]))return!1;return!0}function Nz(t,e){return Ro(t)?f2(t,e):Ro(e)?f2(e,t):t===e}function f2(t,e){return Ro(e)?t.length===e.length&&t.every((n,r)=>n===e[r]):t.length===1&&t[0]===e}function Uz(t,e){if(t.startsWith("/"))return t;if(!t)return e;const n=e.split("/"),r=t.split("/");let c=n.length-1,h,p;for(h=0;h<r.length;h++)if(p=r[h],p!==".")if(p==="..")c>1&&c--;else break;return n.slice(0,c).join("/")+"/"+r.slice(h-(h===r.length?1:0)).join("/")}var tp;(function(t){t.pop="pop",t.push="push"})(tp||(tp={}));var Dd;(function(t){t.back="back",t.forward="forward",t.unknown=""})(Dd||(Dd={}));function Vz(t){if(!t)if(rh){const e=document.querySelector("base");t=e&&e.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),zz(t)}const jz=/^[^#]+#/;function Gz(t,e){return t.replace(jz,"#")+e}function $z(t,e){const n=document.documentElement.getBoundingClientRect(),r=t.getBoundingClientRect();return{behavior:e.behavior,left:r.left-n.left-(e.left||0),top:r.top-n.top-(e.top||0)}}const vy=()=>({left:window.pageXOffset,top:window.pageYOffset});function Hz(t){let e;if("el"in t){const n=t.el,r=typeof n=="string"&&n.startsWith("#"),c=typeof n=="string"?r?document.getElementById(n.slice(1)):document.querySelector(n):n;if(!c)return;e=$z(c,t)}else e=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.pageXOffset,e.top!=null?e.top:window.pageYOffset)}function d2(t,e){return(history.state?history.state.position-e:-1)+t}const yx=new Map;function Wz(t,e){yx.set(t,e)}function qz(t){const e=yx.get(t);return yx.delete(t),e}let Zz=()=>location.protocol+"//"+location.host;function LP(t,e){const{pathname:n,search:r,hash:c}=e,h=t.indexOf("#");if(h>-1){let s=c.includes(t.slice(h))?t.slice(h).length:1,v=c.slice(s);return v[0]!=="/"&&(v="/"+v),h2(v,"")}return h2(n,t)+r+c}function Xz(t,e,n,r){let c=[],h=[],p=null;const s=({state:R})=>{const N=LP(t,location),$=n.value,Z=e.value;let ne=0;if(R){if(n.value=N,e.value=R,p&&p===$){p=null;return}ne=Z?R.position-Z.position:0}else r(N);c.forEach(me=>{me(n.value,$,{delta:ne,type:tp.pop,direction:ne?ne>0?Dd.forward:Dd.back:Dd.unknown})})};function v(){p=n.value}function E(R){c.push(R);const N=()=>{const $=c.indexOf(R);$>-1&&c.splice($,1)};return h.push(N),N}function M(){const{history:R}=window;!R.state||R.replaceState(Ni({},R.state,{scroll:vy()}),"")}function I(){for(const R of h)R();h=[],window.removeEventListener("popstate",s),window.removeEventListener("beforeunload",M)}return window.addEventListener("popstate",s),window.addEventListener("beforeunload",M),{pauseListeners:v,listen:E,destroy:I}}function p2(t,e,n,r=!1,c=!1){return{back:t,current:e,forward:n,replaced:r,position:window.history.length,scroll:c?vy():null}}function Yz(t){const{history:e,location:n}=window,r={value:LP(t,n)},c={value:e.state};c.value||h(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function h(v,E,M){const I=t.indexOf("#"),R=I>-1?(n.host&&document.querySelector("base")?t:t.slice(I))+v:Zz()+t+v;try{e[M?"replaceState":"pushState"](E,"",R),c.value=E}catch(N){console.error(N),n[M?"replace":"assign"](R)}}function p(v,E){const M=Ni({},e.state,p2(c.value.back,v,c.value.forward,!0),E,{position:c.value.position});h(v,M,!0),r.value=v}function s(v,E){const M=Ni({},c.value,e.state,{forward:v,scroll:vy()});h(M.current,M,!0);const I=Ni({},p2(r.value,v,null),{position:M.position+1},E);h(v,I,!1),r.value=v}return{location:r,state:c,push:s,replace:p}}function Kz(t){t=Vz(t);const e=Yz(t),n=Xz(t,e.state,e.location,e.replace);function r(h,p=!0){p||n.pauseListeners(),history.go(h)}const c=Ni({location:"",base:t,go:r,createHref:Gz.bind(null,t)},e,n);return Object.defineProperty(c,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(c,"state",{enumerable:!0,get:()=>e.state.value}),c}function Jz(t){return typeof t=="string"||t&&typeof t=="object"}function kP(t){return typeof t=="string"||typeof t=="symbol"}const gl={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},RP=Symbol("");var m2;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(m2||(m2={}));function Ah(t,e){return Ni(new Error,{type:t,[RP]:!0},e)}function Pa(t,e){return t instanceof Error&&RP in t&&(e==null||!!(t.type&e))}const g2="[^/]+?",Qz={sensitive:!1,strict:!1,start:!0,end:!0},eB=/[.+*?^${}()[\]/\\]/g;function tB(t,e){const n=Ni({},Qz,e),r=[];let c=n.start?"^":"";const h=[];for(const E of t){const M=E.length?[]:[90];n.strict&&!E.length&&(c+="/");for(let I=0;I<E.length;I++){const R=E[I];let N=40+(n.sensitive?.25:0);if(R.type===0)I||(c+="/"),c+=R.value.replace(eB,"\\$&"),N+=40;else if(R.type===1){const{value:$,repeatable:Z,optional:ne,regexp:me}=R;h.push({name:$,repeatable:Z,optional:ne});const we=me||g2;if(we!==g2){N+=10;try{new RegExp(`(${we})`)}catch(Pe){throw new Error(`Invalid custom RegExp for param "${$}" (${we}): `+Pe.message)}}let he=Z?`((?:${we})(?:/(?:${we}))*)`:`(${we})`;I||(he=ne&&E.length<2?`(?:/${he})`:"/"+he),ne&&(he+="?"),c+=he,N+=20,ne&&(N+=-8),Z&&(N+=-20),we===".*"&&(N+=-50)}M.push(N)}r.push(M)}if(n.strict&&n.end){const E=r.length-1;r[E][r[E].length-1]+=.7000000000000001}n.strict||(c+="/?"),n.end?c+="$":n.strict&&(c+="(?:/|$)");const p=new RegExp(c,n.sensitive?"":"i");function s(E){const M=E.match(p),I={};if(!M)return null;for(let R=1;R<M.length;R++){const N=M[R]||"",$=h[R-1];I[$.name]=N&&$.repeatable?N.split("/"):N}return I}function v(E){let M="",I=!1;for(const R of t){(!I||!M.endsWith("/"))&&(M+="/"),I=!1;for(const N of R)if(N.type===0)M+=N.value;else if(N.type===1){const{value:$,repeatable:Z,optional:ne}=N,me=$ in E?E[$]:"";if(Ro(me)&&!Z)throw new Error(`Provided param "${$}" is an array but it is not repeatable (* or + modifiers)`);const we=Ro(me)?me.join("/"):me;if(!we)if(ne)R.length<2&&(M.endsWith("/")?M=M.slice(0,-1):I=!0);else throw new Error(`Missing required param "${$}"`);M+=we}}return M||"/"}return{re:p,score:r,keys:h,parse:s,stringify:v}}function nB(t,e){let n=0;for(;n<t.length&&n<e.length;){const r=e[n]-t[n];if(r)return r;n++}return t.length<e.length?t.length===1&&t[0]===40+40?-1:1:t.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function iB(t,e){let n=0;const r=t.score,c=e.score;for(;n<r.length&&n<c.length;){const h=nB(r[n],c[n]);if(h)return h;n++}if(Math.abs(c.length-r.length)===1){if(_2(r))return 1;if(_2(c))return-1}return c.length-r.length}function _2(t){const e=t[t.length-1];return t.length>0&&e[e.length-1]<0}const rB={type:0,value:""},sB=/[a-zA-Z0-9_]/;function oB(t){if(!t)return[[]];if(t==="/")return[[rB]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function e(N){throw new Error(`ERR (${n})/"${E}": ${N}`)}let n=0,r=n;const c=[];let h;function p(){h&&c.push(h),h=[]}let s=0,v,E="",M="";function I(){!E||(n===0?h.push({type:0,value:E}):n===1||n===2||n===3?(h.length>1&&(v==="*"||v==="+")&&e(`A repeatable param (${E}) must be alone in its segment. eg: '/:ids+.`),h.push({type:1,value:E,regexp:M,repeatable:v==="*"||v==="+",optional:v==="*"||v==="?"})):e("Invalid state to consume buffer"),E="")}function R(){E+=v}for(;s<t.length;){if(v=t[s++],v==="\\"&&n!==2){r=n,n=4;continue}switch(n){case 0:v==="/"?(E&&I(),p()):v===":"?(I(),n=1):R();break;case 4:R(),n=r;break;case 1:v==="("?n=2:sB.test(v)?R():(I(),n=0,v!=="*"&&v!=="?"&&v!=="+"&&s--);break;case 2:v===")"?M[M.length-1]=="\\"?M=M.slice(0,-1)+v:n=3:M+=v;break;case 3:I(),n=0,v!=="*"&&v!=="?"&&v!=="+"&&s--,M="";break;default:e("Unknown state");break}}return n===2&&e(`Unfinished custom RegExp for param "${E}"`),I(),p(),c}function aB(t,e,n){const r=tB(oB(t.path),n),c=Ni(r,{record:t,parent:e,children:[],alias:[]});return e&&!c.record.aliasOf==!e.record.aliasOf&&e.children.push(c),c}function lB(t,e){const n=[],r=new Map;e=x2({strict:!1,end:!0,sensitive:!1},e);function c(M){return r.get(M)}function h(M,I,R){const N=!R,$=cB(M);$.aliasOf=R&&R.record;const Z=x2(e,M),ne=[$];if("alias"in M){const he=typeof M.alias=="string"?[M.alias]:M.alias;for(const Pe of he)ne.push(Ni({},$,{components:R?R.record.components:$.components,path:Pe,aliasOf:R?R.record:$}))}let me,we;for(const he of ne){const{path:Pe}=he;if(I&&Pe[0]!=="/"){const ge=I.record.path,nt=ge[ge.length-1]==="/"?"":"/";he.path=I.record.path+(Pe&&nt+Pe)}if(me=aB(he,I,Z),R?R.alias.push(me):(we=we||me,we!==me&&we.alias.push(me),N&&M.name&&!v2(me)&&p(M.name)),$.children){const ge=$.children;for(let nt=0;nt<ge.length;nt++)h(ge[nt],me,R&&R.children[nt])}R=R||me,(me.record.components&&Object.keys(me.record.components).length||me.record.name||me.record.redirect)&&v(me)}return we?()=>{p(we)}:Od}function p(M){if(kP(M)){const I=r.get(M);I&&(r.delete(M),n.splice(n.indexOf(I),1),I.children.forEach(p),I.alias.forEach(p))}else{const I=n.indexOf(M);I>-1&&(n.splice(I,1),M.record.name&&r.delete(M.record.name),M.children.forEach(p),M.alias.forEach(p))}}function s(){return n}function v(M){let I=0;for(;I<n.length&&iB(M,n[I])>=0&&(M.record.path!==n[I].record.path||!OP(M,n[I]));)I++;n.splice(I,0,M),M.record.name&&!v2(M)&&r.set(M.record.name,M)}function E(M,I){let R,N={},$,Z;if("name"in M&&M.name){if(R=r.get(M.name),!R)throw Ah(1,{location:M});Z=R.record.name,N=Ni(y2(I.params,R.keys.filter(we=>!we.optional).map(we=>we.name)),M.params&&y2(M.params,R.keys.map(we=>we.name))),$=R.stringify(N)}else if("path"in M)$=M.path,R=n.find(we=>we.re.test($)),R&&(N=R.parse($),Z=R.record.name);else{if(R=I.name?r.get(I.name):n.find(we=>we.re.test(I.path)),!R)throw Ah(1,{location:M,currentLocation:I});Z=R.record.name,N=Ni({},I.params,M.params),$=R.stringify(N)}const ne=[];let me=R;for(;me;)ne.unshift(me.record),me=me.parent;return{name:Z,path:$,params:N,matched:ne,meta:hB(ne)}}return t.forEach(M=>h(M)),{addRoute:h,resolve:E,removeRoute:p,getRoutes:s,getRecordMatcher:c}}function y2(t,e){const n={};for(const r of e)r in t&&(n[r]=t[r]);return n}function cB(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:uB(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}function uB(t){const e={},n=t.props||!1;if("component"in t)e.default=n;else for(const r in t.components)e[r]=typeof n=="boolean"?n:n[r];return e}function v2(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function hB(t){return t.reduce((e,n)=>Ni(e,n.meta),{})}function x2(t,e){const n={};for(const r in t)n[r]=r in e?e[r]:t[r];return n}function OP(t,e){return e.children.some(n=>n===t||OP(t,n))}const DP=/#/g,fB=/&/g,dB=/\//g,pB=/=/g,mB=/\?/g,zP=/\+/g,gB=/%5B/g,_B=/%5D/g,BP=/%5E/g,yB=/%60/g,FP=/%7B/g,vB=/%7C/g,NP=/%7D/g,xB=/%20/g;function W1(t){return encodeURI(""+t).replace(vB,"|").replace(gB,"[").replace(_B,"]")}function bB(t){return W1(t).replace(FP,"{").replace(NP,"}").replace(BP,"^")}function vx(t){return W1(t).replace(zP,"%2B").replace(xB,"+").replace(DP,"%23").replace(fB,"%26").replace(yB,"`").replace(FP,"{").replace(NP,"}").replace(BP,"^")}function wB(t){return vx(t).replace(pB,"%3D")}function EB(t){return W1(t).replace(DP,"%23").replace(mB,"%3F")}function TB(t){return t==null?"":EB(t).replace(dB,"%2F")}function b_(t){try{return decodeURIComponent(""+t)}catch{}return""+t}function AB(t){const e={};if(t===""||t==="?")return e;const r=(t[0]==="?"?t.slice(1):t).split("&");for(let c=0;c<r.length;++c){const h=r[c].replace(zP," "),p=h.indexOf("="),s=b_(p<0?h:h.slice(0,p)),v=p<0?null:b_(h.slice(p+1));if(s in e){let E=e[s];Ro(E)||(E=e[s]=[E]),E.push(v)}else e[s]=v}return e}function b2(t){let e="";for(let n in t){const r=t[n];if(n=wB(n),r==null){r!==void 0&&(e+=(e.length?"&":"")+n);continue}(Ro(r)?r.map(h=>h&&vx(h)):[r&&vx(r)]).forEach(h=>{h!==void 0&&(e+=(e.length?"&":"")+n,h!=null&&(e+="="+h))})}return e}function SB(t){const e={};for(const n in t){const r=t[n];r!==void 0&&(e[n]=Ro(r)?r.map(c=>c==null?null:""+c):r==null?r:""+r)}return e}const MB=Symbol(""),w2=Symbol(""),xy=Symbol(""),q1=Symbol(""),xx=Symbol("");function gd(){let t=[];function e(r){return t.push(r),()=>{const c=t.indexOf(r);c>-1&&t.splice(c,1)}}function n(){t=[]}return{add:e,list:()=>t,reset:n}}function El(t,e,n,r,c){const h=r&&(r.enterCallbacks[c]=r.enterCallbacks[c]||[]);return()=>new Promise((p,s)=>{const v=I=>{I===!1?s(Ah(4,{from:n,to:e})):I instanceof Error?s(I):Jz(I)?s(Ah(2,{from:e,to:I})):(h&&r.enterCallbacks[c]===h&&typeof I=="function"&&h.push(I),p())},E=t.call(r&&r.instances[c],e,n,v);let M=Promise.resolve(E);t.length<3&&(M=M.then(v)),M.catch(I=>s(I))})}function hv(t,e,n,r){const c=[];for(const h of t)for(const p in h.components){let s=h.components[p];if(!(e!=="beforeRouteEnter"&&!h.instances[p]))if(PB(s)){const E=(s.__vccOpts||s)[e];E&&c.push(El(E,n,r,h,p))}else{let v=s();c.push(()=>v.then(E=>{if(!E)return Promise.reject(new Error(`Couldn't resolve component "${p}" at "${h.path}"`));const M=Oz(E)?E.default:E;h.components[p]=M;const R=(M.__vccOpts||M)[e];return R&&El(R,n,r,h,p)()}))}}return c}function PB(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function E2(t){const e=Lo(xy),n=Lo(q1),r=Ri(()=>e.resolve(hr(t.to))),c=Ri(()=>{const{matched:v}=r.value,{length:E}=v,M=v[E-1],I=n.matched;if(!M||!I.length)return-1;const R=I.findIndex(Th.bind(null,M));if(R>-1)return R;const N=T2(v[E-2]);return E>1&&T2(M)===N&&I[I.length-1].path!==N?I.findIndex(Th.bind(null,v[E-2])):R}),h=Ri(()=>c.value>-1&&kB(n.params,r.value.params)),p=Ri(()=>c.value>-1&&c.value===n.matched.length-1&&CP(n.params,r.value.params));function s(v={}){return LB(v)?e[hr(t.replace)?"replace":"push"](hr(t.to)).catch(Od):Promise.resolve()}return{route:r,href:Ri(()=>r.value.href),isActive:h,isExactActive:p,navigate:s}}const IB=U1({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:E2,setup(t,{slots:e}){const n=ua(E2(t)),{options:r}=Lo(xy),c=Ri(()=>({[A2(t.activeClass,r.linkActiveClass,"router-link-active")]:n.isActive,[A2(t.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:n.isExactActive}));return()=>{const h=e.default&&e.default(n);return t.custom?h:H1("a",{"aria-current":n.isExactActive?t.ariaCurrentValue:null,href:n.href,onClick:n.navigate,class:c.value},h)}}}),CB=IB;function LB(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}function kB(t,e){for(const n in e){const r=e[n],c=t[n];if(typeof r=="string"){if(r!==c)return!1}else if(!Ro(c)||c.length!==r.length||r.some((h,p)=>h!==c[p]))return!1}return!0}function T2(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const A2=(t,e,n)=>t??e??n,RB=U1({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:e,slots:n}){const r=Lo(xx),c=Ri(()=>t.route||r.value),h=Lo(w2,0),p=Ri(()=>{let E=hr(h);const{matched:M}=c.value;let I;for(;(I=M[E])&&!I.components;)E++;return E}),s=Ri(()=>c.value.matched[p.value]);Qg(w2,Ri(()=>p.value+1)),Qg(MB,s),Qg(xx,c);const v=$r();return nr(()=>[v.value,s.value,t.name],([E,M,I],[R,N,$])=>{M&&(M.instances[I]=E,N&&N!==M&&E&&E===R&&(M.leaveGuards.size||(M.leaveGuards=N.leaveGuards),M.updateGuards.size||(M.updateGuards=N.updateGuards))),E&&M&&(!N||!Th(M,N)||!R)&&(M.enterCallbacks[I]||[]).forEach(Z=>Z(E))},{flush:"post"}),()=>{const E=c.value,M=t.name,I=s.value,R=I&&I.components[M];if(!R)return S2(n.default,{Component:R,route:E});const N=I.props[M],$=N?N===!0?E.params:typeof N=="function"?N(E):N:null,ne=H1(R,Ni({},$,e,{onVnodeUnmounted:me=>{me.component.isUnmounted&&(I.instances[M]=null)},ref:v}));return S2(n.default,{Component:ne,route:E})||ne}}});function S2(t,e){if(!t)return null;const n=t(e);return n.length===1?n[0]:n}const UP=RB;function OB(t){const e=lB(t.routes,t),n=t.parseQuery||AB,r=t.stringifyQuery||b2,c=t.history,h=gd(),p=gd(),s=gd(),v=hy(gl);let E=gl;rh&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const M=cv.bind(null,lt=>""+lt),I=cv.bind(null,TB),R=cv.bind(null,b_);function N(lt,zt){let yt,Ft;return kP(lt)?(yt=e.getRecordMatcher(lt),Ft=zt):Ft=lt,e.addRoute(Ft,yt)}function $(lt){const zt=e.getRecordMatcher(lt);zt&&e.removeRoute(zt)}function Z(){return e.getRoutes().map(lt=>lt.record)}function ne(lt){return!!e.getRecordMatcher(lt)}function me(lt,zt){if(zt=Ni({},zt||v.value),typeof lt=="string"){const ue=uv(n,lt,zt.path),Me=e.resolve({path:ue.path},zt),Ve=c.createHref(ue.fullPath);return Ni(ue,Me,{params:R(Me.params),hash:b_(ue.hash),redirectedFrom:void 0,href:Ve})}let yt;if("path"in lt)yt=Ni({},lt,{path:uv(n,lt.path,zt.path).path});else{const ue=Ni({},lt.params);for(const Me in ue)ue[Me]==null&&delete ue[Me];yt=Ni({},lt,{params:I(lt.params)}),zt.params=I(zt.params)}const Ft=e.resolve(yt,zt),Jt=lt.hash||"";Ft.params=M(R(Ft.params));const xn=Bz(r,Ni({},lt,{hash:bB(Jt),path:Ft.path})),wn=c.createHref(xn);return Ni({fullPath:xn,hash:Jt,query:r===b2?SB(lt.query):lt.query||{}},Ft,{redirectedFrom:void 0,href:wn})}function we(lt){return typeof lt=="string"?uv(n,lt,v.value.path):Ni({},lt)}function he(lt,zt){if(E!==lt)return Ah(8,{from:zt,to:lt})}function Pe(lt){return Tt(lt)}function ge(lt){return Pe(Ni(we(lt),{replace:!0}))}function nt(lt){const zt=lt.matched[lt.matched.length-1];if(zt&&zt.redirect){const{redirect:yt}=zt;let Ft=typeof yt=="function"?yt(lt):yt;return typeof Ft=="string"&&(Ft=Ft.includes("?")||Ft.includes("#")?Ft=we(Ft):{path:Ft},Ft.params={}),Ni({query:lt.query,hash:lt.hash,params:"path"in Ft?{}:lt.params},Ft)}}function Tt(lt,zt){const yt=E=me(lt),Ft=v.value,Jt=lt.state,xn=lt.force,wn=lt.replace===!0,ue=nt(yt);if(ue)return Tt(Ni(we(ue),{state:typeof ue=="object"?Ni({},Jt,ue.state):Jt,force:xn,replace:wn}),zt||yt);const Me=yt;Me.redirectedFrom=zt;let Ve;return!xn&&Fz(r,Ft,yt)&&(Ve=Ah(16,{to:Me,from:Ft}),Wn(Ft,Ft,!0,!1)),(Ve?Promise.resolve(Ve):ke(Me,Ft)).catch(Qe=>Pa(Qe)?Pa(Qe,2)?Qe:Bn(Qe):yn(Qe,Me,Ft)).then(Qe=>{if(Qe){if(Pa(Qe,2))return Tt(Ni({replace:wn},we(Qe.to),{state:typeof Qe.to=="object"?Ni({},Jt,Qe.to.state):Jt,force:xn}),zt||Me)}else Qe=xt(Me,Ft,!0,wn,Jt);return It(Me,Ft,Qe),Qe})}function Rt(lt,zt){const yt=he(lt,zt);return yt?Promise.reject(yt):Promise.resolve()}function ke(lt,zt){let yt;const[Ft,Jt,xn]=DB(lt,zt);yt=hv(Ft.reverse(),"beforeRouteLeave",lt,zt);for(const ue of Ft)ue.leaveGuards.forEach(Me=>{yt.push(El(Me,lt,zt))});const wn=Rt.bind(null,lt,zt);return yt.push(wn),Yu(yt).then(()=>{yt=[];for(const ue of h.list())yt.push(El(ue,lt,zt));return yt.push(wn),Yu(yt)}).then(()=>{yt=hv(Jt,"beforeRouteUpdate",lt,zt);for(const ue of Jt)ue.updateGuards.forEach(Me=>{yt.push(El(Me,lt,zt))});return yt.push(wn),Yu(yt)}).then(()=>{yt=[];for(const ue of lt.matched)if(ue.beforeEnter&&!zt.matched.includes(ue))if(Ro(ue.beforeEnter))for(const Me of ue.beforeEnter)yt.push(El(Me,lt,zt));else yt.push(El(ue.beforeEnter,lt,zt));return yt.push(wn),Yu(yt)}).then(()=>(lt.matched.forEach(ue=>ue.enterCallbacks={}),yt=hv(xn,"beforeRouteEnter",lt,zt),yt.push(wn),Yu(yt))).then(()=>{yt=[];for(const ue of p.list())yt.push(El(ue,lt,zt));return yt.push(wn),Yu(yt)}).catch(ue=>Pa(ue,8)?ue:Promise.reject(ue))}function It(lt,zt,yt){for(const Ft of s.list())Ft(lt,zt,yt)}function xt(lt,zt,yt,Ft,Jt){const xn=he(lt,zt);if(xn)return xn;const wn=zt===gl,ue=rh?history.state:{};yt&&(Ft||wn?c.replace(lt.fullPath,Ni({scroll:wn&&ue&&ue.scroll},Jt)):c.push(lt.fullPath,Jt)),v.value=lt,Wn(lt,zt,yt,wn),Bn()}let gn;function an(){gn||(gn=c.listen((lt,zt,yt)=>{if(!vi.listening)return;const Ft=me(lt),Jt=nt(Ft);if(Jt){Tt(Ni(Jt,{replace:!0}),Ft).catch(Od);return}E=Ft;const xn=v.value;rh&&Wz(d2(xn.fullPath,yt.delta),vy()),ke(Ft,xn).catch(wn=>Pa(wn,12)?wn:Pa(wn,2)?(Tt(wn.to,Ft).then(ue=>{Pa(ue,20)&&!yt.delta&&yt.type===tp.pop&&c.go(-1,!1)}).catch(Od),Promise.reject()):(yt.delta&&c.go(-yt.delta,!1),yn(wn,Ft,xn))).then(wn=>{wn=wn||xt(Ft,xn,!1),wn&&(yt.delta&&!Pa(wn,8)?c.go(-yt.delta,!1):yt.type===tp.pop&&Pa(wn,20)&&c.go(-1,!1)),It(Ft,xn,wn)}).catch(Od)}))}let ln=gd(),$t=gd(),Mn;function yn(lt,zt,yt){Bn(lt);const Ft=$t.list();return Ft.length?Ft.forEach(Jt=>Jt(lt,zt,yt)):console.error(lt),Promise.reject(lt)}function vn(){return Mn&&v.value!==gl?Promise.resolve():new Promise((lt,zt)=>{ln.add([lt,zt])})}function Bn(lt){return Mn||(Mn=!lt,an(),ln.list().forEach(([zt,yt])=>lt?yt(lt):zt()),ln.reset()),lt}function Wn(lt,zt,yt,Ft){const{scrollBehavior:Jt}=t;if(!rh||!Jt)return Promise.resolve();const xn=!yt&&qz(d2(lt.fullPath,0))||(Ft||!yt)&&history.state&&history.state.scroll||null;return iP().then(()=>Jt(lt,zt,xn)).then(wn=>wn&&Hz(wn)).catch(wn=>yn(wn,lt,zt))}const pi=lt=>c.go(lt);let Kn;const Ii=new Set,vi={currentRoute:v,listening:!0,addRoute:N,removeRoute:$,hasRoute:ne,getRoutes:Z,resolve:me,options:t,push:Pe,replace:ge,go:pi,back:()=>pi(-1),forward:()=>pi(1),beforeEach:h.add,beforeResolve:p.add,afterEach:s.add,onError:$t.add,isReady:vn,install(lt){const zt=this;lt.component("RouterLink",CB),lt.component("RouterView",UP),lt.config.globalProperties.$router=zt,Object.defineProperty(lt.config.globalProperties,"$route",{enumerable:!0,get:()=>hr(v)}),rh&&!Kn&&v.value===gl&&(Kn=!0,Pe(c.location).catch(Jt=>{}));const yt={};for(const Jt in gl)yt[Jt]=Ri(()=>v.value[Jt]);lt.provide(xy,zt),lt.provide(q1,ua(yt)),lt.provide(xx,v);const Ft=lt.unmount;Ii.add(lt),lt.unmount=function(){Ii.delete(lt),Ii.size<1&&(E=gl,gn&&gn(),gn=null,v.value=gl,Kn=!1,Mn=!1),Ft()}}};return vi}function Yu(t){return t.reduce((e,n)=>e.then(()=>n()),Promise.resolve())}function DB(t,e){const n=[],r=[],c=[],h=Math.max(e.matched.length,t.matched.length);for(let p=0;p<h;p++){const s=e.matched[p];s&&(t.matched.find(E=>Th(E,s))?r.push(s):n.push(s));const v=t.matched[p];v&&(e.matched.find(E=>Th(E,v))||c.push(v))}return[n,r,c]}function zB(){return Lo(xy)}function BB(){return Lo(q1)}const VP=(t,e)=>{const n=t.__vccOpts||t;for(const[r,c]of e)n[r]=c;return n},FB={__name:"App",setup(t){return(e,n)=>(Kr(),G1(hr(UP)))}},NB=VP(FB,[["__scopeId","data-v-218a79a3"]]);function Cs(t,e,n){return Array.isArray(t)?(t.length=Math.max(t.length,e),t.splice(e,1,n),n):(t[e]=n,n)}function UB(t,e){if(Array.isArray(t)){t.splice(e,1);return}delete t[e]}var M2;const jP=typeof window<"u",VB=Object.prototype.toString,jB=t=>typeof t=="number",GB=t=>typeof t=="string",bx=t=>VB.call(t)==="[object Object]",Gc=()=>{};jP&&((M2=window?.navigator)==null?void 0:M2.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function GP(t){return xO()?(bO(t),!0):!1}function Z1(t){SP()&&Kc(t)}function Sh(t){var e;const n=hr(t);return(e=n?.$el)!=null?e:n}const $P=jP?window:void 0;function $B(...t){let e,n,r,c;if(GB(t[0])?([n,r,c]=t,e=$P):[e,n,r,c]=t,!e)return Gc;let h=Gc;const p=nr(()=>Sh(e),v=>{h(),v&&(v.addEventListener(n,r,c),h=()=>{v.removeEventListener(n,r,c),h=Gc})},{immediate:!0,flush:"post"}),s=()=>{p(),h()};return GP(s),s}const wx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ex="__vueuse_ssr_handlers__";wx[Ex]=wx[Ex]||{};wx[Ex];function HB(t,e,n={}){const{root:r,rootMargin:c="0px",threshold:h=.1,window:p=$P}=n,s=p&&"IntersectionObserver"in p;let v=Gc;const E=s?nr(()=>({el:Sh(t),root:Sh(r)}),({el:I,root:R})=>{if(v(),!I)return;const N=new IntersectionObserver(e,{root:R,rootMargin:c,threshold:h});N.observe(I),v=()=>{N.disconnect(),v=Gc}},{immediate:!0,flush:"post"}):Gc,M=()=>{v(),E()};return GP(M),{isSupported:s,stop:M}}var P2;(function(t){t.UP="UP",t.RIGHT="RIGHT",t.DOWN="DOWN",t.LEFT="LEFT",t.NONE="NONE"})(P2||(P2={}));const HP=1/60*1e3,WB=typeof performance<"u"?()=>performance.now():()=>Date.now(),WP=typeof window<"u"?t=>window.requestAnimationFrame(t):t=>setTimeout(()=>t(WB()),HP);function qB(t){let e=[],n=[],r=0,c=!1,h=!1;const p=new WeakSet,s={schedule:(v,E=!1,M=!1)=>{const I=M&&c,R=I?e:n;return E&&p.add(v),R.indexOf(v)===-1&&(R.push(v),I&&c&&(r=e.length)),v},cancel:v=>{const E=n.indexOf(v);E!==-1&&n.splice(E,1),p.delete(v)},process:v=>{if(c){h=!0;return}if(c=!0,[e,n]=[n,e],n.length=0,r=e.length,r)for(let E=0;E<r;E++){const M=e[E];M(v),p.has(M)&&(s.schedule(M),t())}c=!1,h&&(h=!1,s.process(v))}};return s}const ZB=40;let Tx=!0,np=!1,Ax=!1;const mh={delta:0,timestamp:0},wp=["read","update","preRender","render","postRender"],by=wp.reduce((t,e)=>(t[e]=qB(()=>np=!0),t),{}),Sx=wp.reduce((t,e)=>{const n=by[e];return t[e]=(r,c=!1,h=!1)=>(np||KB(),n.schedule(r,c,h)),t},{}),XB=wp.reduce((t,e)=>(t[e]=by[e].cancel,t),{});wp.reduce((t,e)=>(t[e]=()=>by[e].process(mh),t),{});const YB=t=>by[t].process(mh),qP=t=>{np=!1,mh.delta=Tx?HP:Math.max(Math.min(t-mh.timestamp,ZB),1),mh.timestamp=t,Ax=!0,wp.forEach(YB),Ax=!1,np&&(Tx=!1,WP(qP))},KB=()=>{np=!0,Tx=!0,Ax||WP(qP)},ZP=()=>mh;function XP(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,r=Object.getOwnPropertySymbols(t);c<r.length;c++)e.indexOf(r[c])<0&&Object.prototype.propertyIsEnumerable.call(t,r[c])&&(n[r[c]]=t[r[c]]);return n}var JB=function(){},I2=function(){};const Mx=(t,e,n)=>Math.min(Math.max(n,t),e),fv=.001,QB=.01,C2=10,eF=.05,tF=1;function nF({duration:t=800,bounce:e=.25,velocity:n=0,mass:r=1}){let c,h;JB(t<=C2*1e3);let p=1-e;p=Mx(eF,tF,p),t=Mx(QB,C2,t/1e3),p<1?(c=E=>{const M=E*p,I=M*t,R=M-n,N=Px(E,p),$=Math.exp(-I);return fv-R/N*$},h=E=>{const I=E*p*t,R=I*n+n,N=Math.pow(p,2)*Math.pow(E,2)*t,$=Math.exp(-I),Z=Px(Math.pow(E,2),p);return(-c(E)+fv>0?-1:1)*((R-N)*$)/Z}):(c=E=>{const M=Math.exp(-E*t),I=(E-n)*t+1;return-fv+M*I},h=E=>{const M=Math.exp(-E*t),I=(n-E)*(t*t);return M*I});const s=5/t,v=rF(c,h,s);if(t=t*1e3,isNaN(v))return{stiffness:100,damping:10,duration:t};{const E=Math.pow(v,2)*r;return{stiffness:E,damping:p*2*Math.sqrt(r*E),duration:t}}}const iF=12;function rF(t,e,n){let r=n;for(let c=1;c<iF;c++)r=r-t(r)/e(r);return r}function Px(t,e){return t*Math.sqrt(1-e*e)}const sF=["duration","bounce"],oF=["stiffness","damping","mass"];function L2(t,e){return e.some(n=>t[n]!==void 0)}function aF(t){let e=Object.assign({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},t);if(!L2(t,oF)&&L2(t,sF)){const n=nF(t);e=Object.assign(Object.assign(Object.assign({},e),n),{velocity:0,mass:1}),e.isResolvedFromDuration=!0}return e}function X1(t){var{from:e=0,to:n=1,restSpeed:r=2,restDelta:c}=t,h=XP(t,["from","to","restSpeed","restDelta"]);const p={done:!1,value:e};let{stiffness:s,damping:v,mass:E,velocity:M,duration:I,isResolvedFromDuration:R}=aF(h),N=k2,$=k2;function Z(){const ne=M?-(M/1e3):0,me=n-e,we=v/(2*Math.sqrt(s*E)),he=Math.sqrt(s/E)/1e3;if(c===void 0&&(c=Math.min(Math.abs(n-e)/100,.4)),we<1){const Pe=Px(he,we);N=ge=>{const nt=Math.exp(-we*he*ge);return n-nt*((ne+we*he*me)/Pe*Math.sin(Pe*ge)+me*Math.cos(Pe*ge))},$=ge=>{const nt=Math.exp(-we*he*ge);return we*he*nt*(Math.sin(Pe*ge)*(ne+we*he*me)/Pe+me*Math.cos(Pe*ge))-nt*(Math.cos(Pe*ge)*(ne+we*he*me)-Pe*me*Math.sin(Pe*ge))}}else if(we===1)N=Pe=>n-Math.exp(-he*Pe)*(me+(ne+he*me)*Pe);else{const Pe=he*Math.sqrt(we*we-1);N=ge=>{const nt=Math.exp(-we*he*ge),Tt=Math.min(Pe*ge,300);return n-nt*((ne+we*he*me)*Math.sinh(Tt)+Pe*me*Math.cosh(Tt))/Pe}}}return Z(),{next:ne=>{const me=N(ne);if(R)p.done=ne>=I;else{const we=$(ne)*1e3,he=Math.abs(we)<=r,Pe=Math.abs(n-me)<=c;p.done=he&&Pe}return p.value=p.done?n:me,p},flipTarget:()=>{M=-M,[e,n]=[n,e],Z()}}}X1.needsInterpolation=(t,e)=>typeof t=="string"||typeof e=="string";const k2=t=>0,YP=(t,e,n)=>{const r=e-t;return r===0?1:(n-t)/r},Y1=(t,e,n)=>-n*t+n*e+t,KP=(t,e)=>n=>Math.max(Math.min(n,e),t),zd=t=>t%1?Number(t.toFixed(5)):t,ip=/(-)?([\d]*\.?[\d])+/g,Ix=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,lF=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function Ep(t){return typeof t=="string"}const Tp={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Bd=Object.assign(Object.assign({},Tp),{transform:KP(0,1)}),wg=Object.assign(Object.assign({},Tp),{default:1}),K1=t=>({test:e=>Ep(e)&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Ac=K1("deg"),Fd=K1("%"),Xn=K1("px"),R2=Object.assign(Object.assign({},Fd),{parse:t=>Fd.parse(t)/100,transform:t=>Fd.transform(t*100)}),J1=(t,e)=>n=>Boolean(Ep(n)&&lF.test(n)&&n.startsWith(t)||e&&Object.prototype.hasOwnProperty.call(n,e)),JP=(t,e,n)=>r=>{if(!Ep(r))return r;const[c,h,p,s]=r.match(ip);return{[t]:parseFloat(c),[e]:parseFloat(h),[n]:parseFloat(p),alpha:s!==void 0?parseFloat(s):1}},Fc={test:J1("hsl","hue"),parse:JP("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:r=1})=>"hsla("+Math.round(t)+", "+Fd.transform(zd(e))+", "+Fd.transform(zd(n))+", "+zd(Bd.transform(r))+")"},cF=KP(0,255),dv=Object.assign(Object.assign({},Tp),{transform:t=>Math.round(cF(t))}),Pl={test:J1("rgb","red"),parse:JP("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:r=1})=>"rgba("+dv.transform(t)+", "+dv.transform(e)+", "+dv.transform(n)+", "+zd(Bd.transform(r))+")"};function uF(t){let e="",n="",r="",c="";return t.length>5?(e=t.substr(1,2),n=t.substr(3,2),r=t.substr(5,2),c=t.substr(7,2)):(e=t.substr(1,1),n=t.substr(2,1),r=t.substr(3,1),c=t.substr(4,1),e+=e,n+=n,r+=r,c+=c),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:c?parseInt(c,16)/255:1}}const Cx={test:J1("#"),parse:uF,transform:Pl.transform},Ps={test:t=>Pl.test(t)||Cx.test(t)||Fc.test(t),parse:t=>Pl.test(t)?Pl.parse(t):Fc.test(t)?Fc.parse(t):Cx.parse(t),transform:t=>Ep(t)?t:t.hasOwnProperty("red")?Pl.transform(t):Fc.transform(t)},QP="${c}",eI="${n}";function hF(t){var e,n,r,c;return isNaN(t)&&Ep(t)&&((n=(e=t.match(ip))===null||e===void 0?void 0:e.length)!==null&&n!==void 0?n:0)+((c=(r=t.match(Ix))===null||r===void 0?void 0:r.length)!==null&&c!==void 0?c:0)>0}function tI(t){typeof t=="number"&&(t=`${t}`);const e=[];let n=0;const r=t.match(Ix);r&&(n=r.length,t=t.replace(Ix,QP),e.push(...r.map(Ps.parse)));const c=t.match(ip);return c&&(t=t.replace(ip,eI),e.push(...c.map(Tp.parse))),{values:e,numColors:n,tokenised:t}}function nI(t){return tI(t).values}function iI(t){const{values:e,numColors:n,tokenised:r}=tI(t),c=e.length;return h=>{let p=r;for(let s=0;s<c;s++)p=p.replace(s<n?QP:eI,s<n?Ps.transform(h[s]):zd(h[s]));return p}}const fF=t=>typeof t=="number"?0:t;function dF(t){const e=nI(t);return iI(t)(e.map(fF))}const Ap={test:hF,parse:nI,createTransformer:iI,getAnimatableNone:dF},pF=new Set(["brightness","contrast","saturate","opacity"]);function mF(t){let[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[r]=n.match(ip)||[];if(!r)return t;const c=n.replace(r,"");let h=pF.has(e)?1:0;return r!==n&&(h*=100),e+"("+h+c+")"}const gF=/([a-z-]*)\(.*?\)/g,Lx=Object.assign(Object.assign({},Ap),{getAnimatableNone:t=>{const e=t.match(gF);return e?e.map(mF).join(" "):t}});function pv(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function O2({hue:t,saturation:e,lightness:n,alpha:r}){t/=360,e/=100,n/=100;let c=0,h=0,p=0;if(!e)c=h=p=n;else{const s=n<.5?n*(1+e):n+e-n*e,v=2*n-s;c=pv(v,s,t+1/3),h=pv(v,s,t),p=pv(v,s,t-1/3)}return{red:Math.round(c*255),green:Math.round(h*255),blue:Math.round(p*255),alpha:r}}const _F=(t,e,n)=>{const r=t*t,c=e*e;return Math.sqrt(Math.max(0,n*(c-r)+r))},yF=[Cx,Pl,Fc],D2=t=>yF.find(e=>e.test(t)),rI=(t,e)=>{let n=D2(t),r=D2(e),c=n.parse(t),h=r.parse(e);n===Fc&&(c=O2(c),n=Pl),r===Fc&&(h=O2(h),r=Pl);const p=Object.assign({},c);return s=>{for(const v in p)v!=="alpha"&&(p[v]=_F(c[v],h[v],s));return p.alpha=Y1(c.alpha,h.alpha,s),n.transform(p)}},vF=t=>typeof t=="number",xF=(t,e)=>n=>e(t(n)),sI=(...t)=>t.reduce(xF);function oI(t,e){return vF(t)?n=>Y1(t,e,n):Ps.test(t)?rI(t,e):lI(t,e)}const aI=(t,e)=>{const n=[...t],r=n.length,c=t.map((h,p)=>oI(h,e[p]));return h=>{for(let p=0;p<r;p++)n[p]=c[p](h);return n}},bF=(t,e)=>{const n=Object.assign(Object.assign({},t),e),r={};for(const c in n)t[c]!==void 0&&e[c]!==void 0&&(r[c]=oI(t[c],e[c]));return c=>{for(const h in r)n[h]=r[h](c);return n}};function z2(t){const e=Ap.parse(t),n=e.length;let r=0,c=0,h=0;for(let p=0;p<n;p++)r||typeof e[p]=="number"?r++:e[p].hue!==void 0?h++:c++;return{parsed:e,numNumbers:r,numRGB:c,numHSL:h}}const lI=(t,e)=>{const n=Ap.createTransformer(e),r=z2(t),c=z2(e);return r.numHSL===c.numHSL&&r.numRGB===c.numRGB&&r.numNumbers>=c.numNumbers?sI(aI(r.parsed,c.parsed),n):p=>`${p>0?e:t}`},wF=(t,e)=>n=>Y1(t,e,n);function EF(t){if(typeof t=="number")return wF;if(typeof t=="string")return Ps.test(t)?rI:lI;if(Array.isArray(t))return aI;if(typeof t=="object")return bF}function TF(t,e,n){const r=[],c=n||EF(t[0]),h=t.length-1;for(let p=0;p<h;p++){let s=c(t[p],t[p+1]);if(e){const v=Array.isArray(e)?e[p]:e;s=sI(v,s)}r.push(s)}return r}function AF([t,e],[n]){return r=>n(YP(t,e,r))}function SF(t,e){const n=t.length,r=n-1;return c=>{let h=0,p=!1;if(c<=t[0]?p=!0:c>=t[r]&&(h=r-1,p=!0),!p){let v=1;for(;v<n&&!(t[v]>c||v===r);v++);h=v-1}const s=YP(t[h],t[h+1],c);return e[h](s)}}function cI(t,e,{clamp:n=!0,ease:r,mixer:c}={}){const h=t.length;I2(h===e.length),I2(!r||!Array.isArray(r)||r.length===h-1),t[0]>t[h-1]&&(t=[].concat(t),e=[].concat(e),t.reverse(),e.reverse());const p=TF(e,r,c),s=h===2?AF(t,p):SF(t,p);return n?v=>s(Mx(t[0],t[h-1],v)):s}const wy=t=>e=>1-t(1-e),Q1=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,MF=t=>e=>Math.pow(e,t),uI=t=>e=>e*e*((t+1)*e-t),PF=t=>{const e=uI(t);return n=>(n*=2)<1?.5*e(n):.5*(2-Math.pow(2,-10*(n-1)))},hI=1.525,IF=4/11,CF=8/11,LF=9/10,eb=t=>t,rp=MF(2),kx=wy(rp),fI=Q1(rp),dI=t=>1-Math.sin(Math.acos(t)),pI=wy(dI),kF=Q1(pI),tb=uI(hI),RF=wy(tb),OF=Q1(tb),DF=PF(hI),zF=4356/361,BF=35442/1805,FF=16061/1805,w_=t=>{if(t===1||t===0)return t;const e=t*t;return t<IF?7.5625*e:t<CF?9.075*e-9.9*t+3.4:t<LF?zF*e-BF*t+FF:10.8*t*t-20.52*t+10.72},NF=wy(w_),UF=t=>t<.5?.5*(1-w_(1-t*2)):.5*w_(t*2-1)+.5;function VF(t,e){return t.map(()=>e||fI).splice(0,t.length-1)}function jF(t){const e=t.length;return t.map((n,r)=>r!==0?r/(e-1):0)}function GF(t,e){return t.map(n=>n*e)}function t_({from:t=0,to:e=1,ease:n,offset:r,duration:c=300}){const h={done:!1,value:t},p=Array.isArray(e)?e:[t,e],s=GF(r&&r.length===p.length?r:jF(p),c);function v(){return cI(s,p,{ease:Array.isArray(n)?n:VF(p,n)})}let E=v();return{next:M=>(h.value=E(M),h.done=M>=c,h),flipTarget:()=>{p.reverse(),E=v()}}}function $F({velocity:t=0,from:e=0,power:n=.8,timeConstant:r=350,restDelta:c=.5,modifyTarget:h}){const p={done:!1,value:e};let s=n*t;const v=e+s,E=h===void 0?v:h(v);return E!==v&&(s=E-e),{next:M=>{const I=-s*Math.exp(-M/r);return p.done=!(I>c||I<-c),p.value=p.done?E:E+I,p},flipTarget:()=>{}}}const B2={keyframes:t_,spring:X1,decay:$F};function HF(t){if(Array.isArray(t.to))return t_;if(B2[t.type])return B2[t.type];const e=new Set(Object.keys(t));return e.has("ease")||e.has("duration")&&!e.has("dampingRatio")?t_:e.has("dampingRatio")||e.has("stiffness")||e.has("mass")||e.has("damping")||e.has("restSpeed")||e.has("restDelta")?X1:t_}function mI(t,e,n=0){return t-e-n}function WF(t,e,n=0,r=!0){return r?mI(e+-t,e,n):e-(t-e)+n}function qF(t,e,n,r){return r?t>=e+n:t<=-n}const ZF=t=>{const e=({delta:n})=>t(n);return{start:()=>Sx.update(e,!0),stop:()=>XB.update(e)}};function E_(t){var e,n,{from:r,autoplay:c=!0,driver:h=ZF,elapsed:p=0,repeat:s=0,repeatType:v="loop",repeatDelay:E=0,onPlay:M,onStop:I,onComplete:R,onRepeat:N,onUpdate:$}=t,Z=XP(t,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]);let{to:ne}=Z,me,we=0,he=Z.duration,Pe,ge=!1,nt=!0,Tt;const Rt=HF(Z);!((n=(e=Rt).needsInterpolation)===null||n===void 0)&&n.call(e,r,ne)&&(Tt=cI([0,100],[r,ne],{clamp:!1}),r=0,ne=100);const ke=Rt(Object.assign(Object.assign({},Z),{from:r,to:ne}));function It(){we++,v==="reverse"?(nt=we%2===0,p=WF(p,he,E,nt)):(p=mI(p,he,E),v==="mirror"&&ke.flipTarget()),ge=!1,N&&N()}function xt(){me.stop(),R&&R()}function gn(ln){if(nt||(ln=-ln),p+=ln,!ge){const $t=ke.next(Math.max(0,p));Pe=$t.value,Tt&&(Pe=Tt(Pe)),ge=nt?$t.done:p<=0}$?.(Pe),ge&&(we===0&&(he??(he=p)),we<s?qF(p,he,E,nt)&&It():xt())}function an(){M?.(),me=h(gn),me.start()}return c&&an(),{stop:()=>{I?.(),me.stop()}}}function gI(t,e){return e?t*(1e3/e):0}function XF({from:t=0,velocity:e=0,min:n,max:r,power:c=.8,timeConstant:h=750,bounceStiffness:p=500,bounceDamping:s=10,restDelta:v=1,modifyTarget:E,driver:M,onUpdate:I,onComplete:R,onStop:N}){let $;function Z(he){return n!==void 0&&he<n||r!==void 0&&he>r}function ne(he){return n===void 0?r:r===void 0||Math.abs(n-he)<Math.abs(r-he)?n:r}function me(he){$?.stop(),$=E_(Object.assign(Object.assign({},he),{driver:M,onUpdate:Pe=>{var ge;I?.(Pe),(ge=he.onUpdate)===null||ge===void 0||ge.call(he,Pe)},onComplete:R,onStop:N}))}function we(he){me(Object.assign({type:"spring",stiffness:p,damping:s,restDelta:v},he))}if(Z(t))we({from:t,velocity:e,to:ne(t)});else{let he=c*e+t;typeof E<"u"&&(he=E(he));const Pe=ne(he),ge=Pe===n?-1:1;let nt,Tt;const Rt=ke=>{nt=Tt,Tt=ke,e=gI(ke-nt,ZP().delta),(ge===1&&ke>Pe||ge===-1&&ke<Pe)&&we({from:ke,to:Pe,velocity:e})};me({type:"decay",from:t,velocity:e,timeConstant:h,power:c,restDelta:v,modifyTarget:E,onUpdate:Z(he)?Rt:void 0})}return{stop:()=>$?.stop()}}const _I=(t,e)=>1-3*e+3*t,yI=(t,e)=>3*e-6*t,vI=t=>3*t,T_=(t,e,n)=>((_I(e,n)*t+yI(e,n))*t+vI(e))*t,xI=(t,e,n)=>3*_I(e,n)*t*t+2*yI(e,n)*t+vI(e),YF=1e-7,KF=10;function JF(t,e,n,r,c){let h,p,s=0;do p=e+(n-e)/2,h=T_(p,r,c)-t,h>0?n=p:e=p;while(Math.abs(h)>YF&&++s<KF);return p}const QF=8,e5=.001;function t5(t,e,n,r){for(let c=0;c<QF;++c){const h=xI(e,n,r);if(h===0)return e;const p=T_(e,n,r)-t;e-=p/h}return e}const n_=11,Eg=1/(n_-1);function n5(t,e,n,r){if(t===e&&n===r)return eb;const c=new Float32Array(n_);for(let p=0;p<n_;++p)c[p]=T_(p*Eg,t,n);function h(p){let s=0,v=1;const E=n_-1;for(;v!==E&&c[v]<=p;++v)s+=Eg;--v;const M=(p-c[v])/(c[v+1]-c[v]),I=s+M*Eg,R=xI(I,t,n);return R>=e5?t5(p,I,t,n):R===0?I:JF(p,s,s+Eg,t,n)}return p=>p===0||p===1?p:T_(h(p),e,r)}const mv={};class i5{constructor(){this.subscriptions=new Set}add(e){return this.subscriptions.add(e),()=>this.subscriptions.delete(e)}notify(e,n,r){if(!!this.subscriptions.size)for(const c of this.subscriptions)c(e,n,r)}clear(){this.subscriptions.clear()}}const F2=t=>!isNaN(parseFloat(t));class r5{constructor(e){this.timeDelta=0,this.lastUpdated=0,this.updateSubscribers=new i5,this.canTrackVelocity=!1,this.updateAndNotify=n=>{this.prev=this.current,this.current=n;const{delta:r,timestamp:c}=ZP();this.lastUpdated!==c&&(this.timeDelta=r,this.lastUpdated=c),Sx.postRender(this.scheduleVelocityCheck),this.updateSubscribers.notify(this.current)},this.scheduleVelocityCheck=()=>Sx.postRender(this.velocityCheck),this.velocityCheck=({timestamp:n})=>{this.canTrackVelocity||(this.canTrackVelocity=F2(this.current)),n!==this.lastUpdated&&(this.prev=this.current)},this.prev=this.current=e,this.canTrackVelocity=F2(this.current)}onChange(e){return this.updateSubscribers.add(e)}clearListeners(){this.updateSubscribers.clear()}set(e){this.updateAndNotify(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?gI(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(n=>{const{stop:r}=e(n);this.stopAnimation=r}).then(()=>this.clearAnimation())}stop(){this.stopAnimation&&this.stopAnimation(),this.clearAnimation()}isAnimating(){return!!this.stopAnimation}clearAnimation(){this.stopAnimation=null}destroy(){this.updateSubscribers.clear(),this.stop()}}function s5(t){return new r5(t)}const{isArray:o5}=Array;function a5(){const t=$r({}),e=r=>{const c=h=>{!t.value[h]||(t.value[h].stop(),t.value[h].destroy(),UB(t.value,h))};r?o5(r)?r.forEach(c):c(r):Object.keys(t.value).forEach(c)},n=(r,c,h)=>{if(t.value[r])return t.value[r];const p=s5(c);return p.onChange(s=>{Cs(h,r,s)}),Cs(t.value,r,p),p};return Z1(e),{motionValues:t,get:n,stop:e}}const l5=t=>Array.isArray(t),Sc=()=>({type:"spring",stiffness:500,damping:25,restDelta:.5,restSpeed:10}),gv=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restDelta:.01,restSpeed:10}),c5=t=>({type:"spring",stiffness:550,damping:t===0?100:30,restDelta:.01,restSpeed:10}),_v=()=>({type:"keyframes",ease:"linear",duration:300}),u5=t=>({type:"keyframes",duration:800,values:t}),N2={default:c5,x:Sc,y:Sc,z:Sc,rotate:Sc,rotateX:Sc,rotateY:Sc,rotateZ:Sc,scaleX:gv,scaleY:gv,scale:gv,backgroundColor:_v,color:_v,opacity:_v},bI=(t,e)=>{let n;return l5(e)?n=u5:n=N2[t]||N2.default,{to:e,...n(e)}},U2={...Tp,transform:Math.round},wI={color:Ps,backgroundColor:Ps,outlineColor:Ps,fill:Ps,stroke:Ps,borderColor:Ps,borderTopColor:Ps,borderRightColor:Ps,borderBottomColor:Ps,borderLeftColor:Ps,borderWidth:Xn,borderTopWidth:Xn,borderRightWidth:Xn,borderBottomWidth:Xn,borderLeftWidth:Xn,borderRadius:Xn,radius:Xn,borderTopLeftRadius:Xn,borderTopRightRadius:Xn,borderBottomRightRadius:Xn,borderBottomLeftRadius:Xn,width:Xn,maxWidth:Xn,height:Xn,maxHeight:Xn,size:Xn,top:Xn,right:Xn,bottom:Xn,left:Xn,padding:Xn,paddingTop:Xn,paddingRight:Xn,paddingBottom:Xn,paddingLeft:Xn,margin:Xn,marginTop:Xn,marginRight:Xn,marginBottom:Xn,marginLeft:Xn,rotate:Ac,rotateX:Ac,rotateY:Ac,rotateZ:Ac,scale:wg,scaleX:wg,scaleY:wg,scaleZ:wg,skew:Ac,skewX:Ac,skewY:Ac,distance:Xn,translateX:Xn,translateY:Xn,translateZ:Xn,x:Xn,y:Xn,z:Xn,perspective:Xn,transformPerspective:Xn,opacity:Bd,originX:R2,originY:R2,originZ:Xn,zIndex:U2,filter:Lx,WebkitFilter:Lx,fillOpacity:Bd,strokeOpacity:Bd,numOctaves:U2},nb=t=>wI[t],EI=(t,e)=>e&&typeof t=="number"&&e.transform?e.transform(t):t;function h5(t,e){let n=nb(t);return n!==Lx&&(n=Ap),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const f5={linear:eb,easeIn:rp,easeInOut:fI,easeOut:kx,circIn:dI,circInOut:kF,circOut:pI,backIn:tb,backInOut:OF,backOut:RF,anticipate:DF,bounceIn:NF,bounceInOut:UF,bounceOut:w_},V2=t=>{if(Array.isArray(t)){const[e,n,r,c]=t;return n5(e,n,r,c)}else if(typeof t=="string")return f5[t];return t},d5=t=>Array.isArray(t)&&typeof t[0]!="number",j2=(t,e)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&Ap.test(e)&&!e.startsWith("url("));function p5(t){return Array.isArray(t.to)&&t.to[0]===null&&(t.to=[...t.to],t.to[0]=t.from),t}function m5({ease:t,times:e,delay:n,...r}){const c={...r};return e&&(c.offset=e),t&&(c.ease=d5(t)?t.map(V2):V2(t)),n&&(c.elapsed=-n),c}function g5(t,e,n){return Array.isArray(e.to)&&(t.duration||(t.duration=800)),p5(e),_5(t)||(t={...t,...bI(n,e.to)}),{...e,...m5(t)}}function _5({delay:t,repeat:e,repeatType:n,repeatDelay:r,from:c,...h}){return!!Object.keys(h).length}function y5(t,e){return t[e]||t.default||t}function v5(t,e,n,r,c){const h=y5(r,t);let p=h.from===null||h.from===void 0?e.get():h.from;const s=j2(t,n);p==="none"&&s&&typeof n=="string"&&(p=h5(t,n));const v=j2(t,p);function E(I){const R={from:p,to:n,velocity:r.velocity?r.velocity:e.getVelocity(),onUpdate:N=>e.set(N)};return h.type==="inertia"||h.type==="decay"?XF({...R,...h}):E_({...g5(h,R,t),onUpdate:N=>{R.onUpdate(N),h.onUpdate&&h.onUpdate(N)},onComplete:()=>{r.onComplete&&r.onComplete(),c&&c(),I&&I()}})}function M(I){return e.set(n),r.onComplete&&r.onComplete(),c&&c(),I&&I(),{stop:()=>{}}}return!v||!s||h.type===!1?M:E}function x5(){const{motionValues:t,stop:e,get:n}=a5();return{motionValues:t,stop:e,push:(c,h,p,s={},v)=>{const E=p[c],M=n(c,E,p);if(s&&s.immediate){M.set(h);return}const I=v5(c,M,h,s,v);M.start(I)}}}function b5(t,e={},{motionValues:n,push:r,stop:c}=x5()){const h=hr(e),p=$r(!1),s=nr(n,R=>{p.value=Object.values(R).filter(N=>N.isAnimating()).length>0},{immediate:!0,deep:!0}),v=R=>{if(!h||!h[R])throw new Error(`The variant ${R} does not exist.`);return h[R]},E=R=>(typeof R=="string"&&(R=v(R)),Promise.all(Object.entries(R).map(([N,$])=>{if(N!=="transition")return new Promise(Z=>{r(N,$,t,R.transition||bI(N,R[N]),Z)})}).filter(Boolean)));return{isAnimating:p,apply:E,set:R=>{const N=bx(R)?R:v(R);Object.entries(N).forEach(([$,Z])=>{$!=="transition"&&r($,Z,t,{immediate:!0})})},stopTransitions:()=>{s(),c()},leave:async R=>{let N;if(h&&(h.leave&&(N=h.leave),!h.leave&&h.initial&&(N=h.initial)),!N){R();return}await E(N),R()}}}const ib=typeof window<"u",w5=()=>ib&&window.onpointerdown===null,E5=()=>ib&&window.ontouchstart===null,T5=()=>ib&&window.onmousedown===null;function A5({target:t,state:e,variants:n,apply:r}){const c=hr(n),h=[],p=(...$)=>{const Z=$B.apply(null,$);return h.push(Z),Z},s=$r(!1),v=$r(!1),E=$r(!1),M=Ri(()=>{let $=[];return c&&(c.hovered&&($=[...$,...Object.keys(c.hovered)]),c.tapped&&($=[...$,...Object.keys(c.tapped)]),c.focused&&($=[...$,...Object.keys(c.focused)])),$}),I=Ri(()=>{const $={};Object.assign($,e.value),s.value&&c.hovered&&Object.assign($,c.hovered),v.value&&c.tapped&&Object.assign($,c.tapped),E.value&&c.focused&&Object.assign($,c.focused);for(const Z in $)M.value.includes(Z)||delete $[Z];return $});c.hovered&&(p(t,"mouseenter",()=>{s.value=!0}),p(t,"mouseleave",()=>{s.value=!1,v.value=!1}),p(t,"mouseout",()=>{s.value=!1,v.value=!1})),c.tapped&&(T5()&&(p(t,"mousedown",()=>{v.value=!0}),p(t,"mouseup",()=>{v.value=!1})),w5()&&(p(t,"pointerdown",()=>{v.value=!0}),p(t,"pointerup",()=>{v.value=!1})),E5()&&(p(t,"touchstart",()=>{v.value=!0}),p(t,"touchend",()=>{v.value=!1}))),c.focused&&(p(t,"focus",()=>{E.value=!0}),p(t,"blur",()=>{E.value=!1}));const R=nr(I,r);return{stop:()=>{h.forEach($=>$()),R()}}}function S5({set:t,target:e,variants:n,variant:r}){const c=hr(n);return{stop:nr(()=>e,()=>{!c||(c.initial&&t("initial"),c.enter&&(r.value="enter"))},{immediate:!0,flush:"pre"})}}function M5({state:t,apply:e}){return{stop:nr(t,r=>{r&&e(r)},{immediate:!0})}}function P5({target:t,variants:e,variant:n}){const r=hr(e);let c=Gc;if(r&&(r.visible||r.visibleOnce)){const{stop:h}=HB(t,([{isIntersecting:p}])=>{r.visible?p?n.value="visible":n.value="initial":r.visibleOnce&&(p?n.value!=="visibleOnce"&&(n.value="visibleOnce"):n.value||(n.value="initial"))});c=h}return{stop:c}}function I5(t,e={syncVariants:!0,lifeCycleHooks:!0,visibilityHooks:!0,eventListeners:!0}){const n=$r([]);if(e.lifeCycleHooks){const{stop:c}=S5(t);n.value.push(c)}if(e.syncVariants){const{stop:c}=M5(t);n.value.push(c)}if(e.visibilityHooks){const{stop:c}=P5(t);n.value.push(c)}if(e.eventListeners){const{stop:c}=A5(t);n.value.push(c)}const r=()=>n.value.forEach(c=>c());return Z1(r),{stop:r}}function TI(t={}){const e=ua({...t}),n=$r({});return nr(e,()=>{const r={};for(const[c,h]of Object.entries(e)){const p=nb(c),s=EI(h,p);r[c]=s}n.value=r},{immediate:!0,deep:!0}),{state:e,style:n}}const C5=["","X","Y","Z"],L5=["perspective","translate","scale","rotate","skew"],AI=["transformPerspective","x","y","z"];L5.forEach(t=>{C5.forEach(e=>{const n=t+e;AI.push(n)})});const k5=new Set(AI);function rb(t){return k5.has(t)}const R5=new Set(["originX","originY","originZ"]);function SI(t){return R5.has(t)}function O5(t){const e={},n={};return Object.entries(t).forEach(([r,c])=>{rb(r)||SI(r)?e[r]=c:n[r]=c}),{transform:e,style:n}}function D5(t,e){let n,r;const{state:c,style:h}=TI(),p=nr(()=>Sh(t),E=>{if(!!E){r=E;for(const M of Object.keys(wI))E.style[M]===null||E.style[M]===""||rb(M)||SI(M)||Cs(c,M,E.style[M]);n&&Object.entries(n).forEach(([M,I])=>Cs(E.style,M,I)),e&&e(c)}},{immediate:!0}),s=nr(h,E=>{if(!r){n=E;return}for(const M in E)Cs(r.style,M,E[M])},{immediate:!0});return{style:c,stop:()=>{r=void 0,n=void 0,p(),s()}}}const z5={x:"translateX",y:"translateY",z:"translateZ"};function MI(t={},e=!0){const n=ua({...t}),r=$r("");return nr(n,c=>{let h="",p=!1;if(e&&(c.x||c.y||c.z)){const s=[c.x||0,c.y||0,c.z||0].map(Xn.transform).join(",");h+=`translate3d(${s}) `,p=!0}for(const[s,v]of Object.entries(c)){if(e&&(s==="x"||s==="y"||s==="z"))continue;const E=nb(s),M=EI(v,E);h+=`${z5[s]||s}(${M}) `}e&&!p&&(h+="translateZ(0px) "),r.value=h.trim()},{immediate:!0,deep:!0}),{state:n,transform:r}}function B5(t){const e=t.trim().split(/\) |\)/);if(e.length===1)return{};const n=r=>r.endsWith("px")||r.endsWith("deg")?parseFloat(r):isNaN(Number(r))?Number(r):r;return e.reduce((r,c)=>{if(!c)return r;const[h,p]=c.split("("),v=p.split(",").map(M=>n(M.endsWith(")")?M.replace(")",""):M.trim())),E=v.length===1?v[0]:v;return{...r,[h]:E}},{})}function F5(t,e){Object.entries(B5(e)).forEach(([n,r])=>{r=parseFloat(r);const c=["x","y","z"];if(n==="translate3d"){if(r===0){c.forEach(h=>{Cs(t,h,0)});return}r.forEach((h,p)=>{Cs(t,c[p],h)});return}if(n==="translateX"){Cs(t,"x",r);return}if(n==="translateY"){Cs(t,"y",r);return}if(n==="translateZ"){Cs(t,"z",r);return}Cs(t,n,r)})}function N5(t,e){let n,r;const{state:c,transform:h}=MI(),p=nr(()=>Sh(t),E=>{!E||(r=E,E.style.transform&&F5(c,E.style.transform),n&&(E.style.transform=n),e&&e(c))},{immediate:!0}),s=nr(h,E=>{if(!r){n=E;return}r.style.transform=E},{immediate:!0});return{transform:c,stop:()=>{n=void 0,r=void 0,p(),s()}}}function U5(t,e){const n=ua({}),r=I=>{Object.entries(I).forEach(([R,N])=>{Cs(n,R,N)})},{style:c,stop:h}=D5(t,r),{transform:p,stop:s}=N5(t,r),v=nr(n,I=>{Object.entries(I).forEach(([R,N])=>{const $=rb(R)?p:c;$[R]&&$[R]===N||Cs($,R,N)})},{immediate:!0,deep:!0}),E=nr(()=>Sh(t),I=>{!I||e&&r(e)},{immediate:!0});return{motionProperties:n,style:c,transform:p,stop:()=>{h(),s(),v(),E()}}}function V5(t={}){const e=hr(t),n=$r();return{state:Ri(()=>{if(!!n.value)return e[n.value]}),variant:n}}function j5(t,e={},n){const{motionProperties:r,stop:c}=U5(t),{variant:h,state:p}=V5(e),s=b5(r,e),v={target:t,variant:h,variants:e,state:p,motionProperties:r,...s,stop:(M=!1)=>{}},{stop:E}=I5(v,n);return v.stop=(M=!1)=>{const I=()=>{v.stopTransitions(),c(),E()};if(!M&&e.value&&e.value.leave){const R=nr(v.isAnimating,N=>{N||(R(),I())})}else I()},Z1(()=>v.stop()),v}const G5=["initial","enter","leave","visible","visible-once","hovered","tapped","focused","delay"],$5=(t,e)=>{const n=t.props?t.props:t.data&&t.data.attrs?t.data.attrs:{};n&&(n.variants&&bx(n.variants)&&(e.value={...e.value,...n.variants}),G5.forEach(r=>{if(r==="delay"){if(n&&n[r]&&jB(n[r])){const c=n[r];e&&e.value&&(e.value.enter&&(e.value.enter.transition||(e.value.enter.transition={}),e.value.enter.transition={...e.value.enter.transition,delay:c}),e.value.visible&&(e.value.visible.transition||(e.value.visible.transition={}),e.value.visible.transition={...e.value.visible.transition,delay:c}),e.value.visibleOnce&&(e.value.visibleOnce.transition||(e.value.visibleOnce.transition={}),e.value.visibleOnce.transition={...e.value.visibleOnce.transition,delay:c}))}return}r==="visible-once"&&(r="visibleOnce"),n&&n[r]&&bx(n[r])&&(e.value[r]=n[r])}))},yv=t=>{const e=(r,c,h)=>{const p=c.value&&typeof c.value=="string"?c.value:h.key;p&&mv[p]&&mv[p].stop();const s=$r(t||{});typeof c.value=="object"&&(s.value=c.value),$5(h,s);const v=j5(r,s);r.motionInstance=v,p&&Cs(mv,p,v)},n=r=>{r.motionInstance&&r.motionInstance.stop()};return{created:e,unmounted:n,bind:e,unbind:n,getSSRProps(r,c){const{initial:h}=r.value||c.props||{};if(!h||Object.keys(h).length===0)return;const{transform:p,style:s}=O5(h),{transform:v}=MI(p),{style:E}=TI(s);return v.value&&(E.value.transform=v.value),{style:E.value}}}},H5={initial:{opacity:0},enter:{opacity:1}},W5={initial:{opacity:0},visible:{opacity:1}},q5={initial:{opacity:0},visibleOnce:{opacity:1}},Z5={initial:{scale:0,opacity:0},enter:{scale:1,opacity:1}},X5={initial:{scale:0,opacity:0},visible:{scale:1,opacity:1}},Y5={initial:{scale:0,opacity:0},visibleOnce:{scale:1,opacity:1}},K5={initial:{x:-100,rotate:90,opacity:0},enter:{x:0,rotate:0,opacity:1}},J5={initial:{x:-100,rotate:90,opacity:0},visible:{x:0,rotate:0,opacity:1}},Q5={initial:{x:-100,rotate:90,opacity:0},visibleOnce:{x:0,rotate:0,opacity:1}},e4={initial:{x:100,rotate:-90,opacity:0},enter:{x:0,rotate:0,opacity:1}},t4={initial:{x:100,rotate:-90,opacity:0},visible:{x:0,rotate:0,opacity:1}},n4={initial:{x:100,rotate:-90,opacity:0},visibleOnce:{x:0,rotate:0,opacity:1}},i4={initial:{y:-100,rotate:-90,opacity:0},enter:{y:0,rotate:0,opacity:1}},r4={initial:{y:-100,rotate:-90,opacity:0},visible:{y:0,rotate:0,opacity:1}},s4={initial:{y:-100,rotate:-90,opacity:0},visibleOnce:{y:0,rotate:0,opacity:1}},o4={initial:{y:100,rotate:90,opacity:0},enter:{y:0,rotate:0,opacity:1}},a4={initial:{y:100,rotate:90,opacity:0},visible:{y:0,rotate:0,opacity:1}},l4={initial:{y:100,rotate:90,opacity:0},visibleOnce:{y:0,rotate:0,opacity:1}},c4={initial:{x:-100,opacity:0},enter:{x:0,opacity:1}},u4={initial:{x:-100,opacity:0},visible:{x:0,opacity:1}},h4={initial:{x:-100,opacity:0},visibleOnce:{x:0,opacity:1}},f4={initial:{x:100,opacity:0},enter:{x:0,opacity:1}},d4={initial:{x:100,opacity:0},visible:{x:0,opacity:1}},p4={initial:{x:100,opacity:0},visibleOnce:{x:0,opacity:1}},m4={initial:{y:-100,opacity:0},enter:{y:0,opacity:1}},g4={initial:{y:-100,opacity:0},visible:{y:0,opacity:1}},_4={initial:{y:-100,opacity:0},visibleOnce:{y:0,opacity:1}},y4={initial:{y:100,opacity:0},enter:{y:0,opacity:1}},v4={initial:{y:100,opacity:0},visible:{y:0,opacity:1}},x4={initial:{y:100,opacity:0},visibleOnce:{y:0,opacity:1}},G2={__proto__:null,fade:H5,fadeVisible:W5,fadeVisibleOnce:q5,pop:Z5,popVisible:X5,popVisibleOnce:Y5,rollBottom:o4,rollLeft:K5,rollRight:e4,rollTop:i4,rollVisibleBottom:a4,rollVisibleLeft:J5,rollVisibleRight:t4,rollVisibleTop:r4,rollVisibleOnceBottom:l4,rollVisibleOnceLeft:Q5,rollVisibleOnceRight:n4,rollVisibleOnceTop:s4,slideBottom:y4,slideLeft:c4,slideRight:f4,slideTop:m4,slideVisibleBottom:v4,slideVisibleLeft:u4,slideVisibleRight:d4,slideVisibleTop:g4,slideVisibleOnceBottom:x4,slideVisibleOnceLeft:h4,slideVisibleOnceRight:p4,slideVisibleOnceTop:_4};function b4(t){const e="\xE0\xE1\xE2\xE4\xE6\xE3\xE5\u0101\u0103\u0105\xE7\u0107\u010D\u0111\u010F\xE8\xE9\xEA\xEB\u0113\u0117\u0119\u011B\u011F\u01F5\u1E27\xEE\xEF\xED\u012B\u012F\xEC\u0142\u1E3F\xF1\u0144\u01F9\u0148\xF4\xF6\xF2\xF3\u0153\xF8\u014D\xF5\u0151\u1E55\u0155\u0159\xDF\u015B\u0161\u015F\u0219\u0165\u021B\xFB\xFC\xF9\xFA\u016B\u01D8\u016F\u0171\u0173\u1E83\u1E8D\xFF\xFD\u017E\u017A\u017C\xB7/_,:;",n="aaaaaaaaaacccddeeeeeeeegghiiiiiilmnnnnoooooooooprrsssssttuuuuuuuuuwxyyzzz------",r=new RegExp(e.split("").join("|"),"g");return t.toString().replace(/[A-Z]/g,c=>`-${c}`).toLowerCase().replace(/\s+/g,"-").replace(r,c=>n.charAt(e.indexOf(c))).replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}const w4={install(t,e){if(t.directive("motion",yv()),!e||e&&!e.excludePresets)for(const n in G2){const r=G2[n];t.directive(`motion-${b4(n)}`,yv(r))}if(e&&e.directives)for(const n in e.directives){const r=e.directives[n];!r.initial&&__DEV__&&console.warn(`Your directive v-motion-${n} is missing initial variant!`),t.directive(`motion-${n}`,yv(r))}}},E4=(t,e="/")=>{const n=t.lastIndexOf(e);return[t.slice(0,n+1),t.slice(n+1,t.length)]};const T4="/RapidexVis/assets/congestion-white.b6a18e38.png",A4="/RapidexVis/assets/emissions-white.02b0855c.png",S4="/RapidexVis/assets/orbit-alt-white.92eaee96.png",M4="/RapidexVis/assets/cars-arrow-down-white.5ca367c8.png",P4="/RapidexVis/assets/cars-arrow-up-white.ad9d25cc.png";var I4=function(){function t(e,n){n===void 0&&(n=[]),this._eventType=e,this._eventFunctions=n}return t.prototype.init=function(){var e=this;this._eventFunctions.forEach(function(n){typeof window<"u"&&window.addEventListener(e._eventType,n)})},t}(),A_=globalThis&&globalThis.__assign||function(){return A_=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(t[c]=e[c])}return t},A_.apply(this,arguments)},S_={alwaysOpen:!1,activeClasses:"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white",inactiveClasses:"text-gray-500 dark:text-gray-400",onOpen:function(){},onClose:function(){},onToggle:function(){}},PI=function(){function t(e,n){e===void 0&&(e=[]),n===void 0&&(n=S_),this._items=e,this._options=A_(A_({},S_),n),this._init()}return t.prototype._init=function(){var e=this;this._items.length&&this._items.map(function(n){n.active&&e.open(n.id),n.triggerEl.addEventListener("click",function(){e.toggle(n.id)})})},t.prototype.getItem=function(e){return this._items.filter(function(n){return n.id===e})[0]},t.prototype.open=function(e){var n,r,c=this,h=this.getItem(e);this._options.alwaysOpen||this._items.map(function(p){var s,v;p!==h&&((s=p.triggerEl.classList).remove.apply(s,c._options.activeClasses.split(" ")),(v=p.triggerEl.classList).add.apply(v,c._options.inactiveClasses.split(" ")),p.targetEl.classList.add("hidden"),p.triggerEl.setAttribute("aria-expanded","false"),p.active=!1,p.iconEl&&p.iconEl.classList.remove("rotate-180"))}),(n=h.triggerEl.classList).add.apply(n,this._options.activeClasses.split(" ")),(r=h.triggerEl.classList).remove.apply(r,this._options.inactiveClasses.split(" ")),h.triggerEl.setAttribute("aria-expanded","true"),h.targetEl.classList.remove("hidden"),h.active=!0,h.iconEl&&h.iconEl.classList.add("rotate-180"),this._options.onOpen(this,h)},t.prototype.toggle=function(e){var n=this.getItem(e);n.active?this.close(e):this.open(e),this._options.onToggle(this,n)},t.prototype.close=function(e){var n,r,c=this.getItem(e);(n=c.triggerEl.classList).remove.apply(n,this._options.activeClasses.split(" ")),(r=c.triggerEl.classList).add.apply(r,this._options.inactiveClasses.split(" ")),c.targetEl.classList.add("hidden"),c.triggerEl.setAttribute("aria-expanded","false"),c.active=!1,c.iconEl&&c.iconEl.classList.remove("rotate-180"),this._options.onClose(this,c)},t}();typeof window<"u"&&(window.Accordion=PI);function C4(){document.querySelectorAll("[data-accordion]").forEach(function(t){var e=t.getAttribute("data-accordion"),n=t.getAttribute("data-active-classes"),r=t.getAttribute("data-inactive-classes"),c=[];t.querySelectorAll("[data-accordion-target]").forEach(function(h){var p={id:h.getAttribute("data-accordion-target"),triggerEl:h,targetEl:document.querySelector(h.getAttribute("data-accordion-target")),iconEl:h.querySelector("[data-accordion-icon]"),active:h.getAttribute("aria-expanded")==="true"};c.push(p)}),new PI(c,{alwaysOpen:e==="open",activeClasses:n||S_.activeClasses,inactiveClasses:r||S_.inactiveClasses})})}var M_=globalThis&&globalThis.__assign||function(){return M_=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(t[c]=e[c])}return t},M_.apply(this,arguments)},$2={onCollapse:function(){},onExpand:function(){},onToggle:function(){}},II=function(){function t(e,n,r){e===void 0&&(e=null),n===void 0&&(n=null),r===void 0&&(r=$2),this._targetEl=e,this._triggerEl=n,this._options=M_(M_({},$2),r),this._visible=!1,this._init()}return t.prototype._init=function(){var e=this;this._triggerEl&&(this._triggerEl.hasAttribute("aria-expanded")?this._visible=this._triggerEl.getAttribute("aria-expanded")==="true":this._visible=!this._targetEl.classList.contains("hidden"),this._triggerEl.addEventListener("click",function(){e.toggle()}))},t.prototype.collapse=function(){this._targetEl.classList.add("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","false"),this._visible=!1,this._options.onCollapse(this)},t.prototype.expand=function(){this._targetEl.classList.remove("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","true"),this._visible=!0,this._options.onExpand(this)},t.prototype.toggle=function(){this._visible?this.collapse():this.expand(),this._options.onToggle(this)},t}();typeof window<"u"&&(window.Collapse=II);function L4(){document.querySelectorAll("[data-collapse-toggle]").forEach(function(t){var e=t.getAttribute("data-collapse-toggle"),n=document.getElementById(e);n?new II(n,t):console.error('The target element with id "'.concat(e,'" does not exist. Please check the data-collapse-toggle attribute.'))})}var Oc=globalThis&&globalThis.__assign||function(){return Oc=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(t[c]=e[c])}return t},Oc.apply(this,arguments)},i_={defaultPosition:0,indicators:{items:[],activeClasses:"bg-white dark:bg-gray-800",inactiveClasses:"bg-white/50 dark:bg-gray-800/50 hover:bg-white dark:hover:bg-gray-800"},interval:3e3,onNext:function(){},onPrev:function(){},onChange:function(){}},CI=function(){function t(e,n){e===void 0&&(e=[]),n===void 0&&(n=i_),this._items=e,this._options=Oc(Oc(Oc({},i_),n),{indicators:Oc(Oc({},i_.indicators),n.indicators)}),this._activeItem=this.getItem(this._options.defaultPosition),this._indicators=this._options.indicators.items,this._intervalDuration=this._options.interval,this._intervalInstance=null,this._init()}return t.prototype._init=function(){var e=this;this._items.map(function(n){n.el.classList.add("absolute","inset-0","transition-transform","transform")}),this._getActiveItem()?this.slideTo(this._getActiveItem().position):this.slideTo(0),this._indicators.map(function(n,r){n.el.addEventListener("click",function(){e.slideTo(r)})})},t.prototype.getItem=function(e){return this._items[e]},t.prototype.slideTo=function(e){var n=this._items[e],r={left:n.position===0?this._items[this._items.length-1]:this._items[n.position-1],middle:n,right:n.position===this._items.length-1?this._items[0]:this._items[n.position+1]};this._rotate(r),this._setActiveItem(n),this._intervalInstance&&(this.pause(),this.cycle()),this._options.onChange(this)},t.prototype.next=function(){var e=this._getActiveItem(),n=null;e.position===this._items.length-1?n=this._items[0]:n=this._items[e.position+1],this.slideTo(n.position),this._options.onNext(this)},t.prototype.prev=function(){var e=this._getActiveItem(),n=null;e.position===0?n=this._items[this._items.length-1]:n=this._items[e.position-1],this.slideTo(n.position),this._options.onPrev(this)},t.prototype._rotate=function(e){this._items.map(function(n){n.el.classList.add("hidden")}),e.left.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-20"),e.left.el.classList.add("-translate-x-full","z-10"),e.middle.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-10"),e.middle.el.classList.add("translate-x-0","z-20"),e.right.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-20"),e.right.el.classList.add("translate-x-full","z-10")},t.prototype.cycle=function(){var e=this;typeof window<"u"&&(this._intervalInstance=window.setInterval(function(){e.next()},this._intervalDuration))},t.prototype.pause=function(){clearInterval(this._intervalInstance)},t.prototype._getActiveItem=function(){return this._activeItem},t.prototype._setActiveItem=function(e){var n,r,c=this;this._activeItem=e;var h=e.position;this._indicators.length&&(this._indicators.map(function(p){var s,v;p.el.setAttribute("aria-current","false"),(s=p.el.classList).remove.apply(s,c._options.indicators.activeClasses.split(" ")),(v=p.el.classList).add.apply(v,c._options.indicators.inactiveClasses.split(" "))}),(n=this._indicators[h].el.classList).add.apply(n,this._options.indicators.activeClasses.split(" ")),(r=this._indicators[h].el.classList).remove.apply(r,this._options.indicators.inactiveClasses.split(" ")),this._indicators[h].el.setAttribute("aria-current","true"))},t}();typeof window<"u"&&(window.Carousel=CI);function k4(){document.querySelectorAll("[data-carousel]").forEach(function(t){var e=t.getAttribute("data-carousel-interval"),n=t.getAttribute("data-carousel")==="slide",r=[],c=0;t.querySelectorAll("[data-carousel-item]").length&&Array.from(t.querySelectorAll("[data-carousel-item]")).map(function(E,M){r.push({position:M,el:E}),E.getAttribute("data-carousel-item")==="active"&&(c=M)});var h=[];t.querySelectorAll("[data-carousel-slide-to]").length&&Array.from(t.querySelectorAll("[data-carousel-slide-to]")).map(function(E){h.push({position:parseInt(E.getAttribute("data-carousel-slide-to")),el:E})});var p=new CI(r,{defaultPosition:c,indicators:{items:h},interval:e||i_.interval});n&&p.cycle();var s=t.querySelector("[data-carousel-next]"),v=t.querySelector("[data-carousel-prev]");s&&s.addEventListener("click",function(){p.next()}),v&&v.addEventListener("click",function(){p.prev()})})}var P_=globalThis&&globalThis.__assign||function(){return P_=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(t[c]=e[c])}return t},P_.apply(this,arguments)},H2={transition:"transition-opacity",duration:300,timing:"ease-out",onHide:function(){}},LI=function(){function t(e,n,r){e===void 0&&(e=null),n===void 0&&(n=null),r===void 0&&(r=H2),this._targetEl=e,this._triggerEl=n,this._options=P_(P_({},H2),r),this._init()}return t.prototype._init=function(){var e=this;this._triggerEl&&this._triggerEl.addEventListener("click",function(){e.hide()})},t.prototype.hide=function(){var e=this;this._targetEl.classList.add(this._options.transition,"duration-".concat(this._options.duration),this._options.timing,"opacity-0"),setTimeout(function(){e._targetEl.classList.add("hidden")},this._options.duration),this._options.onHide(this,this._targetEl)},t}();typeof window<"u"&&(window.Dismiss=LI);function R4(){document.querySelectorAll("[data-dismiss-target]").forEach(function(t){var e=t.getAttribute("data-dismiss-target"),n=document.querySelector(e);n?new LI(n,t):console.error('The dismiss element with id "'.concat(e,'" does not exist. Please check the data-dismiss-target attribute.'))})}var ks="top",ao="bottom",lo="right",Rs="left",sb="auto",Sp=[ks,ao,lo,Rs],Mh="start",sp="end",O4="clippingParents",kI="viewport",_d="popper",D4="reference",W2=Sp.reduce(function(t,e){return t.concat([e+"-"+Mh,e+"-"+sp])},[]),RI=[].concat(Sp,[sb]).reduce(function(t,e){return t.concat([e,e+"-"+Mh,e+"-"+sp])},[]),z4="beforeRead",B4="read",F4="afterRead",N4="beforeMain",U4="main",V4="afterMain",j4="beforeWrite",G4="write",$4="afterWrite",H4=[z4,B4,F4,N4,U4,V4,j4,G4,$4];function ha(t){return t?(t.nodeName||"").toLowerCase():null}function uo(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Zc(t){var e=uo(t).Element;return t instanceof e||t instanceof Element}function so(t){var e=uo(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function ob(t){if(typeof ShadowRoot>"u")return!1;var e=uo(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function W4(t){var e=t.state;Object.keys(e.elements).forEach(function(n){var r=e.styles[n]||{},c=e.attributes[n]||{},h=e.elements[n];!so(h)||!ha(h)||(Object.assign(h.style,r),Object.keys(c).forEach(function(p){var s=c[p];s===!1?h.removeAttribute(p):h.setAttribute(p,s===!0?"":s)}))})}function q4(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach(function(r){var c=e.elements[r],h=e.attributes[r]||{},p=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:n[r]),s=p.reduce(function(v,E){return v[E]="",v},{});!so(c)||!ha(c)||(Object.assign(c.style,s),Object.keys(h).forEach(function(v){c.removeAttribute(v)}))})}}const Z4={name:"applyStyles",enabled:!0,phase:"write",fn:W4,effect:q4,requires:["computeStyles"]};function aa(t){return t.split("-")[0]}var $c=Math.max,I_=Math.min,Ph=Math.round;function Rx(){var t=navigator.userAgentData;return t!=null&&t.brands?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function OI(){return!/^((?!chrome|android).)*safari/i.test(Rx())}function Ih(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var r=t.getBoundingClientRect(),c=1,h=1;e&&so(t)&&(c=t.offsetWidth>0&&Ph(r.width)/t.offsetWidth||1,h=t.offsetHeight>0&&Ph(r.height)/t.offsetHeight||1);var p=Zc(t)?uo(t):window,s=p.visualViewport,v=!OI()&&n,E=(r.left+(v&&s?s.offsetLeft:0))/c,M=(r.top+(v&&s?s.offsetTop:0))/h,I=r.width/c,R=r.height/h;return{width:I,height:R,top:M,right:E+I,bottom:M+R,left:E,x:E,y:M}}function ab(t){var e=Ih(t),n=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:r}}function DI(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&ob(n)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Ra(t){return uo(t).getComputedStyle(t)}function X4(t){return["table","td","th"].indexOf(ha(t))>=0}function Bl(t){return((Zc(t)?t.ownerDocument:t.document)||window.document).documentElement}function Ey(t){return ha(t)==="html"?t:t.assignedSlot||t.parentNode||(ob(t)?t.host:null)||Bl(t)}function q2(t){return!so(t)||Ra(t).position==="fixed"?null:t.offsetParent}function Y4(t){var e=/firefox/i.test(Rx()),n=/Trident/i.test(Rx());if(n&&so(t)){var r=Ra(t);if(r.position==="fixed")return null}var c=Ey(t);for(ob(c)&&(c=c.host);so(c)&&["html","body"].indexOf(ha(c))<0;){var h=Ra(c);if(h.transform!=="none"||h.perspective!=="none"||h.contain==="paint"||["transform","perspective"].indexOf(h.willChange)!==-1||e&&h.willChange==="filter"||e&&h.filter&&h.filter!=="none")return c;c=c.parentNode}return null}function Mp(t){for(var e=uo(t),n=q2(t);n&&X4(n)&&Ra(n).position==="static";)n=q2(n);return n&&(ha(n)==="html"||ha(n)==="body"&&Ra(n).position==="static")?e:n||Y4(t)||e}function lb(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Nd(t,e,n){return $c(t,I_(e,n))}function K4(t,e,n){var r=Nd(t,e,n);return r>n?n:r}function zI(){return{top:0,right:0,bottom:0,left:0}}function BI(t){return Object.assign({},zI(),t)}function FI(t,e){return e.reduce(function(n,r){return n[r]=t,n},{})}var J4=function(e,n){return e=typeof e=="function"?e(Object.assign({},n.rects,{placement:n.placement})):e,BI(typeof e!="number"?e:FI(e,Sp))};function Q4(t){var e,n=t.state,r=t.name,c=t.options,h=n.elements.arrow,p=n.modifiersData.popperOffsets,s=aa(n.placement),v=lb(s),E=[Rs,lo].indexOf(s)>=0,M=E?"height":"width";if(!(!h||!p)){var I=J4(c.padding,n),R=ab(h),N=v==="y"?ks:Rs,$=v==="y"?ao:lo,Z=n.rects.reference[M]+n.rects.reference[v]-p[v]-n.rects.popper[M],ne=p[v]-n.rects.reference[v],me=Mp(h),we=me?v==="y"?me.clientHeight||0:me.clientWidth||0:0,he=Z/2-ne/2,Pe=I[N],ge=we-R[M]-I[$],nt=we/2-R[M]/2+he,Tt=Nd(Pe,nt,ge),Rt=v;n.modifiersData[r]=(e={},e[Rt]=Tt,e.centerOffset=Tt-nt,e)}}function e6(t){var e=t.state,n=t.options,r=n.element,c=r===void 0?"[data-popper-arrow]":r;c!=null&&(typeof c=="string"&&(c=e.elements.popper.querySelector(c),!c)||!DI(e.elements.popper,c)||(e.elements.arrow=c))}const t6={name:"arrow",enabled:!0,phase:"main",fn:Q4,effect:e6,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ch(t){return t.split("-")[1]}var n6={top:"auto",right:"auto",bottom:"auto",left:"auto"};function i6(t){var e=t.x,n=t.y,r=window,c=r.devicePixelRatio||1;return{x:Ph(e*c)/c||0,y:Ph(n*c)/c||0}}function Z2(t){var e,n=t.popper,r=t.popperRect,c=t.placement,h=t.variation,p=t.offsets,s=t.position,v=t.gpuAcceleration,E=t.adaptive,M=t.roundOffsets,I=t.isFixed,R=p.x,N=R===void 0?0:R,$=p.y,Z=$===void 0?0:$,ne=typeof M=="function"?M({x:N,y:Z}):{x:N,y:Z};N=ne.x,Z=ne.y;var me=p.hasOwnProperty("x"),we=p.hasOwnProperty("y"),he=Rs,Pe=ks,ge=window;if(E){var nt=Mp(n),Tt="clientHeight",Rt="clientWidth";if(nt===uo(n)&&(nt=Bl(n),Ra(nt).position!=="static"&&s==="absolute"&&(Tt="scrollHeight",Rt="scrollWidth")),nt=nt,c===ks||(c===Rs||c===lo)&&h===sp){Pe=ao;var ke=I&&nt===ge&&ge.visualViewport?ge.visualViewport.height:nt[Tt];Z-=ke-r.height,Z*=v?1:-1}if(c===Rs||(c===ks||c===ao)&&h===sp){he=lo;var It=I&&nt===ge&&ge.visualViewport?ge.visualViewport.width:nt[Rt];N-=It-r.width,N*=v?1:-1}}var xt=Object.assign({position:s},E&&n6),gn=M===!0?i6({x:N,y:Z}):{x:N,y:Z};if(N=gn.x,Z=gn.y,v){var an;return Object.assign({},xt,(an={},an[Pe]=we?"0":"",an[he]=me?"0":"",an.transform=(ge.devicePixelRatio||1)<=1?"translate("+N+"px, "+Z+"px)":"translate3d("+N+"px, "+Z+"px, 0)",an))}return Object.assign({},xt,(e={},e[Pe]=we?Z+"px":"",e[he]=me?N+"px":"",e.transform="",e))}function r6(t){var e=t.state,n=t.options,r=n.gpuAcceleration,c=r===void 0?!0:r,h=n.adaptive,p=h===void 0?!0:h,s=n.roundOffsets,v=s===void 0?!0:s,E={placement:aa(e.placement),variation:Ch(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:c,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Z2(Object.assign({},E,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:p,roundOffsets:v})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Z2(Object.assign({},E,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const s6={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:r6,data:{}};var Tg={passive:!0};function o6(t){var e=t.state,n=t.instance,r=t.options,c=r.scroll,h=c===void 0?!0:c,p=r.resize,s=p===void 0?!0:p,v=uo(e.elements.popper),E=[].concat(e.scrollParents.reference,e.scrollParents.popper);return h&&E.forEach(function(M){M.addEventListener("scroll",n.update,Tg)}),s&&v.addEventListener("resize",n.update,Tg),function(){h&&E.forEach(function(M){M.removeEventListener("scroll",n.update,Tg)}),s&&v.removeEventListener("resize",n.update,Tg)}}const a6={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:o6,data:{}};var l6={left:"right",right:"left",bottom:"top",top:"bottom"};function r_(t){return t.replace(/left|right|bottom|top/g,function(e){return l6[e]})}var c6={start:"end",end:"start"};function X2(t){return t.replace(/start|end/g,function(e){return c6[e]})}function cb(t){var e=uo(t),n=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:n,scrollTop:r}}function ub(t){return Ih(Bl(t)).left+cb(t).scrollLeft}function u6(t,e){var n=uo(t),r=Bl(t),c=n.visualViewport,h=r.clientWidth,p=r.clientHeight,s=0,v=0;if(c){h=c.width,p=c.height;var E=OI();(E||!E&&e==="fixed")&&(s=c.offsetLeft,v=c.offsetTop)}return{width:h,height:p,x:s+ub(t),y:v}}function h6(t){var e,n=Bl(t),r=cb(t),c=(e=t.ownerDocument)==null?void 0:e.body,h=$c(n.scrollWidth,n.clientWidth,c?c.scrollWidth:0,c?c.clientWidth:0),p=$c(n.scrollHeight,n.clientHeight,c?c.scrollHeight:0,c?c.clientHeight:0),s=-r.scrollLeft+ub(t),v=-r.scrollTop;return Ra(c||n).direction==="rtl"&&(s+=$c(n.clientWidth,c?c.clientWidth:0)-h),{width:h,height:p,x:s,y:v}}function hb(t){var e=Ra(t),n=e.overflow,r=e.overflowX,c=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+c+r)}function NI(t){return["html","body","#document"].indexOf(ha(t))>=0?t.ownerDocument.body:so(t)&&hb(t)?t:NI(Ey(t))}function Ud(t,e){var n;e===void 0&&(e=[]);var r=NI(t),c=r===((n=t.ownerDocument)==null?void 0:n.body),h=uo(r),p=c?[h].concat(h.visualViewport||[],hb(r)?r:[]):r,s=e.concat(p);return c?s:s.concat(Ud(Ey(p)))}function Ox(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function f6(t,e){var n=Ih(t,!1,e==="fixed");return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}function Y2(t,e,n){return e===kI?Ox(u6(t,n)):Zc(e)?f6(e,n):Ox(h6(Bl(t)))}function d6(t){var e=Ud(Ey(t)),n=["absolute","fixed"].indexOf(Ra(t).position)>=0,r=n&&so(t)?Mp(t):t;return Zc(r)?e.filter(function(c){return Zc(c)&&DI(c,r)&&ha(c)!=="body"}):[]}function p6(t,e,n,r){var c=e==="clippingParents"?d6(t):[].concat(e),h=[].concat(c,[n]),p=h[0],s=h.reduce(function(v,E){var M=Y2(t,E,r);return v.top=$c(M.top,v.top),v.right=I_(M.right,v.right),v.bottom=I_(M.bottom,v.bottom),v.left=$c(M.left,v.left),v},Y2(t,p,r));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function UI(t){var e=t.reference,n=t.element,r=t.placement,c=r?aa(r):null,h=r?Ch(r):null,p=e.x+e.width/2-n.width/2,s=e.y+e.height/2-n.height/2,v;switch(c){case ks:v={x:p,y:e.y-n.height};break;case ao:v={x:p,y:e.y+e.height};break;case lo:v={x:e.x+e.width,y:s};break;case Rs:v={x:e.x-n.width,y:s};break;default:v={x:e.x,y:e.y}}var E=c?lb(c):null;if(E!=null){var M=E==="y"?"height":"width";switch(h){case Mh:v[E]=v[E]-(e[M]/2-n[M]/2);break;case sp:v[E]=v[E]+(e[M]/2-n[M]/2);break}}return v}function op(t,e){e===void 0&&(e={});var n=e,r=n.placement,c=r===void 0?t.placement:r,h=n.strategy,p=h===void 0?t.strategy:h,s=n.boundary,v=s===void 0?O4:s,E=n.rootBoundary,M=E===void 0?kI:E,I=n.elementContext,R=I===void 0?_d:I,N=n.altBoundary,$=N===void 0?!1:N,Z=n.padding,ne=Z===void 0?0:Z,me=BI(typeof ne!="number"?ne:FI(ne,Sp)),we=R===_d?D4:_d,he=t.rects.popper,Pe=t.elements[$?we:R],ge=p6(Zc(Pe)?Pe:Pe.contextElement||Bl(t.elements.popper),v,M,p),nt=Ih(t.elements.reference),Tt=UI({reference:nt,element:he,strategy:"absolute",placement:c}),Rt=Ox(Object.assign({},he,Tt)),ke=R===_d?Rt:nt,It={top:ge.top-ke.top+me.top,bottom:ke.bottom-ge.bottom+me.bottom,left:ge.left-ke.left+me.left,right:ke.right-ge.right+me.right},xt=t.modifiersData.offset;if(R===_d&&xt){var gn=xt[c];Object.keys(It).forEach(function(an){var ln=[lo,ao].indexOf(an)>=0?1:-1,$t=[ks,ao].indexOf(an)>=0?"y":"x";It[an]+=gn[$t]*ln})}return It}function m6(t,e){e===void 0&&(e={});var n=e,r=n.placement,c=n.boundary,h=n.rootBoundary,p=n.padding,s=n.flipVariations,v=n.allowedAutoPlacements,E=v===void 0?RI:v,M=Ch(r),I=M?s?W2:W2.filter(function($){return Ch($)===M}):Sp,R=I.filter(function($){return E.indexOf($)>=0});R.length===0&&(R=I);var N=R.reduce(function($,Z){return $[Z]=op(t,{placement:Z,boundary:c,rootBoundary:h,padding:p})[aa(Z)],$},{});return Object.keys(N).sort(function($,Z){return N[$]-N[Z]})}function g6(t){if(aa(t)===sb)return[];var e=r_(t);return[X2(t),e,X2(e)]}function _6(t){var e=t.state,n=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var c=n.mainAxis,h=c===void 0?!0:c,p=n.altAxis,s=p===void 0?!0:p,v=n.fallbackPlacements,E=n.padding,M=n.boundary,I=n.rootBoundary,R=n.altBoundary,N=n.flipVariations,$=N===void 0?!0:N,Z=n.allowedAutoPlacements,ne=e.options.placement,me=aa(ne),we=me===ne,he=v||(we||!$?[r_(ne)]:g6(ne)),Pe=[ne].concat(he).reduce(function(vi,lt){return vi.concat(aa(lt)===sb?m6(e,{placement:lt,boundary:M,rootBoundary:I,padding:E,flipVariations:$,allowedAutoPlacements:Z}):lt)},[]),ge=e.rects.reference,nt=e.rects.popper,Tt=new Map,Rt=!0,ke=Pe[0],It=0;It<Pe.length;It++){var xt=Pe[It],gn=aa(xt),an=Ch(xt)===Mh,ln=[ks,ao].indexOf(gn)>=0,$t=ln?"width":"height",Mn=op(e,{placement:xt,boundary:M,rootBoundary:I,altBoundary:R,padding:E}),yn=ln?an?lo:Rs:an?ao:ks;ge[$t]>nt[$t]&&(yn=r_(yn));var vn=r_(yn),Bn=[];if(h&&Bn.push(Mn[gn]<=0),s&&Bn.push(Mn[yn]<=0,Mn[vn]<=0),Bn.every(function(vi){return vi})){ke=xt,Rt=!1;break}Tt.set(xt,Bn)}if(Rt)for(var Wn=$?3:1,pi=function(lt){var zt=Pe.find(function(yt){var Ft=Tt.get(yt);if(Ft)return Ft.slice(0,lt).every(function(Jt){return Jt})});if(zt)return ke=zt,"break"},Kn=Wn;Kn>0;Kn--){var Ii=pi(Kn);if(Ii==="break")break}e.placement!==ke&&(e.modifiersData[r]._skip=!0,e.placement=ke,e.reset=!0)}}const y6={name:"flip",enabled:!0,phase:"main",fn:_6,requiresIfExists:["offset"],data:{_skip:!1}};function K2(t,e,n){return n===void 0&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function J2(t){return[ks,lo,ao,Rs].some(function(e){return t[e]>=0})}function v6(t){var e=t.state,n=t.name,r=e.rects.reference,c=e.rects.popper,h=e.modifiersData.preventOverflow,p=op(e,{elementContext:"reference"}),s=op(e,{altBoundary:!0}),v=K2(p,r),E=K2(s,c,h),M=J2(v),I=J2(E);e.modifiersData[n]={referenceClippingOffsets:v,popperEscapeOffsets:E,isReferenceHidden:M,hasPopperEscaped:I},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":M,"data-popper-escaped":I})}const x6={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:v6};function b6(t,e,n){var r=aa(t),c=[Rs,ks].indexOf(r)>=0?-1:1,h=typeof n=="function"?n(Object.assign({},e,{placement:t})):n,p=h[0],s=h[1];return p=p||0,s=(s||0)*c,[Rs,lo].indexOf(r)>=0?{x:s,y:p}:{x:p,y:s}}function w6(t){var e=t.state,n=t.options,r=t.name,c=n.offset,h=c===void 0?[0,0]:c,p=RI.reduce(function(M,I){return M[I]=b6(I,e.rects,h),M},{}),s=p[e.placement],v=s.x,E=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=v,e.modifiersData.popperOffsets.y+=E),e.modifiersData[r]=p}const E6={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:w6};function T6(t){var e=t.state,n=t.name;e.modifiersData[n]=UI({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const A6={name:"popperOffsets",enabled:!0,phase:"read",fn:T6,data:{}};function S6(t){return t==="x"?"y":"x"}function M6(t){var e=t.state,n=t.options,r=t.name,c=n.mainAxis,h=c===void 0?!0:c,p=n.altAxis,s=p===void 0?!1:p,v=n.boundary,E=n.rootBoundary,M=n.altBoundary,I=n.padding,R=n.tether,N=R===void 0?!0:R,$=n.tetherOffset,Z=$===void 0?0:$,ne=op(e,{boundary:v,rootBoundary:E,padding:I,altBoundary:M}),me=aa(e.placement),we=Ch(e.placement),he=!we,Pe=lb(me),ge=S6(Pe),nt=e.modifiersData.popperOffsets,Tt=e.rects.reference,Rt=e.rects.popper,ke=typeof Z=="function"?Z(Object.assign({},e.rects,{placement:e.placement})):Z,It=typeof ke=="number"?{mainAxis:ke,altAxis:ke}:Object.assign({mainAxis:0,altAxis:0},ke),xt=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,gn={x:0,y:0};if(!!nt){if(h){var an,ln=Pe==="y"?ks:Rs,$t=Pe==="y"?ao:lo,Mn=Pe==="y"?"height":"width",yn=nt[Pe],vn=yn+ne[ln],Bn=yn-ne[$t],Wn=N?-Rt[Mn]/2:0,pi=we===Mh?Tt[Mn]:Rt[Mn],Kn=we===Mh?-Rt[Mn]:-Tt[Mn],Ii=e.elements.arrow,vi=N&&Ii?ab(Ii):{width:0,height:0},lt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:zI(),zt=lt[ln],yt=lt[$t],Ft=Nd(0,Tt[Mn],vi[Mn]),Jt=he?Tt[Mn]/2-Wn-Ft-zt-It.mainAxis:pi-Ft-zt-It.mainAxis,xn=he?-Tt[Mn]/2+Wn+Ft+yt+It.mainAxis:Kn+Ft+yt+It.mainAxis,wn=e.elements.arrow&&Mp(e.elements.arrow),ue=wn?Pe==="y"?wn.clientTop||0:wn.clientLeft||0:0,Me=(an=xt?.[Pe])!=null?an:0,Ve=yn+Jt-Me-ue,Qe=yn+xn-Me,st=Nd(N?I_(vn,Ve):vn,yn,N?$c(Bn,Qe):Bn);nt[Pe]=st,gn[Pe]=st-yn}if(s){var St,Dt=Pe==="x"?ks:Rs,Pt=Pe==="x"?ao:lo,Mt=nt[ge],ht=ge==="y"?"height":"width",Zt=Mt+ne[Dt],jt=Mt-ne[Pt],tn=[ks,Rs].indexOf(me)!==-1,dn=(St=xt?.[ge])!=null?St:0,et=tn?Zt:Mt-Tt[ht]-Rt[ht]-dn+It.altAxis,J=tn?Mt+Tt[ht]+Rt[ht]-dn-It.altAxis:jt,G=N&&tn?K4(et,Mt,J):Nd(N?et:Zt,Mt,N?J:jt);nt[ge]=G,gn[ge]=G-Mt}e.modifiersData[r]=gn}}const P6={name:"preventOverflow",enabled:!0,phase:"main",fn:M6,requiresIfExists:["offset"]};function I6(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function C6(t){return t===uo(t)||!so(t)?cb(t):I6(t)}function L6(t){var e=t.getBoundingClientRect(),n=Ph(e.width)/t.offsetWidth||1,r=Ph(e.height)/t.offsetHeight||1;return n!==1||r!==1}function k6(t,e,n){n===void 0&&(n=!1);var r=so(e),c=so(e)&&L6(e),h=Bl(e),p=Ih(t,c,n),s={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(r||!r&&!n)&&((ha(e)!=="body"||hb(h))&&(s=C6(e)),so(e)?(v=Ih(e,!0),v.x+=e.clientLeft,v.y+=e.clientTop):h&&(v.x=ub(h))),{x:p.left+s.scrollLeft-v.x,y:p.top+s.scrollTop-v.y,width:p.width,height:p.height}}function R6(t){var e=new Map,n=new Set,r=[];t.forEach(function(h){e.set(h.name,h)});function c(h){n.add(h.name);var p=[].concat(h.requires||[],h.requiresIfExists||[]);p.forEach(function(s){if(!n.has(s)){var v=e.get(s);v&&c(v)}}),r.push(h)}return t.forEach(function(h){n.has(h.name)||c(h)}),r}function O6(t){var e=R6(t);return H4.reduce(function(n,r){return n.concat(e.filter(function(c){return c.phase===r}))},[])}function D6(t){var e;return function(){return e||(e=new Promise(function(n){Promise.resolve().then(function(){e=void 0,n(t())})})),e}}function z6(t){var e=t.reduce(function(n,r){var c=n[r.name];return n[r.name]=c?Object.assign({},c,r,{options:Object.assign({},c.options,r.options),data:Object.assign({},c.data,r.data)}):r,n},{});return Object.keys(e).map(function(n){return e[n]})}var Q2={placement:"bottom",modifiers:[],strategy:"absolute"};function eA(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function B6(t){t===void 0&&(t={});var e=t,n=e.defaultModifiers,r=n===void 0?[]:n,c=e.defaultOptions,h=c===void 0?Q2:c;return function(s,v,E){E===void 0&&(E=h);var M={placement:"bottom",orderedModifiers:[],options:Object.assign({},Q2,h),modifiersData:{},elements:{reference:s,popper:v},attributes:{},styles:{}},I=[],R=!1,N={state:M,setOptions:function(me){var we=typeof me=="function"?me(M.options):me;Z(),M.options=Object.assign({},h,M.options,we),M.scrollParents={reference:Zc(s)?Ud(s):s.contextElement?Ud(s.contextElement):[],popper:Ud(v)};var he=O6(z6([].concat(r,M.options.modifiers)));return M.orderedModifiers=he.filter(function(Pe){return Pe.enabled}),$(),N.update()},forceUpdate:function(){if(!R){var me=M.elements,we=me.reference,he=me.popper;if(!!eA(we,he)){M.rects={reference:k6(we,Mp(he),M.options.strategy==="fixed"),popper:ab(he)},M.reset=!1,M.placement=M.options.placement,M.orderedModifiers.forEach(function(It){return M.modifiersData[It.name]=Object.assign({},It.data)});for(var Pe=0;Pe<M.orderedModifiers.length;Pe++){if(M.reset===!0){M.reset=!1,Pe=-1;continue}var ge=M.orderedModifiers[Pe],nt=ge.fn,Tt=ge.options,Rt=Tt===void 0?{}:Tt,ke=ge.name;typeof nt=="function"&&(M=nt({state:M,options:Rt,name:ke,instance:N})||M)}}}},update:D6(function(){return new Promise(function(ne){N.forceUpdate(),ne(M)})}),destroy:function(){Z(),R=!0}};if(!eA(s,v))return N;N.setOptions(E).then(function(ne){!R&&E.onFirstUpdate&&E.onFirstUpdate(ne)});function $(){M.orderedModifiers.forEach(function(ne){var me=ne.name,we=ne.options,he=we===void 0?{}:we,Pe=ne.effect;if(typeof Pe=="function"){var ge=Pe({state:M,name:me,instance:N,options:he}),nt=function(){};I.push(ge||nt)}})}function Z(){I.forEach(function(ne){return ne()}),I=[]}return N}}var F6=[a6,A6,s6,Z4,E6,y6,P6,t6,x6],fb=B6({defaultModifiers:F6}),Tl=globalThis&&globalThis.__assign||function(){return Tl=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(t[c]=e[c])}return t},Tl.apply(this,arguments)},Ag=globalThis&&globalThis.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,c=e.length,h;r<c;r++)(h||!(r in e))&&(h||(h=Array.prototype.slice.call(e,0,r)),h[r]=e[r]);return t.concat(h||Array.prototype.slice.call(e))},Dc={placement:"bottom",triggerType:"click",offsetSkidding:0,offsetDistance:10,delay:300,onShow:function(){},onHide:function(){},onToggle:function(){}},VI=function(){function t(e,n,r){e===void 0&&(e=null),n===void 0&&(n=null),r===void 0&&(r=Dc),this._targetEl=e,this._triggerEl=n,this._options=Tl(Tl({},Dc),r),this._popperInstance=this._createPopperInstance(),this._visible=!1,this._init()}return t.prototype._init=function(){this._triggerEl&&this._setupEventListeners()},t.prototype._setupEventListeners=function(){var e=this,n=this._getTriggerEvents();this._options.triggerType==="click"&&n.showEvents.forEach(function(r){e._triggerEl.addEventListener(r,function(){e.toggle()})}),this._options.triggerType==="hover"&&(n.showEvents.forEach(function(r){e._triggerEl.addEventListener(r,function(){r==="click"?e.toggle():setTimeout(function(){e.show()},e._options.delay)}),e._targetEl.addEventListener(r,function(){e.show()})}),n.hideEvents.forEach(function(r){e._triggerEl.addEventListener(r,function(){setTimeout(function(){e._targetEl.matches(":hover")||e.hide()},e._options.delay)}),e._targetEl.addEventListener(r,function(){setTimeout(function(){e._triggerEl.matches(":hover")||e.hide()},e._options.delay)})}))},t.prototype._createPopperInstance=function(){return fb(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[this._options.offsetSkidding,this._options.offsetDistance]}}]})},t.prototype._setupClickOutsideListener=function(){var e=this;this._clickOutsideEventListener=function(n){e._handleClickOutside(n,e._targetEl)},document.body.addEventListener("click",this._clickOutsideEventListener,!0)},t.prototype._removeClickOutsideListener=function(){document.body.removeEventListener("click",this._clickOutsideEventListener,!0)},t.prototype._handleClickOutside=function(e,n){var r=e.target;r!==n&&!n.contains(r)&&!this._triggerEl.contains(r)&&this.isVisible()&&this.hide()},t.prototype._getTriggerEvents=function(){switch(this._options.triggerType){case"hover":return{showEvents:["mouseenter","click"],hideEvents:["mouseleave"]};case"click":return{showEvents:["click"],hideEvents:[]};case"none":return{showEvents:[],hideEvents:[]};default:return{showEvents:["click"],hideEvents:[]}}},t.prototype.toggle=function(){this.isVisible()?this.hide():this.show(),this._options.onToggle(this)},t.prototype.isVisible=function(){return this._visible},t.prototype.show=function(){this._targetEl.classList.remove("hidden"),this._targetEl.classList.add("block"),this._popperInstance.setOptions(function(e){return Tl(Tl({},e),{modifiers:Ag(Ag([],e.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this._setupClickOutsideListener(),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)},t.prototype.hide=function(){this._targetEl.classList.remove("block"),this._targetEl.classList.add("hidden"),this._popperInstance.setOptions(function(e){return Tl(Tl({},e),{modifiers:Ag(Ag([],e.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this._visible=!1,this._removeClickOutsideListener(),this._options.onHide(this)},t}();typeof window<"u"&&(window.Dropdown=VI);function jI(){document.querySelectorAll("[data-dropdown-toggle]").forEach(function(t){var e=t.getAttribute("data-dropdown-toggle"),n=document.getElementById(e);if(n){var r=t.getAttribute("data-dropdown-placement"),c=t.getAttribute("data-dropdown-offset-skidding"),h=t.getAttribute("data-dropdown-offset-distance"),p=t.getAttribute("data-dropdown-trigger"),s=t.getAttribute("data-dropdown-delay");new VI(n,t,{placement:r||Dc.placement,triggerType:p||Dc.triggerType,offsetSkidding:c?parseInt(c):Dc.offsetSkidding,offsetDistance:h?parseInt(h):Dc.offsetDistance,delay:s?parseInt(s):Dc.delay})}else console.error('The dropdown element with id "'.concat(e,'" does not exist. Please check the data-dropdown-toggle attribute.'))})}var C_=globalThis&&globalThis.__assign||function(){return C_=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(t[c]=e[c])}return t},C_.apply(this,arguments)},oh={placement:"center",backdropClasses:"bg-gray-900 bg-opacity-50 dark:bg-opacity-80 fixed inset-0 z-40",backdrop:"dynamic",closable:!0,onHide:function(){},onShow:function(){},onToggle:function(){}},Dx=function(){function t(e,n){e===void 0&&(e=null),n===void 0&&(n=oh),this._targetEl=e,this._options=C_(C_({},oh),n),this._isHidden=!0,this._backdropEl=null,this._init()}return t.prototype._init=function(){var e=this;this._targetEl&&this._getPlacementClasses().map(function(n){e._targetEl.classList.add(n)})},t.prototype._createBackdrop=function(){var e;if(this._isHidden){var n=document.createElement("div");n.setAttribute("modal-backdrop",""),(e=n.classList).add.apply(e,this._options.backdropClasses.split(" ")),document.querySelector("body").append(n),this._backdropEl=n}},t.prototype._destroyBackdropEl=function(){this._isHidden||document.querySelector("[modal-backdrop]").remove()},t.prototype._setupModalCloseEventListeners=function(){var e=this;this._options.backdrop==="dynamic"&&(this._clickOutsideEventListener=function(n){e._handleOutsideClick(n.target)},this._targetEl.addEventListener("click",this._clickOutsideEventListener,!0)),this._keydownEventListener=function(n){n.key==="Escape"&&e.hide()},document.body.addEventListener("keydown",this._keydownEventListener,!0)},t.prototype._removeModalCloseEventListeners=function(){this._options.backdrop==="dynamic"&&this._targetEl.removeEventListener("click",this._clickOutsideEventListener,!0),document.body.removeEventListener("keydown",this._keydownEventListener,!0)},t.prototype._handleOutsideClick=function(e){(e===this._targetEl||e===this._backdropEl&&this.isVisible())&&this.hide()},t.prototype._getPlacementClasses=function(){switch(this._options.placement){case"top-left":return["justify-start","items-start"];case"top-center":return["justify-center","items-start"];case"top-right":return["justify-end","items-start"];case"center-left":return["justify-start","items-center"];case"center":return["justify-center","items-center"];case"center-right":return["justify-end","items-center"];case"bottom-left":return["justify-start","items-end"];case"bottom-center":return["justify-center","items-end"];case"bottom-right":return["justify-end","items-end"];default:return["justify-center","items-center"]}},t.prototype.toggle=function(){this._isHidden?this.show():this.hide(),this._options.onToggle(this)},t.prototype.show=function(){this.isHidden&&(this._targetEl.classList.add("flex"),this._targetEl.classList.remove("hidden"),this._targetEl.setAttribute("aria-modal","true"),this._targetEl.setAttribute("role","dialog"),this._targetEl.removeAttribute("aria-hidden"),this._createBackdrop(),this._isHidden=!1,document.body.classList.add("overflow-hidden"),this._options.closable&&this._setupModalCloseEventListeners(),this._options.onShow(this))},t.prototype.hide=function(){this.isVisible&&(this._targetEl.classList.add("hidden"),this._targetEl.classList.remove("flex"),this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.removeAttribute("aria-modal"),this._targetEl.removeAttribute("role"),this._destroyBackdropEl(),this._isHidden=!0,document.body.classList.remove("overflow-hidden"),this._options.closable&&this._removeModalCloseEventListeners(),this._options.onHide(this))},t.prototype.isVisible=function(){return!this._isHidden},t.prototype.isHidden=function(){return this._isHidden},t}();typeof window<"u"&&(window.Modal=Dx);var Sg=function(t,e){return e.some(function(n){return n.id===t})?e.find(function(n){return n.id===t}):null};function GI(){var t=[];document.querySelectorAll("[data-modal-target]").forEach(function(e){var n=e.getAttribute("data-modal-target"),r=document.getElementById(n);if(r){var c=r.getAttribute("data-modal-placement"),h=r.getAttribute("data-modal-backdrop");Sg(n,t)||t.push({id:n,object:new Dx(r,{placement:c||oh.placement,backdrop:h||oh.backdrop})})}else console.error("Modal with id ".concat(n," does not exist. Are you sure that the data-modal-target attribute points to the correct modal id?."))}),document.querySelectorAll("[data-modal-toggle]").forEach(function(e){var n=e.getAttribute("data-modal-toggle"),r=document.getElementById(n);if(r){var c=r.getAttribute("data-modal-placement"),h=r.getAttribute("data-modal-backdrop"),p=Sg(n,t);p||(p={id:n,object:new Dx(r,{placement:c||oh.placement,backdrop:h||oh.backdrop})},t.push(p)),e.addEventListener("click",function(){p.object.toggle()})}else console.error("Modal with id ".concat(n," does not exist. Are you sure that the data-modal-toggle attribute points to the correct modal id?"))}),document.querySelectorAll("[data-modal-show]").forEach(function(e){var n=e.getAttribute("data-modal-show"),r=document.getElementById(n);if(r){var c=Sg(n,t);c?e.addEventListener("click",function(){c.object.isHidden&&c.object.show()}):console.error("Modal with id ".concat(n," has not been initialized. Please initialize it using the data-modal-target attribute."))}else console.error("Modal with id ".concat(n," does not exist. Are you sure that the data-modal-show attribute points to the correct modal id?"))}),document.querySelectorAll("[data-modal-hide]").forEach(function(e){var n=e.getAttribute("data-modal-hide"),r=document.getElementById(n);if(r){var c=Sg(n,t);c?e.addEventListener("click",function(){c.object.isVisible&&c.object.hide()}):console.error("Modal with id ".concat(n," has not been initialized. Please initialize it using the data-modal-target attribute."))}else console.error("Modal with id ".concat(n," does not exist. Are you sure that the data-modal-hide attribute points to the correct modal id?"))})}var L_=globalThis&&globalThis.__assign||function(){return L_=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(t[c]=e[c])}return t},L_.apply(this,arguments)},zc={placement:"left",bodyScrolling:!1,backdrop:!0,edge:!1,edgeOffset:"bottom-[60px]",backdropClasses:"bg-gray-900 bg-opacity-50 dark:bg-opacity-80 fixed inset-0 z-30",onShow:function(){},onHide:function(){},onToggle:function(){}},$I=function(){function t(e,n){e===void 0&&(e=null),n===void 0&&(n=zc),this._targetEl=e,this._options=L_(L_({},zc),n),this._visible=!1,this._init()}return t.prototype._init=function(){var e=this;this._targetEl&&(this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.classList.add("transition-transform")),this._getPlacementClasses(this._options.placement).base.map(function(n){e._targetEl.classList.add(n)}),document.addEventListener("keydown",function(n){n.key==="Escape"&&e.isVisible()&&e.hide()})},t.prototype.hide=function(){var e=this;this._options.edge?(this._getPlacementClasses(this._options.placement+"-edge").active.map(function(n){e._targetEl.classList.remove(n)}),this._getPlacementClasses(this._options.placement+"-edge").inactive.map(function(n){e._targetEl.classList.add(n)})):(this._getPlacementClasses(this._options.placement).active.map(function(n){e._targetEl.classList.remove(n)}),this._getPlacementClasses(this._options.placement).inactive.map(function(n){e._targetEl.classList.add(n)})),this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.removeAttribute("aria-modal"),this._targetEl.removeAttribute("role"),this._options.bodyScrolling||document.body.classList.remove("overflow-hidden"),this._options.backdrop&&this._destroyBackdropEl(),this._visible=!1,this._options.onHide(this)},t.prototype.show=function(){var e=this;this._options.edge?(this._getPlacementClasses(this._options.placement+"-edge").active.map(function(n){e._targetEl.classList.add(n)}),this._getPlacementClasses(this._options.placement+"-edge").inactive.map(function(n){e._targetEl.classList.remove(n)})):(this._getPlacementClasses(this._options.placement).active.map(function(n){e._targetEl.classList.add(n)}),this._getPlacementClasses(this._options.placement).inactive.map(function(n){e._targetEl.classList.remove(n)})),this._targetEl.setAttribute("aria-modal","true"),this._targetEl.setAttribute("role","dialog"),this._targetEl.removeAttribute("aria-hidden"),this._options.bodyScrolling||document.body.classList.add("overflow-hidden"),this._options.backdrop&&this._createBackdrop(),this._visible=!0,this._options.onShow(this)},t.prototype.toggle=function(){this.isVisible()?this.hide():this.show()},t.prototype._createBackdrop=function(){var e,n=this;if(!this._visible){var r=document.createElement("div");r.setAttribute("drawer-backdrop",""),(e=r.classList).add.apply(e,this._options.backdropClasses.split(" ")),document.querySelector("body").append(r),r.addEventListener("click",function(){n.hide()})}},t.prototype._destroyBackdropEl=function(){this._visible&&document.querySelector("[drawer-backdrop]").remove()},t.prototype._getPlacementClasses=function(e){switch(e){case"top":return{base:["top-0","left-0","right-0"],active:["transform-none"],inactive:["-translate-y-full"]};case"right":return{base:["right-0","top-0"],active:["transform-none"],inactive:["translate-x-full"]};case"bottom":return{base:["bottom-0","left-0","right-0"],active:["transform-none"],inactive:["translate-y-full"]};case"left":return{base:["left-0","top-0"],active:["transform-none"],inactive:["-translate-x-full"]};case"bottom-edge":return{base:["left-0","top-0"],active:["transform-none"],inactive:["translate-y-full",this._options.edgeOffset]};default:return{base:["left-0","top-0"],active:["transform-none"],inactive:["-translate-x-full"]}}},t.prototype.isHidden=function(){return!this._visible},t.prototype.isVisible=function(){return this._visible},t}();typeof window<"u"&&(window.Drawer=$I);var Mg=function(t,e){if(e.some(function(n){return n.id===t}))return e.find(function(n){return n.id===t})};function N6(){var t=[];document.querySelectorAll("[data-drawer-target]").forEach(function(e){var n=e.getAttribute("data-drawer-target"),r=document.getElementById(n);if(r){var c=e.getAttribute("data-drawer-placement"),h=e.getAttribute("data-drawer-body-scrolling"),p=e.getAttribute("data-drawer-backdrop"),s=e.getAttribute("data-drawer-edge"),v=e.getAttribute("data-drawer-edge-offset");Mg(n,t)||t.push({id:n,object:new $I(r,{placement:c||zc.placement,bodyScrolling:h?h==="true":zc.bodyScrolling,backdrop:p?p==="true":zc.backdrop,edge:s?s==="true":zc.edge,edgeOffset:v||zc.edgeOffset})})}else console.error("Drawer with id ".concat(n," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id?"))}),document.querySelectorAll("[data-drawer-toggle]").forEach(function(e){var n=e.getAttribute("data-drawer-toggle"),r=document.getElementById(n);if(r){var c=Mg(n,t);c?e.addEventListener("click",function(){c.object.toggle()}):console.error("Drawer with id ".concat(n," has not been initialized. Please initialize it using the data-drawer-target attribute."))}else console.error("Drawer with id ".concat(n," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id?"))}),document.querySelectorAll("[data-drawer-dismiss], [data-drawer-hide]").forEach(function(e){var n=e.getAttribute("data-drawer-dismiss")?e.getAttribute("data-drawer-dismiss"):e.getAttribute("data-drawer-hide"),r=document.getElementById(n);if(r){var c=Mg(n,t);c?e.addEventListener("click",function(){c.object.hide()}):console.error("Drawer with id ".concat(n," has not been initialized. Please initialize it using the data-drawer-target attribute."))}else console.error("Drawer with id ".concat(n," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id"))}),document.querySelectorAll("[data-drawer-show]").forEach(function(e){var n=e.getAttribute("data-drawer-show"),r=document.getElementById(n);if(r){var c=Mg(n,t);c?e.addEventListener("click",function(){c.object.show()}):console.error("Drawer with id ".concat(n," has not been initialized. Please initialize it using the data-drawer-target attribute."))}else console.error("Drawer with id ".concat(n," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id?"))})}var k_=globalThis&&globalThis.__assign||function(){return k_=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(t[c]=e[c])}return t},k_.apply(this,arguments)},tA={defaultTabId:null,activeClasses:"text-blue-600 hover:text-blue-600 dark:text-blue-500 dark:hover:text-blue-500 border-blue-600 dark:border-blue-500",inactiveClasses:"dark:border-transparent text-gray-500 hover:text-gray-600 dark:text-gray-400 border-gray-100 hover:border-gray-300 dark:border-gray-700 dark:hover:text-gray-300",onShow:function(){}},HI=function(){function t(e,n){e===void 0&&(e=[]),n===void 0&&(n=tA),this._items=e,this._activeTab=n?this.getTab(n.defaultTabId):null,this._options=k_(k_({},tA),n),this._init()}return t.prototype._init=function(){var e=this;this._items.length&&(this._activeTab||this._setActiveTab(this._items[0]),this.show(this._activeTab.id,!0),this._items.map(function(n){n.triggerEl.addEventListener("click",function(){e.show(n.id)})}))},t.prototype.getActiveTab=function(){return this._activeTab},t.prototype._setActiveTab=function(e){this._activeTab=e},t.prototype.getTab=function(e){return this._items.filter(function(n){return n.id===e})[0]},t.prototype.show=function(e,n){var r,c,h=this;n===void 0&&(n=!1);var p=this.getTab(e);p===this._activeTab&&!n||(this._items.map(function(s){var v,E;s!==p&&((v=s.triggerEl.classList).remove.apply(v,h._options.activeClasses.split(" ")),(E=s.triggerEl.classList).add.apply(E,h._options.inactiveClasses.split(" ")),s.targetEl.classList.add("hidden"),s.triggerEl.setAttribute("aria-selected","false"))}),(r=p.triggerEl.classList).add.apply(r,this._options.activeClasses.split(" ")),(c=p.triggerEl.classList).remove.apply(c,this._options.inactiveClasses.split(" ")),p.triggerEl.setAttribute("aria-selected","true"),p.targetEl.classList.remove("hidden"),this._setActiveTab(p),this._options.onShow(this,p))},t}();typeof window<"u"&&(window.Tabs=HI);function U6(){document.querySelectorAll("[data-tabs-toggle]").forEach(function(t){var e=[],n=null;t.querySelectorAll('[role="tab"]').forEach(function(r){var c=r.getAttribute("aria-selected")==="true",h={id:r.getAttribute("data-tabs-target"),triggerEl:r,targetEl:document.querySelector(r.getAttribute("data-tabs-target"))};e.push(h),c&&(n=h.id)}),new HI(e,{defaultTabId:n})})}var Al=globalThis&&globalThis.__assign||function(){return Al=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(t[c]=e[c])}return t},Al.apply(this,arguments)},Pg=globalThis&&globalThis.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,c=e.length,h;r<c;r++)(h||!(r in e))&&(h||(h=Array.prototype.slice.call(e,0,r)),h[r]=e[r]);return t.concat(h||Array.prototype.slice.call(e))},R_={placement:"top",triggerType:"hover",onShow:function(){},onHide:function(){},onToggle:function(){}},WI=function(){function t(e,n,r){e===void 0&&(e=null),n===void 0&&(n=null),r===void 0&&(r=R_),this._targetEl=e,this._triggerEl=n,this._options=Al(Al({},R_),r),this._popperInstance=this._createPopperInstance(),this._visible=!1,this._init()}return t.prototype._init=function(){this._triggerEl&&this._setupEventListeners()},t.prototype._setupEventListeners=function(){var e=this,n=this._getTriggerEvents();n.showEvents.forEach(function(r){e._triggerEl.addEventListener(r,function(){e.show()})}),n.hideEvents.forEach(function(r){e._triggerEl.addEventListener(r,function(){e.hide()})})},t.prototype._createPopperInstance=function(){return fb(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[0,8]}}]})},t.prototype._getTriggerEvents=function(){switch(this._options.triggerType){case"hover":return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};case"none":return{showEvents:[],hideEvents:[]};default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]}}},t.prototype._setupClickOutsideListener=function(){var e=this;this._clickOutsideEventListener=function(n){e._handleClickOutside(n,e._targetEl)},document.body.addEventListener("click",this._clickOutsideEventListener,!0)},t.prototype._removeClickOutsideListener=function(){document.body.removeEventListener("click",this._clickOutsideEventListener,!0)},t.prototype._handleClickOutside=function(e,n){var r=e.target;r!==n&&!n.contains(r)&&!this._triggerEl.contains(r)&&this.isVisible()&&this.hide()},t.prototype.isVisible=function(){return this._visible},t.prototype.toggle=function(){this.isVisible()?this.hide():this.show()},t.prototype.show=function(){this._targetEl.classList.remove("opacity-0","invisible"),this._targetEl.classList.add("opacity-100","visible"),this._popperInstance.setOptions(function(e){return Al(Al({},e),{modifiers:Pg(Pg([],e.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this._setupClickOutsideListener(),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)},t.prototype.hide=function(){this._targetEl.classList.remove("opacity-100","visible"),this._targetEl.classList.add("opacity-0","invisible"),this._popperInstance.setOptions(function(e){return Al(Al({},e),{modifiers:Pg(Pg([],e.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this._removeClickOutsideListener(),this._visible=!1,this._options.onHide(this)},t}();typeof window<"u"&&(window.Tooltip=WI);function V6(){document.querySelectorAll("[data-tooltip-target]").forEach(function(t){var e=t.getAttribute("data-tooltip-target"),n=document.getElementById(e);if(n){var r=t.getAttribute("data-tooltip-trigger"),c=t.getAttribute("data-tooltip-placement");new WI(n,t,{placement:c||R_.placement,triggerType:r||R_.triggerType})}else console.error('The tooltip element with id "'.concat(e,'" does not exist. Please check the data-tooltip-target attribute.'))})}var Sl=globalThis&&globalThis.__assign||function(){return Sl=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(t[c]=e[c])}return t},Sl.apply(this,arguments)},Ig=globalThis&&globalThis.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,c=e.length,h;r<c;r++)(h||!(r in e))&&(h||(h=Array.prototype.slice.call(e,0,r)),h[r]=e[r]);return t.concat(h||Array.prototype.slice.call(e))},Vd={placement:"top",offset:10,triggerType:"hover",onShow:function(){},onHide:function(){},onToggle:function(){}},qI=function(){function t(e,n,r){e===void 0&&(e=null),n===void 0&&(n=null),r===void 0&&(r=Vd),this._targetEl=e,this._triggerEl=n,this._options=Sl(Sl({},Vd),r),this._popperInstance=this._createPopperInstance(),this._visible=!1,this._init()}return t.prototype._init=function(){this._triggerEl&&this._setupEventListeners()},t.prototype._setupEventListeners=function(){var e=this,n=this._getTriggerEvents();n.showEvents.forEach(function(r){e._triggerEl.addEventListener(r,function(){e.show()}),e._targetEl.addEventListener(r,function(){e.show()})}),n.hideEvents.forEach(function(r){e._triggerEl.addEventListener(r,function(){setTimeout(function(){e._targetEl.matches(":hover")||e.hide()},100)}),e._targetEl.addEventListener(r,function(){setTimeout(function(){e._triggerEl.matches(":hover")||e.hide()},100)})})},t.prototype._createPopperInstance=function(){return fb(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[0,this._options.offset]}}]})},t.prototype._getTriggerEvents=function(){switch(this._options.triggerType){case"hover":return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};case"none":return{showEvents:[],hideEvents:[]};default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]}}},t.prototype._setupClickOutsideListener=function(){var e=this;this._clickOutsideEventListener=function(n){e._handleClickOutside(n,e._targetEl)},document.body.addEventListener("click",this._clickOutsideEventListener,!0)},t.prototype._removeClickOutsideListener=function(){document.body.removeEventListener("click",this._clickOutsideEventListener,!0)},t.prototype._handleClickOutside=function(e,n){var r=e.target;r!==n&&!n.contains(r)&&!this._triggerEl.contains(r)&&this.isVisible()&&this.hide()},t.prototype.isVisible=function(){return this._visible},t.prototype.toggle=function(){this.isVisible()?this.hide():this.show(),this._options.onToggle(this)},t.prototype.show=function(){this._targetEl.classList.remove("opacity-0","invisible"),this._targetEl.classList.add("opacity-100","visible"),this._popperInstance.setOptions(function(e){return Sl(Sl({},e),{modifiers:Ig(Ig([],e.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this._setupClickOutsideListener(),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)},t.prototype.hide=function(){this._targetEl.classList.remove("opacity-100","visible"),this._targetEl.classList.add("opacity-0","invisible"),this._popperInstance.setOptions(function(e){return Sl(Sl({},e),{modifiers:Ig(Ig([],e.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this._removeClickOutsideListener(),this._visible=!1,this._options.onHide(this)},t}();typeof window<"u"&&(window.Popover=qI);function j6(){document.querySelectorAll("[data-popover-target]").forEach(function(t){var e=t.getAttribute("data-popover-target"),n=document.getElementById(e);if(n){var r=t.getAttribute("data-popover-trigger"),c=t.getAttribute("data-popover-placement"),h=t.getAttribute("data-popover-offset");new qI(n,t,{placement:c||Vd.placement,offset:h?parseInt(h):Vd.offset,triggerType:r||Vd.triggerType})}else console.error('The popover element with id "'.concat(e,'" does not exist. Please check the data-popover-target attribute.'))})}var O_=globalThis&&globalThis.__assign||function(){return O_=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(t[c]=e[c])}return t},O_.apply(this,arguments)},zx={triggerType:"hover",onShow:function(){},onHide:function(){},onToggle:function(){}},ZI=function(){function t(e,n,r,c){e===void 0&&(e=null),n===void 0&&(n=null),r===void 0&&(r=null),c===void 0&&(c=zx),this._parentEl=e,this._triggerEl=n,this._targetEl=r,this._options=O_(O_({},zx),c),this._visible=!1,this._init()}return t.prototype._init=function(){var e=this;if(this._triggerEl){var n=this._getTriggerEventTypes(this._options.triggerType);n.showEvents.forEach(function(r){e._triggerEl.addEventListener(r,function(){e.show()}),e._targetEl.addEventListener(r,function(){e.show()})}),n.hideEvents.forEach(function(r){e._parentEl.addEventListener(r,function(){e._parentEl.matches(":hover")||e.hide()})})}},t.prototype.hide=function(){this._targetEl.classList.add("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","false"),this._visible=!1,this._options.onHide(this)},t.prototype.show=function(){this._targetEl.classList.remove("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","true"),this._visible=!0,this._options.onShow(this)},t.prototype.toggle=function(){this._visible?this.hide():this.show()},t.prototype.isHidden=function(){return!this._visible},t.prototype.isVisible=function(){return this._visible},t.prototype._getTriggerEventTypes=function(e){switch(e){case"hover":return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};case"none":return{showEvents:[],hideEvents:[]};default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]}}},t}();typeof window<"u"&&(window.Dial=ZI);function G6(){document.querySelectorAll("[data-dial-init]").forEach(function(t){var e=t.querySelector("[data-dial-toggle]");if(e){var n=e.getAttribute("data-dial-toggle"),r=document.getElementById(n);if(r){var c=e.getAttribute("data-dial-trigger");new ZI(t,e,r,{triggerType:c||zx.triggerType})}else console.error("Dial with id ".concat(n," does not exist. Are you sure that the data-dial-toggle attribute points to the correct modal id?"))}else console.error("Dial with id ".concat(t.id," does not have a trigger element. Are you sure that the data-dial-toggle attribute exists?"))})}var $6=new I4("load",[C4,L4,k4,R4,jI,GI,N6,U6,V6,j6,G6]);$6.init();function H6(t,e){return Kr(),Is("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[en("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})])}function W6(t,e){return Kr(),Is("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[en("path",{"fill-rule":"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z","clip-rule":"evenodd"})])}var nA;const Ty=typeof window<"u",q6=t=>typeof t<"u",Z6=t=>typeof t=="function";Ty&&((nA=window?.navigator)==null?void 0:nA.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function X6(t){return t}Ty&&window.document;Ty&&window.navigator;Ty&&window.location;function Y6(t){return JSON.parse(JSON.stringify(t))}const Bx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Fx="__vueuse_ssr_handlers__";Bx[Fx]=Bx[Fx]||{};Bx[Fx];var iA;(function(t){t.UP="UP",t.RIGHT="RIGHT",t.DOWN="DOWN",t.LEFT="LEFT",t.NONE="NONE"})(iA||(iA={}));var K6=Object.defineProperty,rA=Object.getOwnPropertySymbols,J6=Object.prototype.hasOwnProperty,Q6=Object.prototype.propertyIsEnumerable,sA=(t,e,n)=>e in t?K6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,eN=(t,e)=>{for(var n in e||(e={}))J6.call(e,n)&&sA(t,n,e[n]);if(rA)for(var n of rA(e))Q6.call(e,n)&&sA(t,n,e[n]);return t};const tN={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};eN({linear:X6},tN);function XI(t,e,n,r={}){var c,h,p;const{clone:s=!1,passive:v=!1,eventName:E,deep:M=!1,defaultValue:I}=r,R=SP(),N=n||R?.emit||((c=R?.$emit)==null?void 0:c.bind(R))||((p=(h=R?.proxy)==null?void 0:h.$emit)==null?void 0:p.bind(R?.proxy));let $=E;e||(e="modelValue"),$=E||$||`update:${e.toString()}`;const Z=me=>s?Z6(s)?s(me):Y6(me):me,ne=()=>q6(t[e])?Z(t[e]):I;if(v){const me=ne(),we=$r(me);return nr(()=>t[e],he=>we.value=Z(he)),nr(we,he=>{(he!==t[e]||M)&&N($,he)},{deep:M}),we}else return Ri({get(){return ne()},set(me){N($,me)}})}var YI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nN(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Nx={exports:{}};(function(t,e){(function(n,r){r(e)})(YI,function(n){n.PipsMode=void 0,function(J){J.Range="range",J.Steps="steps",J.Positions="positions",J.Count="count",J.Values="values"}(n.PipsMode||(n.PipsMode={})),n.PipsType=void 0,function(J){J[J.None=-1]="None",J[J.NoValue=0]="NoValue",J[J.LargeValue=1]="LargeValue",J[J.SmallValue=2]="SmallValue"}(n.PipsType||(n.PipsType={}));function r(J){return c(J)&&typeof J.from=="function"}function c(J){return typeof J=="object"&&typeof J.to=="function"}function h(J){J.parentElement.removeChild(J)}function p(J){return J!=null}function s(J){J.preventDefault()}function v(J){return J.filter(function(G){return this[G]?!1:this[G]=!0},{})}function E(J,G){return Math.round(J/G)*G}function M(J,G){var Fe=J.getBoundingClientRect(),gt=J.ownerDocument,ct=gt.documentElement,sn=he(gt);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(sn.x=0),G?Fe.top+sn.y-ct.clientTop:Fe.left+sn.x-ct.clientLeft}function I(J){return typeof J=="number"&&!isNaN(J)&&isFinite(J)}function R(J,G,Fe){Fe>0&&(ne(J,G),setTimeout(function(){me(J,G)},Fe))}function N(J){return Math.max(Math.min(J,100),0)}function $(J){return Array.isArray(J)?J:[J]}function Z(J){J=String(J);var G=J.split(".");return G.length>1?G[1].length:0}function ne(J,G){J.classList&&!/\s/.test(G)?J.classList.add(G):J.className+=" "+G}function me(J,G){J.classList&&!/\s/.test(G)?J.classList.remove(G):J.className=J.className.replace(new RegExp("(^|\\b)"+G.split(" ").join("|")+"(\\b|$)","gi")," ")}function we(J,G){return J.classList?J.classList.contains(G):new RegExp("\\b"+G+"\\b").test(J.className)}function he(J){var G=window.pageXOffset!==void 0,Fe=(J.compatMode||"")==="CSS1Compat",gt=G?window.pageXOffset:Fe?J.documentElement.scrollLeft:J.body.scrollLeft,ct=G?window.pageYOffset:Fe?J.documentElement.scrollTop:J.body.scrollTop;return{x:gt,y:ct}}function Pe(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function ge(){var J=!1;try{var G=Object.defineProperty({},"passive",{get:function(){J=!0}});window.addEventListener("test",null,G)}catch{}return J}function nt(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function Tt(J,G){return 100/(G-J)}function Rt(J,G,Fe){return G*100/(J[Fe+1]-J[Fe])}function ke(J,G){return Rt(J,J[0]<0?G+Math.abs(J[0]):G-J[0],0)}function It(J,G){return G*(J[1]-J[0])/100+J[0]}function xt(J,G){for(var Fe=1;J>=G[Fe];)Fe+=1;return Fe}function gn(J,G,Fe){if(Fe>=J.slice(-1)[0])return 100;var gt=xt(Fe,J),ct=J[gt-1],sn=J[gt],fn=G[gt-1],$n=G[gt];return fn+ke([ct,sn],Fe)/Tt(fn,$n)}function an(J,G,Fe){if(Fe>=100)return J.slice(-1)[0];var gt=xt(Fe,G),ct=J[gt-1],sn=J[gt],fn=G[gt-1],$n=G[gt];return It([ct,sn],(Fe-fn)*Tt(fn,$n))}function ln(J,G,Fe,gt){if(gt===100)return gt;var ct=xt(gt,J),sn=J[ct-1],fn=J[ct];return Fe?gt-sn>(fn-sn)/2?fn:sn:G[ct-1]?J[ct-1]+E(gt-J[ct-1],G[ct-1]):gt}var $t=function(){function J(G,Fe,gt){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[gt||!1],this.xNumSteps=[!1],this.snap=Fe;var ct,sn=[];for(Object.keys(G).forEach(function(fn){sn.push([$(G[fn]),fn])}),sn.sort(function(fn,$n){return fn[0][0]-$n[0][0]}),ct=0;ct<sn.length;ct++)this.handleEntryPoint(sn[ct][1],sn[ct][0]);for(this.xNumSteps=this.xSteps.slice(0),ct=0;ct<this.xNumSteps.length;ct++)this.handleStepPoint(ct,this.xNumSteps[ct])}return J.prototype.getDistance=function(G){for(var Fe=[],gt=0;gt<this.xNumSteps.length-1;gt++)Fe[gt]=Rt(this.xVal,G,gt);return Fe},J.prototype.getAbsoluteDistance=function(G,Fe,gt){var ct=0;if(G<this.xPct[this.xPct.length-1])for(;G>this.xPct[ct+1];)ct++;else G===this.xPct[this.xPct.length-1]&&(ct=this.xPct.length-2);!gt&&G===this.xPct[ct+1]&&ct++,Fe===null&&(Fe=[]);var sn,fn=1,$n=Fe[ct],nn=0,ei=0,qi=0,hi=0;for(gt?sn=(G-this.xPct[ct])/(this.xPct[ct+1]-this.xPct[ct]):sn=(this.xPct[ct+1]-G)/(this.xPct[ct+1]-this.xPct[ct]);$n>0;)nn=this.xPct[ct+1+hi]-this.xPct[ct+hi],Fe[ct+hi]*fn+100-sn*100>100?(ei=nn*sn,fn=($n-100*sn)/Fe[ct+hi],sn=1):(ei=Fe[ct+hi]*nn/100*fn,fn=0),gt?(qi=qi-ei,this.xPct.length+hi>=1&&hi--):(qi=qi+ei,this.xPct.length-hi>=1&&hi++),$n=Fe[ct+hi]*fn;return G+qi},J.prototype.toStepping=function(G){return G=gn(this.xVal,this.xPct,G),G},J.prototype.fromStepping=function(G){return an(this.xVal,this.xPct,G)},J.prototype.getStep=function(G){return G=ln(this.xPct,this.xSteps,this.snap,G),G},J.prototype.getDefaultStep=function(G,Fe,gt){var ct=xt(G,this.xPct);return(G===100||Fe&&G===this.xPct[ct-1])&&(ct=Math.max(ct-1,1)),(this.xVal[ct]-this.xVal[ct-1])/gt},J.prototype.getNearbySteps=function(G){var Fe=xt(G,this.xPct);return{stepBefore:{startValue:this.xVal[Fe-2],step:this.xNumSteps[Fe-2],highestStep:this.xHighestCompleteStep[Fe-2]},thisStep:{startValue:this.xVal[Fe-1],step:this.xNumSteps[Fe-1],highestStep:this.xHighestCompleteStep[Fe-1]},stepAfter:{startValue:this.xVal[Fe],step:this.xNumSteps[Fe],highestStep:this.xHighestCompleteStep[Fe]}}},J.prototype.countStepDecimals=function(){var G=this.xNumSteps.map(Z);return Math.max.apply(null,G)},J.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},J.prototype.convert=function(G){return this.getStep(this.toStepping(G))},J.prototype.handleEntryPoint=function(G,Fe){var gt;if(G==="min"?gt=0:G==="max"?gt=100:gt=parseFloat(G),!I(gt)||!I(Fe[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(gt),this.xVal.push(Fe[0]);var ct=Number(Fe[1]);gt?this.xSteps.push(isNaN(ct)?!1:ct):isNaN(ct)||(this.xSteps[0]=ct),this.xHighestCompleteStep.push(0)},J.prototype.handleStepPoint=function(G,Fe){if(!!Fe){if(this.xVal[G]===this.xVal[G+1]){this.xSteps[G]=this.xHighestCompleteStep[G]=this.xVal[G];return}this.xSteps[G]=Rt([this.xVal[G],this.xVal[G+1]],Fe,0)/Tt(this.xPct[G],this.xPct[G+1]);var gt=(this.xVal[G+1]-this.xVal[G])/this.xNumSteps[G],ct=Math.ceil(Number(gt.toFixed(3))-1),sn=this.xVal[G]+this.xNumSteps[G]*ct;this.xHighestCompleteStep[G]=sn}},J}(),Mn={to:function(J){return J===void 0?"":J.toFixed(2)},from:Number},yn={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},vn={tooltips:".__tooltips",aria:".__aria"};function Bn(J,G){if(!I(G))throw new Error("noUiSlider: 'step' is not numeric.");J.singleStep=G}function Wn(J,G){if(!I(G))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");J.keyboardPageMultiplier=G}function pi(J,G){if(!I(G))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");J.keyboardMultiplier=G}function Kn(J,G){if(!I(G))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");J.keyboardDefaultStep=G}function Ii(J,G){if(typeof G!="object"||Array.isArray(G))throw new Error("noUiSlider: 'range' is not an object.");if(G.min===void 0||G.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");J.spectrum=new $t(G,J.snap||!1,J.singleStep)}function vi(J,G){if(G=$(G),!Array.isArray(G)||!G.length)throw new Error("noUiSlider: 'start' option is incorrect.");J.handles=G.length,J.start=G}function lt(J,G){if(typeof G!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");J.snap=G}function zt(J,G){if(typeof G!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");J.animate=G}function yt(J,G){if(typeof G!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");J.animationDuration=G}function Ft(J,G){var Fe=[!1],gt;if(G==="lower"?G=[!0,!1]:G==="upper"&&(G=[!1,!0]),G===!0||G===!1){for(gt=1;gt<J.handles;gt++)Fe.push(G);Fe.push(!1)}else{if(!Array.isArray(G)||!G.length||G.length!==J.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");Fe=G}J.connect=Fe}function Jt(J,G){switch(G){case"horizontal":J.ort=0;break;case"vertical":J.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function xn(J,G){if(!I(G))throw new Error("noUiSlider: 'margin' option must be numeric.");G!==0&&(J.margin=J.spectrum.getDistance(G))}function wn(J,G){if(!I(G))throw new Error("noUiSlider: 'limit' option must be numeric.");if(J.limit=J.spectrum.getDistance(G),!J.limit||J.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function ue(J,G){var Fe;if(!I(G)&&!Array.isArray(G))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(G)&&!(G.length===2||I(G[0])||I(G[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(G!==0){for(Array.isArray(G)||(G=[G,G]),J.padding=[J.spectrum.getDistance(G[0]),J.spectrum.getDistance(G[1])],Fe=0;Fe<J.spectrum.xNumSteps.length-1;Fe++)if(J.padding[0][Fe]<0||J.padding[1][Fe]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var gt=G[0]+G[1],ct=J.spectrum.xVal[0],sn=J.spectrum.xVal[J.spectrum.xVal.length-1];if(gt/(sn-ct)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function Me(J,G){switch(G){case"ltr":J.dir=0;break;case"rtl":J.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function Ve(J,G){if(typeof G!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var Fe=G.indexOf("tap")>=0,gt=G.indexOf("drag")>=0,ct=G.indexOf("fixed")>=0,sn=G.indexOf("snap")>=0,fn=G.indexOf("hover")>=0,$n=G.indexOf("unconstrained")>=0,nn=G.indexOf("drag-all")>=0,ei=G.indexOf("smooth-steps")>=0;if(ct){if(J.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");xn(J,J.start[1]-J.start[0])}if($n&&(J.margin||J.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");J.events={tap:Fe||sn,drag:gt,dragAll:nn,smoothSteps:ei,fixed:ct,snap:sn,hover:fn,unconstrained:$n}}function Qe(J,G){if(G!==!1)if(G===!0||c(G)){J.tooltips=[];for(var Fe=0;Fe<J.handles;Fe++)J.tooltips.push(G)}else{if(G=$(G),G.length!==J.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");G.forEach(function(gt){if(typeof gt!="boolean"&&!c(gt))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),J.tooltips=G}}function st(J,G){if(G.length!==J.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");J.handleAttributes=G}function St(J,G){if(!c(G))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");J.ariaFormat=G}function Dt(J,G){if(!r(G))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");J.format=G}function Pt(J,G){if(typeof G!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");J.keyboardSupport=G}function Mt(J,G){J.documentElement=G}function ht(J,G){if(typeof G!="string"&&G!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");J.cssPrefix=G}function Zt(J,G){if(typeof G!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof J.cssPrefix=="string"?(J.cssClasses={},Object.keys(G).forEach(function(Fe){J.cssClasses[Fe]=J.cssPrefix+G[Fe]})):J.cssClasses=G}function jt(J){var G={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:Mn,format:Mn},Fe={step:{r:!1,t:Bn},keyboardPageMultiplier:{r:!1,t:Wn},keyboardMultiplier:{r:!1,t:pi},keyboardDefaultStep:{r:!1,t:Kn},start:{r:!0,t:vi},connect:{r:!0,t:Ft},direction:{r:!0,t:Me},snap:{r:!1,t:lt},animate:{r:!1,t:zt},animationDuration:{r:!1,t:yt},range:{r:!0,t:Ii},orientation:{r:!1,t:Jt},margin:{r:!1,t:xn},limit:{r:!1,t:wn},padding:{r:!1,t:ue},behaviour:{r:!0,t:Ve},ariaFormat:{r:!1,t:St},format:{r:!1,t:Dt},tooltips:{r:!1,t:Qe},keyboardSupport:{r:!0,t:Pt},documentElement:{r:!1,t:Mt},cssPrefix:{r:!0,t:ht},cssClasses:{r:!0,t:Zt},handleAttributes:{r:!1,t:st}},gt={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:yn,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};J.format&&!J.ariaFormat&&(J.ariaFormat=J.format),Object.keys(Fe).forEach(function(nn){if(!p(J[nn])&&gt[nn]===void 0){if(Fe[nn].r)throw new Error("noUiSlider: '"+nn+"' is required.");return}Fe[nn].t(G,p(J[nn])?J[nn]:gt[nn])}),G.pips=J.pips;var ct=document.createElement("div"),sn=ct.style.msTransform!==void 0,fn=ct.style.transform!==void 0;G.transformRule=fn?"transform":sn?"msTransform":"webkitTransform";var $n=[["left","top"],["right","bottom"]];return G.style=$n[G.dir][G.ort],G}function tn(J,G,Fe){var gt=Pe(),ct=nt(),sn=ct&&ge(),fn=J,$n,nn,ei,qi,hi,Hn=G.spectrum,_r=[],ti=[],ji=[],_s=0,kr={},Hr=J.ownerDocument,ts=G.documentElement||Hr.documentElement,ir=Hr.body,ys=Hr.dir==="rtl"||G.ort===1?0:100;function Rr(ye,Le){var ze=Hr.createElement("div");return Le&&ne(ze,Le),ye.appendChild(ze),ze}function Os(ye,Le){var ze=Rr(ye,G.cssClasses.origin),wt=Rr(ze,G.cssClasses.handle);if(Rr(wt,G.cssClasses.touchArea),wt.setAttribute("data-handle",String(Le)),G.keyboardSupport&&(wt.setAttribute("tabindex","0"),wt.addEventListener("keydown",function(Lt){return da(Lt,Le)})),G.handleAttributes!==void 0){var Vt=G.handleAttributes[Le];Object.keys(Vt).forEach(function(Lt){wt.setAttribute(Lt,Vt[Lt])})}return wt.setAttribute("role","slider"),wt.setAttribute("aria-orientation",G.ort?"vertical":"horizontal"),Le===0?ne(wt,G.cssClasses.handleLower):Le===G.handles-1&&ne(wt,G.cssClasses.handleUpper),ze.handle=wt,ze}function oe(ye,Le){return Le?Rr(ye,G.cssClasses.connect):!1}function U(ye,Le){var ze=Rr(Le,G.cssClasses.connects);nn=[],ei=[],ei.push(oe(ze,ye[0]));for(var wt=0;wt<G.handles;wt++)nn.push(Os(Le,wt)),ji[wt]=wt,ei.push(oe(ze,ye[wt+1]))}function H(ye){ne(ye,G.cssClasses.target),G.dir===0?ne(ye,G.cssClasses.ltr):ne(ye,G.cssClasses.rtl),G.ort===0?ne(ye,G.cssClasses.horizontal):ne(ye,G.cssClasses.vertical);var Le=getComputedStyle(ye).direction;return Le==="rtl"?ne(ye,G.cssClasses.textDirectionRtl):ne(ye,G.cssClasses.textDirectionLtr),Rr(ye,G.cssClasses.base)}function se(ye,Le){return!G.tooltips||!G.tooltips[Le]?!1:Rr(ye.firstChild,G.cssClasses.tooltip)}function de(){return fn.hasAttribute("disabled")}function Se(ye){var Le=nn[ye];return Le.hasAttribute("disabled")}function Re(ye){ye!=null?(nn[ye].setAttribute("disabled",""),nn[ye].handle.removeAttribute("tabindex")):(fn.setAttribute("disabled",""),nn.forEach(function(Le){Le.handle.removeAttribute("tabindex")}))}function Oe(ye){ye!=null?(nn[ye].removeAttribute("disabled"),nn[ye].handle.setAttribute("tabindex","0")):(fn.removeAttribute("disabled"),nn.forEach(function(Le){Le.removeAttribute("disabled"),Le.handle.setAttribute("tabindex","0")}))}function Ie(){hi&&(Tr("update"+vn.tooltips),hi.forEach(function(ye){ye&&h(ye)}),hi=null)}function Ne(){Ie(),hi=nn.map(se),qr("update"+vn.tooltips,function(ye,Le,ze){if(!(!hi||!G.tooltips)&&hi[Le]!==!1){var wt=ye[Le];G.tooltips[Le]!==!0&&(wt=G.tooltips[Le].to(ze[Le])),hi[Le].innerHTML=wt}})}function at(){Tr("update"+vn.aria),qr("update"+vn.aria,function(ye,Le,ze,wt,Vt){ji.forEach(function(Lt){var mn=nn[Lt],un=Cn(ti,Lt,0,!0,!0,!0),bi=Cn(ti,Lt,100,!0,!0,!0),kn=Vt[Lt],Ai=String(G.ariaFormat.to(ze[Lt]));un=Hn.fromStepping(un).toFixed(1),bi=Hn.fromStepping(bi).toFixed(1),kn=Hn.fromStepping(kn).toFixed(1),mn.children[0].setAttribute("aria-valuemin",un),mn.children[0].setAttribute("aria-valuemax",bi),mn.children[0].setAttribute("aria-valuenow",kn),mn.children[0].setAttribute("aria-valuetext",Ai)})})}function Ot(ye){if(ye.mode===n.PipsMode.Range||ye.mode===n.PipsMode.Steps)return Hn.xVal;if(ye.mode===n.PipsMode.Count){if(ye.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var Le=ye.values-1,ze=100/Le,wt=[];Le--;)wt[Le]=Le*ze;return wt.push(100),dt(wt,ye.stepped)}return ye.mode===n.PipsMode.Positions?dt(ye.values,ye.stepped):ye.mode===n.PipsMode.Values?ye.stepped?ye.values.map(function(Vt){return Hn.fromStepping(Hn.getStep(Hn.toStepping(Vt)))}):ye.values:[]}function dt(ye,Le){return ye.map(function(ze){return Hn.fromStepping(Le?Hn.getStep(ze):ze)})}function Kt(ye){function Le(kn,Ai){return Number((kn+Ai).toFixed(7))}var ze=Ot(ye),wt={},Vt=Hn.xVal[0],Lt=Hn.xVal[Hn.xVal.length-1],mn=!1,un=!1,bi=0;return ze=v(ze.slice().sort(function(kn,Ai){return kn-Ai})),ze[0]!==Vt&&(ze.unshift(Vt),mn=!0),ze[ze.length-1]!==Lt&&(ze.push(Lt),un=!0),ze.forEach(function(kn,Ai){var Di,ri,Jn,sr=kn,Gi=ze[Ai+1],zi,ho,Oo,Fl,ja,Ks,Nl,Do=ye.mode===n.PipsMode.Steps;for(Do&&(Di=Hn.xNumSteps[Ai]),Di||(Di=Gi-sr),Gi===void 0&&(Gi=sr),Di=Math.max(Di,1e-7),ri=sr;ri<=Gi;ri=Le(ri,Di)){for(zi=Hn.toStepping(ri),ho=zi-bi,ja=ho/(ye.density||1),Ks=Math.round(ja),Nl=ho/Ks,Jn=1;Jn<=Ks;Jn+=1)Oo=bi+Jn*Nl,wt[Oo.toFixed(5)]=[Hn.fromStepping(Oo),0];Fl=ze.indexOf(ri)>-1?n.PipsType.LargeValue:Do?n.PipsType.SmallValue:n.PipsType.NoValue,!Ai&&mn&&ri!==Gi&&(Fl=0),ri===Gi&&un||(wt[zi.toFixed(5)]=[ri,Fl]),bi=zi}}),wt}function Yt(ye,Le,ze){var wt,Vt,Lt=Hr.createElement("div"),mn=(wt={},wt[n.PipsType.None]="",wt[n.PipsType.NoValue]=G.cssClasses.valueNormal,wt[n.PipsType.LargeValue]=G.cssClasses.valueLarge,wt[n.PipsType.SmallValue]=G.cssClasses.valueSub,wt),un=(Vt={},Vt[n.PipsType.None]="",Vt[n.PipsType.NoValue]=G.cssClasses.markerNormal,Vt[n.PipsType.LargeValue]=G.cssClasses.markerLarge,Vt[n.PipsType.SmallValue]=G.cssClasses.markerSub,Vt),bi=[G.cssClasses.valueHorizontal,G.cssClasses.valueVertical],kn=[G.cssClasses.markerHorizontal,G.cssClasses.markerVertical];ne(Lt,G.cssClasses.pips),ne(Lt,G.ort===0?G.cssClasses.pipsHorizontal:G.cssClasses.pipsVertical);function Ai(ri,Jn){var sr=Jn===G.cssClasses.value,Gi=sr?bi:kn,zi=sr?mn:un;return Jn+" "+Gi[G.ort]+" "+zi[ri]}function Di(ri,Jn,sr){if(sr=Le?Le(Jn,sr):sr,sr!==n.PipsType.None){var Gi=Rr(Lt,!1);Gi.className=Ai(sr,G.cssClasses.marker),Gi.style[G.style]=ri+"%",sr>n.PipsType.NoValue&&(Gi=Rr(Lt,!1),Gi.className=Ai(sr,G.cssClasses.value),Gi.setAttribute("data-value",String(Jn)),Gi.style[G.style]=ri+"%",Gi.innerHTML=String(ze.to(Jn)))}}return Object.keys(ye).forEach(function(ri){Di(ri,ye[ri][0],ye[ri][1])}),Lt}function Wt(){qi&&(h(qi),qi=null)}function cn(ye){Wt();var Le=Kt(ye),ze=ye.filter,wt=ye.format||{to:function(Vt){return String(Math.round(Vt))}};return qi=fn.appendChild(Yt(Le,ze,wt)),qi}function Pn(){var ye=$n.getBoundingClientRect(),Le="offset"+["Width","Height"][G.ort];return G.ort===0?ye.width||$n[Le]:ye.height||$n[Le]}function Fn(ye,Le,ze,wt){var Vt=function(mn){var un=pn(mn,wt.pageOffset,wt.target||Le);if(!un||de()&&!wt.doNotReject||we(fn,G.cssClasses.tap)&&!wt.doNotReject||ye===gt.start&&un.buttons!==void 0&&un.buttons>1||wt.hover&&un.buttons)return!1;sn||un.preventDefault(),un.calcPoint=un.points[G.ort],ze(un,wt)},Lt=[];return ye.split(" ").forEach(function(mn){Le.addEventListener(mn,Vt,sn?{passive:!0}:!1),Lt.push([mn,Vt])}),Lt}function pn(ye,Le,ze){var wt=ye.type.indexOf("touch")===0,Vt=ye.type.indexOf("mouse")===0,Lt=ye.type.indexOf("pointer")===0,mn=0,un=0;if(ye.type.indexOf("MSPointer")===0&&(Lt=!0),ye.type==="mousedown"&&!ye.buttons&&!ye.touches)return!1;if(wt){var bi=function(Di){var ri=Di.target;return ri===ze||ze.contains(ri)||ye.composed&&ye.composedPath().shift()===ze};if(ye.type==="touchstart"){var kn=Array.prototype.filter.call(ye.touches,bi);if(kn.length>1)return!1;mn=kn[0].pageX,un=kn[0].pageY}else{var Ai=Array.prototype.find.call(ye.changedTouches,bi);if(!Ai)return!1;mn=Ai.pageX,un=Ai.pageY}}return Le=Le||he(Hr),(Vt||Lt)&&(mn=ye.clientX+Le.x,un=ye.clientY+Le.y),ye.pageOffset=Le,ye.points=[mn,un],ye.cursor=Vt||Lt,ye}function qn(ye){var Le=ye-M($n,G.ort),ze=Le*100/Pn();return ze=N(ze),G.dir?100-ze:ze}function Dn(ye){var Le=100,ze=!1;return nn.forEach(function(wt,Vt){if(!Se(Vt)){var Lt=ti[Vt],mn=Math.abs(Lt-ye),un=mn===100&&Le===100,bi=mn<Le,kn=mn<=Le&&ye>Lt;(bi||kn||un)&&(ze=Vt,Le=mn)}}),ze}function Er(ye,Le){ye.type==="mouseout"&&ye.target.nodeName==="HTML"&&ye.relatedTarget===null&&Ze(ye,Le)}function fr(ye,Le){if(navigator.appVersion.indexOf("MSIE 9")===-1&&ye.buttons===0&&Le.buttonsProperty!==0)return Ze(ye,Le);var ze=(G.dir?-1:1)*(ye.calcPoint-Le.startCalcPoint),wt=ze*100/Le.baseSize;Ar(ze>0,wt,Le.locations,Le.handleNumbers,Le.connect)}function Ze(ye,Le){Le.handle&&(me(Le.handle,G.cssClasses.active),_s-=1),Le.listeners.forEach(function(ze){ts.removeEventListener(ze[0],ze[1])}),_s===0&&(me(fn,G.cssClasses.drag),Ds(),ye.cursor&&(ir.style.cursor="",ir.removeEventListener("selectstart",s))),G.events.smoothSteps&&(Le.handleNumbers.forEach(function(ze){Sr(ze,ti[ze],!0,!0,!1,!1)}),Le.handleNumbers.forEach(function(ze){ft("update",ze)})),Le.handleNumbers.forEach(function(ze){ft("change",ze),ft("set",ze),ft("end",ze)})}function yr(ye,Le){if(!Le.handleNumbers.some(Se)){var ze;if(Le.handleNumbers.length===1){var wt=nn[Le.handleNumbers[0]];ze=wt.children[0],_s+=1,ne(ze,G.cssClasses.active)}ye.stopPropagation();var Vt=[],Lt=Fn(gt.move,ts,fr,{target:ye.target,handle:ze,connect:Le.connect,listeners:Vt,startCalcPoint:ye.calcPoint,baseSize:Pn(),pageOffset:ye.pageOffset,handleNumbers:Le.handleNumbers,buttonsProperty:ye.buttons,locations:ti.slice()}),mn=Fn(gt.end,ts,Ze,{target:ye.target,handle:ze,listeners:Vt,doNotReject:!0,handleNumbers:Le.handleNumbers}),un=Fn("mouseout",ts,Er,{target:ye.target,handle:ze,listeners:Vt,doNotReject:!0,handleNumbers:Le.handleNumbers});Vt.push.apply(Vt,Lt.concat(mn,un)),ye.cursor&&(ir.style.cursor=getComputedStyle(ye.target).cursor,nn.length>1&&ne(fn,G.cssClasses.drag),ir.addEventListener("selectstart",s,!1)),Le.handleNumbers.forEach(function(bi){ft("start",bi)})}}function ai(ye){ye.stopPropagation();var Le=qn(ye.calcPoint),ze=Dn(Le);ze!==!1&&(G.events.snap||R(fn,G.cssClasses.tap,G.animationDuration),Sr(ze,Le,!0,!0),Ds(),ft("slide",ze,!0),ft("update",ze,!0),G.events.snap?yr(ye,{handleNumbers:[ze]}):(ft("change",ze,!0),ft("set",ze,!0)))}function dr(ye){var Le=qn(ye.calcPoint),ze=Hn.getStep(Le),wt=Hn.fromStepping(ze);Object.keys(kr).forEach(function(Vt){Vt.split(".")[0]==="hover"&&kr[Vt].forEach(function(Lt){Lt.call(xi,wt)})})}function da(ye,Le){if(de()||Se(Le))return!1;var ze=["Left","Right"],wt=["Down","Up"],Vt=["PageDown","PageUp"],Lt=["Home","End"];G.dir&&!G.ort?ze.reverse():G.ort&&!G.dir&&(wt.reverse(),Vt.reverse());var mn=ye.key.replace("Arrow",""),un=mn===Vt[0],bi=mn===Vt[1],kn=mn===wt[0]||mn===ze[0]||un,Ai=mn===wt[1]||mn===ze[1]||bi,Di=mn===Lt[0],ri=mn===Lt[1];if(!kn&&!Ai&&!Di&&!ri)return!0;ye.preventDefault();var Jn;if(Ai||kn){var sr=kn?0:1,Gi=Je(Le),zi=Gi[sr];if(zi===null)return!1;zi===!1&&(zi=Hn.getDefaultStep(ti[Le],kn,G.keyboardDefaultStep)),bi||un?zi*=G.keyboardPageMultiplier:zi*=G.keyboardMultiplier,zi=Math.max(zi,1e-7),zi=(kn?-1:1)*zi,Jn=_r[Le]+zi}else ri?Jn=G.spectrum.xVal[G.spectrum.xVal.length-1]:Jn=G.spectrum.xVal[0];return Sr(Le,Hn.toStepping(Jn),!0,!0),ft("slide",Le),ft("update",Le),ft("change",Le),ft("set",Le),!1}function Wr(ye){ye.fixed||nn.forEach(function(Le,ze){Fn(gt.start,Le.children[0],yr,{handleNumbers:[ze]})}),ye.tap&&Fn(gt.start,$n,ai,{}),ye.hover&&Fn(gt.move,$n,dr,{hover:!0}),ye.drag&&ei.forEach(function(Le,ze){if(!(Le===!1||ze===0||ze===ei.length-1)){var wt=nn[ze-1],Vt=nn[ze],Lt=[Le],mn=[wt,Vt],un=[ze-1,ze];ne(Le,G.cssClasses.draggable),ye.fixed&&(Lt.push(wt.children[0]),Lt.push(Vt.children[0])),ye.dragAll&&(mn=nn,un=ji),Lt.forEach(function(bi){Fn(gt.start,bi,yr,{handles:mn,handleNumbers:un,connect:Le})})}})}function qr(ye,Le){kr[ye]=kr[ye]||[],kr[ye].push(Le),ye.split(".")[0]==="update"&&nn.forEach(function(ze,wt){ft("update",wt)})}function Or(ye){return ye===vn.aria||ye===vn.tooltips}function Tr(ye){var Le=ye&&ye.split(".")[0],ze=Le?ye.substring(Le.length):ye;Object.keys(kr).forEach(function(wt){var Vt=wt.split(".")[0],Lt=wt.substring(Vt.length);(!Le||Le===Vt)&&(!ze||ze===Lt)&&(!Or(Lt)||ze===Lt)&&delete kr[wt]})}function ft(ye,Le,ze){Object.keys(kr).forEach(function(wt){var Vt=wt.split(".")[0];ye===Vt&&kr[wt].forEach(function(Lt){Lt.call(xi,_r.map(G.format.to),Le,_r.slice(),ze||!1,ti.slice(),xi)})})}function Cn(ye,Le,ze,wt,Vt,Lt,mn){var un;return nn.length>1&&!G.events.unconstrained&&(wt&&Le>0&&(un=Hn.getAbsoluteDistance(ye[Le-1],G.margin,!1),ze=Math.max(ze,un)),Vt&&Le<nn.length-1&&(un=Hn.getAbsoluteDistance(ye[Le+1],G.margin,!0),ze=Math.min(ze,un))),nn.length>1&&G.limit&&(wt&&Le>0&&(un=Hn.getAbsoluteDistance(ye[Le-1],G.limit,!1),ze=Math.min(ze,un)),Vt&&Le<nn.length-1&&(un=Hn.getAbsoluteDistance(ye[Le+1],G.limit,!0),ze=Math.max(ze,un))),G.padding&&(Le===0&&(un=Hn.getAbsoluteDistance(0,G.padding[0],!1),ze=Math.max(ze,un)),Le===nn.length-1&&(un=Hn.getAbsoluteDistance(100,G.padding[1],!0),ze=Math.min(ze,un))),mn||(ze=Hn.getStep(ze)),ze=N(ze),ze===ye[Le]&&!Lt?!1:ze}function Ln(ye,Le){var ze=G.ort;return(ze?Le:ye)+", "+(ze?ye:Le)}function Ar(ye,Le,ze,wt,Vt){var Lt=ze.slice(),mn=wt[0],un=G.events.smoothSteps,bi=[!ye,ye],kn=[ye,!ye];wt=wt.slice(),ye&&wt.reverse(),wt.length>1?wt.forEach(function(Di,ri){var Jn=Cn(Lt,Di,Lt[Di]+Le,bi[ri],kn[ri],!1,un);Jn===!1?Le=0:(Le=Jn-Lt[Di],Lt[Di]=Jn)}):bi=kn=[!0];var Ai=!1;wt.forEach(function(Di,ri){Ai=Sr(Di,ze[Di]+Le,bi[ri],kn[ri],!1,un)||Ai}),Ai&&(wt.forEach(function(Di){ft("update",Di),ft("slide",Di)}),Vt!=null&&ft("drag",mn))}function Zr(ye,Le){return G.dir?100-ye-Le:ye}function Sn(ye,Le){ti[ye]=Le,_r[ye]=Hn.fromStepping(Le);var ze=Zr(Le,0)-ys,wt="translate("+Ln(ze+"%","0")+")";nn[ye].style[G.transformRule]=wt,us(ye),us(ye+1)}function Ds(){ji.forEach(function(ye){var Le=ti[ye]>50?-1:1,ze=3+(nn.length+Le*ye);nn[ye].style.zIndex=String(ze)})}function Sr(ye,Le,ze,wt,Vt,Lt){return Vt||(Le=Cn(ti,ye,Le,ze,wt,!1,Lt)),Le===!1?!1:(Sn(ye,Le),!0)}function us(ye){if(!!ei[ye]){var Le=0,ze=100;ye!==0&&(Le=ti[ye-1]),ye!==ei.length-1&&(ze=ti[ye]);var wt=ze-Le,Vt="translate("+Ln(Zr(Le,wt)+"%","0")+")",Lt="scale("+Ln(wt/100,"1")+")";ei[ye].style[G.transformRule]=Vt+" "+Lt}}function rr(ye,Le){return ye===null||ye===!1||ye===void 0||(typeof ye=="number"&&(ye=String(ye)),ye=G.format.from(ye),ye!==!1&&(ye=Hn.toStepping(ye)),ye===!1||isNaN(ye))?ti[Le]:ye}function ii(ye,Le,ze){var wt=$(ye),Vt=ti[0]===void 0;Le=Le===void 0?!0:Le,G.animate&&!Vt&&R(fn,G.cssClasses.tap,G.animationDuration),ji.forEach(function(un){Sr(un,rr(wt[un],un),!0,!1,ze)});var Lt=ji.length===1?0:1;if(Vt&&Hn.hasNoSize()&&(ze=!0,ti[0]=0,ji.length>1)){var mn=100/(ji.length-1);ji.forEach(function(un){ti[un]=un*mn})}for(;Lt<ji.length;++Lt)ji.forEach(function(un){Sr(un,ti[un],!0,!0,ze)});Ds(),ji.forEach(function(un){ft("update",un),wt[un]!==null&&Le&&ft("set",un)})}function Va(ye){ii(G.start,ye)}function X(ye,Le,ze,wt){if(ye=Number(ye),!(ye>=0&&ye<ji.length))throw new Error("noUiSlider: invalid handle number, got: "+ye);Sr(ye,rr(Le,ye),!0,!0,wt),ft("update",ye),ze&&ft("set",ye)}function re(ye){if(ye===void 0&&(ye=!1),ye)return _r.length===1?_r[0]:_r.slice(0);var Le=_r.map(G.format.to);return Le.length===1?Le[0]:Le}function Ae(){for(Tr(vn.aria),Tr(vn.tooltips),Object.keys(G.cssClasses).forEach(function(ye){me(fn,G.cssClasses[ye])});fn.firstChild;)fn.removeChild(fn.firstChild);delete fn.noUiSlider}function Je(ye){var Le=ti[ye],ze=Hn.getNearbySteps(Le),wt=_r[ye],Vt=ze.thisStep.step,Lt=null;if(G.snap)return[wt-ze.stepBefore.startValue||null,ze.stepAfter.startValue-wt||null];Vt!==!1&&wt+Vt>ze.stepAfter.startValue&&(Vt=ze.stepAfter.startValue-wt),wt>ze.thisStep.startValue?Lt=ze.thisStep.step:ze.stepBefore.step===!1?Lt=!1:Lt=wt-ze.stepBefore.highestStep,Le===100?Vt=null:Le===0&&(Lt=null);var mn=Hn.countStepDecimals();return Vt!==null&&Vt!==!1&&(Vt=Number(Vt.toFixed(mn))),Lt!==null&&Lt!==!1&&(Lt=Number(Lt.toFixed(mn))),[Lt,Vt]}function Et(){return ji.map(Je)}function qt(ye,Le){var ze=re(),wt=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips"];wt.forEach(function(Lt){ye[Lt]!==void 0&&(Fe[Lt]=ye[Lt])});var Vt=jt(Fe);wt.forEach(function(Lt){ye[Lt]!==void 0&&(G[Lt]=Vt[Lt])}),Hn=Vt.spectrum,G.margin=Vt.margin,G.limit=Vt.limit,G.padding=Vt.padding,G.pips?cn(G.pips):Wt(),G.tooltips?Ne():Ie(),ti=[],ii(p(ye.start)?ye.start:ze,Le)}function Rn(){$n=H(fn),U(G.connect,$n),Wr(G.events),ii(G.start),G.pips&&cn(G.pips),G.tooltips&&Ne(),at()}Rn();var xi={destroy:Ae,steps:Et,on:qr,off:Tr,get:re,set:ii,setHandle:X,reset:Va,disable:Re,enable:Oe,__moveHandles:function(ye,Le,ze){Ar(ye,Le,ti,ze)},options:Fe,updateOptions:qt,target:fn,removePips:Wt,removeTooltips:Ie,getPositions:function(){return ti.slice()},getTooltips:function(){return hi},getOrigins:function(){return nn},pips:cn};return xi}function dn(J,G){if(!J||!J.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+J);if(J.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var Fe=jt(G),gt=tn(J,Fe,G);return J.noUiSlider=gt,gt}var et={__spectrum:$t,cssClasses:yn,create:dn};n.create=dn,n.cssClasses=yn,n.default=et,Object.defineProperty(n,"__esModule",{value:!0})})})(Nx,Nx.exports);const iN=nN(Nx.exports);const D_=t=>e=>Object.fromEntries(Object.entries(e).map(t)),rN=t=>D_(([e,n],r)=>[t(e,r),n]),ap=t=>D_(([e,n],r)=>[e,t(n,r)]),sN=t=>t.split(/[\.\[\]\'\"]/).filter(e=>e),oN=(t,e,n=void 0)=>Object.hasOwn(t,e)?t[e]:n,aN=(t,e,n)=>t[e]=n,db=(t,e,n)=>{e=Array.isArray(e)?e:sN(e);const r=(c,h,p)=>aN(c,h,p<e.length-1?oN(c,h,{}):n);return e.reduce(r,t)},KI=rN(t=>t.toLowerCase());const lN={__name:"Slider",props:{options:{type:Object},modelValue:{type:Number}},emits:["update:modelValue"],setup(t,{emit:e}){const n=t,r=ap(hr),c=XI(n,"modelValue",e),h=$r(null),p=$r(null);return qc(()=>{if(!p.value){const s=hr(h);iN.create(s,r(n.options)),p.value=s.noUiSlider,p.value.on("update",(v,E)=>{c.value=parseFloat(v[E])})}}),nr(()=>n.options,()=>{console.log("options",n.options),p.value&&p.value.updateOptions(r(n.options),!0)},{deep:!0}),Kc(()=>{p.value&&(p.value=null)}),(s,v)=>(Kr(),Is("div",{class:"slider-noUi",id:"slider-round",ref_key:"sliderRef",ref:h},null,512))}},oA={__name:"ToggleButton",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(t,{emit:e}){const r=XI(t,"modelValue",e),c=()=>{r.value=!0};return(h,p)=>(Kr(),Is("button",{onClick:c},[MD(h.$slots,"default",aO(TP({value:hr(r)})))]))}},cN=ap(hr);function aA(t,e){const n={instance:hy(null),props:D1(e)},r=cN,c=s=>{const v=n.instance;v.value||(v.value=new t(r(s)))},h=s=>{const v=n.instance;v.value&&v.value.setProps(r(s))},p=()=>{const s=n.instance;s.value&&(s.value=null)};return qc(()=>c(n.props)),Kc(p),nr(n.props,h),n}var pb={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(YI,function(){var n,r,c;function h(s,v){if(!n)n=v;else if(!r)r=v;else{var E="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",M={};n(M),c=v(M),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(c.workerUrl=window.URL.createObjectURL(new Blob([E],{type:"text/javascript"})))}}h(["exports"],function(s){var v=typeof self<"u"?self:{},E="2.13.0-dev";let M;const I={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(M==null){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{M={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):o}catch{M=o}}return M},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},R={supported:!1,testSupport:function(o){!Z&&$&&(ne?me(o):N=o)}};let N,$,Z=!1,ne=!1;function me(o){const i=o.createTexture();o.bindTexture(o.TEXTURE_2D,i);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,$),o.isContextLost())return;R.supported=!0}catch{}o.deleteTexture(i),Z=!0}v.document&&($=v.document.createElement("img"),$.onload=function(){N&&me(N),N=null,ne=!0},$.onerror=function(){Z=!0,N=null},$.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const we="01";var he=Pe;function Pe(o,i,a,u){this.cx=3*o,this.bx=3*(a-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=a,this.p2y=u}Pe.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(i===void 0&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var a=o,u=0;u<8;u++){var d=this.sampleCurveX(a)-o;if(Math.abs(d)<i)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a-=d/g}var y=0,b=1;for(a=o,u=0;u<20&&(d=this.sampleCurveX(a),!(Math.abs(d-o)<i));u++)o>d?y=a:b=a,a=.5*(b-y)+y;return a},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var ge=nt;function nt(o,i){this.x=o,this.y=i}nt.prototype={clone:function(){return new nt(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,a=o.y-this.y;return i*i+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),a=Math.sin(o),u=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=u,this},_rotateAround:function(o,i){var a=Math.cos(o),u=Math.sin(o),d=i.y+u*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-u*(this.y-i.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},nt.convert=function(o){return o instanceof nt?o:Array.isArray(o)?new nt(o[0],o[1]):o};const Tt=Math.PI/180,Rt=180/Math.PI;function ke(o){return o*Tt}function It(o){return o*Rt}const xt=[[0,0],[1,0],[1,1],[0,1]];function gn(o){if(o<=0)return 0;if(o>=1)return 1;const i=o*o,a=i*o;return 4*(o<.5?a:3*(o-i)+a-.75)}function an(o,i,a,u){const d=new he(o,i,a,u);return function(g){return d.solve(g)}}const ln=an(.25,.1,.25,1);function $t(o,i,a){return Math.min(a,Math.max(i,o))}function Mn(o,i,a){return(a=$t((a-o)/(i-o),0,1))*a*(3-2*a)}function yn(o,i,a){const u=a-i,d=((o-i)%u+u)%u+i;return d===i?a:d}function vn(o,i,a){if(!o.length)return a(null,[]);let u=o.length;const d=new Array(o.length);let g=null;o.forEach((y,b)=>{i(y,(T,A)=>{T&&(g=T),d[b]=A,--u==0&&a(g,d)})})}function Bn(o){const i=[];for(const a in o)i.push(o[a]);return i}function Wn(o,...i){for(const a of i)for(const u in a)o[u]=a[u];return o}let pi=1;function Kn(){return pi++}function Ii(){return function o(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function vi(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function lt(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function zt(o,i){o.forEach(a=>{i[a]&&(i[a]=i[a].bind(i))})}function yt(o,i){return o.indexOf(i,o.length-i.length)!==-1}function Ft(o,i,a){const u={};for(const d in o)u[d]=i.call(a||this,o[d],d,o);return u}function Jt(o,i,a){const u={};for(const d in o)i.call(a||this,o[d],d,o)&&(u[d]=o[d]);return u}function xn(o){return Array.isArray(o)?o.map(xn):typeof o=="object"&&o?Ft(o,xn):o}const wn={};function ue(o){wn[o]||(typeof console<"u"&&console.warn(o),wn[o]=!0)}function Me(o,i,a){return(a.y-o.y)*(i.x-o.x)>(i.y-o.y)*(a.x-o.x)}function Ve(o){let i=0;for(let a,u,d=0,g=o.length,y=g-1;d<g;y=d++)a=o[d],u=o[y],i+=(u.x-a.x)*(a.y+u.y);return i}function Qe(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function st(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,d,g)=>{const y=d||g;return i[u]=!y||y.toLowerCase(),""}),i["max-age"]){const a=parseInt(i["max-age"],10);isNaN(a)?delete i["max-age"]:i["max-age"]=a}return i}let St=null;function Dt(o){if(St==null){const i=o.navigator?o.navigator.userAgent:null;St=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return St}function Pt(o){try{const i=v[o];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function Mt(o,i){return[o[4*i],o[4*i+1],o[4*i+2],o[4*i+3]]}const ht="mapbox-tiles";let Zt,jt,tn=500,dn=50;function et(){try{return v.caches}catch{}}function J(){et()&&!Zt&&(Zt=v.caches.open(ht))}function G(o){const i=o.indexOf("?");if(i<0)return o;const a=function(d){const g=d.indexOf("?");return g>0?d.slice(g+1).split("&"):[]}(o),u=a.filter(d=>{const g=d.split("=");return g[0]==="language"||g[0]==="worldview"});return u.length?`${o.slice(0,i)}?${u.join("&")}`:o.slice(0,i)}let Fe=1/0;const gt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(gt);class ct extends Error{constructor(i,a,u){a===401&&ji(u)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const sn=Qe()?()=>self.worker&&self.worker.referrer:()=>(v.location.protocol==="blob:"?v.parent:v).location.href,fn=function(o,i){if(!(/^file:/.test(a=o.url)||/^file:/.test(sn())&&!/^\w+:/.test(a))){if(v.fetch&&v.Request&&v.AbortController&&v.Request.prototype.hasOwnProperty("signal"))return function(u,d){const g=new v.AbortController,y=new v.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:sn(),signal:g.signal});let b=!1,T=!1;const A=(C=y.url).indexOf("sku=")>0&&ji(C);var C;u.type==="json"&&y.headers.set("Accept","application/json");const k=(B,F,j)=>{if(T)return;if(B&&B.message!=="SecurityError"&&ue(B),F&&j)return O(F);const K=Date.now();v.fetch(y).then(ce=>{if(ce.ok){const ve=A?ce.clone():null;return O(ce,ve,K)}return d(new ct(ce.statusText,ce.status,u.url))}).catch(ce=>{ce.name!=="AbortError"&&d(new Error(`${ce.message} ${u.url}`))})},O=(B,F,j)=>{(u.type==="arrayBuffer"?B.arrayBuffer():u.type==="json"?B.json():B.text()).then(K=>{T||(F&&j&&function(ce,ve,ae){if(J(),!Zt)return;const _e={status:ve.status,statusText:ve.statusText,headers:new v.Headers};ve.headers.forEach((He,je)=>_e.headers.set(je,He));const Ee=st(ve.headers.get("Cache-Control")||"");if(Ee["no-store"])return;Ee["max-age"]&&_e.headers.set("Expires",new Date(ae+1e3*Ee["max-age"]).toUTCString());const xe=_e.headers.get("Expires");xe&&(new Date(xe).getTime()-ae<42e4||function(He,je){if(jt===void 0)try{new Response(new ReadableStream),jt=!0}catch{jt=!1}jt?je(He.body):He.blob().then(je)}(ve,He=>{const je=new v.Response(He,_e);J(),Zt&&Zt.then(tt=>tt.put(G(ce.url),je)).catch(tt=>ue(tt.message))}))}(y,F,j),b=!0,d(null,K,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(K=>{T||d(new Error(K.message))})};return A?function(B,F){if(J(),!Zt)return F(null);const j=G(B.url);Zt.then(K=>{K.match(j).then(ce=>{const ve=function(ae){if(!ae)return!1;const _e=new Date(ae.headers.get("Expires")||0),Ee=st(ae.headers.get("Cache-Control")||"");return _e>Date.now()&&!Ee["no-cache"]}(ce);K.delete(j),ve&&K.put(j,ce.clone()),F(null,ce,ve)}).catch(F)}).catch(F)}(y,k):k(null,null),{cancel:()=>{T=!0,b||g.abort()}}}(o,i);if(Qe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,i,void 0,!0)}var a;return function(u,d){const g=new v.XMLHttpRequest;g.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const y in u.headers)g.setRequestHeader(y,u.headers[y]);return u.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=u.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(u.type==="json")try{y=JSON.parse(g.response)}catch(b){return d(b)}d(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else d(new ct(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(o,i)},$n=function(o,i){return fn(Wn(o,{type:"arrayBuffer"}),i)};function nn(o){const i=v.document.createElement("a");return i.href=o,i.protocol===v.document.location.protocol&&i.host===v.document.location.host}const ei="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let qi,hi;qi=[],hi=0;const Hn=function(o,i){if(R.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),hi>=I.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:o,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return qi.push(g),g}hi++;let a=!1;const u=()=>{if(!a)for(a=!0,hi--;qi.length&&hi<I.MAX_PARALLEL_IMAGE_REQUESTS;){const g=qi.shift(),{requestParameters:y,callback:b,cancelled:T}=g;T||(g.cancel=Hn(y,b).cancel)}},d=$n(o,(g,y,b,T)=>{u(),g?i(g):y&&(v.createImageBitmap?function(A,C){const k=new v.Blob([new Uint8Array(A)],{type:"image/png"});v.createImageBitmap(k).then(O=>{C(null,O)}).catch(O=>{C(new Error(`Could not load image because of ${O.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(A,C)=>i(A,C,b,T)):function(A,C){const k=new v.Image,O=v.URL;k.onload=()=>{C(null,k),O.revokeObjectURL(k.src),k.onload=null,v.requestAnimationFrame(()=>{k.src=ei})},k.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new v.Blob([new Uint8Array(A)],{type:"image/png"});k.src=A.byteLength?O.createObjectURL(B):ei}(y,(A,C)=>i(A,C,b,T)))});return{cancel:()=>{d.cancel(),u()}}},_r="NO_ACCESS_TOKEN";function ti(o){return o.indexOf("mapbox:")===0}function ji(o){return I.API_URL_REGEX.test(o)}function _s(o){return I.API_CDN_URL_REGEX.test(o)}function kr(o){return I.API_STYLE_REGEX.test(o)&&!Hr(o)}function Hr(o){return I.API_SPRITE_REGEX.test(o)}const ts=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ir(o){const i=o.match(ts);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function ys(o){const i=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${i}`}function Rr(o){if(!o)return null;const i=o.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(decodeURIComponent(v.atob(i[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Os{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const a=Rr(I.ACCESS_TOKEN);let u="";return u=a&&a.u?v.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(d,g)=>String.fromCharCode(Number("0x"+g)))):I.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const i=Pt("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(i)try{const d=v.localStorage.getItem(a);d&&(this.eventData=JSON.parse(d));const g=v.localStorage.getItem(u);g&&(this.anonId=g)}catch{ue("Unable to read from LocalStorage")}}saveEventData(){const i=Pt("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(i)try{v.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&v.localStorage.setItem(a,JSON.stringify(this.eventData))}catch{ue("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,a,u,d){if(!I.EVENTS_URL)return;const g=ir(I.EVENTS_URL);g.params.push(`access_token=${d||I.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(i).toISOString()},b=a?Wn(y,a):y,T={url:ys(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=function(A,C){return fn(Wn(A,{method:"POST"}),C)}(T,A=>{this.pendingRequest=null,u(A),this.saveEventData(),this.processRequests(d)})}queueRequest(i,a){this.queue.push(i),this.processRequests(a)}}const oe=new class extends Os{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,i){I.EVENTS_URL&&I.ACCESS_TOKEN&&Array.isArray(o)&&o.some(a=>ti(a)||ji(a))&&this.queueRequest(Date.now(),i)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Rr(I.ACCESS_TOKEN),a=i?i.u:I.ACCESS_TOKEN;let u=a!==this.eventData.tokenU;lt(this.anonId)||(this.anonId=Ii(),u=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),y=new Date(d),b=(d-this.eventData.lastSuccess)/864e5;u=u||b>=1||b<-1||g.getDate()!==y.getDate()}else u=!0;u?this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:we,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=d,this.eventData.tokenU=a)},o):this.processRequests()}},U=oe.postTurnstileEvent.bind(oe),H=new class extends Os{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,i,a,u){this.skuToken=i,this.errorCb=u,I.EVENTS_URL&&(a||I.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(_r)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),lt(this.anonId)||(this.anonId=Ii()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:we,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):i&&(this.success[i]=!0)},o))}},se=H.postMapLoadEvent.bind(H),de=new class extends Os{constructor(){super("gljs.performance")}postPerformanceEvent(o,i){I.EVENTS_URL&&(o||I.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:a}=this.queue.shift(),u=function(d){const g=v.performance.getEntriesByType("resource"),y=v.performance.getEntriesByType("mark"),b=function(O){const B={};if(O){for(const F in O)if(F!=="other")for(const j of O[F]){const K=`${F}ResolveRangeMin`,ce=`${F}ResolveRangeMax`,ve=`${F}RequestCount`,ae=`${F}RequestCachedCount`;B[K]=Math.min(B[K]||1/0,j.startTime),B[ce]=Math.max(B[ce]||-1/0,j.responseEnd);const _e=Ee=>{B[Ee]===void 0&&(B[Ee]=0),++B[Ee]};j.transferSize!==void 0&&j.transferSize===0&&_e(ae),_e(ve)}}return B}(function(O,B){const F={};if(O)for(const j of O){const K=B(j);F[K]===void 0&&(F[K]=[]),F[K].push(j)}return F}(g,Ot)),T=v.devicePixelRatio,A=v.navigator.connection||v.navigator.mozConnection||v.navigator.webkitConnection,C={counters:[],metadata:[],attributes:[]},k=(O,B,F)=>{F!=null&&O.push({name:B,value:F.toString()})};for(const O in b)k(C.counters,O,b[O]);if(d.interactionRange[0]!==1/0&&d.interactionRange[1]!==-1/0&&(k(C.counters,"interactionRangeMin",d.interactionRange[0]),k(C.counters,"interactionRangeMax",d.interactionRange[1])),y)for(const O of Object.keys(Ne)){const B=Ne[O],F=y.find(j=>j.name===B);F&&k(C.counters,B,F.startTime)}return k(C.counters,"visibilityHidden",d.visibilityHidden),k(C.attributes,"style",function(O){if(O)for(const B of O){const F=B.name.split("?")[0];if(kr(F)){const j=F.split("/").slice(-2);if(j.length===2)return`mapbox://styles/${j[0]}/${j[1]}`}}}(g)),k(C.attributes,"terrainEnabled",d.terrainEnabled?"true":"false"),k(C.attributes,"fogEnabled",d.fogEnabled?"true":"false"),k(C.attributes,"projection",d.projection),k(C.attributes,"zoom",d.zoom),k(C.metadata,"devicePixelRatio",T),k(C.metadata,"connectionEffectiveType",A?A.effectiveType:void 0),k(C.metadata,"navigatorUserAgent",v.navigator.userAgent),k(C.metadata,"screenWidth",v.screen.width),k(C.metadata,"screenHeight",v.screen.height),k(C.metadata,"windowWidth",v.innerWidth),k(C.metadata,"windowHeight",v.innerHeight),k(C.metadata,"mapWidth",d.width/T),k(C.metadata,"mapHeight",d.height/T),k(C.metadata,"webglRenderer",d.renderer),k(C.metadata,"webglVendor",d.vendor),k(C.metadata,"sdkVersion",E),k(C.metadata,"sdkIdentifier","mapbox-gl-js"),C}(a);for(const d of u.metadata);for(const d of u.counters);for(const d of u.attributes);this.postEvent(i,u,()=>{},o)}},Se=de.postPerformanceEvent.bind(de),Re=new class extends Os{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,i,a,u){if(!I.API_URL||!I.SESSION_PATH)return;const d=ir(I.API_URL+I.SESSION_PATH);d.params.push(`sku=${i||""}`),d.params.push(`access_token=${u||I.ACCESS_TOKEN||""}`);const g={url:ys(d),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(y,b){return fn(Wn(y,{method:"GET"}),b)}(g,y=>{this.pendingRequest=null,a(y),this.saveEventData(),this.processRequests(u)})}getSessionAPI(o,i,a,u){this.skuToken=i,this.errorCb=u,I.SESSION_PATH&&I.API_URL&&(a||I.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(_r)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||this.getSession(a,this.skuToken,u=>{u?this.errorCb(u):i&&(this.success[i]=!0)},o)}},Oe=Re.getSessionAPI.bind(Re),Ie=new Set,Ne={create:"create",load:"load",fullLoad:"fullLoad"},at={mark(o){v.performance.mark(o)},measure(o,i,a){v.performance.measure(o,i,a)}};function Ot(o){const i=o.name.split("?")[0];return _s(i)&&i.includes("mapbox-gl.js")?"javascript":_s(i)&&i.includes("mapbox-gl.css")?"css":function(a){return I.API_FONTS_REGEX.test(a)}(i)?"fontRange":Hr(i)?"sprite":kr(i)?"style":function(a){return I.API_TILEJSON_REGEX.test(a)}(i)?"tilejson":"other"}const dt=v.performance;function Kt(o){const i=o?o.url.toString():void 0;return dt.getEntriesByName(i)}let Yt,Wt,cn,Pn;const Fn={now:()=>cn!==void 0?cn:v.performance.now(),setNow(o){cn=o},restoreNow(){cn=void 0},frame(o){const i=v.requestAnimationFrame(o);return{cancel:()=>v.cancelAnimationFrame(i)}},getImageData(o,i=0){const{width:a,height:u}=o;Pn||(Pn=v.document.createElement("canvas"));const d=Pn.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(a>Pn.width||u>Pn.height)&&(Pn.width=a,Pn.height=u),d.clearRect(-i,-i,a+2*i,u+2*i),d.drawImage(o,0,0,a,u),d.getImageData(-i,-i,a+2*i,u+2*i)},resolveURL:o=>(Yt||(Yt=v.document.createElement("a")),Yt.href=o,Yt.href),get devicePixelRatio(){return v.devicePixelRatio},get prefersReducedMotion(){return!!v.matchMedia&&(Wt==null&&(Wt=v.matchMedia("(prefers-reduced-motion: reduce)")),Wt.matches)}};function pn(o,i,a){a[o]&&a[o].indexOf(i)!==-1||(a[o]=a[o]||[],a[o].push(i))}function qn(o,i,a){if(a&&a[o]){const u=a[o].indexOf(i);u!==-1&&a[o].splice(u,1)}}class Dn{constructor(i,a={}){Wn(this,a),this.type=i}}class Er extends Dn{constructor(i,a={}){super("error",Wn({error:i},a))}}class fr{on(i,a){return this._listeners=this._listeners||{},pn(i,a,this._listeners),this}off(i,a){return qn(i,a,this._listeners),qn(i,a,this._oneTimeListeners),this}once(i,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},pn(i,a,this._oneTimeListeners),this):new Promise(u=>this.once(i,u))}fire(i,a){typeof i=="string"&&(i=new Dn(i,a||{}));const u=i.type;if(this.listens(u)){i.target=this;const d=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of d)b.call(this,i);const g=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of g)qn(u,b,this._oneTimeListeners),b.call(this,i);const y=this._eventedParent;y&&(Wn(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(i))}else i instanceof Er&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,a){return this._eventedParent=i,this._eventedParentData=a,this}}var Ze=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function yr(o,...i){for(const a of i)for(const u in a)o[u]=a[u];return o}function ai(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function dr(o){if(Array.isArray(o))return o.map(dr);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const a in o)i[a]=dr(o[a]);return i}return ai(o)}class da extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}var Wr=da;class qr{constructor(i,a=[]){this.parent=i,this.bindings={};for(const[u,d]of a)this.bindings[u]=d}concat(i){return new qr(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}var Or=qr;const Tr={kind:"null"},ft={kind:"number"},Cn={kind:"string"},Ln={kind:"boolean"},Ar={kind:"color"},Zr={kind:"object"},Sn={kind:"value"},Ds={kind:"collator"},Sr={kind:"formatted"},us={kind:"resolvedImage"};function rr(o,i){return{kind:"array",itemType:o,N:i}}function ii(o){if(o.kind==="array"){const i=ii(o.itemType);return typeof o.N=="number"?`array<${i}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${i}>`}return o.kind}const Va=[Tr,ft,Cn,Ln,Ar,Sr,Zr,rr(Sn),us];function X(o,i){if(i.kind==="error")return null;if(o.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!X(o.itemType,i.itemType))&&(typeof o.N!="number"||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if(o.kind==="value"){for(const a of Va)if(!X(a,i))return null}}return`Expected ${ii(o)} but found ${ii(i)} instead.`}function re(o,i){return i.some(a=>a.kind===o.kind)}function Ae(o,i){return i.some(a=>a==="null"?o===null:a==="array"?Array.isArray(o):a==="object"?o&&!Array.isArray(o)&&typeof o=="object":a===typeof o)}var Je,Et={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function qt(o){return(o=Math.round(o))<0?0:o>255?255:o}function Rn(o){return qt(o[o.length-1]==="%"?parseFloat(o)/100*255:parseInt(o))}function xi(o){return(i=o[o.length-1]==="%"?parseFloat(o)/100:parseFloat(o))<0?0:i>1?1:i;var i}function ye(o,i,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?o+(i-o)*a*6:2*a<1?i:3*a<2?o+(i-o)*(2/3-a)*6:o}try{Je={}.parseCSSColor=function(o){var i,a=o.replace(/ /g,"").toLowerCase();if(a in Et)return Et[a].slice();if(a[0]==="#")return a.length===4?(i=parseInt(a.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:a.length===7&&(i=parseInt(a.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var u=a.indexOf("("),d=a.indexOf(")");if(u!==-1&&d+1===a.length){var g=a.substr(0,u),y=a.substr(u+1,d-(u+1)).split(","),b=1;switch(g){case"rgba":if(y.length!==4)return null;b=xi(y.pop());case"rgb":return y.length!==3?null:[Rn(y[0]),Rn(y[1]),Rn(y[2]),b];case"hsla":if(y.length!==4)return null;b=xi(y.pop());case"hsl":if(y.length!==3)return null;var T=(parseFloat(y[0])%360+360)%360/360,A=xi(y[1]),C=xi(y[2]),k=C<=.5?C*(A+1):C+A-C*A,O=2*C-k;return[qt(255*ye(O,k,T+1/3)),qt(255*ye(O,k,T)),qt(255*ye(O,k,T-1/3)),b];default:return null}}return null}}catch{}class Le{constructor(i,a,u,d=1){this.r=i,this.g=a,this.b=u,this.a=d}static parse(i){if(!i)return;if(i instanceof Le)return i;if(typeof i!="string")return;const a=Je(i);return a?new Le(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[i,a,u,d]=this.toArray();return`rgba(${Math.round(i)},${Math.round(a)},${Math.round(u)},${d})`}toArray(){const{r:i,g:a,b:u,a:d}=this;return d===0?[0,0,0,0]:[255*i/d,255*a/d,255*u/d,d]}toArray01(){const{r:i,g:a,b:u,a:d}=this;return d===0?[0,0,0,0]:[i/d,a/d,u/d,d]}toArray01PremultipliedAlpha(){const{r:i,g:a,b:u,a:d}=this;return[i,a,u,d]}}Le.black=new Le(0,0,0,1),Le.white=new Le(1,1,1,1),Le.transparent=new Le(0,0,0,0),Le.red=new Le(1,0,0,1),Le.blue=new Le(0,0,1,1);var ze=Le;class wt{constructor(i,a,u){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vt{constructor(i,a,u,d,g){this.text=i.normalize?i.normalize():i,this.image=a,this.scale=u,this.fontStack=d,this.textColor=g}}class Lt{constructor(i){this.sections=i}static fromString(i){return new Lt([new Vt(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Lt?i:Lt.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const a of this.sections){if(a.image){i.push(["image",a.image.name]);continue}i.push(a.text);const u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toArray())),i.push(u)}return i}}class mn{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new mn({name:i,available:!1}):null}serialize(){return["image",this.name]}}function un(o,i,a,u){return typeof o=="number"&&o>=0&&o<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof a=="number"&&a>=0&&a<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[o,i,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[o,i,a,u]:[o,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bi(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof ze||o instanceof wt||o instanceof Lt||o instanceof mn)return!0;if(Array.isArray(o)){for(const i of o)if(!bi(i))return!1;return!0}if(typeof o=="object"){for(const i in o)if(!bi(o[i]))return!1;return!0}return!1}function kn(o){if(o===null)return Tr;if(typeof o=="string")return Cn;if(typeof o=="boolean")return Ln;if(typeof o=="number")return ft;if(o instanceof ze)return Ar;if(o instanceof wt)return Ds;if(o instanceof Lt)return Sr;if(o instanceof mn)return us;if(Array.isArray(o)){const i=o.length;let a;for(const u of o){const d=kn(u);if(a){if(a===d)continue;a=Sn;break}a=d}return rr(a||Sn,i)}return Zr}function Ai(o){const i=typeof o;return o===null?"":i==="string"||i==="number"||i==="boolean"?String(o):o instanceof ze||o instanceof Lt||o instanceof mn?o.toString():JSON.stringify(o)}class Di{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(i.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!bi(i[1]))return a.error("invalid value");const u=i[1];let d=kn(u);const g=a.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new Di(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ze?["rgba"].concat(this.value.toArray()):this.value instanceof Lt?this.value.serialize():this.value}}var ri=Di,Jn=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const sr={string:Cn,number:ft,boolean:Ln,object:Zr};class Gi{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let u,d=1;const g=i[0];if(g==="array"){let b,T;if(i.length>2){const A=i[1];if(typeof A!="string"||!(A in sr)||A==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=sr[A],d++}else b=Sn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);T=i[2],d++}u=rr(b,T)}else u=sr[g];const y=[];for(;d<i.length;d++){const b=a.parse(i[d],d,Sn);if(!b)return null;y.push(b)}return new Gi(u,y)}evaluate(i){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(i);if(!X(this.type,kn(u)))return u;if(a===this.args.length-1)throw new Jn(`Expected value to be of type ${ii(this.type)}, but found ${ii(kn(u))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,a=[i.kind];if(i.kind==="array"){const u=i.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){a.push(u.kind);const d=i.N;(typeof d=="number"||this.args.length>1)&&a.push(d)}}return a.concat(this.args.map(u=>u.serialize()))}}var zi=Gi;class ho{constructor(i){this.type=Sr,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const u=i[1];if(!Array.isArray(u)&&typeof u=="object")return a.error("First argument must be an image or text section.");const d=[];let g=!1;for(let y=1;y<=i.length-1;++y){const b=i[y];if(g&&typeof b=="object"&&!Array.isArray(b)){g=!1;let T=null;if(b["font-scale"]&&(T=a.parse(b["font-scale"],1,ft),!T))return null;let A=null;if(b["text-font"]&&(A=a.parse(b["text-font"],1,rr(Cn)),!A))return null;let C=null;if(b["text-color"]&&(C=a.parse(b["text-color"],1,Ar),!C))return null;const k=d[d.length-1];k.scale=T,k.font=A,k.textColor=C}else{const T=a.parse(i[y],1,Sn);if(!T)return null;const A=T.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:T,scale:null,font:null,textColor:null})}}return new ho(d)}evaluate(i){return new Lt(this.sections.map(a=>{const u=a.content.evaluate(i);return kn(u)===us?new Vt("",u,null,null,null):new Vt(Ai(u),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)}))}eachChild(i){for(const a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const a of this.sections){i.push(a.content.serialize());const u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),i.push(u)}return i}}class Oo{constructor(i){this.type=us,this.input=i}static parse(i,a){if(i.length!==2)return a.error("Expected two arguments.");const u=a.parse(i[1],1,Cn);return u?new Oo(u):a.error("No image name provided.")}evaluate(i){const a=this.input.evaluate(i),u=mn.fromString(a);return u&&i.availableImages&&(u.available=i.availableImages.indexOf(a)>-1),u}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Fl={"to-boolean":Ln,"to-color":Ar,"to-number":ft,"to-string":Cn};class ja{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const u=i[0];if((u==="to-boolean"||u==="to-string")&&i.length!==2)return a.error("Expected one argument.");const d=Fl[u],g=[];for(let y=1;y<i.length;y++){const b=a.parse(i[y],y,Sn);if(!b)return null;g.push(b)}return new ja(d,g)}evaluate(i){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(i));if(this.type.kind==="color"){let a,u;for(const d of this.args){if(a=d.evaluate(i),u=null,a instanceof ze)return a;if(typeof a=="string"){const g=i.parseColor(a);if(g)return g}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:un(a[0],a[1],a[2],a[3]),!u))return new ze(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Jn(u||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const u of this.args){if(a=u.evaluate(i),a===null)return 0;const d=Number(a);if(!isNaN(d))return d}throw new Jn(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Lt.fromString(Ai(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?mn.fromString(Ai(this.args[0].evaluate(i))):Ai(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ho([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Oo(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(a=>{i.push(a.serialize())}),i}}var Ks=ja;const Nl=["Unknown","Point","LineString","Polygon"];var Do=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Nl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-o[0])+this.featureDistanceData.bearing[1]*(u*i-o[1])}return 0}parseColor(o){let i=this._parseColorCache[o];return i||(i=this._parseColorCache[o]=ze.parse(o)),i}};class Ga{constructor(i,a,u,d){this.name=i,this.type=a,this._evaluate=u,this.args=d}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,a){const u=i[0],d=Ga.definitions[u];if(!d)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=y.filter(([A])=>!Array.isArray(A)||A.length===i.length-1);let T=null;for(const[A,C]of b){T=new nf(a.registry,a.path,null,a.scope);const k=[];let O=!1;for(let B=1;B<i.length;B++){const F=i[B],j=Array.isArray(A)?A[B-1]:A.type,K=T.parse(F,1+k.length,j);if(!K){O=!0;break}k.push(K)}if(!O)if(Array.isArray(A)&&A.length!==k.length)T.error(`Expected ${A.length} arguments, but found ${k.length} instead.`);else{for(let B=0;B<k.length;B++){const F=Array.isArray(A)?A[B]:A.type,j=k[B];T.concat(B+1).checkSubtype(F,j.type)}if(T.errors.length===0)return new Ga(u,g,C,k)}}if(b.length===1)a.errors.push(...T.errors);else{const A=(b.length?b:y).map(([k])=>{return O=k,Array.isArray(O)?`(${O.map(ii).join(", ")})`:`(${ii(O.type)}...)`;var O}).join(" | "),C=[];for(let k=1;k<i.length;k++){const O=a.parse(i[k],1+C.length);if(!O)return null;C.push(ii(O.type))}a.error(`Expected arguments of type ${A}, but found (${C.join(", ")}) instead.`)}return null}static register(i,a){Ga.definitions=a;for(const u in a)i[u]=Ga}}var zo=Ga;class eu{constructor(i,a,u){this.type=Ds,this.locale=u,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(i.length!==2)return a.error("Expected one argument.");const u=i[1];if(typeof u!="object"||Array.isArray(u))return a.error("Collator options argument must be an object.");const d=a.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Ln);if(!d)return null;const g=a.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Ln);if(!g)return null;let y=null;return u.locale&&(y=a.parse(u.locale,1,Cn),!y)?null:new eu(d,g,y)}evaluate(i){return new wt(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const Bo=8192;function vs(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function Ul(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function Np(o,i){const a=(180+o[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,d=Math.pow(2,i.z);return[Math.round(a*d*Bo),Math.round(u*d*Bo)]}function Up(o,i,a){const u=o[0]-i[0],d=o[1]-i[1],g=o[0]-a[0],y=o[1]-a[1];return u*y-g*d==0&&u*g<=0&&d*y<=0}function tu(o,i){let a=!1;for(let y=0,b=i.length;y<b;y++){const T=i[y];for(let A=0,C=T.length;A<C-1;A++){if(Up(o,T[A],T[A+1]))return!1;(d=T[A])[1]>(u=o)[1]!=(g=T[A+1])[1]>u[1]&&u[0]<(g[0]-d[0])*(u[1]-d[1])/(g[1]-d[1])+d[0]&&(a=!a)}}var u,d,g;return a}function Vp(o,i){for(let a=0;a<i.length;a++)if(tu(o,i[a]))return!0;return!1}function Kh(o,i,a,u){const d=u[0]-a[0],g=u[1]-a[1],y=(o[0]-a[0])*g-d*(o[1]-a[1]),b=(i[0]-a[0])*g-d*(i[1]-a[1]);return y>0&&b<0||y<0&&b>0}function Jh(o,i,a){for(const A of a)for(let C=0;C<A.length-1;++C)if((b=[(y=A[C+1])[0]-(g=A[C])[0],y[1]-g[1]])[0]*(T=[(d=i)[0]-(u=o)[0],d[1]-u[1]])[1]-b[1]*T[0]!=0&&Kh(u,d,g,y)&&Kh(g,y,u,d))return!0;var u,d,g,y,b,T;return!1}function $a(o,i){for(let a=0;a<o.length;++a)if(!tu(o[a],i))return!1;for(let a=0;a<o.length-1;++a)if(Jh(o[a],o[a+1],i))return!1;return!0}function jp(o,i){for(let a=0;a<i.length;a++)if($a(o,i[a]))return!0;return!1}function nu(o,i,a){const u=[];for(let d=0;d<o.length;d++){const g=[];for(let y=0;y<o[d].length;y++){const b=Np(o[d][y],a);vs(i,b),g.push(b)}u.push(g)}return u}function iu(o,i,a){const u=[];for(let d=0;d<o.length;d++){const g=nu(o[d],i,a);u.push(g)}return u}function Qh(o,i,a,u){if(o[0]<a[0]||o[0]>a[2]){const d=.5*u;let g=o[0]-a[0]>d?-u:a[0]-o[0]>d?u:0;g===0&&(g=o[0]-a[2]>d?-u:a[2]-o[0]>d?u:0),o[0]+=g}vs(i,o)}function pa(o,i,a,u){const d=Math.pow(2,u.z)*Bo,g=[u.x*Bo,u.y*Bo],y=[];if(!o)return y;for(const b of o)for(const T of b){const A=[T.x+g[0],T.y+g[1]];Qh(A,i,a,d),y.push(A)}return y}function li(o,i,a,u){const d=Math.pow(2,u.z)*Bo,g=[u.x*Bo,u.y*Bo],y=[];if(!o)return y;for(const T of o){const A=[];for(const C of T){const k=[C.x+g[0],C.y+g[1]];vs(i,k),A.push(k)}y.push(A)}if(i[2]-i[0]<=d/2){(b=i)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of y)for(const A of T)Qh(A,i,a,d)}var b;return y}class Vl{constructor(i,a){this.type=Ln,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(bi(i[1])){const u=i[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){const g=u.features[d].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Vl(u,u.features[d].geometry)}else if(u.type==="Feature"){const d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Vl(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Vl(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(a,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const b=nu(u.coordinates,g,y),T=pa(a.geometry(),d,g,y);if(!Ul(d,g))return!1;for(const A of T)if(!tu(A,b))return!1}if(u.type==="MultiPolygon"){const b=iu(u.coordinates,g,y),T=pa(a.geometry(),d,g,y);if(!Ul(d,g))return!1;for(const A of T)if(!Vp(A,b))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(a,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const b=nu(u.coordinates,g,y),T=li(a.geometry(),d,g,y);if(!Ul(d,g))return!1;for(const A of T)if(!$a(A,b))return!1}if(u.type==="MultiPolygon"){const b=iu(u.coordinates,g,y),T=li(a.geometry(),d,g,y);if(!Ul(d,g))return!1;for(const A of T)if(!jp(A,b))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ef=Vl;function jl(o){if(o instanceof zo&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof ef)return!1;let i=!0;return o.eachChild(a=>{i&&!jl(a)&&(i=!1)}),i}function Gl(o){if(o instanceof zo&&o.name==="feature-state")return!1;let i=!0;return o.eachChild(a=>{i&&!Gl(a)&&(i=!1)}),i}function ru(o,i){if(o instanceof zo&&i.indexOf(o.name)>=0)return!1;let a=!0;return o.eachChild(u=>{a&&!ru(u,i)&&(a=!1)}),a}class su{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(i.length!==2||typeof i[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const u=i[1];return a.scope.has(u)?new su(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var tf=su;class ou{constructor(i,a=[],u,d=new Or,g=[]){this.registry=i,this.path=a,this.key=a.map(y=>`[${y}]`).join(""),this.scope=d,this.errors=g,this.expectedType=u}parse(i,a,u,d,g={}){return a?this.concat(a,u,d)._parse(i,g):this._parse(i,g)}_parse(i,a){function u(d,g,y){return y==="assert"?new zi(g,[d]):y==="coerce"?new Ks(g,[d]):d}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=i[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[d];if(g){let y=g.parse(i,this);if(!y)return null;if(this.expectedType){const b=this.expectedType,T=y.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(b,T))return null}else y=u(y,b,a.typeAnnotation||"coerce");else y=u(y,b,a.typeAnnotation||"assert")}if(!(y instanceof ri)&&y.type.kind!=="resolvedImage"&&Fo(y)){const b=new Do;try{y=new ri(y.type,y.evaluate(b))}catch(T){return this.error(T.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,a,u){const d=typeof i=="number"?this.path.concat(i):this.path,g=u?this.scope.concat(u):this.scope;return new ou(this.registry,d,a||null,g,this.errors)}error(i,...a){const u=`${this.key}${a.map(d=>`[${d}]`).join("")}`;this.errors.push(new Wr(u,i))}checkSubtype(i,a){const u=X(i,a);return u&&this.error(u),u}}var nf=ou;function Fo(o){if(o instanceof tf)return Fo(o.boundExpression);if(o instanceof zo&&o.name==="error"||o instanceof eu||o instanceof ef)return!1;const i=o instanceof Ks||o instanceof zi;let a=!0;return o.eachChild(u=>{a=i?a&&Fo(u):a&&u instanceof ri}),!!a&&jl(o)&&ru(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ma(o,i){const a=o.length-1;let u,d,g=0,y=a,b=0;for(;g<=y;)if(b=Math.floor((g+y)/2),u=o[b],d=o[b+1],u<=i){if(b===a||i<d)return b;g=b+1}else{if(!(u>i))throw new Jn("Input is not a number.");y=b-1}return 0}class au{constructor(i,a,u){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(const[d,g]of u)this.labels.push(d),this.outputs.push(g)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(i[1],1,ft);if(!u)return null;const d=[];let g=null;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);for(let y=1;y<i.length;y+=2){const b=y===1?-1/0:i[y],T=i[y+1],A=y,C=y+1;if(typeof b!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(d.length&&d[d.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const k=a.parse(T,C,g);if(!k)return null;g=g||k.type,d.push([b,k])}return new au(g,u,d)}evaluate(i){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(i);const d=this.input.evaluate(i);if(d<=a[0])return u[0].evaluate(i);const g=a.length;return d>=a[g-1]?u[g-1].evaluate(i):u[ma(a,d)].evaluate(i)}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i}}var rf=au;function Qn(o,i,a){return o*(1-a)+i*a}var $l=Object.freeze({__proto__:null,number:Qn,color:function(o,i,a){return new ze(Qn(o.r,i.r,a),Qn(o.g,i.g,a),Qn(o.b,i.b,a),Qn(o.a,i.a,a))},array:function(o,i,a){return o.map((u,d)=>Qn(u,i[d],a))}});const Gp=.95047,$p=1.08883,sf=4/29,of=6/29,af=3*of*of,Hp=Math.PI/180,Uy=180/Math.PI;function lu(o){return o>.008856451679035631?Math.pow(o,1/3):o/af+sf}function lf(o){return o>of?o*o*o:af*(o-sf)}function cu(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function uu(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Wp(o){const i=uu(o.r),a=uu(o.g),u=uu(o.b),d=lu((.4124564*i+.3575761*a+.1804375*u)/Gp),g=lu((.2126729*i+.7151522*a+.072175*u)/1);return{l:116*g-16,a:500*(d-g),b:200*(g-lu((.0193339*i+.119192*a+.9503041*u)/$p)),alpha:o.a}}function qp(o){let i=(o.l+16)/116,a=isNaN(o.a)?i:i+o.a/500,u=isNaN(o.b)?i:i-o.b/200;return i=1*lf(i),a=Gp*lf(a),u=$p*lf(u),new ze(cu(3.2404542*a-1.5371385*i-.4985314*u),cu(-.969266*a+1.8760108*i+.041556*u),cu(.0556434*a-.2040259*i+1.0572252*u),o.alpha)}function Vy(o,i,a){const u=i-o;return o+a*(u>180||u<-180?u-360*Math.round(u/360):u)}const Hl={forward:Wp,reverse:qp,interpolate:function(o,i,a){return{l:Qn(o.l,i.l,a),a:Qn(o.a,i.a,a),b:Qn(o.b,i.b,a),alpha:Qn(o.alpha,i.alpha,a)}}},Wl={forward:function(o){const{l:i,a,b:u}=Wp(o),d=Math.atan2(u,a)*Uy;return{h:d<0?d+360:d,c:Math.sqrt(a*a+u*u),l:i,alpha:o.a}},reverse:function(o){const i=o.h*Hp,a=o.c;return qp({l:o.l,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:o.alpha})},interpolate:function(o,i,a){return{h:Vy(o.h,i.h,a),c:Qn(o.c,i.c,a),l:Qn(o.l,i.l,a),alpha:Qn(o.alpha,i.alpha,a)}}};var Zp=Object.freeze({__proto__:null,lab:Hl,hcl:Wl});class ql{constructor(i,a,u,d,g){this.type=i,this.operator=a,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[y,b]of g)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(i,a,u,d){let g=0;if(i.name==="exponential")g=cf(a,i.base,u,d);else if(i.name==="linear")g=cf(a,1,u,d);else if(i.name==="cubic-bezier"){const y=i.controlPoints;g=new he(y[0],y[1],y[2],y[3]).solve(cf(a,1,u,d))}return g}static parse(i,a){let[u,d,g,...y]=i;if(!Array.isArray(d)||d.length===0)return a.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const A=d[1];if(typeof A!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:A}}else{if(d[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const A=d.slice(1);if(A.length!==4||A.some(C=>typeof C!="number"||C<0||C>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:A}}}if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(g=a.parse(g,2,ft),!g)return null;const b=[];let T=null;u==="interpolate-hcl"||u==="interpolate-lab"?T=Ar:a.expectedType&&a.expectedType.kind!=="value"&&(T=a.expectedType);for(let A=0;A<y.length;A+=2){const C=y[A],k=y[A+1],O=A+3,B=A+4;if(typeof C!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(b.length&&b[b.length-1][0]>=C)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const F=a.parse(k,B,T);if(!F)return null;T=T||F.type,b.push([C,F])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new ql(T,u,d,g,b):a.error(`Type ${ii(T)} is not interpolatable.`)}evaluate(i){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(i);const d=this.input.evaluate(i);if(d<=a[0])return u[0].evaluate(i);const g=a.length;if(d>=a[g-1])return u[g-1].evaluate(i);const y=ma(a,d),b=ql.interpolationFactor(this.interpolation,d,a[y],a[y+1]),T=u[y].evaluate(i),A=u[y+1].evaluate(i);return this.operator==="interpolate"?$l[this.type.kind.toLowerCase()](T,A,b):this.operator==="interpolate-hcl"?Wl.reverse(Wl.interpolate(Wl.forward(T),Wl.forward(A),b)):Hl.reverse(Hl.interpolate(Hl.forward(T),Hl.forward(A),b))}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,i,this.input.serialize()];for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function cf(o,i,a,u){const d=u-a,g=o-a;return d===0?0:i===1?g/d:(Math.pow(i,g)-1)/(Math.pow(i,d)-1)}var Js=ql;class uf{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expectected at least one argument.");let u=null;const d=a.expectedType;d&&d.kind!=="value"&&(u=d);const g=[];for(const b of i.slice(1)){const T=a.parse(b,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,g.push(T)}const y=d&&g.some(b=>X(d,b.type));return new uf(y?Sn:u,g)}evaluate(i){let a,u=null,d=0;for(const g of this.args){if(d++,u=g.evaluate(i),u&&u instanceof mn&&!u.available&&(a||(a=u),u=null,d===this.args.length))return a;if(u!==null)break}return u}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(a=>{i.push(a.serialize())}),i}}var Xp=uf;class hu{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const u=[];for(let g=1;g<i.length-1;g+=2){const y=i[g];if(typeof y!="string")return a.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",g);const b=a.parse(i[g+1],g+1);if(!b)return null;u.push([y,b])}const d=a.parse(i[i.length-1],i.length-1,a.expectedType,u);return d?new hu(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[a,u]of this.bindings)i.push(a,u.serialize());return i.push(this.result.serialize()),i}}var hf=hu;class fu{constructor(i,a,u){this.type=i,this.index=a,this.input=u}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=a.parse(i[1],1,ft),d=a.parse(i[2],2,rr(a.expectedType||Sn));return u&&d?new fu(d.type.itemType,u,d):null}evaluate(i){const a=this.index.evaluate(i),u=this.input.evaluate(i);if(a<0)throw new Jn(`Array index out of bounds: ${a} < 0.`);if(a>=u.length)throw new Jn(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a!==Math.floor(a))throw new Jn(`Array index must be an integer, but found ${a} instead.`);return u[a]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var jy=fu;class ff{constructor(i,a){this.type=Ln,this.needle=i,this.haystack=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=a.parse(i[1],1,Sn),d=a.parse(i[2],2,Sn);return u&&d?re(u.type,[Ln,Cn,ft,Tr,Sn])?new ff(u,d):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(u.type)} instead`):null}evaluate(i){const a=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(u==null)return!1;if(!Ae(a,["boolean","string","number","null"]))throw new Jn(`Expected first argument to be of type boolean, string, number or null, but found ${ii(kn(a))} instead.`);if(!Ae(u,["string","array"]))throw new Jn(`Expected second argument to be of type array or string, but found ${ii(kn(u))} instead.`);return u.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Yp=ff;class Zl{constructor(i,a,u){this.type=ft,this.needle=i,this.haystack=a,this.fromIndex=u}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=a.parse(i[1],1,Sn),d=a.parse(i[2],2,Sn);if(!u||!d)return null;if(!re(u.type,[Ln,Cn,ft,Tr,Sn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(u.type)} instead`);if(i.length===4){const g=a.parse(i[3],3,ft);return g?new Zl(u,d,g):null}return new Zl(u,d)}evaluate(i){const a=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!Ae(a,["boolean","string","number","null"]))throw new Jn(`Expected first argument to be of type boolean, string, number or null, but found ${ii(kn(a))} instead.`);if(!Ae(u,["string","array"]))throw new Jn(`Expected second argument to be of type array or string, but found ${ii(kn(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(i);return u.indexOf(a,d)}return u.indexOf(a)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Kp=Zl;class df{constructor(i,a,u,d,g,y){this.inputType=i,this.type=a,this.input=u,this.cases=d,this.outputs=g,this.otherwise=y}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return a.error("Expected an even number of arguments.");let u,d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const g={},y=[];for(let A=2;A<i.length-1;A+=2){let C=i[A];const k=i[A+1];Array.isArray(C)||(C=[C]);const O=a.concat(A);if(C.length===0)return O.error("Expected at least one branch label.");for(const F of C){if(typeof F!="number"&&typeof F!="string")return O.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return O.error("Numeric branch labels must be integer values.");if(u){if(O.checkSubtype(u,kn(F)))return null}else u=kn(F);if(g[String(F)]!==void 0)return O.error("Branch labels must be unique.");g[String(F)]=y.length}const B=a.parse(k,A,d);if(!B)return null;d=d||B.type,y.push(B)}const b=a.parse(i[1],1,Sn);if(!b)return null;const T=a.parse(i[i.length-1],i.length-1,d);return T?b.type.kind!=="value"&&a.concat(1).checkSubtype(u,b.type)?null:new df(u,d,b,g,y,T):null}evaluate(i){const a=this.input.evaluate(i);return(kn(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],d={};for(const y of a){const b=d[this.cases[y]];b===void 0?(d[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[b][1].push(y)}const g=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,b]of u)i.push(b.length===1?g(b[0]):b.map(g)),i.push(this.outputs[y].serialize());return i.push(this.otherwise.serialize()),i}}var Gy=df;class pf{constructor(i,a,u){this.type=i,this.branches=a,this.otherwise=u}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&a.expectedType.kind!=="value"&&(u=a.expectedType);const d=[];for(let y=1;y<i.length-1;y+=2){const b=a.parse(i[y],y,Ln);if(!b)return null;const T=a.parse(i[y+1],y+1,u);if(!T)return null;d.push([b,T]),u=u||T.type}const g=a.parse(i[i.length-1],i.length-1,u);return g?new pf(u,d,g):null}evaluate(i){for(const[a,u]of this.branches)if(a.evaluate(i))return u.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[a,u]of this.branches)i(a),i(u);i(this.otherwise)}outputDefined(){return this.branches.every(([i,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(a=>{i.push(a.serialize())}),i}}var $y=pf;class ga{constructor(i,a,u,d){this.type=i,this.input=a,this.beginIndex=u,this.endIndex=d}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=a.parse(i[1],1,Sn),d=a.parse(i[2],2,ft);if(!u||!d)return null;if(!re(u.type,[rr(Sn),Cn,Sn]))return a.error(`Expected first argument to be of type array or string, but found ${ii(u.type)} instead`);if(i.length===4){const g=a.parse(i[3],3,ft);return g?new ga(u.type,u,d,g):null}return new ga(u.type,u,d)}evaluate(i){const a=this.input.evaluate(i),u=this.beginIndex.evaluate(i);if(!Ae(a,["string","array"]))throw new Jn(`Expected first argument to be of type array or string, but found ${ii(kn(a))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(i);return a.slice(u,d)}return a.slice(u)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Jp=ga;function mf(o,i){return o==="=="||o==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Qp(o,i,a,u){return u.compare(i,a)===0}function Ha(o,i,a){const u=o!=="=="&&o!=="!=";return class JI{constructor(g,y,b){this.type=Ln,this.lhs=g,this.rhs=y,this.collator=b,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const b=g[0];let T=y.parse(g[1],1,Sn);if(!T)return null;if(!mf(b,T.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${ii(T.type)}'.`);let A=y.parse(g[2],2,Sn);if(!A)return null;if(!mf(b,A.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${ii(A.type)}'.`);if(T.type.kind!==A.type.kind&&T.type.kind!=="value"&&A.type.kind!=="value")return y.error(`Cannot compare types '${ii(T.type)}' and '${ii(A.type)}'.`);u&&(T.type.kind==="value"&&A.type.kind!=="value"?T=new zi(A.type,[T]):T.type.kind!=="value"&&A.type.kind==="value"&&(A=new zi(T.type,[A])));let C=null;if(g.length===4){if(T.type.kind!=="string"&&A.type.kind!=="string"&&T.type.kind!=="value"&&A.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(C=y.parse(g[3],3,Ds),!C)return null}return new JI(T,A,C)}evaluate(g){const y=this.lhs.evaluate(g),b=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const T=kn(y),A=kn(b);if(T.kind!==A.kind||T.kind!=="string"&&T.kind!=="number")throw new Jn(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${T.kind}, ${A.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=kn(y),A=kn(b);if(T.kind!=="string"||A.kind!=="string")return i(g,y,b)}return this.collator?a(g,y,b,this.collator.evaluate(g)):i(g,y,b)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[o];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const Hy=Ha("==",function(o,i,a){return i===a},Qp),em=Ha("!=",function(o,i,a){return i!==a},function(o,i,a,u){return!Qp(0,i,a,u)}),tm=Ha("<",function(o,i,a){return i<a},function(o,i,a,u){return u.compare(i,a)<0}),nm=Ha(">",function(o,i,a){return i>a},function(o,i,a,u){return u.compare(i,a)>0}),gf=Ha("<=",function(o,i,a){return i<=a},function(o,i,a,u){return u.compare(i,a)<=0}),Wy=Ha(">=",function(o,i,a){return i>=a},function(o,i,a,u){return u.compare(i,a)>=0});class _f{constructor(i,a,u,d,g,y){this.type=Cn,this.number=i,this.locale=a,this.currency=u,this.unit=d,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(i,a){if(i.length!==3)return a.error("Expected two arguments.");const u=a.parse(i[1],1,ft);if(!u)return null;const d=i[2];if(typeof d!="object"||Array.isArray(d))return a.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=a.parse(d.locale,1,Cn),!g))return null;let y=null;if(d.currency&&(y=a.parse(d.currency,1,Cn),!y))return null;let b=null;if(d.unit&&(b=a.parse(d.unit,1,Cn),!b))return null;let T=null;if(d["min-fraction-digits"]&&(T=a.parse(d["min-fraction-digits"],1,ft),!T))return null;let A=null;return d["max-fraction-digits"]&&(A=a.parse(d["max-fraction-digits"],1,ft),!A)?null:new _f(u,g,y,b,T,A)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class yf{constructor(i){this.type=ft,this.input=i}static parse(i,a){if(i.length!==2)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const u=a.parse(i[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${ii(u.type)} instead.`):new yf(u):null}evaluate(i){const a=this.input.evaluate(i);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Jn(`Expected value to be of type string or array, but found ${ii(kn(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(a=>{i.push(a.serialize())}),i}}const im={"==":Hy,"!=":em,">":nm,"<":tm,">=":Wy,"<=":gf,array:zi,at:jy,boolean:zi,case:$y,coalesce:Xp,collator:eu,format:ho,image:Oo,in:Yp,"index-of":Kp,interpolate:Js,"interpolate-hcl":Js,"interpolate-lab":Js,length:yf,let:hf,literal:ri,match:Gy,number:zi,"number-format":_f,object:zi,slice:Jp,step:rf,string:zi,"to-boolean":Ks,"to-color":Ks,"to-number":Ks,"to-string":Ks,var:tf,within:ef};function rm(o,[i,a,u,d]){i=i.evaluate(o),a=a.evaluate(o),u=u.evaluate(o);const g=d?d.evaluate(o):1,y=un(i,a,u,g);if(y)throw new Jn(y);return new ze(i/255*g,a/255*g,u/255*g,g)}function sm(o,i){return o in i}function vf(o,i){const a=i[o];return a===void 0?null:a}function No(o){return{type:o}}zo.register(im,{error:[{kind:"error"},[Cn],(o,[i])=>{throw new Jn(i.evaluate(o))}],typeof:[Cn,[Sn],(o,[i])=>ii(kn(i.evaluate(o)))],"to-rgba":[rr(ft,4),[Ar],(o,[i])=>i.evaluate(o).toArray()],rgb:[Ar,[ft,ft,ft],rm],rgba:[Ar,[ft,ft,ft,ft],rm],has:{type:Ln,overloads:[[[Cn],(o,[i])=>sm(i.evaluate(o),o.properties())],[[Cn,Zr],(o,[i,a])=>sm(i.evaluate(o),a.evaluate(o))]]},get:{type:Sn,overloads:[[[Cn],(o,[i])=>vf(i.evaluate(o),o.properties())],[[Cn,Zr],(o,[i,a])=>vf(i.evaluate(o),a.evaluate(o))]]},"feature-state":[Sn,[Cn],(o,[i])=>vf(i.evaluate(o),o.featureState||{})],properties:[Zr,[],o=>o.properties()],"geometry-type":[Cn,[],o=>o.geometryType()],id:[Sn,[],o=>o.id()],zoom:[ft,[],o=>o.globals.zoom],pitch:[ft,[],o=>o.globals.pitch||0],"distance-from-center":[ft,[],o=>o.distanceFromCenter()],"heatmap-density":[ft,[],o=>o.globals.heatmapDensity||0],"line-progress":[ft,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[ft,[],o=>o.globals.skyRadialProgress||0],accumulated:[Sn,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[ft,No(ft),(o,i)=>{let a=0;for(const u of i)a+=u.evaluate(o);return a}],"*":[ft,No(ft),(o,i)=>{let a=1;for(const u of i)a*=u.evaluate(o);return a}],"-":{type:ft,overloads:[[[ft,ft],(o,[i,a])=>i.evaluate(o)-a.evaluate(o)],[[ft],(o,[i])=>-i.evaluate(o)]]},"/":[ft,[ft,ft],(o,[i,a])=>i.evaluate(o)/a.evaluate(o)],"%":[ft,[ft,ft],(o,[i,a])=>i.evaluate(o)%a.evaluate(o)],ln2:[ft,[],()=>Math.LN2],pi:[ft,[],()=>Math.PI],e:[ft,[],()=>Math.E],"^":[ft,[ft,ft],(o,[i,a])=>Math.pow(i.evaluate(o),a.evaluate(o))],sqrt:[ft,[ft],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[ft,[ft],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[ft,[ft],(o,[i])=>Math.log(i.evaluate(o))],log2:[ft,[ft],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[ft,[ft],(o,[i])=>Math.sin(i.evaluate(o))],cos:[ft,[ft],(o,[i])=>Math.cos(i.evaluate(o))],tan:[ft,[ft],(o,[i])=>Math.tan(i.evaluate(o))],asin:[ft,[ft],(o,[i])=>Math.asin(i.evaluate(o))],acos:[ft,[ft],(o,[i])=>Math.acos(i.evaluate(o))],atan:[ft,[ft],(o,[i])=>Math.atan(i.evaluate(o))],min:[ft,No(ft),(o,i)=>Math.min(...i.map(a=>a.evaluate(o)))],max:[ft,No(ft),(o,i)=>Math.max(...i.map(a=>a.evaluate(o)))],abs:[ft,[ft],(o,[i])=>Math.abs(i.evaluate(o))],round:[ft,[ft],(o,[i])=>{const a=i.evaluate(o);return a<0?-Math.round(-a):Math.round(a)}],floor:[ft,[ft],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[ft,[ft],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[Ln,[Cn,Sn],(o,[i,a])=>o.properties()[i.value]===a.value],"filter-id-==":[Ln,[Sn],(o,[i])=>o.id()===i.value],"filter-type-==":[Ln,[Cn],(o,[i])=>o.geometryType()===i.value],"filter-<":[Ln,[Cn,Sn],(o,[i,a])=>{const u=o.properties()[i.value],d=a.value;return typeof u==typeof d&&u<d}],"filter-id-<":[Ln,[Sn],(o,[i])=>{const a=o.id(),u=i.value;return typeof a==typeof u&&a<u}],"filter->":[Ln,[Cn,Sn],(o,[i,a])=>{const u=o.properties()[i.value],d=a.value;return typeof u==typeof d&&u>d}],"filter-id->":[Ln,[Sn],(o,[i])=>{const a=o.id(),u=i.value;return typeof a==typeof u&&a>u}],"filter-<=":[Ln,[Cn,Sn],(o,[i,a])=>{const u=o.properties()[i.value],d=a.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[Ln,[Sn],(o,[i])=>{const a=o.id(),u=i.value;return typeof a==typeof u&&a<=u}],"filter->=":[Ln,[Cn,Sn],(o,[i,a])=>{const u=o.properties()[i.value],d=a.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[Ln,[Sn],(o,[i])=>{const a=o.id(),u=i.value;return typeof a==typeof u&&a>=u}],"filter-has":[Ln,[Sn],(o,[i])=>i.value in o.properties()],"filter-has-id":[Ln,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Ln,[rr(Cn)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[Ln,[rr(Sn)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[Ln,[Cn,rr(Sn)],(o,[i,a])=>a.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[Ln,[Cn,rr(Sn)],(o,[i,a])=>function(u,d,g,y){for(;g<=y;){const b=g+y>>1;if(d[b]===u)return!0;d[b]>u?y=b-1:g=b+1}return!1}(o.properties()[i.value],a.value,0,a.value.length-1)],all:{type:Ln,overloads:[[[Ln,Ln],(o,[i,a])=>i.evaluate(o)&&a.evaluate(o)],[No(Ln),(o,i)=>{for(const a of i)if(!a.evaluate(o))return!1;return!0}]]},any:{type:Ln,overloads:[[[Ln,Ln],(o,[i,a])=>i.evaluate(o)||a.evaluate(o)],[No(Ln),(o,i)=>{for(const a of i)if(a.evaluate(o))return!0;return!1}]]},"!":[Ln,[Ln],(o,[i])=>!i.evaluate(o)],"is-supported-script":[Ln,[Cn],(o,[i])=>{const a=o.globals&&o.globals.isSupportedScript;return!a||a(i.evaluate(o))}],upcase:[Cn,[Cn],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[Cn,[Cn],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[Cn,No(Sn),(o,i)=>i.map(a=>Ai(a.evaluate(o))).join("")],"resolved-locale":[Cn,[Ds],(o,[i])=>i.evaluate(o).resolvedLocale()]});var Wa=im;function Xl(o){return{result:"success",value:o}}function qa(o){return{result:"error",value:o}}function Za(o){return o["property-type"]==="data-driven"}function fo(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function du(o){return!!o.expression&&o.expression.interpolated}function Zn(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function pu(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function qy(o){return o}function xf(o,i){const a=i.type==="color",u=o.stops&&typeof o.stops[0][0]=="object",d=u||!(u||o.property!==void 0),g=o.type||(du(i)?"exponential":"interval");if(a&&((o=yr({},o)).stops&&(o.stops=o.stops.map(A=>[A[0],ze.parse(A[1])])),o.default=ze.parse(o.default?o.default:i.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!Zp[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let y,b,T;if(g==="exponential")y=mu;else if(g==="interval")y=om;else if(g==="categorical"){y=bf,b=Object.create(null);for(const A of o.stops)b[A[0]]=A[1];T=typeof o.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);y=am}if(u){const A={},C=[];for(let B=0;B<o.stops.length;B++){const F=o.stops[B],j=F[0].zoom;A[j]===void 0&&(A[j]={zoom:j,type:o.type,property:o.property,default:o.default,stops:[]},C.push(j)),A[j].stops.push([F[0].value,F[1]])}const k=[];for(const B of C)k.push([A[B].zoom,xf(A[B],i)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:Js.interpolationFactor.bind(void 0,O),zoomStops:k.map(B=>B[0]),evaluate:({zoom:B},F)=>mu({stops:k,base:o.base},i,B).evaluate(B,F)}}if(d){const A=g==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Js.interpolationFactor.bind(void 0,A),zoomStops:o.stops.map(C=>C[0]),evaluate:({zoom:C})=>y(o,i,C,b,T)}}return{kind:"source",evaluate(A,C){const k=C&&C.properties?C.properties[o.property]:void 0;return k===void 0?Yl(o.default,i.default):y(o,i,k,b,T)}}}function Yl(o,i,a){return o!==void 0?o:i!==void 0?i:a!==void 0?a:void 0}function bf(o,i,a,u,d){return Yl(typeof a===d?u[a]:void 0,o.default,i.default)}function om(o,i,a){if(Zn(a)!=="number")return Yl(o.default,i.default);const u=o.stops.length;if(u===1||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[u-1][0])return o.stops[u-1][1];const d=ma(o.stops.map(g=>g[0]),a);return o.stops[d][1]}function mu(o,i,a){const u=o.base!==void 0?o.base:1;if(Zn(a)!=="number")return Yl(o.default,i.default);const d=o.stops.length;if(d===1||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[d-1][0])return o.stops[d-1][1];const g=ma(o.stops.map(C=>C[0]),a),y=function(C,k,O,B){const F=B-O,j=C-O;return F===0?0:k===1?j/F:(Math.pow(k,j)-1)/(Math.pow(k,F)-1)}(a,u,o.stops[g][0],o.stops[g+1][0]),b=o.stops[g][1],T=o.stops[g+1][1];let A=$l[i.type]||qy;if(o.colorSpace&&o.colorSpace!=="rgb"){const C=Zp[o.colorSpace];A=(k,O)=>C.reverse(C.interpolate(C.forward(k),C.forward(O),y))}return typeof b.evaluate=="function"?{evaluate(...C){const k=b.evaluate.apply(void 0,C),O=T.evaluate.apply(void 0,C);if(k!==void 0&&O!==void 0)return A(k,O,y)}}:A(b,T,y)}function am(o,i,a){return i.type==="color"?a=ze.parse(a):i.type==="formatted"?a=Lt.fromString(a.toString()):i.type==="resolvedImage"?a=mn.fromString(a.toString()):Zn(a)===i.type||i.type==="enum"&&i.values[a]||(a=void 0),Yl(a,o.default,i.default)}class gu{constructor(i,a){this.expression=i,this._warningHistory={},this._evaluator=new Do,this._defaultValue=a?function(u){return u.type==="color"&&(pu(u.default)||Array.isArray(u.default))?new ze(0,0,0,0):u.type==="color"?ze.parse(u.default)||null:u.default===void 0?null:u.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(i,a,u,d,g,y,b,T){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(i,a,u,d,g,y,b,T){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Jn(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function Xa(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Wa}function Ya(o,i){const a=new nf(Wa,[],i?function(d){const g={color:Ar,string:Cn,number:ft,enum:Cn,boolean:Ln,formatted:Sr,resolvedImage:us};return d.type==="array"?rr(g[d.value]||Sn,d.length):g[d.type]}(i):void 0),u=a.parse(o,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Xl(new gu(u,i)):qa(a.errors)}class _u{constructor(i,a){this.kind=i,this._styleExpression=a,this.isStateDependent=i!=="constant"&&!Gl(a.expression)}evaluateWithoutErrorHandling(i,a,u,d,g,y){return this._styleExpression.evaluateWithoutErrorHandling(i,a,u,d,g,y)}evaluate(i,a,u,d,g,y){return this._styleExpression.evaluate(i,a,u,d,g,y)}}class _a{constructor(i,a,u,d){this.kind=i,this.zoomStops=u,this._styleExpression=a,this.isStateDependent=i!=="camera"&&!Gl(a.expression),this.interpolationType=d}evaluateWithoutErrorHandling(i,a,u,d,g,y){return this._styleExpression.evaluateWithoutErrorHandling(i,a,u,d,g,y)}evaluate(i,a,u,d,g,y){return this._styleExpression.evaluate(i,a,u,d,g,y)}interpolationFactor(i,a,u){return this.interpolationType?Js.interpolationFactor(this.interpolationType,i,a,u):0}}function ya(o,i){if((o=Ya(o,i)).result==="error")return o;const a=o.value.expression,u=jl(a);if(!u&&!Za(i))return qa([new Wr("","data expressions not supported")]);const d=ru(a,["zoom","pitch","distance-from-center"]);if(!d&&!fo(i))return qa([new Wr("","zoom expressions not supported")]);const g=Jl(a);return g||d?g instanceof Wr?qa([g]):g instanceof Js&&!du(i)?qa([new Wr("",'"interpolate" expressions cannot be used with this property')]):Xl(g?new _a(u?"camera":"composite",o.value,g.labels,g instanceof Js?g.interpolation:void 0):new _u(u?"constant":"source",o.value)):qa([new Wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Kl{constructor(i,a){this._parameters=i,this._specification=a,yr(this,xf(this._parameters,this._specification))}static deserialize(i){return new Kl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Jl(o){let i=null;if(o instanceof hf)i=Jl(o.result);else if(o instanceof Xp){for(const a of o.args)if(i=Jl(a),i)break}else(o instanceof rf||o instanceof Js)&&o.input instanceof zo&&o.input.name==="zoom"&&(i=o);return i instanceof Wr||o.eachChild(a=>{const u=Jl(a);u instanceof Wr?i=u:!i&&u?i=new Wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&u&&i!==u&&(i=new Wr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class Nt{constructor(i,a,u,d){this.message=(i?`${i}: `:"")+u,d&&(this.identifier=d),a!=null&&a.__line__&&(this.line=a.__line__)}}function xs(o){const i=o.key,a=o.value,u=o.valueSpec||{},d=o.objectElementValidators||{},g=o.style,y=o.styleSpec;let b=[];const T=Zn(a);if(T!=="object")return[new Nt(i,a,`object expected, ${T} found`)];for(const A in a){const C=A.split(".")[0],k=u[C]||u["*"];let O;d[C]?O=d[C]:u[C]?O=Dr:d["*"]?O=d["*"]:u["*"]&&(O=Dr),O?b=b.concat(O({key:(i&&`${i}.`)+A,value:a[A],valueSpec:k,style:g,styleSpec:y,object:a,objectKey:A},a)):b.push(new Nt(i,a[A],`unknown property "${A}"`))}for(const A in u)d[A]||u[A].required&&u[A].default===void 0&&a[A]===void 0&&b.push(new Nt(i,a,`missing required property "${A}"`));return b}function lm(o){const i=o.value,a=o.valueSpec,u=o.style,d=o.styleSpec,g=o.key,y=o.arrayElementValidator||Dr;if(Zn(i)!=="array")return[new Nt(g,i,`array expected, ${Zn(i)} found`)];if(a.length&&i.length!==a.length)return[new Nt(g,i,`array length ${a.length} expected, length ${i.length} found`)];if(a["min-length"]&&i.length<a["min-length"])return[new Nt(g,i,`array length at least ${a["min-length"]} expected, length ${i.length} found`)];let b={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};d.$version<7&&(b.function=a.function),Zn(a.value)==="object"&&(b=a.value);let T=[];for(let A=0;A<i.length;A++)T=T.concat(y({array:i,arrayIndex:A,value:i[A],valueSpec:b,style:u,styleSpec:d,key:`${g}[${A}]`}));return T}function wf(o){const i=o.key,a=o.value,u=o.valueSpec;let d=Zn(a);if(d==="number"&&a!=a&&(d="NaN"),d!=="number")return[new Nt(i,a,`number expected, ${d} found`)];if("minimum"in u){let g=u.minimum;if(Zn(u.minimum)==="array"&&(g=u.minimum[o.arrayIndex]),a<g)return[new Nt(i,a,`${a} is less than the minimum value ${g}`)]}if("maximum"in u){let g=u.maximum;if(Zn(u.maximum)==="array"&&(g=u.maximum[o.arrayIndex]),a>g)return[new Nt(i,a,`${a} is greater than the maximum value ${g}`)]}return[]}function Ql(o){const i=o.valueSpec,a=ai(o.value.type);let u,d,g,y={};const b=a!=="categorical"&&o.value.property===void 0,T=!b,A=Zn(o.value.stops)==="array"&&Zn(o.value.stops[0])==="array"&&Zn(o.value.stops[0][0])==="object",C=xs({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(B){if(a==="identity")return[new Nt(B.key,B.value,'identity function may not have a "stops" property')];let F=[];const j=B.value;return F=F.concat(lm({key:B.key,value:j,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:k})),Zn(j)==="array"&&j.length===0&&F.push(new Nt(B.key,j,"array must have at least one stop")),F},default:function(B){return Dr({key:B.key,value:B.value,valueSpec:i,style:B.style,styleSpec:B.styleSpec})}}});return a==="identity"&&b&&C.push(new Nt(o.key,o.value,'missing required property "property"')),a==="identity"||o.value.stops||C.push(new Nt(o.key,o.value,'missing required property "stops"')),a==="exponential"&&o.valueSpec.expression&&!du(o.valueSpec)&&C.push(new Nt(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(T&&!Za(o.valueSpec)?C.push(new Nt(o.key,o.value,"property functions not supported")):b&&!fo(o.valueSpec)&&C.push(new Nt(o.key,o.value,"zoom functions not supported"))),a!=="categorical"&&!A||o.value.property!==void 0||C.push(new Nt(o.key,o.value,'"property" property is required')),C;function k(B){let F=[];const j=B.value,K=B.key;if(Zn(j)!=="array")return[new Nt(K,j,`array expected, ${Zn(j)} found`)];if(j.length!==2)return[new Nt(K,j,`array length 2 expected, length ${j.length} found`)];if(A){if(Zn(j[0])!=="object")return[new Nt(K,j,`object expected, ${Zn(j[0])} found`)];if(j[0].zoom===void 0)return[new Nt(K,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new Nt(K,j,"object stop key must have value")];const ce=ai(j[0].zoom);if(typeof ce!="number")return[new Nt(K,j[0].zoom,"stop zoom values must be numbers")];if(g&&g>ce)return[new Nt(K,j[0].zoom,"stop zoom values must appear in ascending order")];ce!==g&&(g=ce,d=void 0,y={}),F=F.concat(xs({key:`${K}[0]`,value:j[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:wf,value:O}}))}else F=F.concat(O({key:`${K}[0]`,value:j[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},j));return Xa(dr(j[1]))?F.concat([new Nt(`${K}[1]`,j[1],"expressions are not allowed in function stops.")]):F.concat(Dr({key:`${K}[1]`,value:j[1],valueSpec:i,style:B.style,styleSpec:B.styleSpec}))}function O(B,F){const j=Zn(B.value),K=ai(B.value),ce=B.value!==null?B.value:F;if(u){if(j!==u)return[new Nt(B.key,ce,`${j} stop domain type must match previous stop domain type ${u}`)]}else u=j;if(j!=="number"&&j!=="string"&&j!=="boolean"&&typeof K!="number"&&typeof K!="string"&&typeof K!="boolean")return[new Nt(B.key,ce,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&a!=="categorical"){let ve=`number expected, ${j} found`;return Za(i)&&a===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Nt(B.key,ce,ve)]}return a!=="categorical"||j!=="number"||typeof K=="number"&&isFinite(K)&&Math.floor(K)===K?a!=="categorical"&&j==="number"&&typeof K=="number"&&typeof d=="number"&&d!==void 0&&K<d?[new Nt(B.key,ce,"stop domain values must appear in ascending order")]:(d=K,a==="categorical"&&K in y?[new Nt(B.key,ce,"stop domain values must be unique")]:(y[K]=!0,[])):[new Nt(B.key,ce,`integer expected, found ${String(K)}`)]}}function Ka(o){const i=(o.expressionContext==="property"?ya:Ya)(dr(o.value),o.valueSpec);if(i.result==="error")return i.value.map(u=>new Nt(`${o.key}${u.key}`,o.value,u.message));const a=i.value.expression||i.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!a.outputDefined())return[new Nt(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Gl(a))return[new Nt(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter")return cm(a,o);if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!ru(a,["zoom","feature-state"]))return[new Nt(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!jl(a))return[new Nt(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cm(o,i){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const d of i.valueSpec.expression.parameters)a.delete(d);if(a.size===0)return[];const u=[];return o instanceof zo&&a.has(o.name)?[new Nt(i.key,i.value,`["${o.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(o.eachChild(d=>{u.push(...cm(d,i))}),u)}function yu(o){const i=o.key,a=o.value,u=o.valueSpec,d=[];return Array.isArray(u.values)?u.values.indexOf(ai(a))===-1&&d.push(new Nt(i,a,`expected one of [${u.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(u.values).indexOf(ai(a))===-1&&d.push(new Nt(i,a,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(a)} found`)),d}function Ef(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!Ef(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function vu(o,i="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ef(o)||(o=bu(o));const a=o;let u=!0;try{u=function(A){if(!xr(A))return A;let C=dr(A);return tc(C),C=ec(C),C}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(a,null,2)}
        `)}const d=Ze[`filter_${i}`],g=Ya(u,d);let y=null;if(g.result==="error")throw new Error(g.value.map(A=>`${A.key}: ${A.message}`).join(", "));y=(A,C,k)=>g.value.evaluate(A,C,{},k);let b=null,T=null;if(u!==a){const A=Ya(a,d);if(A.result==="error")throw new Error(A.value.map(C=>`${C.key}: ${C.message}`).join(", "));b=(C,k,O,B,F)=>A.value.evaluate(C,k,{},O,void 0,void 0,B,F),T=!jl(A.value.expression)}return{filter:y,dynamicFilter:b||void 0,needGeometry:um(u),needFeature:!!T}}function ec(o){if(!Array.isArray(o))return o;const i=function(a){if(xu.has(a[0])){for(let u=1;u<a.length;u++)if(xr(a[u]))return!0}return a}(o);return i===!0?i:i.map(a=>ec(a))}function tc(o){let i=!1;const a=[];if(o[0]==="case"){for(let u=1;u<o.length-1;u+=2)i=i||xr(o[u]),a.push(o[u+1]);a.push(o[o.length-1])}else if(o[0]==="match"){i=i||xr(o[1]);for(let u=2;u<o.length-1;u+=2)a.push(o[u+1]);a.push(o[o.length-1])}else if(o[0]==="step"){i=i||xr(o[1]);for(let u=1;u<o.length-1;u+=2)a.push(o[u+1])}i&&(o.length=0,o.push("any",...a));for(let u=1;u<o.length;u++)tc(o[u])}function xr(o){if(!Array.isArray(o))return!1;if((i=o[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let a=1;a<o.length;a++)if(xr(o[a]))return!0;return!1}const xu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Zy(o,i){return o<i?-1:o>i?1:0}function um(o){if(!Array.isArray(o))return!1;if(o[0]==="within")return!0;for(let i=1;i<o.length;i++)if(um(o[i]))return!0;return!1}function bu(o){if(!o)return!0;const i=o[0];return o.length<=1?i!=="any":i==="=="?Tf(o[1],o[2],"=="):i==="!="?Ja(Tf(o[1],o[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Tf(o[1],o[2],i):i==="any"?(a=o.slice(1),["any"].concat(a.map(bu))):i==="all"?["all"].concat(o.slice(1).map(bu)):i==="none"?["all"].concat(o.slice(1).map(bu).map(Ja)):i==="in"?wu(o[1],o.slice(2)):i==="!in"?Ja(wu(o[1],o.slice(2))):i==="has"?hm(o[1]):i==="!has"?Ja(hm(o[1])):i!=="within"||o;var a}function Tf(o,i,a){switch(o){case"$type":return[`filter-type-${a}`,i];case"$id":return[`filter-id-${a}`,i];default:return[`filter-${a}`,o,i]}}function wu(o,i){if(i.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(a=>typeof a!=typeof i[0])?["filter-in-large",o,["literal",i.sort(Zy)]]:["filter-in-small",o,["literal",i]]}}function hm(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Ja(o){return["!",o]}function Af(o){return Ef(dr(o.value))?Ka(yr({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):fm(o)}function fm(o){const i=o.value,a=o.key;if(Zn(i)!=="array")return[new Nt(a,i,`array expected, ${Zn(i)} found`)];const u=o.styleSpec;let d,g=[];if(i.length<1)return[new Nt(a,i,"filter array must have at least 1 element")];switch(g=g.concat(yu({key:`${a}[0]`,value:i[0],valueSpec:u.filter_operator,style:o.style,styleSpec:o.styleSpec})),ai(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&ai(i[1])==="$type"&&g.push(new Nt(a,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&g.push(new Nt(a,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(d=Zn(i[1]),d!=="string"&&g.push(new Nt(`${a}[1]`,i[1],`string expected, ${d} found`)));for(let y=2;y<i.length;y++)d=Zn(i[y]),ai(i[1])==="$type"?g=g.concat(yu({key:`${a}[${y}]`,value:i[y],valueSpec:u.geometry_type,style:o.style,styleSpec:o.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&g.push(new Nt(`${a}[${y}]`,i[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<i.length;y++)g=g.concat(fm({key:`${a}[${y}]`,value:i[y],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":d=Zn(i[1]),i.length!==2?g.push(new Nt(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):d!=="string"&&g.push(new Nt(`${a}[1]`,i[1],`string expected, ${d} found`));break;case"within":d=Zn(i[1]),i.length!==2?g.push(new Nt(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):d!=="object"&&g.push(new Nt(`${a}[1]`,i[1],`object expected, ${d} found`))}return g}function Eu(o,i){const a=o.key,u=o.style,d=o.styleSpec,g=o.value,y=o.objectKey,b=d[`${i}_${o.layerType}`];if(!b)return[];const T=y.match(/^(.*)-transition$/);if(i==="paint"&&T&&b[T[1]]&&b[T[1]].transition)return Dr({key:a,value:g,valueSpec:d.transition,style:u,styleSpec:d});const A=o.valueSpec||b[y];if(!A)return[new Nt(a,g,`unknown property "${y}"`)];let C;if(Zn(g)==="string"&&Za(A)&&!A.tokens&&(C=/^{([^}]+)}$/.exec(g)))return[new Nt(a,g,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const k=[];return o.layerType==="symbol"&&(y==="text-field"&&u&&!u.glyphs&&k.push(new Nt(a,g,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&pu(dr(g))&&ai(g.type)==="identity"&&k.push(new Nt(a,g,'"text-font" does not support identity functions'))),k.concat(Dr({key:o.key,value:g,valueSpec:A,style:u,styleSpec:d,expressionContext:"property",propertyType:i,propertyKey:y}))}function dm(o){return Eu(o,"paint")}function Sf(o){return Eu(o,"layout")}function Mf(o){let i=[];const a=o.value,u=o.key,d=o.style,g=o.styleSpec;a.type||a.ref||i.push(new Nt(u,a,'either "type" or "ref" is required'));let y=ai(a.type);const b=ai(a.ref);if(a.id){const T=ai(a.id);for(let A=0;A<o.arrayIndex;A++){const C=d.layers[A];ai(C.id)===T&&i.push(new Nt(u,a.id,`duplicate layer id "${a.id}", previously used at line ${C.id.__line__}`))}}if("ref"in a){let T;["type","source","source-layer","filter","layout"].forEach(A=>{A in a&&i.push(new Nt(u,a[A],`"${A}" is prohibited for ref layers`))}),d.layers.forEach(A=>{ai(A.id)===b&&(T=A)}),T?T.ref?i.push(new Nt(u,a.ref,"ref cannot reference another ref layer")):y=ai(T.type):typeof b=="string"&&i.push(new Nt(u,a.ref,`ref layer "${b}" not found`))}else if(y!=="background"&&y!=="sky")if(a.source){const T=d.sources&&d.sources[a.source],A=T&&ai(T.type);T?A==="vector"&&y==="raster"?i.push(new Nt(u,a.source,`layer "${a.id}" requires a raster source`)):A==="raster"&&y!=="raster"?i.push(new Nt(u,a.source,`layer "${a.id}" requires a vector source`)):A!=="vector"||a["source-layer"]?A==="raster-dem"&&y!=="hillshade"?i.push(new Nt(u,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||A==="geojson"&&T.lineMetrics||i.push(new Nt(u,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Nt(u,a,`layer "${a.id}" must specify a "source-layer"`)):i.push(new Nt(u,a.source,`source "${a.source}" not found`))}else i.push(new Nt(u,a,'missing required property "source"'));return i=i.concat(xs({key:u,value:a,valueSpec:g.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Dr({key:`${u}.type`,value:a.type,valueSpec:g.layer.type,style:o.style,styleSpec:o.styleSpec,object:a,objectKey:"type"}),filter:T=>Af(yr({layerType:y},T)),layout:T=>xs({layer:a,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":A=>Sf(yr({layerType:y},A))}}),paint:T=>xs({layer:a,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":A=>dm(yr({layerType:y},A))}})}})),i}function Qa(o){const i=o.value,a=o.key,u=Zn(i);return u!=="string"?[new Nt(a,i,`string expected, ${u} found`)]:[]}const Tu={promoteId:function({key:o,value:i}){if(Zn(i)==="string")return Qa({key:o,value:i});{const a=[];for(const u in i)a.push(...Qa({key:`${o}.${u}`,value:i[u]}));return a}}};function nc(o){const i=o.value,a=o.key,u=o.styleSpec,d=o.style;if(!i.type)return[new Nt(a,i,'"type" is required')];const g=ai(i.type);let y;switch(g){case"vector":case"raster":case"raster-dem":return y=xs({key:a,value:i,valueSpec:u[`source_${g.replace("-","_")}`],style:o.style,styleSpec:u,objectElementValidators:Tu}),y;case"geojson":if(y=xs({key:a,value:i,valueSpec:u.source_geojson,style:d,styleSpec:u,objectElementValidators:Tu}),i.cluster)for(const b in i.clusterProperties){const[T,A]=i.clusterProperties[b],C=typeof T=="string"?[T,["accumulated"],["get",b]]:T;y.push(...Ka({key:`${a}.${b}.map`,value:A,expressionContext:"cluster-map"})),y.push(...Ka({key:`${a}.${b}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return y;case"video":return xs({key:a,value:i,valueSpec:u.source_video,style:d,styleSpec:u});case"image":return xs({key:a,value:i,valueSpec:u.source_image,style:d,styleSpec:u});case"canvas":return[new Nt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yu({key:`${a}.type`,value:i.type,valueSpec:{values:pm(u)},style:d,styleSpec:u})}}function pm(o){return o.source.reduce((i,a)=>{const u=o[a];return u.type.type==="enum"&&(i=i.concat(Object.keys(u.type.values))),i},[])}function mm(o){const i=o.value,a=o.styleSpec,u=a.light,d=o.style;let g=[];const y=Zn(i);if(i===void 0)return g;if(y!=="object")return g=g.concat([new Nt("light",i,`object expected, ${y} found`)]),g;for(const b in i){const T=b.match(/^(.*)-transition$/);g=g.concat(T&&u[T[1]]&&u[T[1]].transition?Dr({key:b,value:i[b],valueSpec:a.transition,style:d,styleSpec:a}):u[b]?Dr({key:b,value:i[b],valueSpec:u[b],style:d,styleSpec:a}):[new Nt(b,i[b],`unknown property "${b}"`)])}return g}function Pf(o){const i=o.value,a=o.key,u=o.style,d=o.styleSpec,g=d.terrain;let y=[];const b=Zn(i);if(i===void 0)return y;if(b!=="object")return y=y.concat([new Nt("terrain",i,`object expected, ${b} found`)]),y;for(const T in i){const A=T.match(/^(.*)-transition$/);y=y.concat(A&&g[A[1]]&&g[A[1]].transition?Dr({key:T,value:i[T],valueSpec:d.transition,style:u,styleSpec:d}):g[T]?Dr({key:T,value:i[T],valueSpec:g[T],style:u,styleSpec:d}):[new Nt(T,i[T],`unknown property "${T}"`)])}if(i.source){const T=u.sources&&u.sources[i.source],A=T&&ai(T.type);T?A!=="raster-dem"&&y.push(new Nt(a,i.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):y.push(new Nt(a,i.source,`source "${i.source}" not found`))}else y.push(new Nt(a,i,'terrain is missing required property "source"'));return y}function gm(o){const i=o.value,a=o.style,u=o.styleSpec,d=u.fog;let g=[];const y=Zn(i);if(i===void 0)return g;if(y!=="object")return g=g.concat([new Nt("fog",i,`object expected, ${y} found`)]),g;for(const b in i){const T=b.match(/^(.*)-transition$/);g=g.concat(T&&d[T[1]]&&d[T[1]].transition?Dr({key:b,value:i[b],valueSpec:u.transition,style:a,styleSpec:u}):d[b]?Dr({key:b,value:i[b],valueSpec:d[b],style:a,styleSpec:u}):[new Nt(b,i[b],`unknown property "${b}"`)])}return g}const Au={"*":()=>[],array:lm,boolean:function(o){const i=o.value,a=o.key,u=Zn(i);return u!=="boolean"?[new Nt(a,i,`boolean expected, ${u} found`)]:[]},number:wf,color:function(o){const i=o.key,a=o.value,u=Zn(a);return u!=="string"?[new Nt(i,a,`color expected, ${u} found`)]:Je(a)===null?[new Nt(i,a,`color expected, "${a}" found`)]:[]},enum:yu,filter:Af,function:Ql,layer:Mf,object:xs,source:nc,light:mm,terrain:Pf,fog:gm,string:Qa,formatted:function(o){return Qa(o).length===0?[]:Ka(o)},resolvedImage:function(o){return Qa(o).length===0?[]:Ka(o)},projection:function(o){const i=o.value,a=o.styleSpec,u=a.projection,d=o.style;let g=[];const y=Zn(i);if(y==="object")for(const b in i)g=g.concat(Dr({key:b,value:i[b],valueSpec:u[b],style:d,styleSpec:a}));else y!=="string"&&(g=g.concat([new Nt("projection",i,`object or string expected, ${y} found`)]));return g}};function Dr(o){const i=o.value,a=o.valueSpec,u=o.styleSpec;return a.expression&&pu(ai(i))?Ql(o):a.expression&&Xa(dr(i))?Ka(o):a.type&&Au[a.type]?Au[a.type](o):xs(yr({},o,{valueSpec:a.type?u[a.type]:a}))}function Xy(o){const i=o.value,a=o.key,u=Qa(o);return u.length||(i.indexOf("{fontstack}")===-1&&u.push(new Nt(a,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&u.push(new Nt(a,i,'"glyphs" url must include a "{range}" token'))),u}function _m(o,i=Ze){return po(Dr({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,objectElementValidators:{glyphs:Xy,"*":()=>[]}}))}const Yy=o=>po(dm(o)),ym=o=>po(Sf(o));function po(o){return o.slice().sort((i,a)=>i.line&&a.line?i.line-a.line:0)}function vm(o,i){let a=!1;if(i&&i.length)for(const u of i)o.fire(new Er(new Error(u.message))),a=!0;return a}var el=Qs;function Qs(o,i,a){var u=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var d=new Int32Array(this.arrayBuffer);o=d[0],this.d=(i=d[1])+2*(a=d[2]);for(var g=0;g<this.d*this.d;g++){var y=d[3+g],b=d[3+g+1];u.push(y===b?null:d.subarray(y,b))}var T=d[3+u.length+1];this.keys=d.subarray(d[3+u.length],T),this.bboxes=d.subarray(T),this.insert=this._insertReadonly}else{this.d=i+2*a;for(var A=0;A<this.d*this.d;A++)u.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=o,this.padding=a,this.scale=i/o,this.uid=0;var C=a/i*o;this.min=-C,this.max=o+C}Qs.prototype.insert=function(o,i,a,u,d){this._forEachCell(i,a,u,d,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(d)},Qs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Qs.prototype._insertCell=function(o,i,a,u,d,g){this.cells[d].push(g)},Qs.prototype.query=function(o,i,a,u,d){var g=this.min,y=this.max;if(o<=g&&i<=g&&y<=a&&y<=u&&!d)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(o,i,a,u,this._queryCell,b,{},d),b},Qs.prototype._queryCell=function(o,i,a,u,d,g,y,b){var T=this.cells[d];if(T!==null)for(var A=this.keys,C=this.bboxes,k=0;k<T.length;k++){var O=T[k];if(y[O]===void 0){var B=4*O;(b?b(C[B+0],C[B+1],C[B+2],C[B+3]):o<=C[B+2]&&i<=C[B+3]&&a>=C[B+0]&&u>=C[B+1])?(y[O]=!0,g.push(A[O])):y[O]=!1}}},Qs.prototype._forEachCell=function(o,i,a,u,d,g,y,b){for(var T=this._convertToCellCoord(o),A=this._convertToCellCoord(i),C=this._convertToCellCoord(a),k=this._convertToCellCoord(u),O=T;O<=C;O++)for(var B=A;B<=k;B++){var F=this.d*B+O;if((!b||b(this._convertFromCellCoord(O),this._convertFromCellCoord(B),this._convertFromCellCoord(O+1),this._convertFromCellCoord(B+1)))&&d.call(this,o,i,a,u,F,g,y,b))return}},Qs.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Qs.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Qs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,i=3+this.cells.length+1+1,a=0,u=0;u<this.cells.length;u++)a+=this.cells[u].length;var d=new Int32Array(i+a+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var g=i,y=0;y<o.length;y++){var b=o[y];d[3+y]=g,d.set(b,g),g+=b.length}return d[3+o.length]=g,d.set(this.keys,g),d[3+o.length+1]=g+=this.keys.length,d.set(this.bboxes,g),g+=this.bboxes.length,d.buffer};const Su={};function Gt(o,i,a={}){Object.defineProperty(o,"_classRegistryKey",{value:i,writeable:!1}),Su[i]={klass:o,omit:a.omit||[]}}Gt(Object,"Object"),el.serialize=function(o,i){const a=o.toArrayBuffer();return i&&i.push(a),{buffer:a}},el.deserialize=function(o){return new el(o.buffer)},Object.defineProperty(el,"name",{value:"Grid"}),Gt(el,"Grid"),Gt(ze,"Color"),Gt(Error,"Error"),Gt(ct,"AJAXError"),Gt(mn,"ResolvedImage"),Gt(Kl,"StylePropertyFunction"),Gt(gu,"StyleExpression",{omit:["_evaluator"]}),Gt(_a,"ZoomDependentExpression"),Gt(_u,"ZoomConstantExpression"),Gt(zo,"CompoundExpression",{omit:["_evaluate"]});for(const o in Wa)Su[Wa[o]._classRegistryKey]||Gt(Wa[o],`Expression${o}`);function xm(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function ic(o){return v.ImageBitmap&&o instanceof v.ImageBitmap}function rc(o,i){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(xm(o)||ic(o))return i&&i.push(o),o;if(ArrayBuffer.isView(o)){const a=o;return i&&i.push(a.buffer),a}if(o instanceof v.ImageData)return i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const a=[];for(const u of o)a.push(rc(u,i));return a}if(typeof o=="object"){const a=o.constructor,u=a._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const d=a.serialize?a.serialize(o,i):{};if(!a.serialize){for(const g in o)o.hasOwnProperty(g)&&(Su[u].omit.indexOf(g)>=0||(d[g]=rc(o[g],i)));o instanceof Error&&(d.message=o.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof o)}function sc(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||xm(o)||ic(o)||ArrayBuffer.isView(o)||o instanceof v.ImageData)return o;if(Array.isArray(o))return o.map(sc);if(typeof o=="object"){const i=o.$name||"Object",{klass:a}=Su[i];if(!a)throw new Error(`can't deserialize unregistered class ${i}`);if(a.deserialize)return a.deserialize(o);const u=Object.create(a.prototype);for(const d of Object.keys(o))d!=="$name"&&(u[d]=sc(o[d]));return u}throw new Error("can't deserialize object of type "+typeof o)}const oc=o=>o>=1536&&o<=1791,bm=o=>o>=1872&&o<=1919,If=o=>o>=2208&&o<=2303,wm=o=>o>=11904&&o<=12031,Cf=o=>o>=12032&&o<=12255,Lf=o=>o>=12272&&o<=12287,ac=o=>o>=12288&&o<=12351,Mu=o=>o>=12352&&o<=12447,tl=o=>o>=12448&&o<=12543,Pu=o=>o>=12544&&o<=12591,Em=o=>o>=12704&&o<=12735,Tm=o=>o>=12736&&o<=12783,kf=o=>o>=12784&&o<=12799,Am=o=>o>=12800&&o<=13055,Sm=o=>o>=13056&&o<=13311,Mm=o=>o>=13312&&o<=19903,Rf=o=>o>=19968&&o<=40959,Pm=o=>o>=40960&&o<=42127,Im=o=>o>=42128&&o<=42191,Cm=o=>o>=44032&&o<=55215,Lm=o=>o>=63744&&o<=64255,Iu=o=>o>=64336&&o<=65023,lc=o=>o>=65040&&o<=65055,m=o=>o>=65072&&o<=65103,l=o=>o>=65104&&o<=65135,f=o=>o>=65136&&o<=65279,_=o=>o>=65280&&o<=65519;function x(o){for(const i of o)if(P(i.charCodeAt(0)))return!0;return!1}function w(o){for(const i of o)if(!S(i.charCodeAt(0)))return!1;return!0}function S(o){return!(oc(o)||bm(o)||If(o)||Iu(o)||f(o))}function P(o){return!(o!==746&&o!==747&&(o<4352||!(Em(o)||Pu(o)||m(o)&&!(o>=65097&&o<=65103)||Lm(o)||Sm(o)||wm(o)||Tm(o)||!(!ac(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Mm(o)||Rf(o)||Am(o)||(i=>i>=12592&&i<=12687)(o)||(i=>i>=43360&&i<=43391)(o)||(i=>i>=55216&&i<=55295)(o)||(i=>i>=4352&&i<=4607)(o)||Cm(o)||Mu(o)||Lf(o)||(i=>i>=12688&&i<=12703)(o)||Cf(o)||kf(o)||tl(o)&&o!==12540||!(!_(o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!l(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(i=>i>=5120&&i<=5759)(o)||(i=>i>=6320&&i<=6399)(o)||lc(o)||(i=>i>=19904&&i<=19967)(o)||Pm(o)||Im(o))))}function L(o){return!(P(o)||function(i){return!!((a=>a>=128&&a<=255)(i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||(a=>a>=8192&&a<=8303)(i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||(a=>a>=8448&&a<=8527)(i)||(a=>a>=8528&&a<=8591)(i)||(a=>a>=8960&&a<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||(a=>a>=9216&&a<=9279)(i)&&i!==9251||(a=>a>=9280&&a<=9311)(i)||(a=>a>=9312&&a<=9471)(i)||(a=>a>=9632&&a<=9727)(i)||(a=>a>=9728&&a<=9983)(i)&&!(i>=9754&&i<=9759)||(a=>a>=11008&&a<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||ac(i)||tl(i)||(a=>a>=57344&&a<=63743)(i)||m(i)||l(i)||_(i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(o))}function D(o){return o>=1424&&o<=2303||Iu(o)||f(o)}function z(o,i){return!(!i&&D(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(a=>a>=6016&&a<=6143)(o))}function V(o){for(const i of o)if(D(i.charCodeAt(0)))return!0;return!1}const q="deferred",ee="loading",Q="loaded";let te=null,ie="unavailable",W=null;const fe=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(ie="error"),te&&te(o)};function le(){pe.fire(new Dn("pluginStateChange",{pluginStatus:ie,pluginURL:W}))}const pe=new fr,Te=function(){return ie},be=function(){if(ie!==q||!W)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ie=ee,le(),W&&$n({url:W},o=>{o?fe(o):(ie=Q,le())})},Ce={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ie===Q||Ce.applyArabicShaping!=null,isLoading:()=>ie===ee,setState(o){ie=o.pluginStatus,W=o.pluginURL},isParsed:()=>Ce.applyArabicShaping!=null&&Ce.processBidirectionalText!=null&&Ce.processStyledBidirectionalText!=null,getPluginURL:()=>W};class Be{constructor(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(i){return function(a,u){for(const d of a)if(!z(d.charCodeAt(0),u))return!1;return!0}(i,Ce.isLoaded())}}class Ge{constructor(i,a){this.property=i,this.value=a,this.expression=function(u,d){if(pu(u))return new Kl(u,d);if(Xa(u)){const g=ya(u,d);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=u;return typeof u=="string"&&d.type==="color"&&(g=ze.parse(u)),{kind:"constant",evaluate:()=>g}}}(a===void 0?i.specification.default:a,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,a,u){return this.property.possiblyEvaluate(this,i,a,u)}}class We{constructor(i){this.property=i,this.value=new Ge(i,void 0)}transitioned(i,a){return new Ue(this.property,this.value,a,Wn({},i.transition,this.transition),i.now)}untransitioned(){return new Ue(this.property,this.value,null,{},0)}}class At{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return xn(this._values[i].value.value)}setValue(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new We(this._values[i].property)),this._values[i].value=new Ge(this._values[i].property,a===null?void 0:xn(a))}getTransition(i){return xn(this._values[i].transition)}setTransition(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new We(this._values[i].property)),this._values[i].transition=xn(a)||void 0}serialize(){const i={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(i[a]=u);const d=this.getTransition(a);d!==void 0&&(i[`${a}-transition`]=d)}return i}transitioned(i,a){const u=new rt(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(i,a._values[d]);return u}untransitioned(){const i=new rt(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].untransitioned();return i}}class Ue{constructor(i,a,u,d,g){const y=d.delay||0,b=d.duration||0;g=g||0,this.property=i,this.value=a,this.begin=g+y,this.end=this.begin+b,i.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(i,a,u){const d=i.now||0,g=this.value.possiblyEvaluate(i,a,u),y=this.prior;if(y){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return y.possiblyEvaluate(i,a,u);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(i,a,u),g,gn(b))}}return g}}class rt{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,a,u){const d=new $e(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(i,a,u);return d}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Ye{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return xn(this._values[i].value)}setValue(i,a){this._values[i]=new Ge(this._values[i].property,a===null?void 0:xn(a))}serialize(){const i={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(i[a]=u)}return i}possiblyEvaluate(i,a,u){const d=new $e(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(i,a,u);return d}}class pt{constructor(i,a,u){this.property=i,this.value=a,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,a,u,d){return this.property.evaluate(this.value,this.parameters,i,a,u,d)}}class $e{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class De{constructor(i){this.specification=i}possiblyEvaluate(i,a){return i.expression.evaluate(a)}interpolate(i,a,u){const d=$l[this.specification.type];return d?d(i,a,u):i}}class qe{constructor(i,a){this.specification=i,this.overrides=a}possiblyEvaluate(i,a,u,d){return new pt(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(a,null,{},u,d)}:i.expression,a)}interpolate(i,a,u){if(i.value.kind!=="constant"||a.value.kind!=="constant")return i;if(i.value.value===void 0||a.value.value===void 0)return new pt(this,{kind:"constant",value:void 0},i.parameters);const d=$l[this.specification.type];return d?new pt(this,{kind:"constant",value:d(i.value.value,a.value.value,u)},i.parameters):i}evaluate(i,a,u,d,g,y){return i.kind==="constant"?i.value:i.evaluate(a,u,d,g,y)}}class ut{constructor(i){this.specification=i}possiblyEvaluate(i,a,u,d){return!!i.expression.evaluate(a,null,{},u,d)}interpolate(){return!1}}class _t{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new Be(0,{});for(const u in i){const d=i[u];d.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new Ge(d,void 0),y=this.defaultTransitionablePropertyValues[u]=new We(d);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate(a)}}}function Qt(o,i){return 256*(o=$t(Math.floor(o),0,255))+$t(Math.floor(i),0,255)}Gt(qe,"DataDrivenProperty"),Gt(De,"DataConstantProperty"),Gt(ut,"ColorRampProperty");const zn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ht{constructor(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ut{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,a){return i._trim(),a&&(i.isTransferred=!0,a.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function rn(o,i=1){let a=0,u=0;return{members:o.map(d=>{const g=zn[d.type].BYTES_PER_ELEMENT,y=a=Vn(a,Math.max(i,g)),b=d.components||1;return u=Math.max(u,g),a+=g*b,{name:d.name,type:d.type,components:b,offset:y}}),size:Vn(a,Math.max(u,i)),alignment:i}}function Vn(o,i){return Math.ceil(o/i)*i}class hn extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a){const u=this.length;return this.resize(u+1),this.emplace(u,i,a)}emplace(i,a,u){const d=2*i;return this.int16[d+0]=a,this.int16[d+1]=u,i}}hn.prototype.bytesPerElement=4,Gt(hn,"StructArrayLayout2i4");class ci extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,i,a,u)}emplace(i,a,u,d){const g=3*i;return this.int16[g+0]=a,this.int16[g+1]=u,this.int16[g+2]=d,i}}ci.prototype.bytesPerElement=6,Gt(ci,"StructArrayLayout3i6");class mi extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,d)}emplace(i,a,u,d,g){const y=4*i;return this.int16[y+0]=a,this.int16[y+1]=u,this.int16[y+2]=d,this.int16[y+3]=g,i}}mi.prototype.bytesPerElement=8,Gt(mi,"StructArrayLayout4i8");class Si extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,i,a,u,d,g,y,b)}emplace(i,a,u,d,g,y,b,T){const A=6*i,C=12*i,k=3*i;return this.int16[A+0]=a,this.int16[A+1]=u,this.uint8[C+4]=d,this.uint8[C+5]=g,this.uint8[C+6]=y,this.uint8[C+7]=b,this.float32[k+2]=T,i}}Si.prototype.bytesPerElement=12,Gt(Si,"StructArrayLayout2i4ub1f12");class wi extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,d)}emplace(i,a,u,d,g){const y=4*i;return this.float32[y+0]=a,this.float32[y+1]=u,this.float32[y+2]=d,this.float32[y+3]=g,i}}wi.prototype.bytesPerElement=16,Gt(wi,"StructArrayLayout4f16");class or extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,u,d,g)}emplace(i,a,u,d,g,y){const b=6*i,T=3*i;return this.uint16[b+0]=a,this.uint16[b+1]=u,this.uint16[b+2]=d,this.uint16[b+3]=g,this.float32[T+2]=y,i}}or.prototype.bytesPerElement=12,Gt(or,"StructArrayLayout4ui1f12");class ns extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,d)}emplace(i,a,u,d,g){const y=4*i;return this.uint16[y+0]=a,this.uint16[y+1]=u,this.uint16[y+2]=d,this.uint16[y+3]=g,i}}ns.prototype.bytesPerElement=8,Gt(ns,"StructArrayLayout4ui8");class zs extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,u,d,g,y)}emplace(i,a,u,d,g,y,b){const T=6*i;return this.int16[T+0]=a,this.int16[T+1]=u,this.int16[T+2]=d,this.int16[T+3]=g,this.int16[T+4]=y,this.int16[T+5]=b,i}}zs.prototype.bytesPerElement=12,Gt(zs,"StructArrayLayout6i12");class mo extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,d,g,y,b,T,A,C,k,O){const B=this.length;return this.resize(B+1),this.emplace(B,i,a,u,d,g,y,b,T,A,C,k,O)}emplace(i,a,u,d,g,y,b,T,A,C,k,O,B){const F=12*i;return this.int16[F+0]=a,this.int16[F+1]=u,this.int16[F+2]=d,this.int16[F+3]=g,this.uint16[F+4]=y,this.uint16[F+5]=b,this.uint16[F+6]=T,this.uint16[F+7]=A,this.int16[F+8]=C,this.int16[F+9]=k,this.int16[F+10]=O,this.int16[F+11]=B,i}}mo.prototype.bytesPerElement=24,Gt(mo,"StructArrayLayout4i4ui4i24");class Bi extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,u,d,g,y)}emplace(i,a,u,d,g,y,b){const T=10*i,A=5*i;return this.int16[T+0]=a,this.int16[T+1]=u,this.int16[T+2]=d,this.float32[A+2]=g,this.float32[A+3]=y,this.float32[A+4]=b,i}}Bi.prototype.bytesPerElement=20,Gt(Bi,"StructArrayLayout3i3f20");class Ei extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint32[1*i+0]=a,i}}Ei.prototype.bytesPerElement=4,Gt(Ei,"StructArrayLayout1ul4");class si extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,d,g,y,b,T,A,C,k,O,B){const F=this.length;return this.resize(F+1),this.emplace(F,i,a,u,d,g,y,b,T,A,C,k,O,B)}emplace(i,a,u,d,g,y,b,T,A,C,k,O,B,F){const j=20*i,K=10*i;return this.int16[j+0]=a,this.int16[j+1]=u,this.int16[j+2]=d,this.int16[j+3]=g,this.int16[j+4]=y,this.float32[K+3]=b,this.float32[K+4]=T,this.float32[K+5]=A,this.float32[K+6]=C,this.int16[j+14]=k,this.uint32[K+8]=O,this.uint16[j+18]=B,this.uint16[j+19]=F,i}}si.prototype.bytesPerElement=40,Gt(si,"StructArrayLayout5i4f1i1ul2ui40");class Zi extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,d,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,i,a,u,d,g,y,b)}emplace(i,a,u,d,g,y,b,T){const A=8*i;return this.int16[A+0]=a,this.int16[A+1]=u,this.int16[A+2]=d,this.int16[A+4]=g,this.int16[A+5]=y,this.int16[A+6]=b,this.int16[A+7]=T,i}}Zi.prototype.bytesPerElement=16,Gt(Zi,"StructArrayLayout3i2i2i16");class zr extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,u,d,g)}emplace(i,a,u,d,g,y){const b=4*i,T=8*i;return this.float32[b+0]=a,this.float32[b+1]=u,this.float32[b+2]=d,this.int16[T+6]=g,this.int16[T+7]=y,i}}zr.prototype.bytesPerElement=16,Gt(zr,"StructArrayLayout2f1f2i16");class Ci extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,d)}emplace(i,a,u,d,g){const y=12*i,b=3*i;return this.uint8[y+0]=a,this.uint8[y+1]=u,this.float32[b+1]=d,this.float32[b+2]=g,i}}Ci.prototype.bytesPerElement=12,Gt(Ci,"StructArrayLayout2ub2f12");class Br extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,i,a,u)}emplace(i,a,u,d){const g=3*i;return this.float32[g+0]=a,this.float32[g+1]=u,this.float32[g+2]=d,i}}Br.prototype.bytesPerElement=12,Gt(Br,"StructArrayLayout3f12");class Fr extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,i,a,u)}emplace(i,a,u,d){const g=3*i;return this.uint16[g+0]=a,this.uint16[g+1]=u,this.uint16[g+2]=d,i}}Fr.prototype.bytesPerElement=6,Gt(Fr,"StructArrayLayout3ui6");class Uo extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,g,y,b,T,A,C,k,O,B,F,j,K,ce,ve,ae,_e,Ee){const xe=this.length;return this.resize(xe+1),this.emplace(xe,i,a,u,d,g,y,b,T,A,C,k,O,B,F,j,K,ce,ve,ae,_e,Ee)}emplace(i,a,u,d,g,y,b,T,A,C,k,O,B,F,j,K,ce,ve,ae,_e,Ee,xe){const He=30*i,je=15*i,tt=60*i;return this.int16[He+0]=a,this.int16[He+1]=u,this.int16[He+2]=d,this.float32[je+2]=g,this.float32[je+3]=y,this.uint16[He+8]=b,this.uint16[He+9]=T,this.uint32[je+5]=A,this.uint32[je+6]=C,this.uint32[je+7]=k,this.uint16[He+16]=O,this.uint16[He+17]=B,this.uint16[He+18]=F,this.float32[je+10]=j,this.float32[je+11]=K,this.uint8[tt+48]=ce,this.uint8[tt+49]=ve,this.uint8[tt+50]=ae,this.uint32[je+13]=_e,this.int16[He+28]=Ee,this.uint8[tt+58]=xe,i}}Uo.prototype.bytesPerElement=60,Gt(Uo,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class nl extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,g,y,b,T,A,C,k,O,B,F,j,K,ce,ve,ae,_e,Ee,xe,He,je,tt,vt,Xe,it,ot,mt){const bt=this.length;return this.resize(bt+1),this.emplace(bt,i,a,u,d,g,y,b,T,A,C,k,O,B,F,j,K,ce,ve,ae,_e,Ee,xe,He,je,tt,vt,Xe,it,ot,mt)}emplace(i,a,u,d,g,y,b,T,A,C,k,O,B,F,j,K,ce,ve,ae,_e,Ee,xe,He,je,tt,vt,Xe,it,ot,mt,bt){const Ke=38*i,Ct=19*i;return this.int16[Ke+0]=a,this.int16[Ke+1]=u,this.int16[Ke+2]=d,this.float32[Ct+2]=g,this.float32[Ct+3]=y,this.int16[Ke+8]=b,this.int16[Ke+9]=T,this.int16[Ke+10]=A,this.int16[Ke+11]=C,this.int16[Ke+12]=k,this.int16[Ke+13]=O,this.uint16[Ke+14]=B,this.uint16[Ke+15]=F,this.uint16[Ke+16]=j,this.uint16[Ke+17]=K,this.uint16[Ke+18]=ce,this.uint16[Ke+19]=ve,this.uint16[Ke+20]=ae,this.uint16[Ke+21]=_e,this.uint16[Ke+22]=Ee,this.uint16[Ke+23]=xe,this.uint16[Ke+24]=He,this.uint16[Ke+25]=je,this.uint16[Ke+26]=tt,this.uint16[Ke+27]=vt,this.uint16[Ke+28]=Xe,this.uint32[Ct+15]=it,this.float32[Ct+16]=ot,this.float32[Ct+17]=mt,this.float32[Ct+18]=bt,i}}nl.prototype.bytesPerElement=76,Gt(nl,"StructArrayLayout3i2f6i15ui1ul3f76");class hs extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.float32[1*i+0]=a,i}}hs.prototype.bytesPerElement=4,Gt(hs,"StructArrayLayout1f4");class bs extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,u,d,g)}emplace(i,a,u,d,g,y){const b=5*i;return this.float32[b+0]=a,this.float32[b+1]=u,this.float32[b+2]=d,this.float32[b+3]=g,this.float32[b+4]=y,i}}bs.prototype.bytesPerElement=20,Gt(bs,"StructArrayLayout5f20");class go extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,d)}emplace(i,a,u,d,g){const y=6*i;return this.uint32[3*i+0]=a,this.uint16[y+2]=u,this.uint16[y+3]=d,this.uint16[y+4]=g,i}}go.prototype.bytesPerElement=12,Gt(go,"StructArrayLayout1ul3ui12");class Vo extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a){const u=this.length;return this.resize(u+1),this.emplace(u,i,a)}emplace(i,a,u){const d=2*i;return this.uint16[d+0]=a,this.uint16[d+1]=u,i}}Vo.prototype.bytesPerElement=4,Gt(Vo,"StructArrayLayout2ui4");class jo extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint16[1*i+0]=a,i}}jo.prototype.bytesPerElement=2,Gt(jo,"StructArrayLayout1ui2");class il extends Ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a){const u=this.length;return this.resize(u+1),this.emplace(u,i,a)}emplace(i,a,u){const d=2*i;return this.float32[d+0]=a,this.float32[d+1]=u,i}}il.prototype.bytesPerElement=8,Gt(il,"StructArrayLayout2f8");class rw extends Ht{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}rw.prototype.size=40;class Ky extends si{get(i){return new rw(this,i)}}Gt(Ky,"CollisionBoxArray");class sw extends Ht{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}sw.prototype.size=60;class ow extends Uo{get(i){return new sw(this,i)}}Gt(ow,"PlacedSymbolArray");class aw extends Ht{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}aw.prototype.size=76;class lw extends nl{get(i){return new aw(this,i)}}Gt(lw,"SymbolInstanceArray");class cw extends hs{getoffsetX(i){return this.float32[1*i+0]}}Gt(cw,"GlyphOffsetArray");class uw extends hn{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Gt(uw,"SymbolLineVertexArray");class hw extends Ht{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}hw.prototype.size=12;class fw extends go{get(i){return new hw(this,i)}}Gt(fw,"FeatureIndexArray");class dw extends Vo{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Gt(dw,"FillExtrusionCentroidArray");const P3=rn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),I3=rn([{name:"a_dash",components:4,type:"Uint16"}]);var cc={},C3={get exports(){return cc},set exports(o){cc=o}},Jy={};({get exports(){return Jy},set exports(o){Jy=o}}).exports=function(o,i){var a,u,d,g,y,b,T,A;for(u=o.length-(a=3&o.length),d=i,y=3432918353,b=461845907,A=0;A<u;)T=255&o.charCodeAt(A)|(255&o.charCodeAt(++A))<<8|(255&o.charCodeAt(++A))<<16|(255&o.charCodeAt(++A))<<24,++A,d=27492+(65535&(g=5*(65535&(d=(d^=T=(65535&(T=(T=(65535&T)*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(T=0,a){case 3:T^=(255&o.charCodeAt(A+2))<<16;case 2:T^=(255&o.charCodeAt(A+1))<<8;case 1:d^=T=(65535&(T=(T=(65535&(T^=255&o.charCodeAt(A)))*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295}return d^=o.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var Qy={};({get exports(){return Qy},set exports(o){Qy=o}}).exports=function(o,i){for(var a,u=o.length,d=i^u,g=0;u>=4;)a=1540483477*(65535&(a=255&o.charCodeAt(g)|(255&o.charCodeAt(++g))<<8|(255&o.charCodeAt(++g))<<16|(255&o.charCodeAt(++g))<<24))+((1540483477*(a>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++g;switch(u){case 3:d^=(255&o.charCodeAt(g+2))<<16;case 2:d^=(255&o.charCodeAt(g+1))<<8;case 1:d=1540483477*(65535&(d^=255&o.charCodeAt(g)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var pw=Jy,L3=Qy;C3.exports=pw,cc.murmur3=pw,cc.murmur2=L3;class km{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,a,u,d){this.ids.push(mw(i)),this.positions.push(a,u,d)}getPositions(i){const a=mw(i);let u=0,d=this.ids.length-1;for(;u<d;){const y=u+d>>1;this.ids[y]>=a?d=y:u=y+1}const g=[];for(;this.ids[u]===a;)g.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return g}static serialize(i,a){const u=new Float64Array(i.ids),d=new Uint32Array(i.positions);return e0(u,d,0,u.length-1),a&&a.push(u.buffer,d.buffer),{ids:u,positions:d}}static deserialize(i){const a=new km;return a.ids=i.ids,a.positions=i.positions,a.indexed=!0,a}}function mw(o){const i=+o;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:cc(String(o))}function e0(o,i,a,u){for(;a<u;){const d=o[a+u>>1];let g=a-1,y=u+1;for(;;){do g++;while(o[g]<d);do y--;while(o[y]>d);if(g>=y)break;Rm(o,g,y),Rm(i,3*g,3*y),Rm(i,3*g+1,3*y+1),Rm(i,3*g+2,3*y+2)}y-a<u-y?(e0(o,i,a,y),a=y+1):(e0(o,i,y+1,u),u=y)}}function Rm(o,i,a){const u=o[i];o[i]=o[a],o[a]=u}Gt(km,"FeaturePositionMap");class va{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,a),this.initialized=!0),!!this.location}}class Om extends va{constructor(i){super(i),this.current=0}set(i,a,u){this.fetchUniformLocation(i,a)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class gw extends va{constructor(i){super(i),this.current=[0,0,0,0]}set(i,a,u){this.fetchUniformLocation(i,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class _w extends va{constructor(i){super(i),this.current=ze.transparent}set(i,a,u){this.fetchUniformLocation(i,a)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const k3=new Float32Array(16),R3=new Float32Array(9),O3=new Float32Array(4);function t0(o){return[Qt(255*o.r,255*o.g),Qt(255*o.b,255*o.a)]}class Of{constructor(i,a,u){this.value=i,this.uniformNames=a.map(d=>`u_${d}`),this.type=u}setUniform(i,a,u,d,g){a.set(i,g,d.constantOr(this.value))}getBinding(i,a){return this.type==="color"?new _w(i):new Om(i)}}class Cu{constructor(i,a){this.uniformNames=a.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,a,u,d,g){const y=g==="u_pattern"||g==="u_dash"?this.pattern:g==="u_pixel_ratio"?this.pixelRatio:null;y&&a.set(i,g,y)}getBinding(i,a){return a==="u_pattern"||a==="u_dash"?new gw(i):new Om(i)}}class xa{constructor(i,a,u,d){this.expression=i,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(i,a,u,d,g,y){const b=this.paintVertexArray.length,T=this.expression.evaluate(new Be(0),a,{},g,d,y);this.paintVertexArray.resize(i),this._setPaintValue(b,i,T)}updatePaintArray(i,a,u,d,g){const y=this.expression.evaluate({zoom:0},u,d,void 0,g);this._setPaintValue(i,a,y)}_setPaintValue(i,a,u){if(this.type==="color"){const d=t0(u);for(let g=i;g<a;g++)this.paintVertexArray.emplace(g,d[0],d[1])}else{for(let d=i;d<a;d++)this.paintVertexArray.emplace(d,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _o{constructor(i,a,u,d,g,y){this.expression=i,this.uniformNames=a.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=d,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=a.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(i,a,u,d,g,y){const b=this.expression.evaluate(new Be(this.zoom),a,{},g,d,y),T=this.expression.evaluate(new Be(this.zoom+1),a,{},g,d,y),A=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(A,i,b,T)}updatePaintArray(i,a,u,d,g){const y=this.expression.evaluate({zoom:this.zoom},u,d,void 0,g),b=this.expression.evaluate({zoom:this.zoom+1},u,d,void 0,g);this._setPaintValue(i,a,y,b)}_setPaintValue(i,a,u,d){if(this.type==="color"){const g=t0(u),y=t0(d);for(let b=i;b<a;b++)this.paintVertexArray.emplace(b,g[0],g[1],y[0],y[1])}else{for(let g=i;g<a;g++)this.paintVertexArray.emplace(g,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,a,u,d,g){const y=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=$t(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);a.set(i,g,b)}getBinding(i,a){return new Om(i)}}class rl{constructor(i,a,u,d,g){this.expression=i,this.layerId=g,this.paintVertexAttributes=(u==="array"?I3:P3).members;for(let y=0;y<a.length;++y);this.paintVertexArray=new d}populatePaintArray(i,a,u){const d=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(d,i,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(i,a,u,d,g,y){this._setPaintValues(i,a,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(i,a,u,d){if(!d||!u)return;const g=d[u];if(!g)return;const{tl:y,br:b,pixelRatio:T}=g;for(let A=i;A<a;A++)this.paintVertexArray.emplace(A,y[0],y[1],b[0],b[1],T)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class sl{constructor(i,a,u=()=>!0){this.binders={},this._buffers=[];const d=[];for(const g in i.paint._values){if(!u(g))continue;const y=i.paint.get(g);if(!(y instanceof pt&&Za(y.property.specification)))continue;const b=z3(g,i.type),T=y.value,A=y.property.specification.type,C=y.property.useIntegerZoom,k=g==="line-dasharray"||g.endsWith("pattern"),O=g==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant";if(T.kind!=="constant"||O)if(T.kind==="source"||O||k){const B=yw(g,A,"source");this.binders[g]=k?new rl(T,b,A,B,i.id):new xa(T,b,A,B),d.push(`/a_${g}`)}else{const B=yw(g,A,"composite");this.binders[g]=new _o(T,b,A,C,a,B),d.push(`/z_${g}`)}else this.binders[g]=k?new Cu(T.value,b):new Of(T.value,b,A),d.push(`/u_${g}`)}this.cacheKey=d.sort().join("")}getMaxValue(i){const a=this.binders[i];return a instanceof xa||a instanceof _o?a.maxValue:0}populatePaintArrays(i,a,u,d,g,y){for(const b in this.binders){const T=this.binders[b];(T instanceof xa||T instanceof _o||T instanceof rl)&&T.populatePaintArray(i,a,u,d,g,y)}}setConstantPatternPositions(i){for(const a in this.binders){const u=this.binders[a];u instanceof Cu&&u.setConstantPatternPositions(i)}}updatePaintArrays(i,a,u,d,g,y){let b=!1;for(const T in i){const A=a.getPositions(T);for(const C of A){const k=u.feature(C.index);for(const O in this.binders){const B=this.binders[O];if((B instanceof xa||B instanceof _o||B instanceof rl)&&B.expression.isStateDependent===!0){const F=d.paint.get(O);B.expression=F.value,B.updatePaintArray(C.start,C.end,k,i[T],g,y),b=!0}}}}return b}defines(){const i=[];for(const a in this.binders){const u=this.binders[a];(u instanceof Of||u instanceof Cu)&&i.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return i}getBinderAttributes(){const i=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof xa||u instanceof _o||u instanceof rl)for(let d=0;d<u.paintVertexAttributes.length;d++)i.push(u.paintVertexAttributes[d].name)}return i}getBinderUniforms(){const i=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Of||u instanceof Cu||u instanceof _o)for(const d of u.uniformNames)i.push(d)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const a=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof Of||d instanceof Cu||d instanceof _o)for(const g of d.uniformNames)a.push({name:g,property:u,binding:d.getBinding(i,g)})}return a}setUniforms(i,a,u,d,g){for(const{name:y,property:b,binding:T}of u)this.binders[b].setUniform(i,T,g,d.get(b),y)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const a=this.binders[i];(a instanceof xa||a instanceof _o||a instanceof rl)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(i){for(const a in this.binders){const u=this.binders[a];(u instanceof xa||u instanceof _o||u instanceof rl)&&u.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const a=this.binders[i];(a instanceof xa||a instanceof _o||a instanceof rl)&&a.destroy()}}}class uc{constructor(i,a,u=()=>!0){this.programConfigurations={};for(const d of i)this.programConfigurations[d.id]=new sl(d,a,u);this.needsUpload=!1,this._featureMap=new km,this._bufferOffset=0}populatePaintArrays(i,a,u,d,g,y,b){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,a,d,g,y,b);a.id!==void 0&&this._featureMap.add(a.id,u,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,a,u,d,g){for(const y of u)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(i,this._featureMap,a,y,d,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const D3={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function z3(o,i){return D3[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}const B3={"line-pattern":{source:or,composite:or},"fill-pattern":{source:or,composite:or},"fill-extrusion-pattern":{source:or,composite:or},"line-dasharray":{source:ns,composite:ns}},F3={color:{source:il,composite:wi},number:{source:hs,composite:il}};function yw(o,i,a){const u=B3[o];return u&&u[a]||F3[i][a]}Gt(Of,"ConstantBinder"),Gt(Cu,"PatternConstantBinder"),Gt(xa,"SourceExpressionBinder"),Gt(rl,"PatternCompositeBinder"),Gt(_o,"CompositeExpressionBinder"),Gt(sl,"ProgramConfiguration",{omit:["_buffers"]}),Gt(uc,"ProgramConfigurationSet");const Dm="-transition";class yo extends fr{constructor(i,a){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&i.type!=="sky"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),a.layout&&(this._unevaluatedLayout=new Ye(a.layout)),a.paint)){this._transitionablePaint=new At(a.paint);for(const u in i.paint)this.setPaintProperty(u,i.paint[u],{validate:!1});for(const u in i.layout)this.setLayoutProperty(u,i.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $e(a.paint)}}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,a,u={}){a!=null&&this._validate(ym,`layers.${this.id}.layout.${i}`,i,a,u)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,a):this.visibility=a)}getPaintProperty(i){return yt(i,Dm)?this._transitionablePaint.getTransition(i.slice(0,-Dm.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,a,u={}){if(a!=null&&this._validate(Yy,`layers.${this.id}.paint.${i}`,i,a,u))return!1;if(yt(i,Dm))return this._transitionablePaint.setTransition(i.slice(0,-Dm.length),a||void 0),!1;{const d=this._transitionablePaint._values[i],g=d.value.isDataDriven(),y=d.value;this._transitionablePaint.setValue(i,a),this._handleSpecialPaintPropertyUpdate(i);const b=this._transitionablePaint._values[i].value,T=b.isDataDriven(),A=yt(i,"pattern")||i==="line-dasharray";return T||g||A||this._handleOverridablePaintPropertyUpdate(i,y,b)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,a,u){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,a)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Jt(i,(a,u)=>!(a===void 0||u==="layout"&&!Object.keys(a).length||u==="paint"&&!Object.keys(a).length))}_validate(i,a,u,d,g={}){return(!g||g.validate!==!1)&&vm(this,i.call(_m,{key:a,layerType:this.type,objectKey:u,value:d,styleSpec:Ze,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const a=this.paint.get(i);if(a instanceof pt&&Za(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=vu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const N3=rn([{name:"a_pos",components:2,type:"Int16"}],4),U3=rn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ar{constructor(i=[]){this.segments=i}prepareSegment(i,a,u,d){let g=this.segments[this.segments.length-1];return i>ar.MAX_VERTEX_ARRAY_LENGTH&&ue(`Max vertices per segment is ${ar.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!g||g.vertexLength+i>ar.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d)&&(g={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},d!==void 0&&(g.sortKey=d),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const i of this.segments)for(const a in i.vaos)i.vaos[a].destroy()}static simpleSegment(i,a,u,d){return new ar([{vertexOffset:i,primitiveOffset:a,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}ar.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gt(ar,"SegmentVector");var Tn=8192;class ol{constructor(i,a){i&&(a?this.setSouthWest(i).setNorthEast(a):i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof ni?new ni(i.lng,i.lat):ni.convert(i),this}setSouthWest(i){return this._sw=i instanceof ni?new ni(i.lng,i.lat):ni.convert(i),this}extend(i){const a=this._sw,u=this._ne;let d,g;if(i instanceof ni)d=i,g=i;else{if(!(i instanceof ol))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(ol.convert(i)):this.extend(ni.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&i.hasOwnProperty("lon")?this.extend(ni.convert(i)):this;if(d=i._sw,g=i._ne,!d||!g)return this}return a||u?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new ni(d.lng,d.lat),this._ne=new ni(g.lng,g.lat)),this}getCenter(){return new ni((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ni(this.getWest(),this.getNorth())}getSouthEast(){return new ni(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:u}=ni.convert(i);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(i){return!i||i instanceof ol?i:new ol(i)}}var zm=1e-6,ws=typeof Float32Array<"u"?Float32Array:Array;function vw(){var o=new ws(9);return ws!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function xw(o,i,a){var u=i[0],d=i[1],g=i[2],y=i[3],b=i[4],T=i[5],A=i[6],C=i[7],k=i[8],O=a[0],B=a[1],F=a[2],j=a[3],K=a[4],ce=a[5],ve=a[6],ae=a[7],_e=a[8];return o[0]=O*u+B*y+F*A,o[1]=O*d+B*b+F*C,o[2]=O*g+B*T+F*k,o[3]=j*u+K*y+ce*A,o[4]=j*d+K*b+ce*C,o[5]=j*g+K*T+ce*k,o[6]=ve*u+ae*y+_e*A,o[7]=ve*d+ae*b+_e*C,o[8]=ve*g+ae*T+_e*k,o}function vo(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function n0(o,i){var a=i[0],u=i[1],d=i[2],g=i[3],y=i[4],b=i[5],T=i[6],A=i[7],C=i[8],k=i[9],O=i[10],B=i[11],F=i[12],j=i[13],K=i[14],ce=i[15],ve=a*b-u*y,ae=a*T-d*y,_e=a*A-g*y,Ee=u*T-d*b,xe=u*A-g*b,He=d*A-g*T,je=C*j-k*F,tt=C*K-O*F,vt=C*ce-B*F,Xe=k*K-O*j,it=k*ce-B*j,ot=O*ce-B*K,mt=ve*ot-ae*it+_e*Xe+Ee*vt-xe*tt+He*je;return mt?(o[0]=(b*ot-T*it+A*Xe)*(mt=1/mt),o[1]=(d*it-u*ot-g*Xe)*mt,o[2]=(j*He-K*xe+ce*Ee)*mt,o[3]=(O*xe-k*He-B*Ee)*mt,o[4]=(T*vt-y*ot-A*tt)*mt,o[5]=(a*ot-d*vt+g*tt)*mt,o[6]=(K*_e-F*He-ce*ae)*mt,o[7]=(C*He-O*_e+B*ae)*mt,o[8]=(y*it-b*vt+A*je)*mt,o[9]=(u*vt-a*it-g*je)*mt,o[10]=(F*xe-j*_e+ce*ve)*mt,o[11]=(k*_e-C*xe-B*ve)*mt,o[12]=(b*tt-y*Xe-T*je)*mt,o[13]=(a*Xe-u*tt+d*je)*mt,o[14]=(j*ae-F*Ee-K*ve)*mt,o[15]=(C*Ee-k*ae+O*ve)*mt,o):null}function hc(o,i,a){var u=i[0],d=i[1],g=i[2],y=i[3],b=i[4],T=i[5],A=i[6],C=i[7],k=i[8],O=i[9],B=i[10],F=i[11],j=i[12],K=i[13],ce=i[14],ve=i[15],ae=a[0],_e=a[1],Ee=a[2],xe=a[3];return o[0]=ae*u+_e*b+Ee*k+xe*j,o[1]=ae*d+_e*T+Ee*O+xe*K,o[2]=ae*g+_e*A+Ee*B+xe*ce,o[3]=ae*y+_e*C+Ee*F+xe*ve,o[4]=(ae=a[4])*u+(_e=a[5])*b+(Ee=a[6])*k+(xe=a[7])*j,o[5]=ae*d+_e*T+Ee*O+xe*K,o[6]=ae*g+_e*A+Ee*B+xe*ce,o[7]=ae*y+_e*C+Ee*F+xe*ve,o[8]=(ae=a[8])*u+(_e=a[9])*b+(Ee=a[10])*k+(xe=a[11])*j,o[9]=ae*d+_e*T+Ee*O+xe*K,o[10]=ae*g+_e*A+Ee*B+xe*ce,o[11]=ae*y+_e*C+Ee*F+xe*ve,o[12]=(ae=a[12])*u+(_e=a[13])*b+(Ee=a[14])*k+(xe=a[15])*j,o[13]=ae*d+_e*T+Ee*O+xe*K,o[14]=ae*g+_e*A+Ee*B+xe*ce,o[15]=ae*y+_e*C+Ee*F+xe*ve,o}function Df(o,i,a){var u,d,g,y,b,T,A,C,k,O,B,F,j=a[0],K=a[1],ce=a[2];return i===o?(o[12]=i[0]*j+i[4]*K+i[8]*ce+i[12],o[13]=i[1]*j+i[5]*K+i[9]*ce+i[13],o[14]=i[2]*j+i[6]*K+i[10]*ce+i[14],o[15]=i[3]*j+i[7]*K+i[11]*ce+i[15]):(d=i[1],g=i[2],y=i[3],b=i[4],T=i[5],A=i[6],C=i[7],k=i[8],O=i[9],B=i[10],F=i[11],o[0]=u=i[0],o[1]=d,o[2]=g,o[3]=y,o[4]=b,o[5]=T,o[6]=A,o[7]=C,o[8]=k,o[9]=O,o[10]=B,o[11]=F,o[12]=u*j+b*K+k*ce+i[12],o[13]=d*j+T*K+O*ce+i[13],o[14]=g*j+A*K+B*ce+i[14],o[15]=y*j+C*K+F*ce+i[15]),o}function fc(o,i,a){var u=a[0],d=a[1],g=a[2];return o[0]=i[0]*u,o[1]=i[1]*u,o[2]=i[2]*u,o[3]=i[3]*u,o[4]=i[4]*d,o[5]=i[5]*d,o[6]=i[6]*d,o[7]=i[7]*d,o[8]=i[8]*g,o[9]=i[9]*g,o[10]=i[10]*g,o[11]=i[11]*g,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o}function i0(o,i,a){var u=Math.sin(a),d=Math.cos(a),g=i[4],y=i[5],b=i[6],T=i[7],A=i[8],C=i[9],k=i[10],O=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=g*d+A*u,o[5]=y*d+C*u,o[6]=b*d+k*u,o[7]=T*d+O*u,o[8]=A*d-g*u,o[9]=C*d-y*u,o[10]=k*d-b*u,o[11]=O*d-T*u,o}function Bm(o,i,a){var u=Math.sin(a),d=Math.cos(a),g=i[0],y=i[1],b=i[2],T=i[3],A=i[8],C=i[9],k=i[10],O=i[11];return i!==o&&(o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=g*d-A*u,o[1]=y*d-C*u,o[2]=b*d-k*u,o[3]=T*d-O*u,o[8]=g*u+A*d,o[9]=y*u+C*d,o[10]=b*u+k*d,o[11]=T*u+O*d,o}function bw(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ww(o,i,a){var u,d,g,y=a[0],b=a[1],T=a[2],A=Math.hypot(y,b,T);return A<zm?null:(y*=A=1/A,b*=A,T*=A,u=Math.sin(i),d=Math.cos(i),o[0]=y*y*(g=1-d)+d,o[1]=b*y*g+T*u,o[2]=T*y*g-b*u,o[3]=0,o[4]=y*b*g-T*u,o[5]=b*b*g+d,o[6]=T*b*g+y*u,o[7]=0,o[8]=y*T*g+b*u,o[9]=b*T*g-y*u,o[10]=T*T*g+d,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var V3=hc;function r0(){var o=new ws(3);return ws!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Ew(o){var i=new ws(3);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i}function zf(o){return Math.hypot(o[0],o[1],o[2])}function Lu(o,i,a){var u=new ws(3);return u[0]=o,u[1]=i,u[2]=a,u}function ba(o,i,a){return o[0]=i[0]+a[0],o[1]=i[1]+a[1],o[2]=i[2]+a[2],o}function s0(o,i,a){return o[0]=i[0]-a[0],o[1]=i[1]-a[1],o[2]=i[2]-a[2],o}function Tw(o,i,a){return o[0]=i[0]*a[0],o[1]=i[1]*a[1],o[2]=i[2]*a[2],o}function Bf(o,i,a){return o[0]=Math.min(i[0],a[0]),o[1]=Math.min(i[1],a[1]),o[2]=Math.min(i[2],a[2]),o}function Ff(o,i,a){return o[0]=Math.max(i[0],a[0]),o[1]=Math.max(i[1],a[1]),o[2]=Math.max(i[2],a[2]),o}function Bs(o,i,a){return o[0]=i[0]*a,o[1]=i[1]*a,o[2]=i[2]*a,o}function Nf(o,i,a,u){return o[0]=i[0]+a[0]*u,o[1]=i[1]+a[1]*u,o[2]=i[2]+a[2]*u,o}function is(o,i){var a=i[0],u=i[1],d=i[2],g=a*a+u*u+d*d;return g>0&&(g=1/Math.sqrt(g)),o[0]=i[0]*g,o[1]=i[1]*g,o[2]=i[2]*g,o}function eo(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]}function o0(o,i,a){var u=i[0],d=i[1],g=i[2],y=a[0],b=a[1],T=a[2];return o[0]=d*T-g*b,o[1]=g*y-u*T,o[2]=u*b-d*y,o}function er(o,i,a){var u=i[0],d=i[1],g=i[2],y=a[3]*u+a[7]*d+a[11]*g+a[15];return o[0]=(a[0]*u+a[4]*d+a[8]*g+a[12])/(y=y||1),o[1]=(a[1]*u+a[5]*d+a[9]*g+a[13])/y,o[2]=(a[2]*u+a[6]*d+a[10]*g+a[14])/y,o}function Aw(o,i,a){var u=a[0],d=a[1],g=a[2],y=i[0],b=i[1],T=i[2],A=d*T-g*b,C=g*y-u*T,k=u*b-d*y,O=d*k-g*C,B=g*A-u*k,F=u*C-d*A,j=2*a[3];return C*=j,k*=j,B*=2,F*=2,o[0]=y+(A*=j)+(O*=2),o[1]=b+C+B,o[2]=T+k+F,o}var Uf,xo=s0,j3=Tw,G3=zf;function Sw(o,i,a){return o[0]=i[0]*a,o[1]=i[1]*a,o[2]=i[2]*a,o[3]=i[3]*a,o}function Mw(o,i){var a=i[0],u=i[1],d=i[2],g=i[3],y=a*a+u*u+d*d+g*g;return y>0&&(y=1/Math.sqrt(y)),o[0]=a*y,o[1]=u*y,o[2]=d*y,o[3]=g*y,o}function dc(o,i,a){var u=i[0],d=i[1],g=i[2],y=i[3];return o[0]=a[0]*u+a[4]*d+a[8]*g+a[12]*y,o[1]=a[1]*u+a[5]*d+a[9]*g+a[13]*y,o[2]=a[2]*u+a[6]*d+a[10]*g+a[14]*y,o[3]=a[3]*u+a[7]*d+a[11]*g+a[15]*y,o}function Pw(){var o=new ws(4);return ws!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Iw(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Cw(o,i,a){a*=.5;var u=i[0],d=i[1],g=i[2],y=i[3],b=Math.sin(a),T=Math.cos(a);return o[0]=u*T+y*b,o[1]=d*T+g*b,o[2]=g*T-d*b,o[3]=y*T-u*b,o}function Lw(o,i,a){a*=.5;var u=i[0],d=i[1],g=i[2],y=i[3],b=Math.sin(a),T=Math.cos(a);return o[0]=u*T-g*b,o[1]=d*T+y*b,o[2]=g*T+u*b,o[3]=y*T-d*b,o}r0(),Uf=new ws(4),ws!=Float32Array&&(Uf[0]=0,Uf[1]=0,Uf[2]=0,Uf[3]=0);var $3=Mw;r0(),Lu(1,0,0),Lu(0,1,0),Pw(),Pw(),vw();const H3=rn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:kw}=H3,Rw=rn([{name:"a_pos_3",components:3,type:"Int16"}]);var Vf=rn([{name:"a_pos",type:"Int16",components:2}]);class a0{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,u){const d=eo(a,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1]+(i[2]-this.pos[2])*a[2])/d;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,u[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(i,a,u){if(function(B,F){var j=B[0],K=B[1],ce=B[2],ve=F[0],ae=F[1],_e=F[2];return Math.abs(j-ve)<=zm*Math.max(1,Math.abs(j),Math.abs(ve))&&Math.abs(K-ae)<=zm*Math.max(1,Math.abs(K),Math.abs(ae))&&Math.abs(ce-_e)<=zm*Math.max(1,Math.abs(ce),Math.abs(_e))}(this.pos,i)||a===0)return u[0]=u[1]=u[2]=0,!1;const[d,g,y]=this.dir,b=this.pos[0]-i[0],T=this.pos[1]-i[1],A=this.pos[2]-i[2],C=d*d+g*g+y*y,k=2*(b*d+T*g+A*y),O=k*k-4*C*(b*b+T*T+A*A-a*a);if(O<0){const B=Math.max(-k/2,0),F=b+d*B,j=T+g*B,K=A+y*B,ce=Math.hypot(F,j,K);return u[0]=F*a/ce,u[1]=j*a/ce,u[2]=K*a/ce,!1}{const B=(-k-Math.sqrt(O))/(2*C);if(B<0){const F=Math.hypot(b,T,A);return u[0]=b*a/F,u[1]=T*a/F,u[2]=A*a/F,!1}return u[0]=b+d*B,u[1]=T+g*B,u[2]=A+y*B,!0}}}class l0{constructor(i,a,u,d,g){this.TL=i,this.TR=a,this.BR=u,this.BL=d,this.horizon=g}static fromInvProjectionMatrix(i,a,u){const d=[-1,1,1],g=[1,1,1],y=[1,-1,1],b=[-1,-1,1],T=er(d,d,i),A=er(g,g,i),C=er(y,y,i),k=er(b,b,i);return new l0(T,A,C,k,a/u)}}class c0{constructor(i,a){this.points=i,this.planes=a}static fromInvProjectionMatrix(i,a,u,d){const g=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const A=dc([],T,i),C=1/A[3]/a*g;return function(k,O,B){return k[0]=O[0]*B[0],k[1]=O[1]*B[1],k[2]=O[2]*B[2],k[3]=O[3]*B[3],k}(A,A,[C,C,d?1/A[3]:C,C])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const A=is([],o0([],xo([],y[T[0]],y[T[1]]),xo([],y[T[2]],y[T[1]]))),C=-eo(A,y[T[1]]);return A.concat(C)});return new c0(y,b)}}class rs{static fromPoints(i){const a=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const d of i)Bf(a,a,d),Ff(u,u,d);return new rs(a,u)}static applyTransform(i,a){const u=i.getCorners();for(let d=0;d<u.length;++d)er(u[d],u[d],a);return rs.fromPoints(u)}constructor(i,a){this.min=i,this.max=a,this.center=Bs([],ba([],this.min,this.max),.5)}quadrant(i){const a=[i%2==0,i<2],u=Ew(this.min),d=Ew(this.max);for(let g=0;g<a.length;g++)u[g]=a[g]?this.min[g]:this.center[g],d[g]=a[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new rs(u,d)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,a=this.max;return[[i[0],i[1],i[2]],[a[0],i[1],i[2]],[a[0],a[1],i[2]],[i[0],a[1],i[2]],[i[0],i[1],a[2]],[a[0],i[1],a[2]],[a[0],a[1],a[2]],[i[0],a[1],a[2]]]}intersects(i){const a=this.getCorners();let u=!0;for(let d=0;d<i.planes.length;d++){const g=i.planes[d];let y=0;for(let b=0;b<a.length;b++)y+=eo(g,a[b])+g[3]>=0;if(y===0)return 0;y!==a.length&&(u=!1)}if(u)return 2;for(let d=0;d<3;d++){let g=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let b=0;b<i.points.length;b++){const T=i.points[b][d]-this.min[d];g=Math.min(g,T),y=Math.max(y,T)}if(y<0||g>this.max[d]-this.min[d])return 0}return 1}}const Go=Tn/Math.PI/2,pc=64,jf=[pc,32,16],to=-Go,no=Go,W3=[new rs([to,to,to],[no,no,no]),new rs([to,to,to],[0,0,no]),new rs([0,to,to],[no,0,no]),new rs([to,0,to],[0,no,no]),new rs([0,0,to],[no,no,no])];function Fm(o){return o*Go/Hf}function Ow(o,i,a,u=!0){const d=Bs([],o._camera.position,o.worldSize),g=[i,a,1,1];dc(g,g,o.pixelMatrixInverse),Sw(g,g,1/g[3]);const y=is([],xo([],g,d)),b=o.globeMatrix,T=[b[12],b[13],b[14]],A=xo([],T,d),C=zf(A),k=is([],A),O=o.worldSize/(2*Math.PI),B=eo(k,y),F=Math.asin(O/C);if(F<Math.acos(B)){if(!u)return null;const vt=[],Xe=[];Bs(vt,y,C/B),is(Xe,xo(Xe,vt,A)),is(y,ba(y,A,Bs(y,Xe,Math.tan(F)*C)))}const j=[];new a0(d,y).closestPointOnSphere(T,O,j);const K=is([],Mt(b,0)),ce=is([],Mt(b,1)),ve=is([],Mt(b,2)),ae=eo(K,j),_e=eo(ce,j),Ee=eo(ve,j),xe=It(Math.asin(-_e/O));let He=It(Math.atan2(ae,Ee));He=o.center.lng+function(vt,Xe){const it=(Xe-vt+180)%360-180;return it<-180?it+360:it}(o.center.lng,He);const je=Ho(He),tt=$t(Wo(xe),0,1);return new Du(je,tt)}class q3{constructor(i,a,u){this.a=xo([],i,u),this.b=xo([],a,u),this.center=u;const d=is([],this.a),g=is([],this.b);this.angle=Math.acos(eo(d,g))}}function u0(o,i){if(o.angle===0)return null;let a;return a=o.a[i]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[i]/o.a[i]/Math.sin(o.angle)-1/Math.tan(o.angle)),a<0||a>1?null:function(u,d,g,y){const b=Math.sin(g);return u*(Math.sin((1-y)*g)/b)+d*(Math.sin(y*g)/b)}(o.a[i],o.b[i],o.angle,$t(a,0,1))+o.center[i]}function $o(o){if(o.z<=1)return W3[o.z+2*o.y+o.x];const i=h0(Nm(o));return rs.fromPoints(i)}function mc(o,i,a){return Bs(o,o,1-a),Nf(o,o,i,a)}function Dw(o,i){const a=Ou(i.zoom);if(a===0)return $o(o);const u=Nm(o),d=h0(u),g=Ho(u.getWest())*i.worldSize,y=Ho(u.getEast())*i.worldSize,b=Wo(u.getNorth())*i.worldSize,T=Wo(u.getSouth())*i.worldSize,A=[g,b,0],C=[y,b,0],k=[g,T,0],O=[y,T,0],B=n0([],i.globeMatrix);return er(A,A,B),er(C,C,B),er(k,k,B),er(O,O,B),d[0]=mc(d[0],k,a),d[1]=mc(d[1],O,a),d[2]=mc(d[2],C,a),d[3]=mc(d[3],A,a),rs.fromPoints(d)}function zw(o,i,a){for(const u of o)er(u,u,i),Bs(u,u,a)}function Z3(o,i,a){const u=i/o.worldSize,d=o.globeMatrix;if(a.z<=1){const je=$o(a).getCorners();return zw(je,d,u),rs.fromPoints(je)}const g=Nm(a),y=h0(g);zw(y,d,u);const b=Number.MAX_VALUE,T=[-b,-b,-b],A=[b,b,b];if(g.contains(o.center)){for(const vt of y)Bf(A,A,vt),Ff(T,T,vt);T[2]=0;const je=o.point,tt=[je.x*u,je.y*u,0];return Bf(A,A,tt),Ff(T,T,tt),new rs(A,T)}const C=[d[12]*u,d[13]*u,d[14]*u],k=g.getCenter(),O=$t(o.center.lat,-Ur,Ur),B=$t(k.lat,-Ur,Ur),F=Ho(o.center.lng),j=Wo(O);let K=F-Ho(k.lng);const ce=j-Wo(B);K>.5?K-=1:K<-.5&&(K+=1);let ve=0;Math.abs(K)>Math.abs(ce)?ve=K>=0?1:3:(ve=ce>=0?0:2,Nf(C,C,[d[4]*u,d[5]*u,d[6]*u],-Math.sin(ke(ce>=0?g.getSouth():g.getNorth()))*Go));const ae=y[ve],_e=y[(ve+1)%4],Ee=new q3(ae,_e,C),xe=[u0(Ee,0)||ae[0],u0(Ee,1)||ae[1],u0(Ee,2)||ae[2]],He=Ou(o.zoom);if(He>0){const je=function({x:vt,y:Xe,z:it},ot,mt,bt,Ke){const Ct=1/(1<<it);let _n=vt*Ct,Bt=_n+Ct,Xt=Xe*Ct,kt=Xt+Ct,bn=0;const jn=(_n+Bt)/2-bt;return jn>.5?bn=-1:jn<-.5&&(bn=1),_n=((_n+bn)*ot-(bt*=ot))*mt+bt,Bt=((Bt+bn)*ot-bt)*mt+bt,Xt=(Xt*ot-(Ke*=ot))*mt+Ke,kt=(kt*ot-Ke)*mt+Ke,[[_n,kt,0],[Bt,kt,0],[Bt,Xt,0],[_n,Xt,0]]}(a,i,o._pixelsPerMercatorPixel,F,j);for(let vt=0;vt<y.length;vt++)mc(y[vt],je[vt],He);const tt=ba([],je[ve],je[(ve+1)%4]);Bs(tt,tt,.5),mc(xe,tt,He)}for(const je of y)Bf(A,A,je),Ff(T,T,je);return A[2]=Math.min(ae[2],_e[2]),Bf(A,A,xe),Ff(T,T,xe),new rs(A,T)}function Nm({x:o,y:i,z:a}){const u=1/(1<<a),d=new ni(Fs(o*u),Nr((i+1)*u)),g=new ni(Fs((o+1)*u),Nr(i*u));return new ol(d,g)}function h0(o){const i=ke(o.getNorth()),a=ke(o.getSouth()),u=Math.cos(i),d=Math.cos(a),g=Math.sin(i),y=Math.sin(a),b=o.getWest(),T=o.getEast();return[ku(d,y,b),ku(d,y,T),ku(u,g,T),ku(u,g,b)]}function ku(o,i,a,u=Go){return a=ke(a),[o*Math.sin(a)*u,-i*u,o*Math.cos(a)*u]}function Ru(o,i,a){return ku(Math.cos(ke(o)),Math.sin(ke(o)),i,a)}function Gf(o,i,a,u){const d=1<<a.z,g=(o/Tn+a.x)/d;return Ru(Nr((i/Tn+a.y)/d),Fs(g),u)}function Um({min:o,max:i}){return 16383/Math.max(i[0]-o[0],i[1]-o[1],i[2]-o[2])}const Bw=new Float64Array(16);function $f(o){const i=Um(o),a=bw(Bw,[i,i,i]);return Df(a,a,((u=[])[0]=-(d=o.min)[0],u[1]=-d[1],u[2]=-d[2],u));var u,d}function f0(o){const i=(u=o.min,(a=Bw)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=u[0],a[13]=u[1],a[14]=u[2],a[15]=1,a);var a,u;const d=1/Um(o);return fc(i,i,[d,d,d])}function Fw(o,i,a,u,d){const g=function(T){const A=Tn/(2*Math.PI);return T/(2*Math.PI)/A}(a),y=[o,i,-a/(2*Math.PI)],b=vo(new Float64Array(16));return Df(b,b,y),fc(b,b,[g,g,g]),i0(b,b,ke(-d)),Bm(b,b,ke(-u)),b}function Ou(o){return Mn(5,6,o)}function Nw(o,i){const a=Ru(i.lat,i.lng),u=function(F){const j=Ru(F._center.lat,F._center.lng);let K=o0([],Lu(0,1,0),j);const ce=ww([],-F.angle,j);K=er(K,K,ce),ww(ce,-F._pitch,K);const ve=is([],j);return Bs(ve,ve,Fm(F.cameraToCenterDistance/F.pixelsPerMeter)),er(ve,ve,ce),ba([],j,ve)}(o);return y=(d=s0([],u,a))[0],b=d[1],T=d[2],A=(g=a)[0],C=g[1],k=g[2],B=(O=Math.sqrt(y*y+b*b+T*T)*Math.sqrt(A*A+C*C+k*k))&&eo(d,g)/O,Math.acos(Math.min(Math.max(B,-1),1));var d,g,y,b,T,A,C,k,O,B}function d0(o,i){return Nw(o,i)>Math.PI/2*1.01}const Uw=ke(85),X3=Math.cos(Uw),Y3=Math.sin(Uw),Hf=63710088e-1,Vw=2*Math.PI*Hf;class ni{constructor(i,a){if(isNaN(i)||isNaN(a))throw new Error(`Invalid LngLat object: (${i}, ${a})`);if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ni(yn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const a=Math.PI/180,u=this.lat*a,d=i.lat*a,g=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((i.lng-this.lng)*a);return Hf*Math.acos(Math.min(g,1))}toBounds(i=0){const a=360*i/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new ol(new ni(this.lng-u,this.lat-a),new ni(this.lng+u,this.lat+a))}toEcef(i){const a=Fm(i);return Ru(this.lat,this.lng,Go+a)}static convert(i){if(i instanceof ni)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new ni(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new ni(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function p0(o){return Vw*Math.cos(o*Math.PI/180)}function Ho(o){return(180+o)/360}function Wo(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function bo(o,i){return o/p0(i)}function Fs(o){return 360*o-180}function Nr(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function jw(o,i){return o*p0(Nr(i))}const Ur=85.051129;function Gw(o){return 1/Math.cos(o*Math.PI/180)}class Du{constructor(i,a,u=0){this.x=+i,this.y=+a,this.z=+u}static fromLngLat(i,a=0){const u=ni.convert(i);return new Du(Ho(u.lng),Wo(u.lat),bo(a,u.lat))}toLngLat(){return new ni(Fs(this.x),Nr(this.y))}toAltitude(){return jw(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Vw*Gw(Nr(this.y))}}function m0(o,i,a,u,d,g,y,b,T){const A=(i+u)/2,C=(a+d)/2,k=new ge(A,C);b(k),function(O,B,F,j,K,ce){const ve=F-K,ae=j-ce;return Math.abs((j-B)*ve-(F-O)*ae)/Math.hypot(ve,ae)}(k.x,k.y,g.x,g.y,y.x,y.y)>=T?(m0(o,i,a,A,C,g,k,b,T),m0(o,A,C,u,d,k,y,b,T)):o.push(y)}function $w(o,i,a){let u=o[0],d=u.x,g=u.y;i(u);const y=[u];for(let b=1;b<o.length;b++){const T=o[b],{x:A,y:C}=T;i(T),m0(y,d,g,A,C,u,T,i,a),d=A,g=C,u=T}return y}function g0(o,i,a,u){if(u(i,a)){const d=i.add(a)._mult(.5);g0(o,i,d,u),g0(o,d,a,u)}else o.push(a)}function K3(o,i){let a=o[0];const u=[a];for(let d=1;d<o.length;d++){const g=o[d];g0(u,a,g,i),a=g}return u}const _0=Math.pow(2,14)-1,Hw=-_0-1;function J3(o,i){const a=Math.round(o.x*i),u=Math.round(o.y*i);return o.x=$t(a,Hw,_0),o.y=$t(u,Hw,_0),(a<o.x||a>o.x+1||u<o.y||u>o.y+1)&&ue("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function wa(o,i,a){const u=o.loadGeometry(),d=o.extent,g=Tn/d;if(i&&a&&a.projection.isReprojectedInTileSpace){const y=1<<i.z,{scale:b,x:T,y:A,projection:C}=a,k=O=>{const B=Fs((i.x+O.x/d)/y),F=Nr((i.y+O.y/d)/y),j=C.project(B,F);O.x=(j.x*b-T)*d,O.y=(j.y*b-A)*d};for(let O=0;O<u.length;O++)if(o.type!==1)u[O]=$w(u[O],k,1);else{const B=[];for(const F of u[O])F.x<0||F.x>=d||F.y<0||F.y>=d||(k(F),B.push(F));u[O]=B}}for(const y of u)for(const b of y)J3(b,g);return u}function gc(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?wa(o):[]}}function Vm(o,i,a,u,d){o.emplaceBack(2*i+(u+1)/2,2*a+(d+1)/2)}function jm(o,i,a){o.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}class y0{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new hn,this.indexArray=new Fr,this.segments=new ar,this.programConfigurations=new uc(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(i,a,u,d){const g=this.layers[0],y=[];let b=null;g.type==="circle"&&(b=g.layout.get("circle-sort-key"));for(const{feature:A,id:C,index:k,sourceLayerIndex:O}of i){const B=this.layers[0]._featureFilter.needGeometry,F=gc(A,B);if(!this.layers[0]._featureFilter.filter(new Be(this.zoom),F,u))continue;const j=b?b.evaluate(F,{},u):void 0,K={id:C,properties:A.properties,type:A.type,sourceLayerIndex:O,index:k,geometry:B?F.geometry:wa(A,u,d),patterns:{},sortKey:j};y.push(K)}b&&y.sort((A,C)=>A.sortKey-C.sortKey);let T=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new zs,T=d.projection);for(const A of y){const{geometry:C,index:k,sourceLayerIndex:O}=A,B=i[k].feature;this.addFeature(A,C,k,a.availableImages,u,T),a.featureIndex.insert(B,C,k,O,this.index)}}update(i,a,u,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,N3.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,U3.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,a,u,d,g,y){for(const b of a)for(const T of b){const A=T.x,C=T.y;if(A<0||A>=Tn||C<0||C>=Tn)continue;if(y){const B=y.projectTilePoint(A,C,g),F=y.upVector(g,A,C),j=this.globeExtVertexArray;jm(j,B,F),jm(j,B,F),jm(j,B,F),jm(j,B,F)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),O=k.vertexLength;Vm(this.layoutVertexArray,A,C,-1,-1),Vm(this.layoutVertexArray,A,C,1,-1),Vm(this.layoutVertexArray,A,C,1,1),Vm(this.layoutVertexArray,A,C,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,{},d,g)}}function Ww(o,i){for(let a=0;a<o.length;a++)if(_c(i,o[a]))return!0;for(let a=0;a<i.length;a++)if(_c(o,i[a]))return!0;return!!v0(o,i)}function Q3(o,i,a){return!!_c(o,i)||!!x0(i,o,a)}function qw(o,i){if(o.length===1)return Xw(i,o[0]);for(let a=0;a<i.length;a++){const u=i[a];for(let d=0;d<u.length;d++)if(_c(o,u[d]))return!0}for(let a=0;a<o.length;a++)if(Xw(i,o[a]))return!0;for(let a=0;a<i.length;a++)if(v0(o,i[a]))return!0;return!1}function ek(o,i,a){if(o.length>1){if(v0(o,i))return!0;for(let u=0;u<i.length;u++)if(x0(i[u],o,a))return!0}for(let u=0;u<o.length;u++)if(x0(o[u],i,a))return!0;return!1}function v0(o,i){if(o.length===0||i.length===0)return!1;for(let a=0;a<o.length-1;a++){const u=o[a],d=o[a+1];for(let g=0;g<i.length-1;g++)if(tk(u,d,i[g],i[g+1]))return!0}return!1}function tk(o,i,a,u){return Me(o,a,u)!==Me(i,a,u)&&Me(o,i,a)!==Me(o,i,u)}function x0(o,i,a){const u=a*a;if(i.length===1)return o.distSqr(i[0])<u;for(let d=1;d<i.length;d++)if(Zw(o,i[d-1],i[d])<u)return!0;return!1}function Zw(o,i,a){const u=i.distSqr(a);if(u===0)return o.distSqr(i);const d=((o.x-i.x)*(a.x-i.x)+(o.y-i.y)*(a.y-i.y))/u;return o.distSqr(d<0?i:d>1?a:a.sub(i)._mult(d)._add(i))}function Xw(o,i){let a,u,d,g=!1;for(let y=0;y<o.length;y++){a=o[y];for(let b=0,T=a.length-1;b<a.length;T=b++)u=a[b],d=a[T],u.y>i.y!=d.y>i.y&&i.x<(d.x-u.x)*(i.y-u.y)/(d.y-u.y)+u.x&&(g=!g)}return g}function _c(o,i){let a=!1;for(let u=0,d=o.length-1;u<o.length;d=u++){const g=o[u],y=o[d];g.y>i.y!=y.y>i.y&&i.x<(y.x-g.x)*(i.y-g.y)/(y.y-g.y)+g.x&&(a=!a)}return a}function Yw(o,i,a,u,d){for(const y of o)if(i<=y.x&&a<=y.y&&u>=y.x&&d>=y.y)return!0;const g=[new ge(i,a),new ge(i,d),new ge(u,d),new ge(u,a)];if(o.length>2){for(const y of g)if(_c(o,y))return!0}for(let y=0;y<o.length-1;y++)if(nk(o[y],o[y+1],g))return!0;return!1}function nk(o,i,a){const u=a[0],d=a[2];if(o.x<u.x&&i.x<u.x||o.x>d.x&&i.x>d.x||o.y<u.y&&i.y<u.y||o.y>d.y&&i.y>d.y)return!1;const g=Me(o,i,a[0]);return g!==Me(o,i,a[1])||g!==Me(o,i,a[2])||g!==Me(o,i,a[3])}function zu(o,i,a){const u=i.paint.get(o).value;return u.kind==="constant"?u.value:a.programConfigurations.get(i.id).getMaxValue(o)}function Gm(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Kw(o,i,a,u,d){if(!i[0]&&!i[1])return o;const g=ge.convert(i)._mult(d);a==="viewport"&&g._rotate(-u);const y=[];for(let b=0;b<o.length;b++)y.push(o[b].sub(g));return y}function Jw(o,i,a,u){const d=ge.convert(o)._mult(u);return i==="viewport"&&d._rotate(-a),d}Gt(y0,"CircleBucket",{omit:["layers"]});const ik=new _t({"circle-sort-key":new qe(Ze.layout_circle["circle-sort-key"])});var rk={paint:new _t({"circle-radius":new qe(Ze.paint_circle["circle-radius"]),"circle-color":new qe(Ze.paint_circle["circle-color"]),"circle-blur":new qe(Ze.paint_circle["circle-blur"]),"circle-opacity":new qe(Ze.paint_circle["circle-opacity"]),"circle-translate":new De(Ze.paint_circle["circle-translate"]),"circle-translate-anchor":new De(Ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new De(Ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new De(Ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qe(Ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qe(Ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qe(Ze.paint_circle["circle-stroke-opacity"])}),layout:ik};function Qw(o,i,a,u,d,g,y,b,T){if(g&&o.queryGeometry.isAboveHorizon)return!1;g&&(T*=o.pixelToTileUnitsFactor);const A=o.tileID.canonical,C=a.projection.upVectorScale(A,a.center.lat,a.worldSize).metersToTile;for(const k of i)for(const O of k){const B=O.add(b),F=d&&a.elevation?a.elevation.exaggeration()*d.getElevationAt(B.x,B.y,!0):0,j=a.projection.projectTilePoint(B.x,B.y,A);if(F>0){const ae=a.projection.upVector(A,B.x,B.y);j.x+=ae[0]*C*F,j.y+=ae[1]*C*F,j.z+=ae[2]*C*F}const K=g?B:sk(j.x,j.y,j.z,u),ce=g?o.tilespaceRays.map(ae=>ak(ae,F)):o.queryGeometry.screenGeometry,ve=dc([],[j.x,j.y,j.z,1],u);if(!y&&g?T*=ve[3]/a.cameraToCenterDistance:y&&!g&&(T*=a.cameraToCenterDistance/ve[3]),g){const ae=Nr((O.y/Tn+A.y)/(1<<A.z));T/=a.projection.pixelsPerMeter(ae,1)/bo(1,ae)}if(Q3(ce,K,T))return!0}return!1}function sk(o,i,a,u){const d=dc([],[o,i,a,1],u);return new ge(d[0]/d[3],d[1]/d[3])}const eE=Lu(0,0,0),ok=Lu(0,0,1);function ak(o,i){const a=r0();return eE[2]=i,o.intersectsPlane(eE,ok,a),new ge(a[0],a[1])}class tE extends y0{}function nE(o,{width:i,height:a},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==i*a*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(i*a*u);return o.width=i,o.height=a,o.data=d,o}function iE(o,i,a){const{width:u,height:d}=i;u===o.width&&d===o.height||(b0(o,i,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,u),height:Math.min(o.height,d)},a),o.width=u,o.height=d,o.data=i.data)}function b0(o,i,a,u,d,g){if(d.width===0||d.height===0)return i;if(d.width>o.width||d.height>o.height||a.x>o.width-d.width||a.y>o.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>i.width||d.height>i.height||u.x>i.width-d.width||u.y>i.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=o.data,b=i.data;for(let T=0;T<d.height;T++){const A=((a.y+T)*o.width+a.x)*g,C=((u.y+T)*i.width+u.x)*g;for(let k=0;k<d.width*g;k++)b[C+k]=y[A+k]}return i}Gt(tE,"HeatmapBucket",{omit:["layers"]});class Ea{constructor(i,a){nE(this,i,1,a)}resize(i){iE(this,new Ea(i),1)}clone(){return new Ea({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,u,d,g){b0(i,a,u,d,g,1)}}class Es{constructor(i,a){nE(this,i,4,a)}resize(i){iE(this,new Es(i),4)}replace(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Es({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,u,d,g){b0(i,a,u,d,g,4)}}Gt(Ea,"AlphaImage"),Gt(Es,"RGBAImage");var lk={paint:new _t({"heatmap-radius":new qe(Ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qe(Ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new De(Ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ut(Ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new De(Ze.paint_heatmap["heatmap-opacity"])})};function w0(o){const i={},a=o.resolution||256,u=o.clips?o.clips.length:1,d=o.image||new Es({width:a,height:u}),g=(y,b,T)=>{i[o.evaluationKey]=T;const A=o.expression.evaluate(i);d.data[y+b+0]=Math.floor(255*A.r/A.a),d.data[y+b+1]=Math.floor(255*A.g/A.a),d.data[y+b+2]=Math.floor(255*A.b/A.a),d.data[y+b+3]=Math.floor(255*A.a)};if(o.clips)for(let y=0,b=0;y<u;++y,b+=4*a)for(let T=0,A=0;T<a;T++,A+=4){const C=T/(a-1),{start:k,end:O}=o.clips[y];g(b,A,k*(1-C)+O*C)}else for(let y=0,b=0;y<a;y++,b+=4)g(0,b,y/(a-1));return d}var ck={paint:new _t({"hillshade-illumination-direction":new De(Ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new De(Ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new De(Ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new De(Ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new De(Ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new De(Ze.paint_hillshade["hillshade-accent-color"])})};const uk=rn([{name:"a_pos",components:2,type:"Int16"}],4),{members:hk}=uk;var Bu={};function $m(o,i,a){a=a||2;var u,d,g,y,b,T,A,C=i&&i.length,k=C?i[0]*a:o.length,O=rE(o,0,k,a,!0),B=[];if(!O||O.next===O.prev)return B;if(C&&(O=function(j,K,ce,ve){var ae,_e,Ee,xe=[];for(ae=0,_e=K.length;ae<_e;ae++)(Ee=rE(j,K[ae]*ve,ae<_e-1?K[ae+1]*ve:j.length,ve,!1))===Ee.next&&(Ee.steiner=!0),xe.push(vk(Ee));for(xe.sort(gk),ae=0;ae<xe.length;ae++)ce=_k(xe[ae],ce);return ce}(o,i,O,a)),o.length>80*a){u=g=o[0],d=y=o[1];for(var F=a;F<k;F+=a)(b=o[F])<u&&(u=b),(T=o[F+1])<d&&(d=T),b>g&&(g=b),T>y&&(y=T);A=(A=Math.max(g-u,y-d))!==0?32767/A:0}return Wf(O,B,a,u,d,A,0),B}function rE(o,i,a,u,d){var g,y;if(d===A0(o,i,a,u)>0)for(g=i;g<a;g+=u)y=aE(g,o[g],o[g+1],y);else for(g=a-u;g>=i;g-=u)y=aE(g,o[g],o[g+1],y);return y&&Hm(y,y.next)&&(Zf(y),y=y.next),y}function yc(o,i){if(!o)return o;i||(i=o);var a,u=o;do if(a=!1,u.steiner||!Hm(u,u.next)&&lr(u.prev,u,u.next)!==0)u=u.next;else{if(Zf(u),(u=i=u.prev)===u.next)break;a=!0}while(a||u!==i);return i}function Wf(o,i,a,u,d,g,y){if(o){!y&&g&&function(C,k,O,B){var F=C;do F.z===0&&(F.z=E0(F.x,F.y,k,O,B)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==C);F.prevZ.nextZ=null,F.prevZ=null,function(j){var K,ce,ve,ae,_e,Ee,xe,He,je=1;do{for(ce=j,j=null,_e=null,Ee=0;ce;){for(Ee++,ve=ce,xe=0,K=0;K<je&&(xe++,ve=ve.nextZ);K++);for(He=je;xe>0||He>0&&ve;)xe!==0&&(He===0||!ve||ce.z<=ve.z)?(ae=ce,ce=ce.nextZ,xe--):(ae=ve,ve=ve.nextZ,He--),_e?_e.nextZ=ae:j=ae,ae.prevZ=_e,_e=ae;ce=ve}_e.nextZ=null,je*=2}while(Ee>1)}(F)}(o,u,d,g);for(var b,T,A=o;o.prev!==o.next;)if(b=o.prev,T=o.next,g?dk(o,u,d,g):fk(o))i.push(b.i/a|0),i.push(o.i/a|0),i.push(T.i/a|0),Zf(o),o=T.next,A=T.next;else if((o=T)===A){y?y===1?Wf(o=pk(yc(o),i,a),i,a,u,d,g,2):y===2&&mk(o,i,a,u,d,g):Wf(yc(o),i,a,u,d,g,1);break}}}function fk(o){var i=o.prev,a=o,u=o.next;if(lr(i,a,u)>=0)return!1;for(var d=i.x,g=a.x,y=u.x,b=i.y,T=a.y,A=u.y,C=d<g?d<y?d:y:g<y?g:y,k=b<T?b<A?b:A:T<A?T:A,O=d>g?d>y?d:y:g>y?g:y,B=b>T?b>A?b:A:T>A?T:A,F=u.next;F!==i;){if(F.x>=C&&F.x<=O&&F.y>=k&&F.y<=B&&Fu(d,b,g,T,y,A,F.x,F.y)&&lr(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function dk(o,i,a,u){var d=o.prev,g=o,y=o.next;if(lr(d,g,y)>=0)return!1;for(var b=d.x,T=g.x,A=y.x,C=d.y,k=g.y,O=y.y,B=b<T?b<A?b:A:T<A?T:A,F=C<k?C<O?C:O:k<O?k:O,j=b>T?b>A?b:A:T>A?T:A,K=C>k?C>O?C:O:k>O?k:O,ce=E0(B,F,i,a,u),ve=E0(j,K,i,a,u),ae=o.prevZ,_e=o.nextZ;ae&&ae.z>=ce&&_e&&_e.z<=ve;){if(ae.x>=B&&ae.x<=j&&ae.y>=F&&ae.y<=K&&ae!==d&&ae!==y&&Fu(b,C,T,k,A,O,ae.x,ae.y)&&lr(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,_e.x>=B&&_e.x<=j&&_e.y>=F&&_e.y<=K&&_e!==d&&_e!==y&&Fu(b,C,T,k,A,O,_e.x,_e.y)&&lr(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;ae&&ae.z>=ce;){if(ae.x>=B&&ae.x<=j&&ae.y>=F&&ae.y<=K&&ae!==d&&ae!==y&&Fu(b,C,T,k,A,O,ae.x,ae.y)&&lr(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;_e&&_e.z<=ve;){if(_e.x>=B&&_e.x<=j&&_e.y>=F&&_e.y<=K&&_e!==d&&_e!==y&&Fu(b,C,T,k,A,O,_e.x,_e.y)&&lr(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function pk(o,i,a){var u=o;do{var d=u.prev,g=u.next.next;!Hm(d,g)&&sE(d,u,u.next,g)&&qf(d,g)&&qf(g,d)&&(i.push(d.i/a|0),i.push(u.i/a|0),i.push(g.i/a|0),Zf(u),Zf(u.next),u=o=g),u=u.next}while(u!==o);return yc(u)}function mk(o,i,a,u,d,g){var y=o;do{for(var b=y.next.next;b!==y.prev;){if(y.i!==b.i&&xk(y,b)){var T=oE(y,b);return y=yc(y,y.next),T=yc(T,T.next),Wf(y,i,a,u,d,g,0),void Wf(T,i,a,u,d,g,0)}b=b.next}y=y.next}while(y!==o)}function gk(o,i){return o.x-i.x}function _k(o,i){var a=function(d,g){var y,b=g,T=d.x,A=d.y,C=-1/0;do{if(A<=b.y&&A>=b.next.y&&b.next.y!==b.y){var k=b.x+(A-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(k<=T&&k>C&&(C=k,y=b.x<b.next.x?b:b.next,k===T))return y}b=b.next}while(b!==g);if(!y)return null;var O,B=y,F=y.x,j=y.y,K=1/0;b=y;do T>=b.x&&b.x>=F&&T!==b.x&&Fu(A<j?T:C,A,F,j,A<j?C:T,A,b.x,b.y)&&(O=Math.abs(A-b.y)/(T-b.x),qf(b,d)&&(O<K||O===K&&(b.x>y.x||b.x===y.x&&yk(y,b)))&&(y=b,K=O)),b=b.next;while(b!==B);return y}(o,i);if(!a)return i;var u=oE(a,o);return yc(u,u.next),yc(a,a.next)}function yk(o,i){return lr(o.prev,o,i.prev)<0&&lr(i.next,o,o.next)<0}function E0(o,i,a,u,d){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-a)*d|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-u)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function vk(o){var i=o,a=o;do(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next;while(i!==o);return a}function Fu(o,i,a,u,d,g,y,b){return(d-y)*(i-b)>=(o-y)*(g-b)&&(o-y)*(u-b)>=(a-y)*(i-b)&&(a-y)*(g-b)>=(d-y)*(u-b)}function xk(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(a,u){var d=a;do{if(d.i!==a.i&&d.next.i!==a.i&&d.i!==u.i&&d.next.i!==u.i&&sE(d,d.next,a,u))return!0;d=d.next}while(d!==a);return!1}(o,i)&&(qf(o,i)&&qf(i,o)&&function(a,u){var d=a,g=!1,y=(a.x+u.x)/2,b=(a.y+u.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&y<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==a);return g}(o,i)&&(lr(o.prev,o,i.prev)||lr(o,i.prev,i))||Hm(o,i)&&lr(o.prev,o,o.next)>0&&lr(i.prev,i,i.next)>0)}function lr(o,i,a){return(i.y-o.y)*(a.x-i.x)-(i.x-o.x)*(a.y-i.y)}function Hm(o,i){return o.x===i.x&&o.y===i.y}function sE(o,i,a,u){var d=qm(lr(o,i,a)),g=qm(lr(o,i,u)),y=qm(lr(a,u,o)),b=qm(lr(a,u,i));return d!==g&&y!==b||!(d!==0||!Wm(o,a,i))||!(g!==0||!Wm(o,u,i))||!(y!==0||!Wm(a,o,u))||!(b!==0||!Wm(a,i,u))}function Wm(o,i,a){return i.x<=Math.max(o.x,a.x)&&i.x>=Math.min(o.x,a.x)&&i.y<=Math.max(o.y,a.y)&&i.y>=Math.min(o.y,a.y)}function qm(o){return o>0?1:o<0?-1:0}function qf(o,i){return lr(o.prev,o,o.next)<0?lr(o,i,o.next)>=0&&lr(o,o.prev,i)>=0:lr(o,i,o.prev)<0||lr(o,o.next,i)<0}function oE(o,i){var a=new T0(o.i,o.x,o.y),u=new T0(i.i,i.x,i.y),d=o.next,g=i.prev;return o.next=i,i.prev=o,a.next=d,d.prev=a,u.next=a,a.prev=u,g.next=u,u.prev=g,u}function aE(o,i,a,u){var d=new T0(o,i,a);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function Zf(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function T0(o,i,a){this.i=o,this.x=i,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A0(o,i,a,u){for(var d=0,g=i,y=a-u;g<a;g+=u)d+=(o[y]-o[g])*(o[g+1]+o[y+1]),y=g;return d}function bk(o,i,a,u,d){lE(o,i,a||0,u||o.length-1,d||wk)}function lE(o,i,a,u,d){for(;u>a;){if(u-a>600){var g=u-a+1,y=i-a+1,b=Math.log(g),T=.5*Math.exp(2*b/3),A=.5*Math.sqrt(b*T*(g-T)/g)*(y-g/2<0?-1:1);lE(o,i,Math.max(a,Math.floor(i-y*T/g+A)),Math.min(u,Math.floor(i+(g-y)*T/g+A)),d)}var C=o[i],k=a,O=u;for(Xf(o,a,i),d(o[u],C)>0&&Xf(o,a,u);k<O;){for(Xf(o,k,O),k++,O--;d(o[k],C)<0;)k++;for(;d(o[O],C)>0;)O--}d(o[a],C)===0?Xf(o,a,O):Xf(o,++O,u),O<=i&&(a=O+1),i<=O&&(u=O-1)}}function Xf(o,i,a){var u=o[i];o[i]=o[a],o[a]=u}function wk(o,i){return o<i?-1:o>i?1:0}function S0(o,i){const a=o.length;if(a<=1)return[o];const u=[];let d,g;for(let y=0;y<a;y++){const b=Ve(o[y]);b!==0&&(o[y].area=Math.abs(b),g===void 0&&(g=b<0),g===b<0?(d&&u.push(d),d=[o[y]]):d.push(o[y]))}if(d&&u.push(d),i>1)for(let y=0;y<u.length;y++)u[y].length<=i||(bk(u[y],i,1,u[y].length-1,Ek),u[y]=u[y].slice(0,i));return u}function Ek(o,i){return i.area-o.area}function M0(o,i,a){const u=a.patternDependencies;let d=!1;for(const g of i){const y=g.paint.get(`${o}-pattern`);y.isConstant()||(d=!0);const b=y.constantOr(null);b&&(d=!0,u[b]=!0)}return d}function P0(o,i,a,u,d){const g=d.patternDependencies;for(const y of i){const b=y.paint.get(`${o}-pattern`).value;if(b.kind!=="constant"){let T=b.evaluate({zoom:u},a,{},d.availableImages);T=T&&T.name?T.name:T,g[T]=!0,a.patterns[y.id]=T}}return a}({get exports(){return Bu},set exports(o){Bu=o}}).exports=$m,Bu.default=$m,$m.deviation=function(o,i,a,u){var d=i&&i.length,g=Math.abs(A0(o,0,d?i[0]*a:o.length,a));if(d)for(var y=0,b=i.length;y<b;y++)g-=Math.abs(A0(o,i[y]*a,y<b-1?i[y+1]*a:o.length,a));var T=0;for(y=0;y<u.length;y+=3){var A=u[y]*a,C=u[y+1]*a,k=u[y+2]*a;T+=Math.abs((o[A]-o[k])*(o[C+1]-o[A+1])-(o[A]-o[C])*(o[k+1]-o[A+1]))}return g===0&&T===0?0:Math.abs((T-g)/g)},$m.flatten=function(o){for(var i=o[0][0].length,a={vertices:[],holes:[],dimensions:i},u=0,d=0;d<o.length;d++){for(var g=0;g<o[d].length;g++)for(var y=0;y<i;y++)a.vertices.push(o[d][g][y]);d>0&&a.holes.push(u+=o[d-1].length)}return a};class Zm{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new hn,this.indexArray=new Fr,this.indexArray2=new Vo,this.programConfigurations=new uc(i.layers,i.zoom),this.segments=new ar,this.segments2=new ar,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection}populate(i,a,u,d){this.hasPattern=M0("fill",this.layers,a);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:b,id:T,index:A,sourceLayerIndex:C}of i){const k=this.layers[0]._featureFilter.needGeometry,O=gc(b,k);if(!this.layers[0]._featureFilter.filter(new Be(this.zoom),O,u))continue;const B=g?g.evaluate(O,{},u,a.availableImages):void 0,F={id:T,properties:b.properties,type:b.type,sourceLayerIndex:C,index:A,geometry:k?O.geometry:wa(b,u,d),patterns:{},sortKey:B};y.push(F)}g&&y.sort((b,T)=>b.sortKey-T.sortKey);for(const b of y){const{geometry:T,index:A,sourceLayerIndex:C}=b;if(this.hasPattern){const k=P0("fill",this.layers,b,this.zoom,a);this.patternFeatures.push(k)}else this.addFeature(b,T,A,u,{},a.availableImages);a.featureIndex.insert(i[A].feature,T,A,C,this.index)}}update(i,a,u,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,u,d)}addFeatures(i,a,u,d,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,hk),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,a,u,d,g,y=[]){for(const b of S0(a,500)){let T=0;for(const F of b)T+=F.length;const A=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),C=A.vertexLength,k=[],O=[];for(const F of b){if(F.length===0)continue;F!==b[0]&&O.push(k.length/2);const j=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),K=j.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(K+F.length-1,K),k.push(F[0].x),k.push(F[0].y);for(let ce=1;ce<F.length;ce++)this.layoutVertexArray.emplaceBack(F[ce].x,F[ce].y),this.indexArray2.emplaceBack(K+ce-1,K+ce),k.push(F[ce].x),k.push(F[ce].y);j.vertexLength+=F.length,j.primitiveLength+=F.length}const B=Bu(k,O);for(let F=0;F<B.length;F+=3)this.indexArray.emplaceBack(C+B[F],C+B[F+1],C+B[F+2]);A.vertexLength+=T,A.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,g,y,d)}}Gt(Zm,"FillBucket",{omit:["layers","patternFeatures"]});const Tk=new _t({"fill-sort-key":new qe(Ze.layout_fill["fill-sort-key"])});var Ak={paint:new _t({"fill-antialias":new De(Ze.paint_fill["fill-antialias"]),"fill-opacity":new qe(Ze.paint_fill["fill-opacity"]),"fill-color":new qe(Ze.paint_fill["fill-color"]),"fill-outline-color":new qe(Ze.paint_fill["fill-outline-color"]),"fill-translate":new De(Ze.paint_fill["fill-translate"]),"fill-translate-anchor":new De(Ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new qe(Ze.paint_fill["fill-pattern"])}),layout:Tk};const Sk=rn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Mk=rn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Pk=rn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ik}=Sk;var Xm={},Ck=ge,cE=Nu;function Nu(o,i,a,u,d){this.properties={},this.extent=a,this.type=0,this._pbf=o,this._geometry=-1,this._keys=u,this._values=d,o.readFields(Lk,this,i)}function Lk(o,i,a){o==1?i.id=a.readVarint():o==2?function(u,d){for(var g=u.readVarint()+u.pos;u.pos<g;){var y=d._keys[u.readVarint()],b=d._values[u.readVarint()];d.properties[y]=b}}(a,i):o==3?i.type=a.readVarint():o==4&&(i._geometry=a.pos)}function kk(o){for(var i,a,u=0,d=0,g=o.length,y=g-1;d<g;y=d++)u+=((a=o[y]).x-(i=o[d]).x)*(i.y+a.y);return u}Nu.types=["Unknown","Point","LineString","Polygon"],Nu.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,a=o.readVarint()+o.pos,u=1,d=0,g=0,y=0,b=[];o.pos<a;){if(d<=0){var T=o.readVarint();u=7&T,d=T>>3}if(d--,u===1||u===2)g+=o.readSVarint(),y+=o.readSVarint(),u===1&&(i&&b.push(i),i=[]),i.push(new Ck(g,y));else{if(u!==7)throw new Error("unknown command "+u);i&&i.push(i[0].clone())}}return i&&b.push(i),b},Nu.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,a=1,u=0,d=0,g=0,y=1/0,b=-1/0,T=1/0,A=-1/0;o.pos<i;){if(u<=0){var C=o.readVarint();a=7&C,u=C>>3}if(u--,a===1||a===2)(d+=o.readSVarint())<y&&(y=d),d>b&&(b=d),(g+=o.readSVarint())<T&&(T=g),g>A&&(A=g);else if(a!==7)throw new Error("unknown command "+a)}return[y,T,b,A]},Nu.prototype.toGeoJSON=function(o,i,a){var u,d,g=this.extent*Math.pow(2,a),y=this.extent*o,b=this.extent*i,T=this.loadGeometry(),A=Nu.types[this.type];function C(B){for(var F=0;F<B.length;F++){var j=B[F];B[F]=[360*(j.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+b)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(u=0;u<T.length;u++)k[u]=T[u][0];C(T=k);break;case 2:for(u=0;u<T.length;u++)C(T[u]);break;case 3:for(T=function(B){var F=B.length;if(F<=1)return[B];for(var j,K,ce=[],ve=0;ve<F;ve++){var ae=kk(B[ve]);ae!==0&&(K===void 0&&(K=ae<0),K===ae<0?(j&&ce.push(j),j=[B[ve]]):j.push(B[ve]))}return j&&ce.push(j),ce}(T),u=0;u<T.length;u++)for(d=0;d<T[u].length;d++)C(T[u][d])}T.length===1?T=T[0]:A="Multi"+A;var O={type:"Feature",geometry:{type:A,coordinates:T},properties:this.properties};return"id"in this&&(O.id=this.id),O};var Rk=cE,uE=hE;function hE(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Ok,this,i),this.length=this._features.length}function Ok(o,i,a){o===15?i.version=a.readVarint():o===1?i.name=a.readString():o===5?i.extent=a.readVarint():o===2?i._features.push(a.pos):o===3?i._keys.push(a.readString()):o===4&&i._values.push(function(u){for(var d=null,g=u.readVarint()+u.pos;u.pos<g;){var y=u.readVarint()>>3;d=y===1?u.readString():y===2?u.readFloat():y===3?u.readDouble():y===4?u.readVarint64():y===5?u.readVarint():y===6?u.readSVarint():y===7?u.readBoolean():null}return d}(a))}hE.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new Rk(this._pbf,i,this.extent,this._keys,this._values)};var Dk=uE;function zk(o,i,a){if(o===3){var u=new Dk(a,a.readVarint()+a.pos);u.length&&(i[u.name]=u)}}var I0=Xm.VectorTile=function(o,i){this.layers=o.readFields(zk,{},i)},Ym=Xm.VectorTileFeature=cE;function Km(o,i,a,u){const d=[],g=u===0?(y,b,T,A,C,k)=>{y.push(new ge(k,T+(k-b)/(A-b)*(C-T)))}:(y,b,T,A,C,k)=>{y.push(new ge(b+(k-T)/(C-T)*(A-b),k))};for(const y of o){const b=[];for(const T of y){if(T.length<=2)continue;const A=[];for(let O=0;O<T.length-1;O++){const B=T[O].x,F=T[O].y,j=T[O+1].x,K=T[O+1].y,ce=u===0?B:F,ve=u===0?j:K;ce<i?ve>i&&g(A,B,F,j,K,i):ce>a?ve<a&&g(A,B,F,j,K,a):A.push(T[O]),ve<i&&ce>=i&&g(A,B,F,j,K,i),ve>a&&ce<=a&&g(A,B,F,j,K,a)}let C=T[T.length-1];const k=u===0?C.x:C.y;k>=i&&k<=a&&A.push(C),A.length&&(C=A[A.length-1],A[0].x===C.x&&A[0].y===C.y||A.push(A[0]),b.push(A))}b.length&&d.push(b)}return d}Xm.VectorTileLayer=uE;const Bk=Ym.types,Fk=Math.pow(2,13);function Yf(o,i,a,u,d,g,y,b){o.emplaceBack((i<<1)+y,(a<<1)+g,(Math.floor(u*Fk)<<1)+d,Math.round(b))}function Kf(o,i,a){o.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}class fE{constructor(){this.acc=new ge(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ge(i.x,i.y),this.max=new ge(i.x,i.y))}append(i,a){this.currentPolyCount.edges++,this.acc._add(i);const u=this.min,d=this.max;i.x<u.x?u.x=i.x:i.x>d.x&&(d.x=i.x),i.y<u.y?u.y=i.y:i.y>d.y&&(d.y=i.y),((i.x===0||i.x===Tn)&&i.x===a.x)!=((i.y===0||i.y===Tn)&&i.y===a.y)&&this.processBorderOverlap(i,a),a.x<0!=i.x<0&&this.addBorderIntersection(0,Qn(a.y,i.y,(0-a.x)/(i.x-a.x))),a.x>Tn!=i.x>Tn&&this.addBorderIntersection(1,Qn(a.y,i.y,(Tn-a.x)/(i.x-a.x))),a.y<0!=i.y<0&&this.addBorderIntersection(2,Qn(a.x,i.x,(0-a.y)/(i.y-a.y))),a.y>Tn!=i.y>Tn&&this.addBorderIntersection(3,Qn(a.x,i.x,(Tn-a.y)/(i.y-a.y)))}addBorderIntersection(i,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[i];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(i,a){if(i.x===a.x){if(i.y===a.y)return;const u=i.x===0?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,i.y)}else{const u=i.y===0?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,i.x)}}centroid(){const i=this.polyCount.reduce((a,u)=>a+u.edges,0);return i!==0?this.acc.div(i)._round():new ge(0,0)}span(){return new ge(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,a)=>i+ +(a[0]!==Number.MAX_VALUE),0)}}class Jf{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.layoutVertexArray=new mi,this.centroidVertexArray=new dw,this.indexArray=new Fr,this.programConfigurations=new uc(i.layers,i.zoom),this.segments=new ar,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=i.enableTerrain}populate(i,a,u,d){this.features=[],this.hasPattern=M0("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const y=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*y/(y*y+1)/Tn/(1<<g.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:g,id:y,index:b,sourceLayerIndex:T}of i){const A=this.layers[0]._featureFilter.needGeometry,C=gc(g,A);if(!this.layers[0]._featureFilter.filter(new Be(this.zoom),C,u))continue;const k={id:y,sourceLayerIndex:T,index:b,geometry:A?C.geometry:wa(g,u,d),properties:g.properties,type:g.type,patterns:{}},O=this.layoutVertexArray.length;this.hasPattern?this.features.push(P0("fill-extrusion",this.layers,k,this.zoom,a)):this.addFeature(k,k.geometry,b,u,{},a.availableImages,d),a.featureIndex.insert(g,k.geometry,b,T,this.index,O)}this.sortBorders()}addFeatures(i,a,u,d,g){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,a,u,d,g)}this.sortBorders()}update(i,a,u,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Ik),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,Pk.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Mk.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,a,u,d,g,y,b){const T=[new ge(0,0),new ge(Tn,Tn)],A=b.projection,C=A.name==="globe",k=this.enableTerrain&&!C?new fE:null,O=Bk[i.type]==="Polygon";C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new zs);const B=S0(a,500);for(let ce=B.length-1;ce>=0;ce--){const ve=B[ce];(ve.length===0||(F=ve[0]).every(ae=>ae.x<=0)||F.every(ae=>ae.x>=Tn)||F.every(ae=>ae.y<=0)||F.every(ae=>ae.y>=Tn))&&B.splice(ce,1)}var F;let j;if(C)j=vE(B,T,d);else{j=[];for(const ce of B)j.push({polygon:ce,bounds:T})}const K=O?this.edgeRadius:0;for(const{polygon:ce,bounds:ve}of j){let ae=0,_e=0;for(const xe of ce)O&&!xe[0].equals(xe[xe.length-1])&&xe.push(xe[0]),_e+=O?xe.length-1:xe.length;const Ee=this.segments.prepareSegment((O?5:4)*_e,this.layoutVertexArray,this.indexArray);if(O){const xe=[],He=[];ae=Ee.vertexLength;for(const tt of ce){let vt,Xe;tt.length&&tt!==ce[0]&&He.push(xe.length/2),vt=tt[1].sub(tt[0])._perp()._unit();for(let it=1;it<tt.length;it++){const ot=tt[it],mt=tt[it===tt.length-1?1:it+1];let{x:bt,y:Ke}=ot;if(K){Xe=mt.sub(ot)._perp()._unit();const Ct=vt.add(Xe)._unit(),_n=K*Math.min(4,1/(vt.x*Ct.x+vt.y*Ct.y));bt+=_n*Ct.x,Ke+=_n*Ct.y,vt=Xe}Yf(this.layoutVertexArray,bt,Ke,0,0,1,1,0),Ee.vertexLength++,xe.push(ot.x,ot.y),C&&Kf(this.layoutVertexExtArray,A.projectTilePoint(bt,Ke,d),A.upVector(d,bt,Ke))}}const je=Bu(xe,He);for(let tt=0;tt<je.length;tt+=3)this.indexArray.emplaceBack(ae+je[tt],ae+je[tt+2],ae+je[tt+1]),Ee.primitiveLength++}for(const xe of ce){k&&xe.length&&k.startRing(xe[0]);let He,je,tt,vt=xe.length>4&&gE(xe[xe.length-2],xe[0],xe[1]),Xe=K?Nk(xe[xe.length-2],xe[0],xe[1],K):0;je=xe[1].sub(xe[0])._perp()._unit();let it=!0;for(let ot=1,mt=0;ot<xe.length;ot++){let bt=xe[ot-1],Ke=xe[ot];const Ct=xe[ot===xe.length-1?1:ot+1];if(k&&O&&k.currentPolyCount.top++,mE(Ke,bt,ve)){K&&(je=Ct.sub(Ke)._perp()._unit(),it=!it);continue}k&&k.append(Ke,bt);const _n=Ke.sub(bt)._perp(),Bt=_n.x/(Math.abs(_n.x)+Math.abs(_n.y)),Xt=_n.y>0?1:0,kt=bt.dist(Ke);if(mt+kt>32768&&(mt=0),K){tt=Ct.sub(Ke)._perp()._unit();let Nn=pE(bt,Ke,Ct,dE(je,tt),K);isNaN(Nn)&&(Nn=0);const En=Ke.sub(bt)._unit();bt=bt.add(En.mult(Xe))._round(),Ke=Ke.add(En.mult(-Nn))._round(),Xe=Nn,je=tt}const bn=Ee.vertexLength,jn=xe.length>4&&gE(bt,Ke,Ct);let Un=_E(mt,vt,it);if(Yf(this.layoutVertexArray,bt.x,bt.y,Bt,Xt,0,0,Un),Yf(this.layoutVertexArray,bt.x,bt.y,Bt,Xt,0,1,Un),mt+=kt,Un=_E(mt,jn,!it),vt=jn,Yf(this.layoutVertexArray,Ke.x,Ke.y,Bt,Xt,0,0,Un),Yf(this.layoutVertexArray,Ke.x,Ke.y,Bt,Xt,0,1,Un),Ee.vertexLength+=4,this.indexArray.emplaceBack(bn+0,bn+1,bn+2),this.indexArray.emplaceBack(bn+1,bn+3,bn+2),Ee.primitiveLength+=2,K){const Nn=ae+(ot===1?xe.length-2:ot-2),En=ot===1?ae:Nn+1;if(this.indexArray.emplaceBack(bn+1,Nn,bn+3),this.indexArray.emplaceBack(Nn,En,bn+3),Ee.primitiveLength+=2,He===void 0&&(He=bn),!mE(Ct,xe[ot],ve)){const fi=ot===xe.length-1?He:Ee.vertexLength;this.indexArray.emplaceBack(bn+2,bn+3,fi),this.indexArray.emplaceBack(bn+3,fi+1,fi),this.indexArray.emplaceBack(bn+3,En,fi+1),Ee.primitiveLength+=3}it=!it}if(C){const Nn=this.layoutVertexExtArray,En=A.projectTilePoint(bt.x,bt.y,d),fi=A.projectTilePoint(Ke.x,Ke.y,d),In=A.upVector(d,bt.x,bt.y),Gn=A.upVector(d,Ke.x,Ke.y);Kf(Nn,En,In),Kf(Nn,En,In),Kf(Nn,fi,Gn),Kf(Nn,fi,Gn)}}O&&(ae+=xe.length-1)}}if(k&&k.polyCount.length>0){if(k.borders){k.vertexArrayOffset=this.centroidVertexArray.length;const ce=k.borders,ve=this.featuresOnBorder.push(k)-1;for(let ae=0;ae<4;ae++)ce[ae][0]!==Number.MAX_VALUE&&this.borders[ae].push(ve)}this.encodeCentroid(k.borders?void 0:k.centroid(),k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,g,y,d)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((a,u)=>this.featuresOnBorder[a].borders[i][0]-this.featuresOnBorder[u].borders[i][0])}encodeCentroid(i,a,u=!0){let d,g;if(i)if(i.y!==0){const b=a.span()._mult(this.tileToMeter);d=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(b.x/10)),g=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else d=Math.ceil(7*(i.x+450)),g=0;else d=0,g=+u;let y=u?this.centroidVertexArray.length:a.vertexArrayOffset;for(const b of a.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let T=0;T<b.top;T++)this.centroidVertexArray.emplace(y++,d,g);for(let T=0;T<2*b.edges;T++)this.centroidVertexArray.emplace(y++,0,g),this.centroidVertexArray.emplace(y++,d,g)}}}function dE(o,i){const a=o.add(i)._unit();return o.x*a.x+o.y*a.y}function Nk(o,i,a,u){const d=i.sub(o)._perp()._unit(),g=a.sub(i)._perp()._unit();return pE(o,i,a,dE(d,g),u)}function pE(o,i,a,u,d){const g=Math.sqrt(1-u*u);return Math.min(o.dist(i)/3,i.dist(a)/3,d*g/u)}function mE(o,i,a){return o.x<a[0].x&&i.x<a[0].x||o.x>a[1].x&&i.x>a[1].x||o.y<a[0].y&&i.y<a[0].y||o.y>a[1].y&&i.y>a[1].y}function gE(o,i,a){if(o.x<0||o.x>=Tn||i.x<0||i.x>=Tn||a.x<0||a.x>=Tn)return!1;const u=a.sub(i),d=u.perp(),g=o.sub(i);return(u.x*g.x+u.y*g.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(g.x*g.x+g.y*g.y))>-.866&&d.x*g.x+d.y*g.y<0}function _E(o,i,a){const u=i?2|o:-3&o;return a?1|u:-2&u}function yE(){const o=Math.PI/32,i=Math.tan(o),a=Hf;return a*Math.sqrt(1+2*i*i)-a}function vE(o,i,a){const u=1<<a.z,d=Fs(a.x/u),g=Fs((a.x+1)/u),y=Nr(a.y/u),b=Nr((a.y+1)/u);return function(T,A,C,k,O=0,B){const F=[];if(!T.length||!C||!k)return F;const j=(xe,He)=>{for(const je of xe)F.push({polygon:je,bounds:He})},K=Math.ceil(Math.log2(C)),ce=Math.ceil(Math.log2(k)),ve=K-ce,ae=[];for(let xe=0;xe<Math.abs(ve);xe++)ae.push(ve>0?0:1);for(let xe=0;xe<Math.min(K,ce);xe++)ae.push(0),ae.push(1);let _e=T;if(_e=Km(_e,A[0].y-O,A[1].y+O,1),_e=Km(_e,A[0].x-O,A[1].x+O,0),!_e.length)return F;const Ee=[];for(ae.length?Ee.push({polygons:_e,bounds:A,depth:0}):j(_e,A);Ee.length;){const xe=Ee.pop(),He=xe.depth,je=ae[He],tt=xe.bounds[0],vt=xe.bounds[1],Xe=je===0?tt.x:tt.y,it=je===0?vt.x:vt.y,ot=B?B(je,Xe,it):.5*(Xe+it),mt=Km(xe.polygons,Xe-O,ot+O,je),bt=Km(xe.polygons,ot-O,it+O,je);if(mt.length){const Ke=[tt,new ge(je===0?ot:vt.x,je===1?ot:vt.y)];ae.length>He+1?Ee.push({polygons:mt,bounds:Ke,depth:He+1}):j(mt,Ke)}if(bt.length){const Ke=[new ge(je===0?ot:tt.x,je===1?ot:tt.y),vt];ae.length>He+1?Ee.push({polygons:bt,bounds:Ke,depth:He+1}):j(bt,Ke)}}return F}(o,i,Math.ceil((g-d)/11.25),Math.ceil((y-b)/11.25),1,(T,A,C)=>{if(T===0)return .5*(A+C);{const k=Nr((a.y+A/Tn)/u);return(Wo(.5*(Nr((a.y+C/Tn)/u)+k))*u-a.y)*Tn}})}Gt(Jf,"FillExtrusionBucket",{omit:["layers","features"]}),Gt(fE,"PartMetadata");const Uk=new _t({"fill-extrusion-edge-radius":new De(Ze["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Vk={paint:new _t({"fill-extrusion-opacity":new De(Ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qe(Ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new De(Ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new De(Ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new qe(Ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qe(Ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qe(Ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new De(Ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new De(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new De(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Uk};function xE(o,i,a){var u=2*Math.PI*6378137/256/Math.pow(2,a);return[o*u-2*Math.PI*6378137/2,i*u-2*Math.PI*6378137/2]}class Jm{constructor(i,a,u){this.z=i,this.x=a,this.y=u,this.key=Qf(0,i,i,a,u)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,a){const u=function(g,y,b){var T=xE(256*g,256*(y=Math.pow(2,b)-y-1),b),A=xE(256*(g+1),256*(y+1),b);return T[0]+","+T[1]+","+A[0]+","+A[1]}(this.x,this.y,this.z),d=function(g,y,b){let T,A="";for(let C=g;C>0;C--)T=1<<C-1,A+=(y&T?1:0)+(b&T?2:0);return A}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bE{constructor(i,a){this.wrap=i,this.canonical=a,this.key=Qf(i,a.z,a.z,a.x,a.y)}}class ss{constructor(i,a,u,d,g){this.overscaledZ=i,this.wrap=a,this.canonical=new Jm(u,+d,+g),this.key=a===0&&i===u?this.canonical.key:Qf(a,i,u,d,g)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const a=this.canonical.z-i;return i>this.canonical.z?new ss(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ss(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(i,a=!0){if(this.overscaledZ===i&&a)return this.key;if(i>this.canonical.z)return Qf(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-i;return Qf(this.wrap*+a,i,i,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const a=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a}children(i){if(this.overscaledZ>=i)return[new ss(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new ss(a,this.wrap,a,u,d),new ss(a,this.wrap,a,u+1,d),new ss(a,this.wrap,a,u,d+1),new ss(a,this.wrap,a,u+1,d+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new ss(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new ss(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bE(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Qf(o,i,a,u,d){const g=1<<Math.min(a,22);let y=g*(d%g)+u%g;return o&&a<22&&(y+=g*g*((o<0?-2*o-1:2*o)%(1<<2*(22-a)))),16*(32*y+a)+(i-a)}Gt(Jm,"CanonicalTileID"),Gt(ss,"OverscaledTileID",{omit:["projMatrix"]});class Uu extends ge{constructor(i,a,u){super(i,a),this.z=u}}function ed(o,i){return o.x*i.x+o.y*i.y}function wE(o,i){if(o.length===1){let a=0;const u=i[a++];let d;for(;!d||u.equals(d);)if(d=i[a++],!d)return 1/0;for(;a<i.length;a++){const g=i[a],y=o[0],b=d.sub(u),T=g.sub(u),A=y.sub(u),C=ed(b,b),k=ed(b,T),O=ed(T,T),B=ed(A,b),F=ed(A,T),j=C*O-k*k,K=(O*B-k*F)/j,ce=(C*F-k*B)/j,ve=u.z*(1-K-ce)+d.z*K+g.z*ce;if(isFinite(ve))return ve}return 1/0}{let a=1/0;for(const u of i)a=Math.min(a,u.z);return a}}function EE(o,i,a,u,d,g,y,b){const T=y*d.getElevationAt(o,i,!0,!0),A=g[0]!==0,C=A?g[1]===0?y*(g[0]/7-450):y*function(k,O,B){const F=Math.floor(O[0]/8),j=Math.floor(O[1]/8),K=10*(O[0]-8*F),ce=10*(O[1]-8*j),ve=k.getElevationAt(F,j,!0,!0),ae=k.getMeterToDEM(B),_e=Math.floor(.5*(K*ae-1)),Ee=Math.floor(.5*(ce*ae-1)),xe=k.tileCoordToPixel(F,j),He=2*_e+1,je=2*Ee+1,tt=function(bt,Ke,Ct,_n,Bt){return[bt.getElevationAtPixel(Ke,Ct,!0),bt.getElevationAtPixel(Ke+Bt,Ct,!0),bt.getElevationAtPixel(Ke,Ct+Bt,!0),bt.getElevationAtPixel(Ke+_n,Ct+Bt,!0)]}(k,xe.x-_e,xe.y-Ee,He,je),vt=Math.abs(tt[0]-tt[1]),Xe=Math.abs(tt[2]-tt[3]),it=Math.abs(tt[0]-tt[2])+Math.abs(tt[1]-tt[3]),ot=Math.min(.25,.5*ae*(vt+Xe)/He),mt=Math.min(.25,.5*ae*it/je);return ve+Math.max(ot*K,mt*ce)}(d,g,b):T;return{base:T+(a===0)?-1:a,top:A?Math.max(C+u,T+a+2):T+u}}const jk=rn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Gk}=jk,$k=rn([{name:"a_packed",components:4,type:"Float32"}]),{members:Hk}=$k,Wk=Ym.types,qk=Math.cos(Math.PI/180*37.5);class Qm{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Si,this.layoutVertexArray2=new wi,this.indexArray=new Fr,this.programConfigurations=new uc(i.layers,i.zoom),this.segments=new ar,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(i,a,u,d){this.hasPattern=M0("line",this.layers,a);const g=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:C,id:k,index:O,sourceLayerIndex:B}of i){const F=this.layers[0]._featureFilter.needGeometry,j=gc(C,F);if(!this.layers[0]._featureFilter.filter(new Be(this.zoom),j,u))continue;const K=g?g.evaluate(j,{},u):void 0,ce={id:k,properties:C.properties,type:C.type,sourceLayerIndex:B,index:O,geometry:F?j.geometry:wa(C,u,d),patterns:{},sortKey:K};y.push(ce)}g&&y.sort((C,k)=>C.sortKey-k.sortKey);const{lineAtlas:b,featureIndex:T}=a,A=this.addConstantDashes(b);for(const C of y){const{geometry:k,index:O,sourceLayerIndex:B}=C;if(A&&this.addFeatureDashes(C,b),this.hasPattern){const F=P0("line",this.layers,C,this.zoom,a);this.patternFeatures.push(F)}else this.addFeature(C,k,O,u,b.positions,a.availableImages);T.insert(i[O].feature,k,O,B,this.index)}}addConstantDashes(i){let a=!1;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(d.kind!=="constant"||g.kind!=="constant")a=!0;else{const y=g.value,b=d.value;if(!b)continue;i.addDash(b,y)}}return a}addFeatureDashes(i,a){const u=this.zoom;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(g.kind==="constant"&&y.kind==="constant")continue;let b,T;if(g.kind==="constant"){if(b=g.value,!b)continue}else b=g.evaluate({zoom:u},i);T=y.kind==="constant"?y.value:y.evaluate({zoom:u},i),a.addDash(b,T),i.patterns[d.id]=a.getKey(b,T)}}update(i,a,u,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,u,d)}addFeatures(i,a,u,d,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Hk)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Gk),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,a,u,d,g,y){const b=this.layers[0].layout,T=b.get("line-join").evaluate(i,{}),A=b.get("line-cap").evaluate(i,{}),C=b.get("line-miter-limit"),k=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const O of a)this.addLine(O,i,T,A,C,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,g,y,d)}addLine(i,a,u,d,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ce=0;ce<i.length-1;ce++)this.totalDistance+=i[ce].dist(i[ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=Wk[a.type]==="Polygon";let T=i.length;for(;T>=2&&i[T-1].equals(i[T-2]);)T--;let A=0;for(;A<T-1&&i[A].equals(i[A+1]);)A++;if(T<(b?3:2))return;u==="bevel"&&(g=1.05);const C=this.overscaling<=16?122880/(512*this.overscaling):0,k=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let O,B,F,j,K;this.e1=this.e2=-1,b&&(O=i[T-2],K=i[A].sub(O)._unit()._perp());for(let ce=A;ce<T;ce++){if(F=ce===T-1?b?i[A+1]:void 0:i[ce+1],F&&i[ce].equals(F))continue;K&&(j=K),O&&(B=O),O=i[ce],K=F?F.sub(O)._unit()._perp():j,j=j||K;let ve=j.add(K);ve.x===0&&ve.y===0||ve._unit();const ae=j.x*K.x+j.y*K.y,_e=ve.x*K.x+ve.y*K.y,Ee=_e!==0?1/_e:1/0,xe=2*Math.sqrt(2-2*_e),He=_e<qk&&B&&F,je=j.x*K.y-j.y*K.x>0;if(He&&ce>A){const Xe=O.dist(B);if(Xe>2*C){const it=O.sub(O.sub(B)._mult(C/Xe)._round());this.updateDistance(B,it),this.addCurrentVertex(it,j,0,0,k),B=it}}const tt=B&&F;let vt=tt?u:b?"butt":d;if(tt&&vt==="round"&&(Ee<y?vt="miter":Ee<=2&&(vt="fakeround")),vt==="miter"&&Ee>g&&(vt="bevel"),vt==="bevel"&&(Ee>2&&(vt="flipbevel"),Ee<g&&(vt="miter")),B&&this.updateDistance(B,O),vt==="miter")ve._mult(Ee),this.addCurrentVertex(O,ve,0,0,k);else if(vt==="flipbevel"){if(Ee>100)ve=K.mult(-1);else{const Xe=Ee*j.add(K).mag()/j.sub(K).mag();ve._perp()._mult(Xe*(je?-1:1))}this.addCurrentVertex(O,ve,0,0,k),this.addCurrentVertex(O,ve.mult(-1),0,0,k)}else if(vt==="bevel"||vt==="fakeround"){const Xe=-Math.sqrt(Ee*Ee-1),it=je?Xe:0,ot=je?0:Xe;if(B&&this.addCurrentVertex(O,j,it,ot,k),vt==="fakeround"){const mt=Math.round(180*xe/Math.PI/20);for(let bt=1;bt<mt;bt++){let Ke=bt/mt;if(Ke!==.5){const _n=Ke-.5;Ke+=Ke*_n*(Ke-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*_n*_n+(.848013+ae*(.215638*ae-1.06021)))}const Ct=K.sub(j)._mult(Ke)._add(j)._unit()._mult(je?-1:1);this.addHalfVertex(O,Ct.x,Ct.y,!1,je,0,k)}}F&&this.addCurrentVertex(O,K,-it,-ot,k)}else if(vt==="butt")this.addCurrentVertex(O,ve,0,0,k);else if(vt==="square"){const Xe=B?1:-1;B||this.addCurrentVertex(O,ve,Xe,Xe,k),this.addCurrentVertex(O,ve,0,0,k),B&&this.addCurrentVertex(O,ve,Xe,Xe,k)}else vt==="round"&&(B&&(this.addCurrentVertex(O,j,0,0,k),this.addCurrentVertex(O,j,1,1,k,!0)),F&&(this.addCurrentVertex(O,K,-1,-1,k,!0),this.addCurrentVertex(O,K,0,0,k)));if(He&&ce<T-1){const Xe=O.dist(F);if(Xe>2*C){const it=O.add(F.sub(O)._mult(C/Xe)._round());this.updateDistance(O,it),this.addCurrentVertex(it,K,0,0,k),O=it}}}}addCurrentVertex(i,a,u,d,g,y=!1){const b=a.y*d-a.x,T=-a.y-a.x*d;this.addHalfVertex(i,a.x+a.y*u,a.y-a.x*u,y,!1,u,g),this.addHalfVertex(i,b,T,y,!0,-d,g)}addHalfVertex({x:i,y:a},u,d,g,y,b,T){this.layoutVertexArray.emplaceBack((i<<1)+(g?1:0),(a<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const A=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),T.primitiveLength++),y?this.e2=A:this.e1=A}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,a){this.distance+=i.dist(a),this.updateScaledDistance()}}Gt(Qm,"LineBucket",{omit:["layers","patternFeatures"]});const Zk=new _t({"line-cap":new qe(Ze.layout_line["line-cap"]),"line-join":new qe(Ze.layout_line["line-join"]),"line-miter-limit":new De(Ze.layout_line["line-miter-limit"]),"line-round-limit":new De(Ze.layout_line["line-round-limit"]),"line-sort-key":new qe(Ze.layout_line["line-sort-key"])});var TE={paint:new _t({"line-opacity":new qe(Ze.paint_line["line-opacity"]),"line-color":new qe(Ze.paint_line["line-color"]),"line-translate":new De(Ze.paint_line["line-translate"]),"line-translate-anchor":new De(Ze.paint_line["line-translate-anchor"]),"line-width":new qe(Ze.paint_line["line-width"]),"line-gap-width":new qe(Ze.paint_line["line-gap-width"]),"line-offset":new qe(Ze.paint_line["line-offset"]),"line-blur":new qe(Ze.paint_line["line-blur"]),"line-dasharray":new qe(Ze.paint_line["line-dasharray"]),"line-pattern":new qe(Ze.paint_line["line-pattern"]),"line-gradient":new ut(Ze.paint_line["line-gradient"]),"line-trim-offset":new De(Ze.paint_line["line-trim-offset"])}),layout:Zk};const AE=new class extends qe{possiblyEvaluate(o,i){return i=new Be(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(o,i)}evaluate(o,i,a,u){return i=Wn({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(o,i,a,u)}}(TE.paint.properties["line-width"].specification);function SE(o,i){return i>0?i+2*o:o}AE.useIntegerZoom=!0;const Xk=rn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Yk=rn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Kk=rn([{name:"a_projected_pos",components:4,type:"Float32"}],4);rn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jk=rn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Qk=rn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ME=rn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),eR=rn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);rn([{name:"triangle",components:3,type:"Uint16"}]),rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),rn([{type:"Float32",name:"offsetX"}]),rn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Vr=24;const qo=128;function C0(o,i){const{expression:a}=i;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new Be(o+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:d}=a;let g=0;for(;g<u.length&&u[g]<=o;)g++;g=Math.max(0,g-1);let y=g;for(;y<u.length&&u[y]<o+1;)y++;y=Math.min(u.length-1,y);const b=u[g],T=u[y];return a.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:T,minSize:a.evaluate(new Be(b)),maxSize:a.evaluate(new Be(T)),interpolationType:d}}}function eg(o,{uSize:i,uSizeT:a},{lowerSize:u,upperSize:d}){return o.kind==="source"?u/qo:o.kind==="composite"?Qn(u/qo,d/qo,a):i}function Vu(o,i){let a=0,u=0;if(o.kind==="constant")u=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:d,minZoom:g,maxZoom:y}=o,b=d?$t(Js.interpolationFactor(d,i,g,y),0,1):0;o.kind==="camera"?u=Qn(o.minSize,o.maxSize,b):a=b}return{uSizeT:a,uSize:u}}var tR=Object.freeze({__proto__:null,getSizeData:C0,evaluateSizeForFeature:eg,evaluateSizeForZoom:Vu,SIZE_PACK_FACTOR:qo});function nR(o,i,a){return o.sections.forEach(u=>{u.text=function(d,g,y){const b=g.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),Ce.applyArabicShaping&&(d=Ce.applyArabicShaping(d)),d}(u.text,i,a)}),o}const td={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function iR(o){return o==="\uFE36"||o==="\uFE48"||o==="\uFE38"||o==="\uFE44"||o==="\uFE42"||o==="\uFE3E"||o==="\uFE3C"||o==="\uFE3A"||o==="\uFE18"||o==="\uFE40"||o==="\uFE10"||o==="\uFE13"||o==="\uFE14"||o==="\uFF40"||o==="\uFFE3"||o==="\uFE11"||o==="\uFE12"}function rR(o){return o==="\uFE35"||o==="\uFE47"||o==="\uFE37"||o==="\uFE43"||o==="\uFE41"||o==="\uFE3D"||o==="\uFE3B"||o==="\uFE39"||o==="\uFE17"||o==="\uFE3F"}var nd=Mi,PE=function(o,i,a,u,d){var g,y,b=8*d-u-1,T=(1<<b)-1,A=T>>1,C=-7,k=a?d-1:0,O=a?-1:1,B=o[i+k];for(k+=O,g=B&(1<<-C)-1,B>>=-C,C+=b;C>0;g=256*g+o[i+k],k+=O,C-=8);for(y=g&(1<<-C)-1,g>>=-C,C+=u;C>0;y=256*y+o[i+k],k+=O,C-=8);if(g===0)g=1-A;else{if(g===T)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,u),g-=A}return(B?-1:1)*y*Math.pow(2,g-u)},IE=function(o,i,a,u,d,g){var y,b,T,A=8*g-d-1,C=(1<<A)-1,k=C>>1,O=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=u?0:g-1,F=u?1:-1,j=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(b=isNaN(i)?1:0,y=C):(y=Math.floor(Math.log(i)/Math.LN2),i*(T=Math.pow(2,-y))<1&&(y--,T*=2),(i+=y+k>=1?O/T:O*Math.pow(2,1-k))*T>=2&&(y++,T/=2),y+k>=C?(b=0,y=C):y+k>=1?(b=(i*T-1)*Math.pow(2,d),y+=k):(b=i*Math.pow(2,k-1)*Math.pow(2,d),y=0));d>=8;o[a+B]=255&b,B+=F,b/=256,d-=8);for(y=y<<d|b,A+=d;A>0;o[a+B]=255&y,B+=F,y/=256,A-=8);o[a+B-F]|=128*j};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Mi(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Mi.Varint=0,Mi.Fixed64=1,Mi.Bytes=2,Mi.Fixed32=5;var L0=4294967296,CE=1/L0,LE=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ta(o){return o.type===Mi.Bytes?o.readVarint()+o.pos:o.pos+1}function ju(o,i,a){return a?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}function kE(o,i,a){var u=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));a.realloc(u);for(var d=a.pos-1;d>=o;d--)a.buf[d+u]=a.buf[d]}function sR(o,i){for(var a=0;a<o.length;a++)i.writeVarint(o[a])}function oR(o,i){for(var a=0;a<o.length;a++)i.writeSVarint(o[a])}function aR(o,i){for(var a=0;a<o.length;a++)i.writeFloat(o[a])}function lR(o,i){for(var a=0;a<o.length;a++)i.writeDouble(o[a])}function cR(o,i){for(var a=0;a<o.length;a++)i.writeBoolean(o[a])}function uR(o,i){for(var a=0;a<o.length;a++)i.writeFixed32(o[a])}function hR(o,i){for(var a=0;a<o.length;a++)i.writeSFixed32(o[a])}function fR(o,i){for(var a=0;a<o.length;a++)i.writeFixed64(o[a])}function dR(o,i){for(var a=0;a<o.length;a++)i.writeSFixed64(o[a])}function tg(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function Gu(o,i,a){o[a]=i,o[a+1]=i>>>8,o[a+2]=i>>>16,o[a+3]=i>>>24}function RE(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}function pR(o,i,a){i.glyphs=[],o===1&&a.readMessage(mR,i)}function mR(o,i,a){if(o===3){const{id:u,bitmap:d,width:g,height:y,left:b,top:T,advance:A}=a.readMessage(gR,{});i.glyphs.push({id:u,bitmap:new Ea({width:g+6,height:y+6},d),metrics:{width:g,height:y,left:b,top:T,advance:A}})}else o===4?i.ascender=a.readSVarint():o===5&&(i.descender=a.readSVarint())}function gR(o,i,a){o===1?i.id=a.readVarint():o===2?i.bitmap=a.readBytes():o===3?i.width=a.readVarint():o===4?i.height=a.readVarint():o===5?i.left=a.readSVarint():o===6?i.top=a.readSVarint():o===7&&(i.advance=a.readVarint())}function k0(o){let i=0,a=0;for(const y of o)i+=y.w*y.h,a=Math.max(a,y.w);o.sort((y,b)=>b.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),a),h:1/0}];let d=0,g=0;for(const y of o)for(let b=u.length-1;b>=0;b--){const T=u[b];if(!(y.w>T.w||y.h>T.h)){if(y.x=T.x,y.y=T.y,g=Math.max(g,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===T.w&&y.h===T.h){const A=u.pop();b<u.length&&(u[b]=A)}else y.h===T.h?(T.x+=y.w,T.w-=y.w):y.w===T.w?(T.y+=y.h,T.h-=y.h):(u.push({x:T.x+y.w,y:T.y,w:T.w-y.w,h:y.h}),T.y+=y.h,T.h-=y.h);break}}return{w:d,h:g,fill:i/(d*g)||0}}Mi.prototype={destroy:function(){this.buf=null},readFields:function(o,i,a){for(a=a||this.length;this.pos<a;){var u=this.readVarint(),d=u>>3,g=this.pos;this.type=7&u,o(d,i,this),this.pos===g&&this.skip(u)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=tg(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=RE(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=tg(this.buf,this.pos)+tg(this.buf,this.pos+4)*L0;return this.pos+=8,o},readSFixed64:function(){var o=tg(this.buf,this.pos)+RE(this.buf,this.pos+4)*L0;return this.pos+=8,o},readFloat:function(){var o=PE(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=PE(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,a,u=this.buf;return i=127&(a=u[this.pos++]),a<128?i:(i|=(127&(a=u[this.pos++]))<<7,a<128?i:(i|=(127&(a=u[this.pos++]))<<14,a<128?i:(i|=(127&(a=u[this.pos++]))<<21,a<128?i:function(d,g,y){var b,T,A=y.buf;if(b=(112&(T=A[y.pos++]))>>4,T<128||(b|=(127&(T=A[y.pos++]))<<3,T<128)||(b|=(127&(T=A[y.pos++]))<<10,T<128)||(b|=(127&(T=A[y.pos++]))<<17,T<128)||(b|=(127&(T=A[y.pos++]))<<24,T<128)||(b|=(1&(T=A[y.pos++]))<<31,T<128))return ju(d,b,g);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(a=u[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&LE?function(a,u,d){return LE.decode(a.subarray(u,d))}(this.buf,i,o):function(a,u,d){for(var g="",y=u;y<d;){var b,T,A,C=a[y],k=null,O=C>239?4:C>223?3:C>191?2:1;if(y+O>d)break;O===1?C<128&&(k=C):O===2?(192&(b=a[y+1]))==128&&(k=(31&C)<<6|63&b)<=127&&(k=null):O===3?(T=a[y+2],(192&(b=a[y+1]))==128&&(192&T)==128&&((k=(15&C)<<12|(63&b)<<6|63&T)<=2047||k>=55296&&k<=57343)&&(k=null)):O===4&&(T=a[y+2],A=a[y+3],(192&(b=a[y+1]))==128&&(192&T)==128&&(192&A)==128&&((k=(15&C)<<18|(63&b)<<12|(63&T)<<6|63&A)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,O=1):k>65535&&(k-=65536,g+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),g+=String.fromCharCode(k),y+=O}return g}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==Mi.Bytes)return o.push(this.readVarint(i));var a=Ta(this);for(o=o||[];this.pos<a;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==Mi.Bytes)return o.push(this.readSVarint());var i=Ta(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Mi.Bytes)return o.push(this.readBoolean());var i=Ta(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Mi.Bytes)return o.push(this.readFloat());var i=Ta(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Mi.Bytes)return o.push(this.readDouble());var i=Ta(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Mi.Bytes)return o.push(this.readFixed32());var i=Ta(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Mi.Bytes)return o.push(this.readSFixed32());var i=Ta(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Mi.Bytes)return o.push(this.readFixed64());var i=Ta(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Mi.Bytes)return o.push(this.readSFixed64());var i=Ta(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===Mi.Varint)for(;this.buf[this.pos++]>127;);else if(i===Mi.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Mi.Fixed32)this.pos+=4;else{if(i!==Mi.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Gu(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Gu(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Gu(this.buf,-1&o,this.pos),Gu(this.buf,Math.floor(o*CE),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Gu(this.buf,-1&o,this.pos),Gu(this.buf,Math.floor(o*CE),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,a){var u,d;if(i>=0?(u=i%4294967296|0,d=i/4294967296|0):(d=~(-i/4294967296),4294967295^(u=~(-i%4294967296))?u=u+1|0:(u=0,d=d+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(g,y,b){b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,b.buf[b.pos]=127&(g>>>=7)}(u,0,a),function(g,y){var b=(7&g)<<4;y.buf[y.pos++]|=b|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(d,a)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(u,d,g){for(var y,b,T=0;T<d.length;T++){if((y=d.charCodeAt(T))>55295&&y<57344){if(!b){y>56319||T+1===d.length?(u[g++]=239,u[g++]=191,u[g++]=189):b=y;continue}if(y<56320){u[g++]=239,u[g++]=191,u[g++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(u[g++]=239,u[g++]=191,u[g++]=189,b=null);y<128?u[g++]=y:(y<2048?u[g++]=y>>6|192:(y<65536?u[g++]=y>>12|224:(u[g++]=y>>18|240,u[g++]=y>>12&63|128),u[g++]=y>>6&63|128),u[g++]=63&y|128)}return g}(this.buf,o,this.pos);var a=this.pos-i;a>=128&&kE(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeFloat:function(o){this.realloc(4),IE(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),IE(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var a=0;a<i;a++)this.buf[this.pos++]=o[a]},writeRawMessage:function(o,i){this.pos++;var a=this.pos;o(i,this);var u=this.pos-a;u>=128&&kE(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u},writeMessage:function(o,i,a){this.writeTag(o,Mi.Bytes),this.writeRawMessage(i,a)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,sR,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,oR,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,cR,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,aR,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,lR,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,uR,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,hR,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,fR,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,dR,i)},writeBytesField:function(o,i){this.writeTag(o,Mi.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,Mi.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,Mi.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,Mi.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,Mi.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,Mi.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,Mi.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,Mi.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,Mi.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,Mi.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,Boolean(i))}};class R0{constructor(i,{pixelRatio:a,version:u,stretchX:d,stretchY:g,content:y}){this.paddedRect=i,this.pixelRatio=a,this.stretchX=d,this.stretchY=g,this.content=y,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class OE{constructor(i,a){const u={},d={};this.haveRenderCallbacks=[];const g=[];this.addImages(i,u,g),this.addImages(a,d,g);const{w:y,h:b}=k0(g),T=new Es({width:y||1,height:b||1});for(const A in i){const C=i[A],k=u[A].paddedRect;Es.copy(C.data,T,{x:0,y:0},{x:k.x+1,y:k.y+1},C.data)}for(const A in a){const C=a[A],k=d[A].paddedRect,O=k.x+1,B=k.y+1,F=C.data.width,j=C.data.height;Es.copy(C.data,T,{x:0,y:0},{x:O,y:B},C.data),Es.copy(C.data,T,{x:0,y:j-1},{x:O,y:B-1},{width:F,height:1}),Es.copy(C.data,T,{x:0,y:0},{x:O,y:B+j},{width:F,height:1}),Es.copy(C.data,T,{x:F-1,y:0},{x:O-1,y:B},{width:1,height:j}),Es.copy(C.data,T,{x:0,y:0},{x:O+F,y:B},{width:1,height:j})}this.image=T,this.iconPositions=u,this.patternPositions=d}addImages(i,a,u){for(const d in i){const g=i[d],y={x:0,y:0,w:g.data.width+2,h:g.data.height+2};u.push(y),a[d]=new R0(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>i.hasImage(u)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in i.updatedImages)this.patchUpdatedImage(this.iconPositions[u],i.getImage(u),a),this.patchUpdatedImage(this.patternPositions[u],i.getImage(u),a)}patchUpdatedImage(i,a,u){if(!i||!a||i.version===a.version)return;i.version=a.version;const[d,g]=i.tl;u.update(a.data,void 0,{x:d,y:g})}}Gt(R0,"ImagePosition"),Gt(OE,"ImageAtlas");const Ns={horizontal:1,vertical:2,horizontalOnly:3};class id{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,a){const u=new id;return u.scale=i||1,u.fontStack=a,u}static forImage(i){const a=new id;return a.imageName=i,a}}class $u{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,a){const u=new $u;for(let d=0;d<i.sections.length;d++){const g=i.sections[d];g.image?u.addImageSection(g):u.addTextSection(g,a)}return u}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(a,u){let d="";for(let g=0;g<a.length;g++){const y=a.charCodeAt(g+1)||null,b=a.charCodeAt(g-1)||null;d+=!u&&(y&&L(y)&&!td[a[g+1]]||b&&L(b)&&!td[a[g-1]])||!td[a[g]]?a[g]:td[a[g]]}return d}(this.text,i)}trim(){let i=0;for(let u=0;u<this.text.length&&ng[this.text.charCodeAt(u)];u++)i++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=i&&ng[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(i,a),this.sectionIndex=this.sectionIndex.slice(i,a)}substring(i,a){const u=new $u;return u.text=this.text.substring(i,a),u.sectionIndex=this.sectionIndex.slice(i,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,a)=>Math.max(i,this.sections[a].scale),0)}addTextSection(i,a){this.text+=i.text,this.sections.push(id.forText(i.scale,i.fontStack||a));const u=this.sections.length-1;for(let d=0;d<i.text.length;++d)this.sectionIndex.push(u)}addImageSection(i){const a=i.image?i.image.name:"";if(a.length===0)return void ue("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(id.forImage(a)),this.sectionIndex.push(this.sections.length-1)):ue("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function O0(o,i,a,u,d,g,y,b,T,A,C,k,O,B,F){const j=$u.fromFeature(o,d);k===Ns.vertical&&j.verticalizePunctuation(O);let K=[];const ce=function(xe,He,je,tt,vt,Xe){if(!xe)return[];const it=[],ot=function(Ct,_n,Bt,Xt,kt,bn){let jn=0;for(let Un=0;Un<Ct.length();Un++){const Nn=Ct.getSection(Un);jn+=DE(Ct.getCharCode(Un),Nn,Xt,kt,_n,bn)}return jn/Math.max(1,Math.ceil(jn/Bt))}(xe,He,je,tt,vt,Xe),mt=xe.text.indexOf("\u200B")>=0;let bt=0;for(let Ct=0;Ct<xe.length();Ct++){const _n=xe.getSection(Ct),Bt=xe.getCharCode(Ct);if(ng[Bt]||(bt+=DE(Bt,_n,tt,vt,He,Xe)),Ct<xe.length()-1){const Xt=!((Ke=Bt)<11904||!(Em(Ke)||Pu(Ke)||m(Ke)||Lm(Ke)||Sm(Ke)||wm(Ke)||Tm(Ke)||ac(Ke)||Mm(Ke)||Rf(Ke)||Am(Ke)||_(Ke)||Mu(Ke)||Lf(Ke)||Cf(Ke)||kf(Ke)||tl(Ke)||lc(Ke)||Im(Ke)||Pm(Ke)));(_R[Bt]||Xt||_n.imageName)&&it.push(BE(Ct+1,bt,ot,it,yR(Bt,xe.getCharCode(Ct+1),Xt&&mt),!1))}}var Ke;return FE(BE(xe.length(),bt,ot,it,0,!0))}(j,A,g,i,u,B),{processBidirectionalText:ve,processStyledBidirectionalText:ae}=Ce;if(ve&&j.sections.length===1){const xe=ve(j.toString(),ce);for(const He of xe){const je=new $u;je.text=He,je.sections=j.sections;for(let tt=0;tt<He.length;tt++)je.sectionIndex.push(0);K.push(je)}}else if(ae){const xe=ae(j.text,j.sectionIndex,ce);for(const He of xe){const je=new $u;je.text=He[0],je.sectionIndex=He[1],je.sections=j.sections,K.push(je)}}else K=function(xe,He){const je=[],tt=xe.text;let vt=0;for(const Xe of He)je.push(xe.substring(vt,Xe)),vt=Xe;return vt<tt.length&&je.push(xe.substring(vt,tt.length)),je}(j,ce);const _e=[],Ee={positionedLines:_e,text:j.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(xe,He,je,tt,vt,Xe,it,ot,mt,bt,Ke,Ct){let _n=0,Bt=0,Xt=0;const kt=ot==="right"?1:ot==="left"?0:.5;let bn=!1;for(const In of vt){const Gn=In.getSections();for(const gi of Gn){if(gi.imageName)continue;const Li=He[gi.fontStack];if(Li&&(bn=Li.ascender!==void 0&&Li.descender!==void 0,!bn))break}if(!bn)break}let jn=0;for(const In of vt){In.trim();const Gn=In.getMaxScale(),gi=(Gn-1)*Vr,Li={positionedGlyphs:[],lineOffset:0};xe.positionedLines[jn]=Li;const Pi=Li.positionedGlyphs;let ki=0;if(!In.length()){Bt+=Xe,++jn;continue}let Fi=0,Xi=0;for(let di=0;di<In.length();di++){const pr=In.getSection(di),cr=In.getSectionIndex(di),oi=In.getCharCode(di);let $i=pr.scale,vr=null,_i=null,tr=null,Xr=Vr,Pr=0;const Ir=!(mt===Ns.horizontal||!Ke&&!P(oi)||Ke&&(ng[oi]||(Un=oi,oc(Un)||bm(Un)||If(Un)||Iu(Un)||f(Un))));if(pr.imageName){const os=tt[pr.imageName];if(!os)continue;tr=pr.imageName,xe.iconsInText=xe.iconsInText||!0,_i=os.paddedRect;const Cr=os.displaySize;$i=$i*Vr/Ct,vr={width:Cr[0],height:Cr[1],left:1,top:-3,advance:Ir?Cr[1]:Cr[0],localGlyph:!1},Pr=bn?-vr.height*$i:Gn*Vr-17-Cr[1]*$i,Xr=vr.advance;const Sa=(Ir?Cr[0]:Cr[1])*$i-Vr*Gn;Sa>0&&Sa>ki&&(ki=Sa)}else{const os=je[pr.fontStack];if(!os)continue;os[oi]&&(_i=os[oi]);const Cr=He[pr.fontStack];if(!Cr)continue;const Sa=Cr.glyphs[oi];if(!Sa)continue;if(vr=Sa.metrics,Xr=oi!==8203?Vr:0,bn){const Xu=Cr.ascender!==void 0?Math.abs(Cr.ascender):0,hd=Cr.descender!==void 0?Math.abs(Cr.descender):0,fd=(Xu+hd)*$i;Fi<fd&&(Fi=fd,Xi=(Xu-hd)/2*$i),Pr=-Xu*$i}else Pr=(Gn-$i)*Vr-17}Ir?(xe.verticalizable=!0,Pi.push({glyph:oi,imageName:tr,x:_n,y:Bt+Pr,vertical:Ir,scale:$i,localGlyph:vr.localGlyph,fontStack:pr.fontStack,sectionIndex:cr,metrics:vr,rect:_i}),_n+=Xr*$i+bt):(Pi.push({glyph:oi,imageName:tr,x:_n,y:Bt+Pr,vertical:Ir,scale:$i,localGlyph:vr.localGlyph,fontStack:pr.fontStack,sectionIndex:cr,metrics:vr,rect:_i}),_n+=vr.advance*$i+bt)}Pi.length!==0&&(Xt=Math.max(_n-bt,Xt),bn?NE(Pi,kt,ki,Xi,Xe*Gn/2):NE(Pi,kt,ki,0,Xe/2)),_n=0;const Mr=Xe*Gn+ki;Li.lineOffset=Math.max(ki,gi),Bt+=Mr,++jn}var Un;const Nn=Bt,{horizontalAlign:En,verticalAlign:fi}=D0(it);(function(In,Gn,gi,Li,Pi,ki){const Fi=(Gn-gi)*Pi,Xi=-ki*Li;for(const Mr of In)for(const di of Mr.positionedGlyphs)di.x+=Fi,di.y+=Xi})(xe.positionedLines,kt,En,fi,Xt,Nn),xe.top+=-fi*Nn,xe.bottom=xe.top+Nn,xe.left+=-En*Xt,xe.right=xe.left+Xt,xe.hasBaseline=bn}(Ee,i,a,u,K,y,b,T,k,A,O,F),!function(xe){for(const He of xe)if(He.positionedGlyphs.length!==0)return!1;return!0}(_e)&&Ee}const ng={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_R={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function DE(o,i,a,u,d,g){if(i.imageName){const y=u[i.imageName];return y?y.displaySize[0]*i.scale*Vr/g+d:0}{const y=a[i.fontStack],b=y&&y.glyphs[o];return b?b.metrics.advance*i.scale+d:0}}function zE(o,i,a,u){const d=Math.pow(o-i,2);return u?o<i?d/2:2*d:d+Math.abs(a)*a}function yR(o,i,a){let u=0;return o===10&&(u-=1e4),a&&(u+=150),o!==40&&o!==65288||(u+=50),i!==41&&i!==65289||(u+=50),u}function BE(o,i,a,u,d,g){let y=null,b=zE(i,a,d,g);for(const T of u){const A=zE(i-T.x,a,d,g)+T.badness;A<=b&&(y=T,b=A)}return{index:o,x:i,priorBreak:y,badness:b}}function FE(o){return o?FE(o.priorBreak).concat(o.index):[]}function D0(o){let i=.5,a=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:i,verticalAlign:a}}function NE(o,i,a,u,d){if(!(i||a||u||d))return;const g=o.length-1,y=o[g],b=(y.x+y.metrics.advance*y.scale)*i;for(let T=0;T<=g;T++)o[T].x-=b,o[T].y+=a+u+d}function vR(o,i,a){const{horizontalAlign:u,verticalAlign:d}=D0(a),g=i[0]-o.displaySize[0]*u,y=i[1]-o.displaySize[1]*d;return{image:o,top:y,bottom:y+o.displaySize[1],left:g,right:g+o.displaySize[0]}}function UE(o,i,a,u,d,g){const y=o.image;let b;if(y.content){const K=y.content,ce=y.pixelRatio||1;b=[K[0]/ce,K[1]/ce,y.displaySize[0]-K[2]/ce,y.displaySize[1]-K[3]/ce]}const T=i.left*g,A=i.right*g;let C,k,O,B;a==="width"||a==="both"?(B=d[0]+T-u[3],k=d[0]+A+u[1]):(B=d[0]+(T+A-y.displaySize[0])/2,k=B+y.displaySize[0]);const F=i.top*g,j=i.bottom*g;return a==="height"||a==="both"?(C=d[1]+F-u[0],O=d[1]+j+u[2]):(C=d[1]+(F+j-y.displaySize[1])/2,O=C+y.displaySize[1]),{image:y,top:C,right:k,bottom:O,left:B,collisionPadding:b}}class Aa extends ge{constructor(i,a,u,d,g){super(i,a),this.angle=d,this.z=u,g!==void 0&&(this.segment=g)}clone(){return new Aa(this.x,this.y,this.z,this.angle,this.segment)}}function VE(o,i,a,u,d){if(i.segment===void 0)return!0;let g=i,y=i.segment+1,b=0;for(;b>-a/2;){if(y--,y<0)return!1;b-=o[y].dist(g),g=o[y]}b+=o[y].dist(o[y+1]),y++;const T=[];let A=0;for(;b<a/2;){const C=o[y],k=o[y+1];if(!k)return!1;let O=o[y-1].angleTo(C)-C.angleTo(k);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:O}),A+=O;b-T[0].distance>u;)A-=T.shift().angleDelta;if(A>d)return!1;y++,b+=C.dist(k)}return!0}function jE(o){let i=0;for(let a=0;a<o.length-1;a++)i+=o[a].dist(o[a+1]);return i}function GE(o,i,a){return o?.6*i*a:0}function $E(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function xR(o,i,a,u,d,g){const y=GE(a,d,g),b=$E(a,u)*g;let T=0;const A=jE(o)/2;for(let C=0;C<o.length-1;C++){const k=o[C],O=o[C+1],B=k.dist(O);if(T+B>A){const F=(A-T)/B,j=Qn(k.x,O.x,F),K=Qn(k.y,O.y,F),ce=new Aa(j,K,0,O.angleTo(k),C);return!y||VE(o,ce,b,y,i)?ce:void 0}T+=B}}function bR(o,i,a,u,d,g,y,b,T){const A=GE(u,g,y),C=$E(u,d),k=C*y,O=o[0].x===0||o[0].x===T||o[0].y===0||o[0].y===T;return i-k<i/4&&(i=k+i/4),HE(o,O?i/2*b%i:(C/2+2*g)*y*b%i,i,A,a,k,O,!1,T)}function HE(o,i,a,u,d,g,y,b,T){const A=g/2,C=jE(o);let k=0,O=i-a,B=[];for(let F=0;F<o.length-1;F++){const j=o[F],K=o[F+1],ce=j.dist(K),ve=K.angleTo(j);for(;O+a<k+ce;){O+=a;const ae=(O-k)/ce,_e=Qn(j.x,K.x,ae),Ee=Qn(j.y,K.y,ae);if(_e>=0&&_e<T&&Ee>=0&&Ee<T&&O-A>=0&&O+A<=C){const xe=new Aa(_e,Ee,0,ve,F);xe._round(),u&&!VE(o,xe,g,u,d)||B.push(xe)}}k+=ce}return b||B.length||y||(B=HE(o,k/2,a,u,d,g,y,!0,T)),B}function WE(o,i,a,u,d){const g=[];for(let y=0;y<o.length;y++){const b=o[y];let T;for(let A=0;A<b.length-1;A++){let C=b[A],k=b[A+1];C.x<i&&k.x<i||(C.x<i?C=new ge(i,C.y+(i-C.x)/(k.x-C.x)*(k.y-C.y))._round():k.x<i&&(k=new ge(i,C.y+(i-C.x)/(k.x-C.x)*(k.y-C.y))._round()),C.y<a&&k.y<a||(C.y<a?C=new ge(C.x+(a-C.y)/(k.y-C.y)*(k.x-C.x),a)._round():k.y<a&&(k=new ge(C.x+(a-C.y)/(k.y-C.y)*(k.x-C.x),a)._round()),C.x>=u&&k.x>=u||(C.x>=u?C=new ge(u,C.y+(u-C.x)/(k.x-C.x)*(k.y-C.y))._round():k.x>=u&&(k=new ge(u,C.y+(u-C.x)/(k.x-C.x)*(k.y-C.y))._round()),C.y>=d&&k.y>=d||(C.y>=d?C=new ge(C.x+(d-C.y)/(k.y-C.y)*(k.x-C.x),d)._round():k.y>=d&&(k=new ge(C.x+(d-C.y)/(k.y-C.y)*(k.x-C.x),d)._round()),T&&C.equals(T[T.length-1])||(T=[C],g.push(T)),T.push(k)))))}}return g}Gt(Aa,"Anchor");const rd=1e20;function qE(o,i,a,u,d,g,y,b,T){for(let A=i;A<i+u;A++)ZE(o,a*g+A,g,d,y,b,T);for(let A=a;A<a+d;A++)ZE(o,A*g+i,1,u,y,b,T)}function ZE(o,i,a,u,d,g,y){g[0]=0,y[0]=-rd,y[1]=rd,d[0]=o[i];for(let b=1,T=0,A=0;b<u;b++){d[b]=o[i+b*a];const C=b*b;do{const k=g[T];A=(d[b]-d[k]+C-k*k)/(b-k)/2}while(A<=y[T]&&--T>-1);T++,g[T]=b,y[T]=A,y[T+1]=rd}for(let b=0,T=0;b<u;b++){for(;y[T+1]<b;)T++;const A=g[T],C=b-A;o[i+b*a]=d[A]+C*C}}const z0={none:0,ideographs:1,all:2};class Hu{constructor(i,a,u){this.requestManager=i,this.localGlyphMode=a,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,a){const u=[];for(const d in i)for(const g of i[d])u.push({stack:d,id:g});vn(u,({stack:d,id:g},y)=>{let b=this.entries[d];b||(b=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=b.glyphs[g];if(T!==void 0)return void y(null,{stack:d,id:g,glyph:T});if(T=this._tinySDF(b,d,g),T)return b.glyphs[g]=T,void y(null,{stack:d,id:g,glyph:T});const A=Math.floor(g/256);if(256*A>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[A])return void y(null,{stack:d,id:g,glyph:T});let C=b.requests[A];C||(C=b.requests[A]=[],Hu.loadGlyphRange(d,A,this.url,this.requestManager,(k,O)=>{if(O){b.ascender=O.ascender,b.descender=O.descender;for(const B in O.glyphs)this._doesCharSupportLocalGlyph(+B)||(b.glyphs[+B]=O.glyphs[+B]);b.ranges[A]=!0}for(const B of C)B(k,O);delete b.requests[A]})),C.push((k,O)=>{k?y(k):O&&y(null,{stack:d,id:g,glyph:O.glyphs[g]||null})})},(d,g)=>{if(d)a(d);else if(g){const y={};for(const{stack:b,id:T,glyph:A}of g)y[b]===void 0&&(y[b]={}),y[b].glyphs===void 0&&(y[b].glyphs={}),y[b].glyphs[T]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;a(null,y)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==z0.none&&(this.localGlyphMode===z0.all?!!this.localFontFamily:!!this.localFontFamily&&(Rf(i)||Cm(i)||Mu(i)||tl(i)||ac(i)))}_tinySDF(i,a,u){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let g=i.tinySDF;if(!g){let j="400";/bold/i.test(a)?j="900":/medium/i.test(a)?j="500":/light/i.test(a)&&(j="200"),g=i.tinySDF=new Hu.TinySDF({fontFamily:d,fontWeight:j,fontSize:48,buffer:6,radius:16}),g.fontWeight=j}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const y=String.fromCharCode(u),{data:b,width:T,height:A,glyphWidth:C,glyphHeight:k,glyphLeft:O,glyphTop:B,glyphAdvance:F}=g.draw(y);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new Ea({width:T,height:A},b),metrics:{width:C/2,height:k/2,left:O/2,top:B/2-27,advance:F/2,localGlyph:!0}}}}function XE(o,i,a,u){const d=[],g=o.image,y=g.pixelRatio,b=g.paddedRect.w-2,T=g.paddedRect.h-2,A=o.right-o.left,C=o.bottom-o.top,k=g.stretchX||[[0,b]],O=g.stretchY||[[0,T]],B=(Xe,it)=>Xe+it[1]-it[0],F=k.reduce(B,0),j=O.reduce(B,0),K=b-F,ce=T-j;let ve=0,ae=F,_e=0,Ee=j,xe=0,He=K,je=0,tt=ce;if(g.content&&u){const Xe=g.content;ve=ig(k,0,Xe[0]),_e=ig(O,0,Xe[1]),ae=ig(k,Xe[0],Xe[2]),Ee=ig(O,Xe[1],Xe[3]),xe=Xe[0]-ve,je=Xe[1]-_e,He=Xe[2]-Xe[0]-ae,tt=Xe[3]-Xe[1]-Ee}const vt=(Xe,it,ot,mt)=>{const bt=rg(Xe.stretch-ve,ae,A,o.left),Ke=sg(Xe.fixed-xe,He,Xe.stretch,F),Ct=rg(it.stretch-_e,Ee,C,o.top),_n=sg(it.fixed-je,tt,it.stretch,j),Bt=rg(ot.stretch-ve,ae,A,o.left),Xt=sg(ot.fixed-xe,He,ot.stretch,F),kt=rg(mt.stretch-_e,Ee,C,o.top),bn=sg(mt.fixed-je,tt,mt.stretch,j),jn=new ge(bt,Ct),Un=new ge(Bt,Ct),Nn=new ge(Bt,kt),En=new ge(bt,kt),fi=new ge(Ke/y,_n/y),In=new ge(Xt/y,bn/y),Gn=i*Math.PI/180;if(Gn){const Pi=Math.sin(Gn),ki=Math.cos(Gn),Fi=[ki,-Pi,Pi,ki];jn._matMult(Fi),Un._matMult(Fi),En._matMult(Fi),Nn._matMult(Fi)}const gi=Xe.stretch+Xe.fixed,Li=it.stretch+it.fixed;return{tl:jn,tr:Un,bl:En,br:Nn,tex:{x:g.paddedRect.x+1+gi,y:g.paddedRect.y+1+Li,w:ot.stretch+ot.fixed-gi,h:mt.stretch+mt.fixed-Li},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fi,pixelOffsetBR:In,minFontScaleX:He/y/A,minFontScaleY:tt/y/C,isSDF:a}};if(u&&(g.stretchX||g.stretchY)){const Xe=YE(k,K,F),it=YE(O,ce,j);for(let ot=0;ot<Xe.length-1;ot++){const mt=Xe[ot],bt=Xe[ot+1];for(let Ke=0;Ke<it.length-1;Ke++)d.push(vt(mt,it[Ke],bt,it[Ke+1]))}}else d.push(vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return d}function ig(o,i,a){let u=0;for(const d of o)u+=Math.max(i,Math.min(a,d[1]))-Math.max(i,Math.min(a,d[0]));return u}function YE(o,i,a){const u=[{fixed:-1,stretch:0}];for(const[d,g]of o){const y=u[u.length-1];u.push({fixed:d-y.stretch,stretch:y.stretch}),u.push({fixed:d-y.stretch,stretch:y.stretch+(g-d)})}return u.push({fixed:i+1,stretch:a}),u}function rg(o,i,a,u){return o/i*a+u}function sg(o,i,a,u){return o-i*a/u}function wR(o,i,a,u){const d=i+o.positionedLines[u].lineOffset;return u===0?a+d/2:a+(d+(i+o.positionedLines[u-1].lineOffset))/2}Hu.loadGlyphRange=function(o,i,a,u,d){const g=256*i,y=g+255,b=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",o).replace("{range}",`${g}-${y}`),gt.Glyphs);$n(b,(T,A)=>{if(T)d(T);else if(A){const C={},k=function(O){return new nd(O).readFields(pR,{})}(A);for(const O of k.glyphs)C[O.id]=O;d(null,{glyphs:C,ascender:k.ascender,descender:k.descender})}})},Hu.TinySDF=class{constructor({fontSize:o=24,buffer:i=3,radius:a=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:y="normal"}={}){this.buffer=i,this.cutoff=u,this.radius=a;const b=this.size=o+4*i,T=this._createCanvas(b),A=this.ctx=T.getContext("2d",{willReadFrequently:!0});A.font=`${y} ${g} ${o}px ${d}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(o){const i=document.createElement("canvas");return i.width=i.height=o,i}draw(o){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(o),y=Math.ceil(a),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),T=Math.min(this.size-this.buffer,y+Math.ceil(u)),A=b+2*this.buffer,C=T+2*this.buffer,k=Math.max(A*C,0),O=new Uint8ClampedArray(k),B={data:O,width:A,height:C,glyphWidth:b,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:i};if(b===0||T===0)return B;const{ctx:F,buffer:j,gridInner:K,gridOuter:ce}=this;F.clearRect(j,j,b,T),F.fillText(o,j,j+y);const ve=F.getImageData(j,j,b,T);ce.fill(rd,0,k),K.fill(0,0,k);for(let ae=0;ae<T;ae++)for(let _e=0;_e<b;_e++){const Ee=ve.data[4*(ae*b+_e)+3]/255;if(Ee===0)continue;const xe=(ae+j)*A+_e+j;if(Ee===1)ce[xe]=0,K[xe]=rd;else{const He=.5-Ee;ce[xe]=He>0?He*He:0,K[xe]=He<0?He*He:0}}qE(ce,0,0,A,C,A,this.f,this.v,this.z),qE(K,j,j,b,T,A,this.f,this.v,this.z);for(let ae=0;ae<k;ae++){const _e=Math.sqrt(ce[ae])-Math.sqrt(K[ae]);O[ae]=Math.round(255-255*(_e/this.radius+this.cutoff))}return B}};class ER{constructor(i=[],a=TR){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:a,compare:u}=this,d=a[i];for(;i>0;){const g=i-1>>1,y=a[g];if(u(d,y)>=0)break;a[i]=y,i=g}a[i]=d}_down(i){const{data:a,compare:u}=this,d=this.length>>1,g=a[i];for(;i<d;){let y=1+(i<<1),b=a[y];const T=y+1;if(T<this.length&&u(a[T],b)<0&&(y=T,b=a[T]),u(b,g)>=0)break;a[i]=b,i=y}a[i]=g}}function TR(o,i){return o<i?-1:o>i?1:0}function AR(o,i=1,a=!1){let u=1/0,d=1/0,g=-1/0,y=-1/0;const b=o[0];for(let B=0;B<b.length;B++){const F=b[B];(!B||F.x<u)&&(u=F.x),(!B||F.y<d)&&(d=F.y),(!B||F.x>g)&&(g=F.x),(!B||F.y>y)&&(y=F.y)}const T=Math.min(g-u,y-d);let A=T/2;const C=new ER([],SR);if(T===0)return new ge(u,d);for(let B=u;B<g;B+=T)for(let F=d;F<y;F+=T)C.push(new Wu(B+A,F+A,A,o));let k=function(B){let F=0,j=0,K=0;const ce=B[0];for(let ve=0,ae=ce.length,_e=ae-1;ve<ae;_e=ve++){const Ee=ce[ve],xe=ce[_e],He=Ee.x*xe.y-xe.x*Ee.y;j+=(Ee.x+xe.x)*He,K+=(Ee.y+xe.y)*He,F+=3*He}return new Wu(j/F,K/F,0,B)}(o),O=C.length;for(;C.length;){const B=C.pop();(B.d>k.d||!k.d)&&(k=B,a&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,O)),B.max-k.d<=i||(A=B.h/2,C.push(new Wu(B.p.x-A,B.p.y-A,A,o)),C.push(new Wu(B.p.x+A,B.p.y-A,A,o)),C.push(new Wu(B.p.x-A,B.p.y+A,A,o)),C.push(new Wu(B.p.x+A,B.p.y+A,A,o)),O+=4)}return a&&(console.log(`num probes: ${O}`),console.log(`best distance: ${k.d}`)),k.p}function SR(o,i){return i.max-o.max}function Wu(o,i,a,u){this.p=new ge(o,i),this.h=a,this.d=function(d,g){let y=!1,b=1/0;for(let T=0;T<g.length;T++){const A=g[T];for(let C=0,k=A.length,O=k-1;C<k;O=C++){const B=A[C],F=A[O];B.y>d.y!=F.y>d.y&&d.x<(F.x-B.x)*(d.y-B.y)/(F.y-B.y)+B.x&&(y=!y),b=Math.min(b,Zw(d,B,F))}}return(y?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const B0=Number.POSITIVE_INFINITY,MR=Math.sqrt(2);function KE(o,[i,a]){let u=0,d=0;if(a===B0){i<0&&(i=0);const g=i/MR;switch(o){case"top-right":case"top-left":d=g-7;break;case"bottom-right":case"bottom-left":d=7-g;break;case"bottom":d=7-i;break;case"top":d=i-7}switch(o){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=i;break;case"right":u=-i}}else{switch(i=Math.abs(i),a=Math.abs(a),o){case"top-right":case"top-left":case"top":d=a-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-a}switch(o){case"top-right":case"bottom-right":case"right":u=-i;break;case"top-left":case"bottom-left":case"left":u=i}}return[u,d]}function PR(o,i,a,u,d,g,y,b,T,A){o.createArrays(),o.tilePixelRatio=Tn/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const C=o.layers[0].layout,k=o.layers[0]._unevaluatedLayout._values,O={};if(o.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:K}=o.textSizeData;O.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Be(j),b),k["text-size"].possiblyEvaluate(new Be(K),b)]}if(o.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:K}=o.iconSizeData;O.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Be(j),b),k["icon-size"].possiblyEvaluate(new Be(K),b)]}O.layoutTextSize=k["text-size"].possiblyEvaluate(new Be(T+1),b),O.layoutIconSize=k["icon-size"].possiblyEvaluate(new Be(T+1),b),O.textMaxSize=k["text-size"].possiblyEvaluate(new Be(18),b);const B=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",F=C.get("text-size");for(const j of o.features){const K=C.get("text-font").evaluate(j,{},b).join(","),ce=F.evaluate(j,{},b),ve=O.layoutTextSize.evaluate(j,{},b),ae=(O.layoutIconSize.evaluate(j,{},b),{horizontal:{},vertical:void 0}),_e=j.text;let Ee,xe=[0,0];if(_e){const tt=_e.toString(),vt=C.get("text-letter-spacing").evaluate(j,{},b)*Vr,Xe=C.get("text-line-height").evaluate(j,{},b)*Vr,it=w(tt)?vt:0,ot=C.get("text-anchor").evaluate(j,{},b),mt=C.get("text-variable-anchor");if(!mt){const Bt=C.get("text-radial-offset").evaluate(j,{},b);xe=Bt?KE(ot,[Bt*Vr,B0]):C.get("text-offset").evaluate(j,{},b).map(Xt=>Xt*Vr)}let bt=B?"center":C.get("text-justify").evaluate(j,{},b);const Ke=C.get("symbol-placement")==="point",Ct=Ke?C.get("text-max-width").evaluate(j,{},b)*Vr:1/0,_n=Bt=>{o.allowVerticalPlacement&&x(tt)&&(ae.vertical=O0(_e,i,a,d,K,Ct,Xe,ot,Bt,it,xe,Ns.vertical,!0,ve,ce))};if(!B&&mt){const Bt=bt==="auto"?mt.map(kt=>F0(kt)):[bt];let Xt=!1;for(let kt=0;kt<Bt.length;kt++){const bn=Bt[kt];if(!ae.horizontal[bn])if(Xt)ae.horizontal[bn]=ae.horizontal[0];else{const jn=O0(_e,i,a,d,K,Ct,Xe,"center",bn,it,xe,Ns.horizontal,!1,ve,ce);jn&&(ae.horizontal[bn]=jn,Xt=jn.positionedLines.length===1)}}_n("left")}else{if(bt==="auto"&&(bt=F0(ot)),Ke||C.get("text-writing-mode").indexOf("horizontal")>=0||!x(tt)){const Bt=O0(_e,i,a,d,K,Ct,Xe,ot,bt,it,xe,Ns.horizontal,!1,ve,ce);Bt&&(ae.horizontal[bt]=Bt)}_n(Ke?"left":bt)}}let He=!1;if(j.icon&&j.icon.name){const tt=u[j.icon.name];tt&&(Ee=vR(d[j.icon.name],C.get("icon-offset").evaluate(j,{},b),C.get("icon-anchor").evaluate(j,{},b)),He=tt.sdf,o.sdfIcons===void 0?o.sdfIcons=tt.sdf:o.sdfIcons!==tt.sdf&&ue("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==o.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}const je=QE(ae.horizontal)||ae.vertical;o.iconsInText||(o.iconsInText=!!je&&je.iconsInText),(je||Ee)&&IR(o,j,ae,Ee,u,O,ve,0,xe,He,y,b,A)}g&&o.generateCollisionDebugBuffers(T,o.collisionBoxArray)}function F0(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function IR(o,i,a,u,d,g,y,b,T,A,C,k,O){let B=g.textMaxSize.evaluate(i,{},k);B===void 0&&(B=y);const F=o.layers[0].layout,j=F.get("icon-offset").evaluate(i,{},k),K=QE(a.horizontal)||a.vertical,ce=O.name==="globe",ve=y/24,ae=o.tilePixelRatio*B/24,_e=(it=o.overscaling,o.zoom>18&&it>2&&(it>>=1),Math.max(Tn/(512*it),1)*F.get("symbol-spacing")),Ee=F.get("text-padding")*o.tilePixelRatio,xe=F.get("icon-padding")*o.tilePixelRatio,He=ke(F.get("text-max-angle")),je=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",tt=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",vt=F.get("symbol-placement"),Xe=_e/2;var it;const ot=F.get("icon-text-fit");let mt;u&&ot!=="none"&&(o.allowVerticalPlacement&&a.vertical&&(mt=UE(u,a.vertical,ot,F.get("icon-text-fit-padding"),j,ve)),K&&(u=UE(u,K,ot,F.get("icon-text-fit-padding"),j,ve)));const bt=(Ke,Ct,_n)=>{if(Ct.x<0||Ct.x>=Tn||Ct.y<0||Ct.y>=Tn)return;let Bt=null;if(ce){const{x:Xt,y:kt,z:bn}=O.projectTilePoint(Ct.x,Ct.y,_n);Bt={anchor:new Aa(Xt,kt,bn,0,void 0),up:O.upVector(_n,Ct.x,Ct.y)}}(function(Xt,kt,bn,jn,Un,Nn,En,fi,In,Gn,gi,Li,Pi,ki,Fi,Xi,Mr,di,pr,cr,oi,$i,vr,_i,tr){const Xr=Xt.addToLineVertexArray(kt,jn);let Pr,Ir,os,Cr,Sa,Xu,hd,fd=0,PT=0,IT=0,CT=0,Y0=-1,K0=-1;const Ko={};let LT=cc("");const bc=bn?bn.anchor:kt;let J0=0,Q0=0;if(In._unevaluatedLayout.getValue("text-radial-offset")===void 0?[J0,Q0]=In.layout.get("text-offset").evaluate(oi,{},tr).map(Ts=>Ts*Vr):(J0=In.layout.get("text-radial-offset").evaluate(oi,{},tr)*Vr,Q0=B0),Xt.allowVerticalPlacement&&Un.vertical){const Ts=Un.vertical;if(Fi)Xu=N0(Ts),fi&&(hd=N0(fi));else{const As=In.layout.get("text-rotate").evaluate(oi,{},tr)+90;os=og(Gn,bc,kt,gi,Li,Pi,Ts,ki,As,Xi),fi&&(Cr=og(Gn,bc,kt,gi,Li,Pi,fi,di,As))}}if(Nn){const Ts=In.layout.get("icon-rotate").evaluate(oi,{},tr),As=In.layout.get("icon-text-fit")!=="none",dd=XE(Nn,Ts,vr,As),tv=fi?XE(fi,Ts,vr,As):void 0;Ir=og(Gn,bc,kt,gi,Li,Pi,Nn,di,Ts),fd=4*dd.length;const kT=Xt.iconSizeData;let wc=null;kT.kind==="source"?(wc=[qo*In.layout.get("icon-size").evaluate(oi,{},tr)],wc[0]>al&&ue(`${Xt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):kT.kind==="composite"&&(wc=[qo*$i.compositeIconSizes[0].evaluate(oi,{},tr),qo*$i.compositeIconSizes[1].evaluate(oi,{},tr)],(wc[0]>al||wc[1]>al)&&ue(`${Xt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Xt.addSymbols(Xt.icon,dd,wc,cr,pr,oi,!1,bn,kt,Xr.lineStartIndex,Xr.lineLength,-1,_i,tr),Y0=Xt.icon.placedSymbolArray.length-1,tv&&(PT=4*tv.length,Xt.addSymbols(Xt.icon,tv,wc,cr,pr,oi,Ns.vertical,bn,kt,Xr.lineStartIndex,Xr.lineLength,-1,_i,tr),K0=Xt.icon.placedSymbolArray.length-1)}for(const Ts in Un.horizontal){const As=Un.horizontal[Ts];Pr||(LT=cc(As.text),Fi?Sa=N0(As):Pr=og(Gn,bc,kt,gi,Li,Pi,As,ki,In.layout.get("text-rotate").evaluate(oi,{},tr),Xi));const dd=As.positionedLines.length===1;if(IT+=JE(Xt,bn,kt,As,En,In,Fi,oi,Xi,Xr,Un.vertical?Ns.horizontal:Ns.horizontalOnly,dd?Object.keys(Un.horizontal):[Ts],Ko,Y0,$i,_i,tr),dd)break}Un.vertical&&(CT+=JE(Xt,bn,kt,Un.vertical,En,In,Fi,oi,Xi,Xr,Ns.vertical,["vertical"],Ko,K0,$i,_i,tr));let dl=-1;const ev=(Ts,As)=>Ts?Math.max(Ts,As):As;dl=ev(Sa,dl),dl=ev(Xu,dl),dl=ev(hd,dl);const tO=dl>-1?1:0;Xt.glyphOffsetArray.length>=cl.MAX_GLYPHS&&ue("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),oi.sortKey!==void 0&&Xt.addToSortKeyRanges(Xt.symbolInstances.length,oi.sortKey),Xt.symbolInstances.emplaceBack(bc.x,bc.y,bc.z,kt.x,kt.y,Ko.right>=0?Ko.right:-1,Ko.center>=0?Ko.center:-1,Ko.left>=0?Ko.left:-1,Ko.vertical>=0?Ko.vertical:-1,Y0,K0,LT,Pr!==void 0?Pr:Xt.collisionBoxArray.length,Pr!==void 0?Pr+1:Xt.collisionBoxArray.length,os!==void 0?os:Xt.collisionBoxArray.length,os!==void 0?os+1:Xt.collisionBoxArray.length,Ir!==void 0?Ir:Xt.collisionBoxArray.length,Ir!==void 0?Ir+1:Xt.collisionBoxArray.length,Cr||Xt.collisionBoxArray.length,Cr?Cr+1:Xt.collisionBoxArray.length,gi,IT,CT,fd,PT,tO,0,J0,Q0,dl)})(o,Ct,Bt,Ke,a,u,d,mt,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,Ee,je,T,0,xe,tt,j,i,g,A,C,k)};if(vt==="line")for(const Ke of WE(i.geometry,0,0,Tn,Tn)){const Ct=bR(Ke,_e,He,a.vertical||K,u,24,ae,o.overscaling,Tn);for(const _n of Ct){const Bt=K;Bt&&CR(o,Bt.text,Xe,_n)||bt(Ke,_n,k)}}else if(vt==="line-center"){for(const Ke of i.geometry)if(Ke.length>1){const Ct=xR(Ke,He,a.vertical||K,u,24,ae);Ct&&bt(Ke,Ct,k)}}else if(i.type==="Polygon")for(const Ke of S0(i.geometry,0)){const Ct=AR(Ke,16);bt(Ke[0],new Aa(Ct.x,Ct.y,0,0,void 0),k)}else if(i.type==="LineString")for(const Ke of i.geometry)bt(Ke,new Aa(Ke[0].x,Ke[0].y,0,0,void 0),k);else if(i.type==="Point")for(const Ke of i.geometry)for(const Ct of Ke)bt([Ct],new Aa(Ct.x,Ct.y,0,0,void 0),k)}const al=32640;function JE(o,i,a,u,d,g,y,b,T,A,C,k,O,B,F,j,K){const ce=function(_e,Ee,xe,He,je,tt,vt,Xe){const it=[];if(Ee.positionedLines.length===0)return it;const ot=He.layout.get("text-rotate").evaluate(tt,{})*Math.PI/180,mt=function(Bt){const Xt=Bt[0],kt=Bt[1],bn=Xt*kt;return bn>0?[Xt,-kt]:bn<0?[-Xt,kt]:Xt===0?[kt,Xt]:[kt,-Xt]}(xe);let bt=Math.abs(Ee.top-Ee.bottom);for(const Bt of Ee.positionedLines)bt-=Bt.lineOffset;const Ke=Ee.positionedLines.length,Ct=bt/Ke;let _n=Ee.top-xe[1];for(let Bt=0;Bt<Ke;++Bt){const Xt=Ee.positionedLines[Bt];_n=wR(Ee,Ct,_n,Bt);for(const kt of Xt.positionedGlyphs){if(!kt.rect)continue;const bn=kt.rect||{};let jn=4,Un=!0,Nn=1,En=0;if(kt.imageName){const _i=vt[kt.imageName];if(!_i)continue;if(_i.sdf){ue("SDF images are not supported in formatted text and will be ignored.");continue}Un=!1,Nn=_i.pixelRatio,jn=1/Nn}const fi=(je||Xe)&&kt.vertical,In=kt.metrics.advance*kt.scale/2,Gn=kt.metrics,gi=kt.rect;if(gi===null)continue;Xe&&Ee.verticalizable&&(En=kt.imageName?In-kt.metrics.width*kt.scale/2:0);const Li=je?[kt.x+In,kt.y]:[0,0];let Pi=[0,0],ki=[0,0],Fi=!1;je||(fi?(ki=[kt.x+In+mt[0],kt.y+mt[1]-En],Fi=!0):Pi=[kt.x+In+xe[0],kt.y+xe[1]-En]);const Xi=gi.w*kt.scale/(Nn*(kt.localGlyph?2:1)),Mr=gi.h*kt.scale/(Nn*(kt.localGlyph?2:1));let di,pr,cr,oi;if(fi){const _i=kt.y-_n,tr=new ge(-In,In-_i),Xr=-Math.PI/2,Pr=new ge(...ki);di=new ge(-In+Pi[0],Pi[1]),di._rotateAround(Xr,tr)._add(Pr),di.x+=-_i+In,di.y-=(Gn.left-jn)*kt.scale;const Ir=kt.imageName?Gn.advance*kt.scale:Vr*kt.scale,os=String.fromCharCode(kt.glyph);iR(os)?di.x+=(1-jn)*kt.scale:rR(os)?di.x+=Ir-Gn.height*kt.scale+(-jn-1)*kt.scale:di.x+=kt.imageName||Gn.width+2*jn===gi.w&&Gn.height+2*jn===gi.h?(Ir-Mr)/2:(Ir-(Gn.height+2*jn)*kt.scale)/2,pr=new ge(di.x,di.y-Xi),cr=new ge(di.x+Mr,di.y),oi=new ge(di.x+Mr,di.y-Xi)}else{const _i=(Gn.left-jn)*kt.scale-In+Pi[0],tr=(-Gn.top-jn)*kt.scale+Pi[1],Xr=_i+Xi,Pr=tr+Mr;di=new ge(_i,tr),pr=new ge(Xr,tr),cr=new ge(_i,Pr),oi=new ge(Xr,Pr)}if(ot){let _i;_i=je?new ge(0,0):Fi?new ge(mt[0],mt[1]):new ge(xe[0],xe[1]),di._rotateAround(ot,_i),pr._rotateAround(ot,_i),cr._rotateAround(ot,_i),oi._rotateAround(ot,_i)}const $i=new ge(0,0),vr=new ge(0,0);it.push({tl:di,tr:pr,bl:cr,br:oi,tex:bn,writingMode:Ee.writingMode,glyphOffset:Li,sectionIndex:kt.sectionIndex,isSDF:Un,pixelOffsetTL:$i,pixelOffsetBR:vr,minFontScaleX:0,minFontScaleY:0})}}return it}(0,u,T,g,y,b,d,o.allowVerticalPlacement),ve=o.textSizeData;let ae=null;ve.kind==="source"?(ae=[qo*g.layout.get("text-size").evaluate(b,{},K)],ae[0]>al&&ue(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ve.kind==="composite"&&(ae=[qo*F.compositeTextSizes[0].evaluate(b,{},K),qo*F.compositeTextSizes[1].evaluate(b,{},K)],(ae[0]>al||ae[1]>al)&&ue(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,ce,ae,T,y,b,C,i,a,A.lineStartIndex,A.lineLength,B,j,K);for(const _e of k)O[_e]=o.text.placedSymbolArray.length-1;return 4*ce.length}function QE(o){for(const i in o)return o[i];return null}function og(o,i,a,u,d,g,y,b,T,A){let C=y.top,k=y.bottom,O=y.left,B=y.right;const F=y.collisionPadding;if(F&&(O-=F[0],C-=F[1],B+=F[2],k+=F[3]),T){const j=new ge(O,C),K=new ge(B,C),ce=new ge(O,k),ve=new ge(B,k),ae=ke(T);let _e=new ge(0,0);A&&(_e=new ge(A[0],A[1])),j._rotateAround(ae,_e),K._rotateAround(ae,_e),ce._rotateAround(ae,_e),ve._rotateAround(ae,_e),O=Math.min(j.x,K.x,ce.x,ve.x),B=Math.max(j.x,K.x,ce.x,ve.x),C=Math.min(j.y,K.y,ce.y,ve.y),k=Math.max(j.y,K.y,ce.y,ve.y)}return o.emplaceBack(i.x,i.y,i.z,a.x,a.y,O,C,B,k,b,u,d,g),o.length-1}function N0(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const i=o.bottom-o.top;return i>0?Math.max(10,i):null}function CR(o,i,a,u){const d=o.compareText;if(i in d){const g=d[i];for(let y=g.length-1;y>=0;y--)if(u.dist(g[y])<a)return!0}else d[i]=[];return d[i].push(u),!1}function eT(o,i){const a=o.fovAboveCenter,u=o.elevation?o.elevation.getMinElevationBelowMSL()*i:0,d=(o._camera.position[2]*o.worldSize-u)/Math.cos(o._pitch),g=Math.sin(a)*d/Math.sin(Math.max(Math.PI/2-o._pitch-a,.01)),y=Math.sin(o._pitch)*g+d;return Math.min(1.01*y,d*(1/o._horizonShift))}function vc(o,i){if(!i.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:i};const a=Math.pow(2,-o.z),u=o.x*a,d=(o.x+1)*a,g=o.y*a,y=(o.y+1)*a,b=Fs(u),T=Fs(d),A=Nr(g),C=Nr(y),k=i.project(b,A),O=i.project(T,A),B=i.project(T,C),F=i.project(b,C);let j=Math.min(k.x,O.x,B.x,F.x),K=Math.min(k.y,O.y,B.y,F.y),ce=Math.max(k.x,O.x,B.x,F.x),ve=Math.max(k.y,O.y,B.y,F.y);const ae=a/16;function _e(xe,He,je,tt,vt,Xe){const it=(je+vt)/2,ot=(tt+Xe)/2,mt=i.project(Fs(it),Nr(ot)),bt=Math.max(0,j-mt.x,K-mt.y,mt.x-ce,mt.y-ve);j=Math.min(j,mt.x),ce=Math.max(ce,mt.x),K=Math.min(K,mt.y),ve=Math.max(ve,mt.y),bt>ae&&(_e(xe,mt,je,tt,it,ot),_e(mt,He,it,ot,vt,Xe))}_e(k,O,u,g,d,g),_e(O,B,d,g,d,y),_e(B,F,d,y,u,y),_e(F,k,u,y,u,g),j-=ae,K-=ae,ce+=ae,ve+=ae;const Ee=1/Math.max(ce-j,ve-K);return{scale:Ee,x:j*Ee,y:K*Ee,x2:ce*Ee,y2:ve*Ee,projection:i}}const LR=vo(new Float32Array(16));class ll{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,a){return{x:0,y:0,z:0}}unproject(i,a){return new ni(0,0)}projectTilePoint(i,a,u){return{x:i,y:a,z:0}}locationPoint(i,a,u=!0){return i._coordinatePoint(i.locationCoordinate(a),u)}pixelsPerMeter(i,a){return bo(1,i)*a}pixelSpaceConversion(i,a,u){return 1}farthestPixelDistance(i){return eT(i,i.pixelsPerMeter)}pointCoordinate(i,a,u,d){const g=i.horizonLineFromTop(!1),y=new ge(a,Math.max(g,u));return i.rayIntersectionCoordinate(i.pointRayIntersection(y,d))}pointCoordinate3D(i,a,u){const d=new ge(a,u);if(i.elevation)return i.elevation.pointCoordinate(d);{const g=this.pointCoordinate(i,d.x,d.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(i,a){if(i.elevation)return!this.pointCoordinate3D(i,a.x,a.y);const u=i.horizonLineFromTop();return a.y<u}createInversionMatrix(i,a){return LR}createTileMatrix(i,a,u){let d,g,y;const b=u.canonical,T=vo(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=vc(b,this);d=1,g=A.x+u.wrap*A.scale,y=A.y,fc(T,T,[d/A.scale,d/A.scale,i.pixelsPerMeter/a])}else d=a/i.zoomScale(b.z),g=(b.x+Math.pow(2,b.z)*u.wrap)*d,y=b.y*d;return Df(T,T,[g,y,0]),fc(T,T,[d/Tn,d/Tn,1]),T}upVector(i,a,u){return[0,0,1]}upVectorScale(i,a,u){return{metersToTile:1}}}class kR extends ll{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[a,u]=this.parallels=i.parallels||[29.5,45.5],d=Math.sin(ke(a));this.n=(d+Math.sin(ke(u)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(i,a){const{n:u,c:d,r0:g}=this,y=ke(i-this.center[0]),b=ke(a),T=Math.sqrt(d-2*u*Math.sin(b))/u;return{x:T*Math.sin(y*u),y:T*Math.cos(y*u)-g,z:0}}unproject(i,a){const{n:u,c:d,r0:g}=this,y=g+a;let b=Math.atan2(i,Math.abs(y))*Math.sign(y);y*u<0&&(b-=Math.PI*Math.sign(i)*Math.sign(y));const T=ke(this.center[0])*u;b=yn(b,-Math.PI-T,Math.PI-T);const A=$t(It(b/u)+this.center[0],-180,180),C=Math.asin($t((d-(i*i+y*y)*u*u)/(2*u),-1,1)),k=$t(It(C),-Ur,Ur);return new ni(A,k)}}const sd=1.340264,od=-.081106,ad=893e-6,ld=.003796,ag=Math.sqrt(3)/2;class RR extends ll{project(i,a){a=a/180*Math.PI,i=i/180*Math.PI;const u=Math.asin(ag*Math.sin(a)),d=u*u,g=d*d*d;return{x:.5*(i*Math.cos(u)/(ag*(sd+3*od*d+g*(7*ad+9*ld*d)))/Math.PI+.5),y:1-.5*(u*(sd+od*d+g*(ad+ld*d))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,d=u*u,g=d*d*d;for(let C,k,O,B=0;B<12&&(k=u*(sd+od*d+g*(ad+ld*d))-a,O=sd+3*od*d+g*(7*ad+9*ld*d),C=k/O,u=$t(u-C,-Math.PI/3,Math.PI/3),d=u*u,g=d*d*d,!(Math.abs(C)<1e-12));++B);const y=ag*i*(sd+3*od*d+g*(7*ad+9*ld*d))/Math.cos(u),b=Math.asin(Math.sin(u)/ag),T=$t(180*y/Math.PI,-180,180),A=$t(180*b/Math.PI,-Ur,Ur);return new ni(T,A)}}class OR extends ll{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){return{x:.5+i/360,y:.5-a/360,z:0}}unproject(i,a){const u=360*(i-.5),d=$t(360*(.5-a),-Ur,Ur);return new ni(u,d)}}const qu=Math.PI/2;function lg(o){return Math.tan((qu+o)/2)}class DR extends ll{constructor(i){super(i),this.center=i.center||[0,30];const[a,u]=this.parallels=i.parallels||[30,30];let d=ke(a),g=ke(u);this.southernCenter=d+g<0,this.southernCenter&&(d=-d,g=-g);const y=Math.cos(d),b=lg(d);this.n=d===g?Math.sin(d):Math.log(y/Math.cos(g))/Math.log(lg(g)/b),this.f=y*Math.pow(lg(d),this.n)/this.n}project(i,a){a=ke(a),this.southernCenter&&(a=-a),i=ke(i-this.center[0]);const u=1e-6,{n:d,f:g}=this;g>0?a<-qu+u&&(a=-qu+u):a>qu-u&&(a=qu-u);const y=g/Math.pow(lg(a),d);let b=y*Math.sin(d*i),T=g-y*Math.cos(d*i);return b=.5*(b/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:b,y:this.southernCenter?T:1-T,z:0}}unproject(i,a){i=(2*i-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:u,f:d}=this,g=d-a,y=Math.sign(g),b=Math.sign(u)*Math.sqrt(i*i+g*g);let T=Math.atan2(i,Math.abs(g))*y;g*u<0&&(T-=Math.PI*Math.sign(i)*y);const A=$t(It(T/u)+this.center[0],-180,180),C=$t(It(2*Math.atan(Math.pow(d/b,1/u))-qu),-Ur,Ur);return new ni(A,this.southernCenter?-C:C)}}class tT extends ll{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,a){return{x:Ho(i),y:Wo(a),z:0}}unproject(i,a){const u=Fs(i),d=Nr(a);return new ni(u,d)}}const nT=ke(Ur);class zR extends ll{project(i,a){const u=(a=ke(a))*a,d=u*u;return{x:.5*((i=ke(i))*(.8707-.131979*u+d*(d*(.003971*u-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+d*(.028874*u-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,d=25,g=0,y=u*u;do{y=u*u;const A=y*y;g=(u*(1.007226+y*(.015085+A*(.028874*y-.044475-.005916*A)))-a)/(1.007226+y*(.045255+A*(.259866*y-.311325-.005916*11*A))),u=$t(u-g,-nT,nT)}while(Math.abs(g)>1e-6&&--d>0);y=u*u;const b=$t(It(i/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),T=It(u);return new ni(b,T)}}const iT=ke(Ur);class BR extends ll{project(i,a){a=ke(a),i=ke(i);const u=Math.cos(a),d=2/Math.PI,g=Math.acos(u*Math.cos(i/2)),y=Math.sin(g)/g,b=.5*(i*d+2*u*Math.sin(i/2)/y)||0,T=.5*(a+Math.sin(a)/y)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(i,a){let u=i=(2*i-.5)*Math.PI,d=a=(2*(1-a)-1)*Math.PI,g=25;const y=1e-6;let b=0,T=0;do{const A=Math.cos(d),C=Math.sin(d),k=2*C*A,O=C*C,B=A*A,F=Math.cos(u/2),j=Math.sin(u/2),K=2*F*j,ce=j*j,ve=1-B*F*F,ae=ve?1/ve:0,_e=ve?Math.acos(A*F)*Math.sqrt(1/ve):0,Ee=.5*(2*_e*A*j+2*u/Math.PI)-i,xe=.5*(_e*C+d)-a,He=.5*ae*(B*ce+_e*A*F*O)+1/Math.PI,je=ae*(K*k/4-_e*C*j),tt=.125*ae*(k*j-_e*C*B*K),vt=.5*ae*(O*F+_e*ce*A)+.5,Xe=je*tt-vt*He;b=(xe*je-Ee*vt)/Xe,T=(Ee*tt-xe*He)/Xe,u=$t(u-b,-Math.PI,Math.PI),d=$t(d-T,-iT,iT)}while((Math.abs(b)>y||Math.abs(T)>y)&&--g>0);return new ni(It(u),It(d))}}class rT extends ll{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ke(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){const{scale:u,cosPhi:d}=this;return{x:ke(i)*d*u+.5,y:-Math.sin(ke(a))/d*u+.5,z:0}}unproject(i,a){const{scale:u,cosPhi:d}=this,g=-(a-.5)/u,y=$t(It((i-.5)/u)/d,-180,180),b=Math.asin($t(g*d,-1,1)),T=$t(It(b),-Ur,Ur);return new ni(y,T)}}class FR extends tT{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,a,u){const d=Gf(i,a,u);return er(d,d,$f($o(u))),{x:d[0],y:d[1],z:d[2]}}locationPoint(i,a){const u=Ru(a.lat,a.lng),d=is([],u),g=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(a),i._centerAltitude):i._centerAltitude;Nf(u,u,d,bo(1,0)*Tn*g);const y=vo(new Float64Array(16));return hc(y,i.pixelMatrix,i.globeMatrix),er(u,u,y),new ge(u[0],u[1])}pixelsPerMeter(i,a){return bo(1,0)*a}pixelSpaceConversion(i,a,u){const d=bo(1,i)*a,g=Qn(bo(1,45)*a,d,u);return this.pixelsPerMeter(i,a)/g}createTileMatrix(i,a,u){const d=f0($o(u.canonical));return hc(new Float64Array(16),i.globeMatrix,d)}createInversionMatrix(i,a){const{center:u}=i,d=$f($o(a));return Bm(d,d,ke(u.lng)),i0(d,d,ke(u.lat)),fc(d,d,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(i,a,u,d){return Ow(i,a,u,!0)||new Du(0,0)}pointCoordinate3D(i,a,u){const d=this.pointCoordinate(i,a,u,0);return[d.x,d.y,d.z]}isPointAboveHorizon(i,a){return!Ow(i,a.x,a.y,!1)}farthestPixelDistance(i){const a=function(d,g){const y=d.cameraToCenterDistance,b=d._centerAltitude*g,T=d._camera,A=d._camera.forward(),C=ba([],Bs([],A,-y),[0,0,b]),k=d.worldSize/(2*Math.PI),O=[0,0,-k],B=d.width/d.height,F=Math.tan(d.fovAboveCenter),j=Bs([],T.up(),F),K=Bs([],T.right(),F*B),ce=is([],ba([],ba([],A,j),K)),ve=[];let ae;if(new a0(C,ce).closestPointOnSphere(O,k,ve)){const _e=ba([],ve,O),Ee=xo([],_e,C);ae=Math.cos(d.fovAboveCenter)*zf(Ee)}else{const _e=xo([],C,O),Ee=xo([],O,C);is(Ee,Ee);const xe=zf(_e)-k;ae=Math.sqrt(xe*(xe+2*k));const He=Math.acos(ae/(k+xe))-Math.acos(eo(A,Ee));ae*=Math.cos(He)}return 1.01*ae}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),u=Ou(i.zoom);if(u>0){const d=eT(i,bo(1,i.center.lat)*i.worldSize),g=i.worldSize/(2*Math.PI),y=Math.max(i.width,i.height)/i.worldSize*Math.PI;return Qn(a,d+g*(1-Math.cos(y)),Math.pow(u,10))}return a}upVector(i,a,u){return Gf(a,u,i,1)}upVectorScale(i){return{metersToTile:Fm(Um($o(i)))}}}function sT(o){const i=o.parallels,a=!!i&&Math.abs(i[0]+i[1])<.01;switch(o.name){case"mercator":return new tT(o);case"equirectangular":return new OR(o);case"naturalEarth":return new zR(o);case"equalEarth":return new RR(o);case"winkelTripel":return new BR(o);case"albers":return a?new rT(o):new kR(o);case"lambertConformalConic":return a?new rT(o):new DR(o);case"globe":return new FR(o)}throw new Error(`Invalid projection name: ${o.name}`)}const NR=Ym.types,UR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cg(o,i,a,u,d,g,y,b,T,A,C,k,O){const B=b?Math.min(al,Math.round(b[0])):0,F=b?Math.min(al,Math.round(b[1])):0;o.emplaceBack(i,a,Math.round(32*u),Math.round(32*d),g,y,(B<<1)+(T?1:0),F,16*A,16*C,256*k,256*O)}function ug(o,i,a,u,d,g,y){o.emplaceBack(i,a,u,d,g,y)}function hg(o,i,a,u,d){o.emplaceBack(i,a,u,d),o.emplaceBack(i,a,u,d),o.emplaceBack(i,a,u,d),o.emplaceBack(i,a,u,d)}function VR(o){for(const i of o.sections)if(V(i.text))return!0;return!1}class U0{constructor(i){this.layoutVertexArray=new mo,this.indexArray=new Fr,this.programConfigurations=i,this.segments=new ar,this.dynamicLayoutVertexArray=new wi,this.opacityVertexArray=new Ei,this.placedSymbolArray=new ow,this.globeExtVertexArray=new Bi}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,a,u,d){this.isEmpty()||(u&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Xk.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Kk.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,UR,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Yk.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Gt(U0,"SymbolBuffers");class V0{constructor(i,a,u){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new u,this.segments=new ar,this.collisionVertexArray=new Ci,this.collisionVertexArrayExt=new Br}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Jk.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,Qk.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Gt(V0,"CollisionBuffers");class cl{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(y=>y.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=vo([]),this.placementViewportMatrix=vo([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=C0(this.zoom,a["text-size"]),this.iconSizeData=C0(this.zoom,a["icon-size"]);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>Ns[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new U0(new uc(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new U0(new uc(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new cw,this.lineVertexArray=new uw,this.symbolInstances=new lw}calculateGlyphDependencies(i,a,u,d,g){for(let y=0;y<i.length;y++)if(a[i.charCodeAt(y)]=!0,d&&g){const b=td[i.charAt(y)];b&&(a[b.charCodeAt(0)]=!0)}}populate(i,a,u,d){const g=this.layers[0],y=g.layout,b=this.projection.name==="globe",T=y.get("text-font"),A=y.get("text-field"),C=y.get("icon-image"),k=(A.value.kind!=="constant"||A.value.value instanceof Lt&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),O=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,B=y.get("symbol-sort-key");if(this.features=[],!k&&!O)return;const F=a.iconDependencies,j=a.glyphDependencies,K=a.availableImages,ce=new Be(this.zoom);for(const{feature:ve,id:ae,index:_e,sourceLayerIndex:Ee}of i){const xe=g._featureFilter.needGeometry,He=gc(ve,xe);if(!g._featureFilter.filter(ce,He,u))continue;if(xe||(He.geometry=wa(ve,u,d)),b&&ve.type!==1&&u.z<=5){const Xe=He.geometry,it=.98078528056,ot=(mt,bt)=>eo(Gf(mt.x,mt.y,u,1),Gf(bt.x,bt.y,u,1))<it;for(let mt=0;mt<Xe.length;mt++)Xe[mt]=K3(Xe[mt],ot)}let je,tt;if(k){const Xe=g.getValueAndResolveTokens("text-field",He,u,K),it=Lt.factory(Xe);VR(it)&&(this.hasRTLText=!0),(!this.hasRTLText||Te()==="unavailable"||this.hasRTLText&&Ce.isParsed())&&(je=nR(it,g,He))}if(O){const Xe=g.getValueAndResolveTokens("icon-image",He,u,K);tt=Xe instanceof mn?Xe:mn.fromString(Xe)}if(!je&&!tt)continue;const vt=this.sortFeaturesByKey?B.evaluate(He,{},u):void 0;if(this.features.push({id:ae,text:je,icon:tt,index:_e,sourceLayerIndex:Ee,geometry:He.geometry,properties:ve.properties,type:NR[ve.type],sortKey:vt}),tt&&(F[tt.name]=!0),je){const Xe=T.evaluate(He,{},u).join(","),it=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ns.vertical)>=0;for(const ot of je.sections)if(ot.image)F[ot.image.name]=!0;else{const mt=x(je.toString()),bt=ot.fontStack||Xe,Ke=j[bt]=j[bt]||{};this.calculateGlyphDependencies(ot.text,Ke,it,this.allowVerticalPlacement,mt)}}}y.get("symbol-placement")==="line"&&(this.features=function(ve){const ae={},_e={},Ee=[];let xe=0;function He(Xe){Ee.push(ve[Xe]),xe++}function je(Xe,it,ot){const mt=_e[Xe];return delete _e[Xe],_e[it]=mt,Ee[mt].geometry[0].pop(),Ee[mt].geometry[0]=Ee[mt].geometry[0].concat(ot[0]),mt}function tt(Xe,it,ot){const mt=ae[it];return delete ae[it],ae[Xe]=mt,Ee[mt].geometry[0].shift(),Ee[mt].geometry[0]=ot[0].concat(Ee[mt].geometry[0]),mt}function vt(Xe,it,ot){const mt=ot?it[0][it[0].length-1]:it[0][0];return`${Xe}:${mt.x}:${mt.y}`}for(let Xe=0;Xe<ve.length;Xe++){const it=ve[Xe],ot=it.geometry,mt=it.text?it.text.toString():null;if(!mt){He(Xe);continue}const bt=vt(mt,ot),Ke=vt(mt,ot,!0);if(bt in _e&&Ke in ae&&_e[bt]!==ae[Ke]){const Ct=tt(bt,Ke,ot),_n=je(bt,Ke,Ee[Ct].geometry);delete ae[bt],delete _e[Ke],_e[vt(mt,Ee[_n].geometry,!0)]=_n,Ee[Ct].geometry=null}else bt in _e?je(bt,Ke,ot):Ke in ae?tt(bt,Ke,ot):(He(Xe),ae[bt]=xe-1,_e[Ke]=xe-1)}return Ee.filter(Xe=>Xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ve,ae)=>ve.sortKey-ae.sortKey)}update(i,a,u,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,a,this.layers,u,d),this.icon.programConfigurations.updatePaintArrays(i,a,this.layers,u,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=sT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,a){const u=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:d,y:g}of a)this.lineVertexArray.emplaceBack(d,g);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(i,a,u,d,g,y,b,T,A,C,k,O,B,F){const j=i.indexArray,K=i.layoutVertexArray,ce=i.globeExtVertexArray,ve=i.segments.prepareSegment(4*a.length,K,j,this.canOverlap?y.sortKey:void 0),ae=this.glyphOffsetArray.length,_e=ve.vertexLength,Ee=this.allowVerticalPlacement&&b===Ns.vertical?Math.PI/2:0,xe=y.text&&y.text.sections;for(let je=0;je<a.length;je++){const{tl:tt,tr:vt,bl:Xe,br:it,tex:ot,pixelOffsetTL:mt,pixelOffsetBR:bt,minFontScaleX:Ke,minFontScaleY:Ct,glyphOffset:_n,isSDF:Bt,sectionIndex:Xt}=a[je],kt=ve.vertexLength,bn=_n[1];if(cg(K,A.x,A.y,tt.x,bn+tt.y,ot.x,ot.y,u,Bt,mt.x,mt.y,Ke,Ct),cg(K,A.x,A.y,vt.x,bn+vt.y,ot.x+ot.w,ot.y,u,Bt,bt.x,mt.y,Ke,Ct),cg(K,A.x,A.y,Xe.x,bn+Xe.y,ot.x,ot.y+ot.h,u,Bt,mt.x,bt.y,Ke,Ct),cg(K,A.x,A.y,it.x,bn+it.y,ot.x+ot.w,ot.y+ot.h,u,Bt,bt.x,bt.y,Ke,Ct),T){const{x:jn,y:Un,z:Nn}=T.anchor,[En,fi,In]=T.up;ug(ce,jn,Un,Nn,En,fi,In),ug(ce,jn,Un,Nn,En,fi,In),ug(ce,jn,Un,Nn,En,fi,In),ug(ce,jn,Un,Nn,En,fi,In),hg(i.dynamicLayoutVertexArray,jn,Un,Nn,Ee)}else hg(i.dynamicLayoutVertexArray,A.x,A.y,A.z,Ee);j.emplaceBack(kt,kt+1,kt+2),j.emplaceBack(kt+1,kt+2,kt+3),ve.vertexLength+=4,ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_n[0]),je!==a.length-1&&Xt===a[je+1].sectionIndex||i.programConfigurations.populatePaintArrays(K.length,y,y.index,{},B,F,xe&&xe[Xt])}const He=T?T.anchor:A;i.placedSymbolArray.emplaceBack(He.x,He.y,He.z,A.x,A.y,ae,this.glyphOffsetArray.length-ae,_e,C,k,A.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],b,0,!1,0,O,0)}_commitLayoutVertex(i,a,u,d,g,y,b){i.emplaceBack(a,u,d,g,y,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(i,a,u,d,g,y,b){const T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),A=T.vertexLength,C=b.tileAnchorX,k=b.tileAnchorY;for(let B=0;B<4;B++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(a,-i.padding,-i.padding),u.collisionVertexArrayExt.emplaceBack(a,i.padding,-i.padding),u.collisionVertexArrayExt.emplaceBack(a,i.padding,i.padding),u.collisionVertexArrayExt.emplaceBack(a,-i.padding,i.padding),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,C,k,new ge(i.x1,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,C,k,new ge(i.x2,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,C,k,new ge(i.x2,i.y2)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,C,k,new ge(i.x1,i.y2)),T.vertexLength+=4;const O=u.indexArray;O.emplaceBack(A,A+1),O.emplaceBack(A+1,A+2),O.emplaceBack(A+2,A+3),O.emplaceBack(A+3,A),T.primitiveLength+=4}_addTextDebugCollisionBoxes(i,a,u,d,g,y){for(let b=d;b<g;b++){const T=u.get(b),A=this.getSymbolInstanceTextSize(i,y,a,b);this._addCollisionDebugVertices(T,A,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(i,a,u,d,g,y){for(let b=d;b<g;b++){const T=u.get(b),A=this.getSymbolInstanceIconSize(i,a,y.placedIconSymbolIndex);this._addCollisionDebugVertices(T,A,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}generateCollisionDebugBuffers(i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new V0(Zi,ME.members,Vo),this.iconCollisionBox=new V0(Zi,ME.members,Vo);const u=Vu(this.iconSizeData,i),d=Vu(this.textSizeData,i);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(d,i,a,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(d,i,a,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,i,a,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,i,a,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(i,a,u,d){const g=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:d),y=eg(this.textSizeData,i,g)/Vr;return this.tilePixelRatio*y}getSymbolInstanceIconSize(i,a,u){const d=this.icon.placedSymbolArray.get(u),g=eg(this.iconSizeData,i,d);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(i,a,u){i.emplaceBack(a,-u,-u),i.emplaceBack(a,u,-u),i.emplaceBack(a,u,u),i.emplaceBack(a,-u,u)}_updateTextDebugCollisionBoxes(i,a,u,d,g,y){for(let b=d;b<g;b++){const T=u.get(b),A=this.getSymbolInstanceTextSize(i,y,a,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,T.padding)}}_updateIconDebugCollisionBoxes(i,a,u,d,g,y){for(let b=d;b<g;b++){const T=u.get(b),A=this.getSymbolInstanceIconSize(i,a,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,T.padding)}}updateCollisionDebugBuffers(i,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Vu(this.iconSizeData,i),d=Vu(this.textSizeData,i);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(d,i,a,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(d,i,a,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(u,i,a,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,i,a,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,a,u,d,g,y,b,T,A){const C={};if(a<u){const{x1:k,y1:O,x2:B,y2:F,padding:j,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:ve,tileAnchorX:ae,tileAnchorY:_e,featureIndex:Ee}=i.get(a);C.textBox={x1:k,y1:O,x2:B,y2:F,padding:j,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:ve,tileAnchorX:ae,tileAnchorY:_e},C.textFeatureIndex=Ee}if(d<g){const{x1:k,y1:O,x2:B,y2:F,padding:j,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:ve,tileAnchorX:ae,tileAnchorY:_e,featureIndex:Ee}=i.get(d);C.verticalTextBox={x1:k,y1:O,x2:B,y2:F,padding:j,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:ve,tileAnchorX:ae,tileAnchorY:_e},C.verticalTextFeatureIndex=Ee}if(y<b){const{x1:k,y1:O,x2:B,y2:F,padding:j,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:ve,tileAnchorX:ae,tileAnchorY:_e,featureIndex:Ee}=i.get(y);C.iconBox={x1:k,y1:O,x2:B,y2:F,padding:j,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:ve,tileAnchorX:ae,tileAnchorY:_e},C.iconFeatureIndex=Ee}if(T<A){const{x1:k,y1:O,x2:B,y2:F,padding:j,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:ve,tileAnchorX:ae,tileAnchorY:_e,featureIndex:Ee}=i.get(T);C.verticalIconBox={x1:k,y1:O,x2:B,y2:F,padding:j,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:ve,tileAnchorX:ae,tileAnchorY:_e},C.verticalIconFeatureIndex=Ee}return C}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,a){const u=i.placedSymbolArray.get(a),d=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<d;g+=4)i.indexArray.emplaceBack(g,g+1,g+2),i.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(i),u=Math.cos(i),d=[],g=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const T=this.symbolInstances.get(b);d.push(0|Math.round(a*T.tileAnchorX+u*T.tileAnchorY)),g.push(T.featureIndex)}return y.sort((b,T)=>d[b]-d[T]||g[T]-g[b]),y}addToSortKeyRanges(i,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:A}=u;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&y!==g&&y!==d&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Gt(cl,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),cl.MAX_GLYPHS=65535,cl.addDynamicAttributes=hg;const jR=new _t({"symbol-placement":new De(Ze.layout_symbol["symbol-placement"]),"symbol-spacing":new De(Ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new De(Ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qe(Ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new De(Ze.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new De(Ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new De(Ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new De(Ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new De(Ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new qe(Ze.layout_symbol["icon-size"]),"icon-text-fit":new De(Ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new De(Ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new qe(Ze.layout_symbol["icon-image"]),"icon-rotate":new qe(Ze.layout_symbol["icon-rotate"]),"icon-padding":new De(Ze.layout_symbol["icon-padding"]),"icon-keep-upright":new De(Ze.layout_symbol["icon-keep-upright"]),"icon-offset":new qe(Ze.layout_symbol["icon-offset"]),"icon-anchor":new qe(Ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new De(Ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new De(Ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new De(Ze.layout_symbol["text-rotation-alignment"]),"text-field":new qe(Ze.layout_symbol["text-field"]),"text-font":new qe(Ze.layout_symbol["text-font"]),"text-size":new qe(Ze.layout_symbol["text-size"]),"text-max-width":new qe(Ze.layout_symbol["text-max-width"]),"text-line-height":new qe(Ze.layout_symbol["text-line-height"]),"text-letter-spacing":new qe(Ze.layout_symbol["text-letter-spacing"]),"text-justify":new qe(Ze.layout_symbol["text-justify"]),"text-radial-offset":new qe(Ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new De(Ze.layout_symbol["text-variable-anchor"]),"text-anchor":new qe(Ze.layout_symbol["text-anchor"]),"text-max-angle":new De(Ze.layout_symbol["text-max-angle"]),"text-writing-mode":new De(Ze.layout_symbol["text-writing-mode"]),"text-rotate":new qe(Ze.layout_symbol["text-rotate"]),"text-padding":new De(Ze.layout_symbol["text-padding"]),"text-keep-upright":new De(Ze.layout_symbol["text-keep-upright"]),"text-transform":new qe(Ze.layout_symbol["text-transform"]),"text-offset":new qe(Ze.layout_symbol["text-offset"]),"text-allow-overlap":new De(Ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new De(Ze.layout_symbol["text-ignore-placement"]),"text-optional":new De(Ze.layout_symbol["text-optional"])});var j0={paint:new _t({"icon-opacity":new qe(Ze.paint_symbol["icon-opacity"]),"icon-color":new qe(Ze.paint_symbol["icon-color"]),"icon-halo-color":new qe(Ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new qe(Ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qe(Ze.paint_symbol["icon-halo-blur"]),"icon-translate":new De(Ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new De(Ze.paint_symbol["icon-translate-anchor"]),"text-opacity":new qe(Ze.paint_symbol["text-opacity"]),"text-color":new qe(Ze.paint_symbol["text-color"],{runtimeType:Ar,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new qe(Ze.paint_symbol["text-halo-color"]),"text-halo-width":new qe(Ze.paint_symbol["text-halo-width"]),"text-halo-blur":new qe(Ze.paint_symbol["text-halo-blur"]),"text-translate":new De(Ze.paint_symbol["text-translate"]),"text-translate-anchor":new De(Ze.paint_symbol["text-translate-anchor"])}),layout:jR};class oT{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Tr,this.defaultValue=i}evaluate(i){if(i.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Gt(oT,"FormatSectionOverride",{omit:["defaultValue"]});class fg extends yo{constructor(i){super(i,j0)}recalculate(i,a){super.recalculate(i,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const g of u)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,a,u,d){const g=this.layout.get(i).evaluate(a,{},u,d),y=this._unevaluatedLayout._values[i];return y.isDataDriven()||Xa(y.value)||!g?g:function(b,T){return T.replace(/{([^{}]+)}/g,(A,C)=>C in b?String(b[C]):"")}(a.properties,g)}createBucket(i){return new cl(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of j0.paint.overridableProperties){if(!fg.hasPaintOverride(this.layout,i))continue;const a=this.paint.get(i),u=new oT(a),d=new gu(u,a.property.specification);let g=null;g=a.value.kind==="constant"||a.value.kind==="source"?new _u("source",d):new _a("composite",d,a.value.zoomStops,a.value._interpolationType),this.paint._values[i]=new pt(a.property,g,a.parameters)}}_handleOverridablePaintPropertyUpdate(i,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&fg.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,a){const u=i.get("text-field"),d=j0.paint.properties[a];let g=!1;const y=b=>{for(const T of b)if(d.overrides&&d.overrides.hasOverride(T))return void(g=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Lt)y(u.value.value.sections);else if(u.value.kind==="source"){const b=A=>{g||(A instanceof ri&&kn(A.value)===Sr?y(A.value.sections):A instanceof ho?y(A.sections):A.eachChild(b))},T=u.value;T._styleExpression&&b(T._styleExpression.expression)}return g}getProgramConfiguration(i){return new sl(this,i)}}var GR={paint:new _t({"background-color":new De(Ze.paint_background["background-color"]),"background-pattern":new De(Ze.paint_background["background-pattern"]),"background-opacity":new De(Ze.paint_background["background-opacity"])})},$R={paint:new _t({"raster-opacity":new De(Ze.paint_raster["raster-opacity"]),"raster-hue-rotate":new De(Ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new De(Ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new De(Ze.paint_raster["raster-brightness-max"]),"raster-saturation":new De(Ze.paint_raster["raster-saturation"]),"raster-contrast":new De(Ze.paint_raster["raster-contrast"]),"raster-resampling":new De(Ze.paint_raster["raster-resampling"]),"raster-fade-duration":new De(Ze.paint_raster["raster-fade-duration"])})};class HR extends yo{constructor(i){super(i,{}),this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var WR={paint:new _t({"sky-type":new De(Ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new De(Ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new De(Ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new De(Ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new De(Ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new ut(Ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new De(Ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new De(Ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new De(Ze.paint_sky["sky-opacity"])})};function G0(o,i,a){const u=[0,0,1],d=Iw([]);return Lw(d,d,a?-ke(o)+Math.PI:ke(o)),Cw(d,d,-ke(i)),Aw(u,u,d),is(u,u)}const qR={circle:class extends yo{constructor(o){super(o,rk)}createBucket(o){return new y0(o)}queryRadius(o){const i=o;return zu("circle-radius",this,i)+zu("circle-stroke-width",this,i)+Gm(this.paint.get("circle-translate"))}queryIntersectsFeature(o,i,a,u,d,g,y,b){const T=Jw(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a);return Qw(o,u,g,y,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,A)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new sl(this,o)}},heatmap:class extends yo{createBucket(o){return new tE(o)}constructor(o){super(o,lk),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=w0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return zu("heatmap-radius",this,o)}queryIntersectsFeature(o,i,a,u,d,g,y,b){const T=this.paint.get("heatmap-radius").evaluate(i,a);return Qw(o,u,g,y,b,!0,!0,new ge(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new sl(this,o)}},hillshade:class extends yo{constructor(o){super(o,ck)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends yo{constructor(o){super(o,Ak)}getProgramIds(){const o=this.paint.get("fill-pattern"),i=o&&o.constantOr(1),a=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(o){return new sl(this,o)}recalculate(o,i){super.recalculate(o,i);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Zm(o)}queryRadius(){return Gm(this.paint.get("fill-translate"))}queryIntersectsFeature(o,i,a,u,d,g){return!o.queryGeometry.isAboveHorizon&&qw(Kw(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends yo{constructor(o){super(o,Vk)}createBucket(o){return new Jf(o)}queryRadius(){return Gm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new sl(this,o)}queryIntersectsFeature(o,i,a,u,d,g,y,b,T){const A=Jw(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(i,a),k=this.paint.get("fill-extrusion-base").evaluate(i,a),O=[0,0],B=b&&g.elevation,F=g.elevation?g.elevation.exaggeration():1,j=o.tile.getBucket(this);if(B&&j instanceof Jf){const _e=j.centroidVertexArray,Ee=T+1;Ee<_e.length&&(O[0]=_e.geta_centroid_pos0(Ee),O[1]=_e.geta_centroid_pos1(Ee))}if(O[0]===0&&O[1]===1)return!1;g.projection.name==="globe"&&(u=vE([u],[new ge(0,0),new ge(Tn,Tn)],o.tileID.canonical).map(_e=>_e.polygon).flat());const K=B?b:null,[ce,ve]=function(_e,Ee,xe,He,je,tt,vt,Xe,it,ot,mt){return _e.projection.name==="globe"?function(bt,Ke,Ct,_n,Bt,Xt,kt,bn,jn,Un,Nn){const En=[],fi=[],In=bt.projection.upVectorScale(Nn,bt.center.lat,bt.worldSize).metersToTile,Gn=[0,0,0,1],gi=[0,0,0,1],Li=(ki,Fi,Xi,Mr)=>{ki[0]=Fi,ki[1]=Xi,ki[2]=Mr,ki[3]=1},Pi=yE();Ct>0&&(Ct+=Pi),_n+=Pi;for(const ki of Ke){const Fi=[],Xi=[];for(const Mr of ki){const di=Mr.x+Bt.x,pr=Mr.y+Bt.y,cr=bt.projection.projectTilePoint(di,pr,Nn),oi=bt.projection.upVector(Nn,Mr.x,Mr.y);let $i=Ct,vr=_n;if(kt){const _i=EE(di,pr,Ct,_n,kt,bn,jn,Un);$i+=_i.base,vr+=_i.top}Ct!==0?Li(Gn,cr.x+oi[0]*In*$i,cr.y+oi[1]*In*$i,cr.z+oi[2]*In*$i):Li(Gn,cr.x,cr.y,cr.z),Li(gi,cr.x+oi[0]*In*vr,cr.y+oi[1]*In*vr,cr.z+oi[2]*In*vr),er(Gn,Gn,Xt),er(gi,gi,Xt),Fi.push(new Uu(Gn[0],Gn[1],Gn[2])),Xi.push(new Uu(gi[0],gi[1],gi[2]))}En.push(Fi),fi.push(Xi)}return[En,fi]}(_e,Ee,xe,He,je,tt,vt,Xe,it,ot,mt):vt?function(bt,Ke,Ct,_n,Bt,Xt,kt,bn,jn){const Un=[],Nn=[],En=[0,0,0,1];for(const fi of bt){const In=[],Gn=[];for(const gi of fi){const Li=gi.x+_n.x,Pi=gi.y+_n.y,ki=EE(Li,Pi,Ke,Ct,Xt,kt,bn,jn);En[0]=Li,En[1]=Pi,En[2]=ki.base,En[3]=1,dc(En,En,Bt),En[3]=Math.max(En[3],1e-5);const Fi=new Uu(En[0]/En[3],En[1]/En[3],En[2]/En[3]);En[0]=Li,En[1]=Pi,En[2]=ki.top,En[3]=1,dc(En,En,Bt),En[3]=Math.max(En[3],1e-5);const Xi=new Uu(En[0]/En[3],En[1]/En[3],En[2]/En[3]);In.push(Fi),Gn.push(Xi)}Un.push(In),Nn.push(Gn)}return[Un,Nn]}(Ee,xe,He,je,tt,vt,Xe,it,ot):function(bt,Ke,Ct,_n,Bt){const Xt=[],kt=[],bn=Bt[8]*Ke,jn=Bt[9]*Ke,Un=Bt[10]*Ke,Nn=Bt[11]*Ke,En=Bt[8]*Ct,fi=Bt[9]*Ct,In=Bt[10]*Ct,Gn=Bt[11]*Ct;for(const gi of bt){const Li=[],Pi=[];for(const ki of gi){const Fi=ki.x+_n.x,Xi=ki.y+_n.y,Mr=Bt[0]*Fi+Bt[4]*Xi+Bt[12],di=Bt[1]*Fi+Bt[5]*Xi+Bt[13],pr=Bt[2]*Fi+Bt[6]*Xi+Bt[14],cr=Bt[3]*Fi+Bt[7]*Xi+Bt[15],oi=Mr+bn,$i=di+jn,vr=pr+Un,_i=Math.max(cr+Nn,1e-5),tr=Mr+En,Xr=di+fi,Pr=pr+In,Ir=Math.max(cr+Gn,1e-5);Li.push(new Uu(oi/_i,$i/_i,vr/_i)),Pi.push(new Uu(tr/Ir,Xr/Ir,Pr/Ir))}Xt.push(Li),kt.push(Pi)}return[Xt,kt]}(Ee,xe,He,je,tt)}(g,u,k,C,A,y,K,O,F,g.center.lat,o.tileID.canonical),ae=o.queryGeometry;return function(_e,Ee,xe){let He=1/0;qw(xe,Ee)&&(He=wE(xe,Ee[0]));for(let je=0;je<Ee.length;je++){const tt=Ee[je],vt=_e[je];for(let Xe=0;Xe<tt.length-1;Xe++){const it=tt[Xe],ot=[it,tt[Xe+1],vt[Xe+1],vt[Xe],it];Ww(xe,ot)&&(He=Math.min(He,wE(xe,ot)))}}return He!==1/0&&He}(ce,ve,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends yo{constructor(o){super(o,TE),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof rf,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,i){super.recalculate(o,i),this.paint._values["line-floorwidth"]=AE.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Qm(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new sl(this,o)}queryRadius(o){const i=o,a=SE(zu("line-width",this,i),zu("line-gap-width",this,i)),u=zu("line-offset",this,i);return a/2+Math.abs(u)+Gm(this.paint.get("line-translate"))}queryIntersectsFeature(o,i,a,u,d,g){if(o.queryGeometry.isAboveHorizon)return!1;const y=Kw(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),b=o.pixelToTileUnitsFactor/2*SE(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),T=this.paint.get("line-offset").evaluate(i,a);return T&&(u=function(A,C){const k=[],O=new ge(0,0);for(let B=0;B<A.length;B++){const F=A[B],j=[];for(let K=0;K<F.length;K++){const ce=F[K-1],ve=F[K],ae=F[K+1],_e=K===0?O:ve.sub(ce)._unit()._perp(),Ee=K===F.length-1?O:ae.sub(ve)._unit()._perp(),xe=_e._add(Ee)._unit();xe._mult(1/(xe.x*Ee.x+xe.y*Ee.y)),j.push(xe._mult(C)._add(ve))}k.push(j)}return k}(u,T*o.pixelToTileUnitsFactor)),function(A,C,k){for(let O=0;O<C.length;O++){const B=C[O];if(A.length>=3){for(let F=0;F<B.length;F++)if(_c(A,B[F]))return!0}if(ek(A,B,k))return!0}return!1}(y,u,b)}isTileClipped(){return!0}},symbol:fg,background:class extends yo{constructor(o){super(o,GR)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends yo{constructor(o){super(o,$R)}getProgramIds(){return["raster"]}},sky:class extends yo{constructor(o){super(o,WR),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=w0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(o,i){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),d=!u,g=o.style.light,y=g.properties.get("position");return d&&g.properties.get("anchor")==="viewport"&&ue("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?G0(y.azimuthal,90-y.polar,i):G0(u[0],90-u[1],i)}const a=this.paint.get("sky-gradient-center");return G0(a[0],90-a[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}}};class cd{constructor(i,a,u,d){this.context=i,this.format=u,this.texture=i.gl.createTexture(),this.update(a,d)}update(i,a,u){const{width:d,height:g}=i,{context:y}=this,{gl:b}=y,{HTMLImageElement:T,HTMLCanvasElement:A,HTMLVideoElement:C,ImageData:k,ImageBitmap:O}=v;if(b.bindTexture(b.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!a||a.premultiply!==!1)),u||this.size&&this.size[0]===d&&this.size[1]===g){const{x:B,y:F}=u||{x:0,y:0};i instanceof T||i instanceof A||i instanceof C||i instanceof k||O&&i instanceof O?b.texSubImage2D(b.TEXTURE_2D,0,B,F,b.RGBA,b.UNSIGNED_BYTE,i):b.texSubImage2D(b.TEXTURE_2D,0,B,F,d,g,b.RGBA,b.UNSIGNED_BYTE,i.data)}else this.size=[d,g],i instanceof T||i instanceof A||i instanceof C||i instanceof k||O&&i instanceof O?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,i):b.texImage2D(b.TEXTURE_2D,0,this.format,d,g,0,this.format,b.UNSIGNED_BYTE,i.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(i,a){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?i===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_NEAREST:i),this.filter=i),a!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class ZR{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class XR{constructor(){this.tasks={},this.taskQueue=[],zt(["process"],this),this.invoker=new ZR(this.process),this.nextId=0}add(i,a){const u=this.nextId++,d=function({type:g,isSymbolTile:y,zoom:b}){return b=b||0,g==="message"?0:g!=="maybePrepare"||y?g!=="parseTile"||y?g==="parseTile"&&y?300-b:g==="maybePrepare"&&y?400-b:500:200-b:100-b}(a);if(d===0){Qe();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:i,metadata:a,priority:d,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){Qe();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const a=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let i=null,a=1/0;for(let d=0;d<this.taskQueue.length;d++){const g=this.tasks[this.taskQueue[d]];g.priority<a&&(a=g.priority,i=d)}if(i===null)return null;const u=this.taskQueue[i];return this.taskQueue.splice(i,1),u}remove(){this.invoker.remove()}}class aT{constructor(i){this._stringToNumber={},this._numberToString=[];for(let a=0;a<i.length;a++){const u=i[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const YR=["tile","layer","source","sourceLayer","state"];class lT{constructor(i,a,u,d,g){this.type="Feature",this._vectorTileFeature=i,this._z=a,this._x=u,this._y=d,this.properties=i.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(i.id=this.id);for(const a of YR)this[a]!==void 0&&(i[a]=this[a]);return i}}const io=32,Zo=33,ul=new Uint16Array(8184);for(let o=0;o<2046;o++){let i=o+2,a=0,u=0,d=0,g=0,y=0,b=0;for(1&i?d=g=y=io:a=u=b=io;(i>>=1)>1;){const A=a+d>>1,C=u+g>>1;1&i?(d=a,g=u,a=y,u=b):(a=d,u=g,d=y,g=b),y=A,b=C}const T=4*o;ul[T+0]=a,ul[T+1]=u,ul[T+2]=d,ul[T+3]=g}const Xo=new Uint16Array(2178),hl=new Uint8Array(1089),dg=new Uint16Array(1089);function cT(o){return o===0?-.03125:o===32?.03125:0}var uT=rn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const hT={type:2,extent:Tn,loadGeometry:()=>[[new ge(0,0),new ge(8193,0),new ge(8193,8193),new ge(0,8193),new ge(0,0)]]};class $0{constructor(i,a,u,d,g){this.tileID=i,this.uid=Kn(),this.uses=0,this.tileSize=a,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection)}registerFadeDuration(i){const a=i+this.timeAdded;a<Fn.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=vc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,a,u){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(d,g){const y={};if(!g)return y;for(const b of d){const T=b.layerIds.map(A=>g.getLayer(A)).filter(Boolean);if(T.length!==0){b.layers=T,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(A=>T.filter(C=>C.id===A)[0]));for(const A of T)y[A.id]=b}}return y}(i.buckets,a.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const g=this.buckets[d];if(g instanceof cl){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const g=this.buckets[d];if(g instanceof cl&&g.hasRTLText){this.hasRTLText=!0,Ce.isLoading()||Ce.isLoaded()||Te()!=="deferred"||be();break}}this.queryPadding=0;for(const d in this.buckets){const g=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(d).queryRadius(g))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Ky}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(i)}const a=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new cd(i,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new cd(i,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new cd(i,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,a,u,d,g,y,b,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:b,transform:y,params:g,tileTransform:this.tileTransform},i,a,u):{}}querySourceFeatures(i,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),g=a?a.sourceLayer:"",y=d._geojsonTileLayer||d[g];if(!y)return;const b=vu(a&&a.filter),{z:T,x:A,y:C}=this.tileID.canonical,k={z:T,x:A,y:C};for(let O=0;O<y.length;O++){const B=y.feature(O);if(b.needGeometry){const K=gc(B,!0);if(!b.filter(new Be(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!b.filter(new Be(this.tileID.overscaledZ),B))continue;const F=u.getId(B,g),j=new lT(B,T,A,C,F);j.tile=k,i.push(j)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const a=this.expirationTime;if(i.cacheControl){const u=st(i.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(a)if(this.expirationTime<a)d=!0;else{const g=this.expirationTime-a;g?this.expirationTime=u+Math.max(g,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0||!a)return;const u=this.latestFeatureIndex.loadVTLayers(),d=a.style.listImages();for(const g in this.buckets){if(!a.style.hasLayer(g))continue;const y=this.buckets[g],b=y.layers[0].sourceLayer||"_geojsonTileLayer",T=u[b],A=i[b];if(!T||!A||Object.keys(A).length===0)continue;if(y.update(A,T,d,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof Qm||y instanceof Zm){const k=a.style._getSourceCache(y.layers[0].source);a._terrain&&a._terrain.enabled&&k&&y.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(k.id,this.tileID)}const C=a&&a.style&&a.style.getLayer(g);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Fn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=Fn.now()+i}setTexture(i,a){const u=a.context,d=u.gl;this.texture=this.texture||a.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new cd(u,i,d.RGBA,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax))}setDependencies(i,a){const u={};for(const d of a)u[d]=!0;this.dependencies[i]=u}hasDependency(i,a){for(const u of i){const d=this.dependencies[u];if(d){for(const g of a)if(d[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const u=wa(hT,this.tileID.canonical,this.tileTransform)[0],d=new hn,g=new jo;for(let y=0;y<u.length;y++){const{x:b,y:T}=u[y];d.emplaceBack(b,T),g.emplaceBack(y)}g.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(g),this._tileDebugBuffer=i.createVertexBuffer(d,Vf.members),this._tileDebugSegments=ar.simpleSegment(0,0,d.length,g.length)}_makeTileBoundsBuffers(i,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const u=wa(hT,this.tileID.canonical,this.tileTransform)[0];let d,g;if(this.isRaster){const y=function(b,T){const A=vc(b,T),C=Math.pow(2,b.z);for(let K=0;K<Zo;K++)for(let ce=0;ce<Zo;ce++){const ve=Fs((b.x+(ce+cT(ce))/io)/C),ae=Nr((b.y+(K+cT(K))/io)/C),_e=T.project(ve,ae),Ee=K*Zo+ce;Xo[2*Ee+0]=Math.round((_e.x*A.scale-A.x)*Tn),Xo[2*Ee+1]=Math.round((_e.y*A.scale-A.y)*Tn)}hl.fill(0),dg.fill(0);for(let K=2045;K>=0;K--){const ce=4*K,ve=ul[ce+0],ae=ul[ce+1],_e=ul[ce+2],Ee=ul[ce+3],xe=ve+_e>>1,He=ae+Ee>>1,je=xe+He-ae,tt=He+ve-xe,vt=ae*Zo+ve,Xe=Ee*Zo+_e,it=He*Zo+xe,ot=Math.hypot((Xo[2*vt+0]+Xo[2*Xe+0])/2-Xo[2*it+0],(Xo[2*vt+1]+Xo[2*Xe+1])/2-Xo[2*it+1])>=16;if(hl[it]=hl[it]||(ot?1:0),K<1022){const mt=(ae+tt>>1)*Zo+(ve+je>>1),bt=(Ee+tt>>1)*Zo+(_e+je>>1);hl[it]=hl[it]||hl[mt]||hl[bt]}}const k=new mi,O=new Fr;let B=0;function F(K,ce){const ve=ce*Zo+K;return dg[ve]===0&&(k.emplaceBack(Xo[2*ve+0],Xo[2*ve+1],K*Tn/io,ce*Tn/io),dg[ve]=++B),dg[ve]-1}function j(K,ce,ve,ae,_e,Ee){const xe=K+ve>>1,He=ce+ae>>1;if(Math.abs(K-_e)+Math.abs(ce-Ee)>1&&hl[He*Zo+xe])j(_e,Ee,K,ce,xe,He),j(ve,ae,_e,Ee,xe,He);else{const je=F(K,ce),tt=F(ve,ae),vt=F(_e,Ee);O.emplaceBack(je,tt,vt)}}return j(0,0,io,io,io,0),j(io,io,0,0,0,io),{vertices:k,indices:O}}(this.tileID.canonical,a);d=y.vertices,g=y.indices}else{d=new mi,g=new Fr;for(const{x:b,y:T}of u)d.emplaceBack(b,T,0,0);const y=Bu(d.int16,void 0,4);for(let b=0;b<y.length;b+=3)g.emplaceBack(y[b],y[b+1],y[b+2])}this._tileBoundsBuffer=i.createVertexBuffer(d,uT.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(g),this._tileBoundsSegments=ar.simpleSegment(0,0,d.length,g.length)}_makeGlobeTileDebugBuffers(i,a){const u=a.projection;if(!u||u.name!=="globe"||a.freezeTileCoverage)return;const d=this.tileID.canonical,g=$f(Dw(d,a)),y=Ou(a.zoom);let b;y>0&&(b=n0(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,d,a,g,b,y),this._makeGlobeTileDebugTextBuffer(i,d,a,g,b,y)}_globePoint(i,a,u,d,g,y,b){let T=Gf(i,a,u);if(y){const A=1<<u.z,C=Ho(d.center.lng),k=Wo(d.center.lat),O=(u.x+.5)/A-C;let B=0;O>.5?B=-1:O<-.5&&(B=1);let F=(i/Tn+u.x)/A+B,j=(a/Tn+u.y)/A;F=(F-C)*d._pixelsPerMercatorPixel+C,j=(j-k)*d._pixelsPerMercatorPixel+k;const K=[F*d.worldSize,j*d.worldSize,0];er(K,K,y),T=mc(T,K,b)}return er(T,T,g)}_makeGlobeTileDebugBorderBuffer(i,a,u,d,g,y){const b=new hn,T=new jo,A=new ci,C=(O,B,F,j,K)=>{const ce=(F-O)/(K-1),ve=(j-B)/(K-1),ae=b.length;for(let _e=0;_e<K;_e++){const Ee=O+_e*ce,xe=B+_e*ve;b.emplaceBack(Ee,xe);const He=this._globePoint(Ee,xe,a,u,d,g,y);A.emplaceBack(He[0],He[1],He[2]),T.emplaceBack(ae+_e)}},k=Tn;C(0,0,k,0,16),C(k,0,k,k,16),C(k,k,0,k,16),C(0,k,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(T),this._tileDebugBuffer=i.createVertexBuffer(b,Vf.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(A,Rw.members),this._tileDebugSegments=ar.simpleSegment(0,0,b.length,T.length)}_makeGlobeTileDebugTextBuffer(i,a,u,d,g,y){const b=new hn,T=new Fr,A=new ci,C=25;T.reserve(32),b.reserve(C),A.reserve(C);const k=(O,B)=>C*O+B;for(let O=0;O<C;O++){const B=2048*O;for(let F=0;F<C;F++){const j=2048*F;b.emplaceBack(j,B);const K=this._globePoint(j,B,a,u,d,g,y);A.emplaceBack(K[0],K[1],K[2])}}for(let O=0;O<4;O++)for(let B=0;B<4;B++){const F=k(O,B),j=k(O,B+1),K=k(O+1,B),ce=k(O+1,B+1);T.emplaceBack(F,j,K),T.emplaceBack(K,j,ce)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(T),this._tileDebugTextBuffer=i.createVertexBuffer(b,Vf.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(A,Rw.members),this._tileDebugTextSegments=ar.simpleSegment(0,0,C,32)}}class KR{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,a,u){const d=String(a);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][d]=this.stateChanges[i][d]||{},Wn(this.stateChanges[i][d],u),this.deletedStates[i]===null){this.deletedStates[i]={};for(const g in this.state[i])g!==d&&(this.deletedStates[i][g]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][d]===null){this.deletedStates[i][d]={};for(const g in this.state[i][d])u[g]||(this.deletedStates[i][d][g]=null)}else for(const g in u)this.deletedStates[i]&&this.deletedStates[i][d]&&this.deletedStates[i][d][g]===null&&delete this.deletedStates[i][d][g]}removeFeatureState(i,a,u){if(this.deletedStates[i]===null)return;const d=String(a);if(this.deletedStates[i]=this.deletedStates[i]||{},u&&a!==void 0)this.deletedStates[i][d]!==null&&(this.deletedStates[i][d]=this.deletedStates[i][d]||{},this.deletedStates[i][d][u]=null);else if(a!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][d])for(u in this.deletedStates[i][d]={},this.stateChanges[i][d])this.deletedStates[i][d][u]=null;else this.deletedStates[i][d]=null;else this.deletedStates[i]=null}getState(i,a){const u=String(a),d=Wn({},(this.state[i]||{})[u],(this.stateChanges[i]||{})[u]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const g=this.deletedStates[i][a];if(g===null)return{};for(const y in g)delete d[y]}return d}initializeTileState(i,a){i.setFeatureState(this.state,a)}coalesceChanges(i,a){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const g={};for(const y in this.stateChanges[d])this.state[d][y]||(this.state[d][y]={}),Wn(this.state[d][y],this.stateChanges[d][y]),g[y]=this.state[d][y];u[d]=g}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const g={};if(this.deletedStates[d]===null)for(const y in this.state[d])g[y]={},this.state[d][y]={};else for(const y in this.deletedStates[d]){if(this.deletedStates[d][y]===null)this.state[d][y]={};else if(this.state[d][y])for(const b of Object.keys(this.deletedStates[d][y]))delete this.state[d][y][b];g[y]=this.state[d][y]}u[d]=u[d]||{},Wn(u[d],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in i)i[d].setFeatureState(u,a)}}class fT{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,a){const u=this.toIdx(i,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(i,a){return this.leaves[this.toIdx(i,a)]}toIdx(i,a){return a*this.size+i}}function dT(o,i,a,u){let d=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(a[y]<o[y]||a[y]>i[y])return null}else{const b=1/u[y];let T=(o[y]-a[y])*b,A=(i[y]-a[y])*b;if(T>A){const C=T;T=A,A=C}if(T>d&&(d=T),A<g&&(g=A),d>g)return null}return d}function pT(o,i,a,u,d,g,y,b,T,A,C){const k=u-o,O=d-i,B=g-a,F=y-o,j=b-i,K=T-a,ce=C[1]*K-C[2]*j,ve=C[2]*F-C[0]*K,ae=C[0]*j-C[1]*F,_e=k*ce+O*ve+B*ae;if(Math.abs(_e)<1e-15)return null;const Ee=1/_e,xe=A[0]-o,He=A[1]-i,je=A[2]-a,tt=(xe*ce+He*ve+je*ae)*Ee;if(tt<0||tt>1)return null;const vt=He*B-je*O,Xe=je*k-xe*B,it=xe*O-He*k,ot=(C[0]*vt+C[1]*Xe+C[2]*it)*Ee;return ot<0||tt+ot>1?null:(F*vt+j*Xe+K*it)*Ee}function mT(o,i,a){return(o-i)/(a-i)}function gT(o,i,a,u,d,g,y,b,T){const A=1<<a,C=g-u,k=y-d,O=(o+1)/A*C+u,B=(i+0)/A*k+d,F=(i+1)/A*k+d;b[0]=(o+0)/A*C+u,b[1]=B,T[0]=O,T[1]=F}class _T{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(g){const y=Math.ceil(Math.log2(g.dim/8)),b=[];let T=Math.ceil(Math.pow(2,y));const A=1/T,C=(B,F,j,K,ce)=>{const ve=K?1:0,ae=(B+1)*j-ve,_e=F*j,Ee=(F+1)*j-ve;ce[0]=B*j,ce[1]=_e,ce[2]=ae,ce[3]=Ee};let k=new fT(T);const O=[];for(let B=0;B<T*T;B++){C(B%T,Math.floor(B/T),A,!1,O);const F=fl(O[0],O[1],g),j=fl(O[2],O[1],g),K=fl(O[2],O[3],g),ce=fl(O[0],O[3],g);k.minimums.push(Math.min(F,j,K,ce)),k.maximums.push(Math.max(F,j,K,ce)),k.leaves.push(1)}for(b.push(k),T/=2;T>=1;T/=2){const B=b[b.length-1];k=new fT(T);for(let F=0;F<T*T;F++){C(F%T,Math.floor(F/T),2,!0,O);const j=B.getElevation(O[0],O[1]),K=B.getElevation(O[2],O[1]),ce=B.getElevation(O[2],O[3]),ve=B.getElevation(O[0],O[3]),ae=B.isLeaf(O[0],O[1]),_e=B.isLeaf(O[2],O[1]),Ee=B.isLeaf(O[2],O[3]),xe=B.isLeaf(O[0],O[3]),He=Math.min(j.min,K.min,ce.min,ve.min),je=Math.max(j.max,K.max,ce.max,ve.max),tt=ae&&_e&&Ee&&xe;k.maximums.push(je),k.minimums.push(He),k.leaves.push(je-He<=5&&tt?1:0)}b.push(k)}return b}(this.dem),u=a.length-1,d=a[u];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(i,a,u,d,g,y,b=1){return dT([i,a,-100],[u,d,this.maximums[0]*b],g,y)}raycast(i,a,u,d,g,y,b=1){if(!this.nodeCount)return null;const T=this.raycastRoot(i,a,u,d,g,y,b);if(T==null)return null;const A=[],C=[],k=[],O=[],B=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:F,t:j,nodex:K,nodey:ce,depth:ve}=B.pop();if(this.leaves[F]){gT(K,ce,ve,i,a,u,d,k,O);const _e=1<<ve,Ee=(K+0)/_e,xe=(K+1)/_e,He=(ce+0)/_e,je=(ce+1)/_e,tt=fl(Ee,He,this.dem)*b,vt=fl(xe,He,this.dem)*b,Xe=fl(xe,je,this.dem)*b,it=fl(Ee,je,this.dem)*b,ot=pT(k[0],k[1],tt,O[0],k[1],vt,O[0],O[1],Xe,g,y),mt=pT(O[0],O[1],Xe,k[0],O[1],it,k[0],k[1],tt,g,y),bt=Math.min(ot!==null?ot:Number.MAX_VALUE,mt!==null?mt:Number.MAX_VALUE);if(bt!==Number.MAX_VALUE)return bt;{const Ke=Nf([],g,y,j);if(yT(tt,vt,it,Xe,mT(Ke[0],k[0],O[0]),mT(Ke[1],k[1],O[1]))>=Ke[2])return j}continue}let ae=0;for(let _e=0;_e<this._siblingOffset.length;_e++){gT((K<<1)+this._siblingOffset[_e][0],(ce<<1)+this._siblingOffset[_e][1],ve+1,i,a,u,d,k,O),k[2]=-100,O[2]=this.maximums[this.childOffsets[F]+_e]*b;const Ee=dT(k,O,g,y);if(Ee!=null){const xe=Ee;A[_e]=xe;let He=!1;for(let je=0;je<ae&&!He;je++)xe>=A[C[je]]&&(C.splice(je,0,_e),He=!0);He||(C[ae]=_e),ae++}}for(let _e=0;_e<ae;_e++){const Ee=C[_e];B.push({idx:this.childOffsets[F]+Ee,t:A[Ee],nodex:(K<<1)+this._siblingOffset[Ee][0],nodey:(ce<<1)+this._siblingOffset[Ee][1],depth:ve+1})}}return null}_addNode(i,a,u){return this.minimums.push(i),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(i,a,u,d,g){if(i[d].isLeaf(a,u)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=d-1,b=i[y];let T=0,A=0;for(let C=0;C<this._siblingOffset.length;C++){const k=2*a+this._siblingOffset[C][0],O=2*u+this._siblingOffset[C][1],B=b.getElevation(k,O),F=b.isLeaf(k,O),j=this._addNode(B.min,B.max,F);F&&(T|=1<<C),A||(A=j)}for(let C=0;C<this._siblingOffset.length;C++)T&1<<C||this._construct(i,2*a+this._siblingOffset[C][0],2*u+this._siblingOffset[C][1],y,A+C)}}function yT(o,i,a,u,d,g){return Qn(Qn(o,a,g),Qn(i,u,g),d)}function fl(o,i,a){const u=a.dim,d=$t(o*u-.5,0,u-1),g=$t(i*u-.5,0,u-1),y=Math.floor(d),b=Math.floor(g),T=Math.min(y+1,u-1),A=Math.min(b+1,u-1);return yT(a.get(y,b),a.get(T,b),a.get(y,A),a.get(T,A),d-y,g-b)}const vT={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class pg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,a,u,d=!1,g=!1){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return ue(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const y=this.dim=a.height-2,b=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=u||"mapbox",this.borderReady=d,!d){for(let T=0;T<y;T++)b[this._idx(-1,T)]=b[this._idx(0,T)],b[this._idx(y,T)]=b[this._idx(y-1,T)],b[this._idx(T,-1)]=b[this._idx(T,0)],b[this._idx(T,y)]=b[this._idx(T,y-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(y,-1)]=b[this._idx(y-1,0)],b[this._idx(-1,y)]=b[this._idx(0,y-1)],b[this._idx(y,y)]=b[this._idx(y-1,y-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new _T(this)}get(i,a,u=!1){u&&(i=$t(i,-1,this.dim),a=$t(a,-1,this.dim));const d=4*this._idx(i,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[d],this.pixels[d+1],this.pixels[d+2])}static getUnpackVector(i){return vT[i]}get unpackVector(){return vT[this.encoding]}_idx(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)}_unpackMapbox(i,a,u){return(256*i*256+256*a+u)/10-1e4}_unpackTerrarium(i,a,u){return 256*i+a+u/256-32768}static pack(i,a){const u=[0,0,0,0],d=pg.getUnpackVector(a);let g=Math.floor((i+d[3])/d[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new Es({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,a,u){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let d=a*this.dim,g=a*this.dim+this.dim,y=u*this.dim,b=u*this.dim+this.dim;switch(a){case-1:d=g-1;break;case 1:g=d+1}switch(u){case-1:y=b-1;break;case 1:b=y+1}const T=-a*this.dim,A=-u*this.dim;for(let C=y;C<b;C++)for(let k=d;k<g;k++){const O=4*this._idx(k,C),B=4*this._idx(k+T,C+A);this.pixels[O+0]=i.pixels[B+0],this.pixels[O+1]=i.pixels[B+1],this.pixels[O+2]=i.pixels[B+2],this.pixels[O+3]=i.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Gt(pg,"DEMData"),Gt(_T,"DemMinMaxQuadTree",{omit:["dem"]});class JR{constructor(i,a){this.max=i,this.onRemove=a,this.reset()}reset(){for(const i in this.data)for(const a of this.data[i])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(i,a,u){const d=i.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const g={value:a,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout(()=>{this.remove(i,g)},u)),this.data[d].push(g),this.order.push(d),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const a=this.data[i].shift();return a.timeout&&clearTimeout(a.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),a.value}getByKey(i){const a=this.data[i];return a?a[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,a){if(!this.has(i))return this;const u=i.wrapped().key,d=a===void 0?0:this.data[u].indexOf(a),g=this.data[u][d];return this.data[u].splice(d,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(i){const a=[];for(const u in this.data)for(const d of this.data[u])i(d.value)||a.push(d);for(const u of a)this.remove(u.value.tileID,u)}}class Zu{constructor(i,a,u){this.func=i,this.mask=a,this.range=u}}Zu.ReadOnly=!1,Zu.ReadWrite=!0,Zu.disabled=new Zu(519,Zu.ReadOnly,[0,1]);const H0=7680;class W0{constructor(i,a,u,d,g,y){this.test=i,this.ref=a,this.mask=u,this.fail=d,this.depthFail=g,this.pass=y}}W0.disabled=new W0({func:519,mask:0},0,0,H0,H0,H0);class Yo{constructor(i,a,u){this.blendFunction=i,this.blendColor=a,this.mask=u}}Yo.Replace=[1,0],Yo.disabled=new Yo(Yo.Replace,ze.transparent,[!1,!1,!1,!1]),Yo.unblended=new Yo(Yo.Replace,ze.transparent,[!0,!0,!0,!0]),Yo.alphaBlended=new Yo([1,771],ze.transparent,[!0,!0,!0,!0]);const q0=1029,Z0=2305;class wo{constructor(i,a,u){this.enable=i,this.mode=a,this.frontFace=u}}wo.disabled=new wo(!1,q0,Z0),wo.backCCW=new wo(!0,q0,Z0),wo.backCW=new wo(!0,q0,2304),wo.frontCW=new wo(!0,1028,2304),wo.frontCCW=new wo(!0,1028,Z0);class xc extends fr{constructor(i,a,u){super(),this.id=i,this._onlySymbols=u,a.on("data",d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new JR(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new KR,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const a=this._tiles[i];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,a){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,a)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const u=this._tiles[a];u.upload(i),u.prepare(this.map.style.imageManager)}}getIds(){return Bn(this._tiles).map(i=>i.tileID).sort(xT).map(i=>i.key)}getRenderableIds(i){const a=[];for(const u in this._tiles)this._isIdRenderable(+u,i)&&a.push(this._tiles[u]);return i?a.sort((u,d)=>{const g=u.tileID,y=d.tileID,b=new ge(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),T=new ge(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-y.overscaledZ||T.y-b.y||T.x-b.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(xT).map(u=>u.key)}hasRenderableParent(i){const a=this.findLoadedParent(i,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(i,a){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(a||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,a){const u=this._tiles[i];u&&(u.state!=="loading"&&(u.state=a),this._loadTile(u,this._tileLoaded.bind(this,u,i,a)))}_tileLoaded(i,a,u,d){if(d)if(i.state="errored",d.status!==404)this._source.fire(new Er(d,{tile:i}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=Fn.now(),u==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(a,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new Dn("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const a=this.getRenderableIds();for(let d=0;d<a.length;d++){const g=a[d];if(i.neighboringTiles&&i.neighboringTiles[g]){const y=this.getTileByID(g);u(i,y),u(y,i)}}function u(d,g){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let y=g.tileID.canonical.x-d.tileID.canonical.x;const b=g.tileID.canonical.y-d.tileID.canonical.y,T=Math.pow(2,d.tileID.canonical.z),A=g.tileID.key;y===0&&b===0||Math.abs(b)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),g.dem&&d.dem&&(d.dem.backfillBorder(g.dem,y,b),d.neighboringTiles&&d.neighboringTiles[A]&&(d.neighboringTiles[A].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,a,u,d){for(const g in this._tiles){let y=this._tiles[g];if(d[g]||!y.hasData()||y.tileID.overscaledZ<=a||y.tileID.overscaledZ>u)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>a+1;){const A=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[A.key],y&&y.hasData()&&(b=A)}let T=b;for(;T.overscaledZ>a;)if(T=T.scaledTo(T.overscaledZ-1),i[T.key]){d[b.key]=b;break}}}findLoadedParent(i,a){if(i.key in this._loadedParentTiles){const u=this._loadedParentTiles[i.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=i.overscaledZ-1;u>=a;u--){const d=i.scaledTo(u),g=this._getLoadedTile(d);if(g)return g}}_getLoadedTile(i){const a=this._tiles[i.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,a){a=a||this._source.tileSize;const u=Math.ceil(i.width/a)+1,d=Math.ceil(i.height/a)+1,g=Math.floor(u*d*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(b)}handleWrapJump(i){const a=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,a){const u={};for(const d in this._tiles){const g=this._tiles[d];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),u[g.tileID.key]=g}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(i,a,u){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let d;this.updateCacheSize(i,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new ss(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(d=i.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(b=>this._source.hasTile(b)))):d=[];const g=this._updateRetainedTiles(d);if(bT(this._source.type)&&d.length!==0){const b={},T={},A=Object.keys(g);for(const k of A){const O=g[k],B=this._tiles[k];if(!B||B.fadeEndTime&&B.fadeEndTime<=Fn.now())continue;const F=this.findLoadedParent(O,Math.max(O.overscaledZ-xc.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),b[F.tileID.key]=F.tileID),T[k]=O}const C=d[d.length-1].overscaledZ;for(const k in this._tiles){const O=this._tiles[k];if(g[k]||!O.hasData())continue;let B=O.tileID;for(;B.overscaledZ>C;){B=B.scaledTo(B.overscaledZ-1);const F=this._tiles[B.key];if(F&&F.hasData()&&T[B.key]){g[k]=O.tileID;break}}}for(const k in b)g[k]||(this._coveredTiles[k]=!0,g[k]=b[k])}for(const b in g)this._tiles[b].clearFadeHold();const y=function(b,T){const A=[];for(const C in b)C in T||A.push(C);return A}(this._tiles,g);for(const b of y){const T=this._tiles[b];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const a={};if(i.length===0)return a;const u={},d=i.reduce((A,C)=>Math.min(A,C.overscaledZ),1/0),g=i[0].overscaledZ,y=Math.max(g-xc.maxOverzooming,this._source.minzoom),b=Math.max(g+xc.maxUnderzooming,this._source.minzoom),T={};for(const A of i){const C=this._addTile(A);a[A.key]=A,C.hasData()||d<this._source.maxzoom&&(T[A.key]=A)}this._retainLoadedChildren(T,d,b,a);for(const A of i){let C=this._tiles[A.key];if(C.hasData())continue;if(A.canonical.z>=this._source.maxzoom){const O=A.children(this._source.maxzoom)[0],B=this.getTile(O);if(B&&B.hasData()){a[O.key]=O;continue}}else{const O=A.children(this._source.maxzoom);if(a[O[0].key]&&a[O[1].key]&&a[O[2].key]&&a[O[3].key])continue}let k=C.wasRequested();for(let O=A.overscaledZ-1;O>=y;--O){const B=A.scaledTo(O);if(u[B.key]||(u[B.key]=!0,C=this.getTile(B),!C&&k&&(C=this._addTile(B)),C&&(a[B.key]=B,k=C.wasRequested(),C.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const a=[];let u,d=this._tiles[i].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}a.push(d.key);const g=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;d=g}for(const g of a)this._loadedParentTiles[g]=u}}_addTile(i){let a=this._tiles[i.key];if(a)return a;a=this._cache.getAndRemove(i),a&&(this._setTileReloadTimer(i.key,a),a.tileID=i,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,a)));const u=Boolean(a);if(!u){const d=this.map?this.map.painter:null;a=new $0(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,d,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,i.key,a.state))}return a?(a.uses++,this._tiles[i.key]=a,u||this._source.fire(new Dn("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(i,a){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const u=a.getExpiryTimeout();u&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},u))}_removeTile(i){const a=this._tiles[i];a&&(a.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,a,u){const d=[],g=this.transform;if(!g)return d;const y=g.projection.name==="globe",b=Ho(g.center.lng);for(const T in this._tiles){const A=this._tiles[T];if(u&&A.clearQueryDebugViz(),A.holdingForFade())continue;let C;if(y){const k=A.tileID.canonical;if(k.z===0){const O=[Math.abs($t(b,...ud(k,-1))-b),Math.abs($t(b,...ud(k,1))-b)];C=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs($t(b,...ud(k,-1))-b),Math.abs($t(b,...ud(k,0))-b),Math.abs($t(b,...ud(k,1))-b)];C=[O.indexOf(Math.min(...O))-1]}}else C=[0];for(const k of C){const O=i.containsTile(A,g,a,k);O&&d.push(O)}}return d}getVisibleCoordinates(i){const a=this.getRenderableIds(i).map(u=>this._tiles[u].tileID);for(const u of a)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(bT(this._source.type))for(const i in this._tiles){const a=this._tiles[i];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=Fn.now())return!0}return!1}setFeatureState(i,a,u){this._state.updateState(i=i||"_geojsonTileLayer",a,u)}removeFeatureState(i,a,u){this._state.removeFeatureState(i=i||"_geojsonTileLayer",a,u)}getFeatureState(i,a){return this._state.getState(i=i||"_geojsonTileLayer",a)}setDependencies(i,a,u){const d=this._tiles[i];d&&d.setDependencies(a,u)}reloadTilesForDependencies(i,a){for(const u in this._tiles)this._tiles[u].hasDependency(i,a)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(i,a))}_preloadTiles(i,a){const u=new Map,d=Array.isArray(i)?i:[i],g=this.map.painter.terrain,y=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const b of d){const T=b.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const A of T)u.set(A.key,A);this.usedForTerrain&&b.updateElevation(!1)}vn(Array.from(u.values()),(b,T)=>{const A=new $0(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(A,C=>{this._source.type==="raster-dem"&&A.dem&&this._backfillDEM(A),T(C,A)})},a)}}function xT(o,i){const a=Math.abs(2*o.wrap)-+(o.wrap<0),u=Math.abs(2*i.wrap)-+(i.wrap<0);return o.overscaledZ-i.overscaledZ||u-a||i.canonical.y-o.canonical.y||i.canonical.x-o.canonical.x}function bT(o){return o==="raster"||o==="image"||o==="video"||o==="custom"}function ud(o,i){const a=1<<o.z;return[o.x/a+i,(o.x+1)/a+i]}xc.maxOverzooming=10,xc.maxUnderzooming=3;class mg{constructor(i,a,u){this._demTile=i,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(i,a,u){const d=u||i.findDEMTileFor(a);if(!d||!d.dem)return;const g=d.dem,y=d.tileID,b=1<<a.canonical.z-y.canonical.z;return new mg(d,d.tileSize/Tn/b,[(a.canonical.x/b-y.canonical.x)*g.dim,(a.canonical.y/b-y.canonical.y)*g.dim])}tileCoordToPixel(i,a){const u=a*this._scale+this._offset[1],d=Math.floor(i*this._scale+this._offset[0]),g=Math.floor(u);return new ge(d,g)}getElevationAt(i,a,u,d){const g=i*this._scale+this._offset[0],y=a*this._scale+this._offset[1],b=Math.floor(g),T=Math.floor(y),A=this._dem;return d=!!d,u?Qn(Qn(A.get(b,T,d),A.get(b,T+1,d),y-T),Qn(A.get(b+1,T,d),A.get(b+1,T+1,d),y-T),g-b):A.get(b,T,d)}getElevationAtPixel(i,a,u){return this._dem.get(i,a,!!u)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*bo(1,i)*this._dem.stride}}class wT{constructor(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new el(Tn,16,0),this.featureIndexArray=new fw,this.promoteId=a}insert(i,a,u,d,g,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,g,y);const T=this.grid;for(let A=0;A<a.length;A++){const C=a[A],k=[1/0,1/0,-1/0,-1/0];for(let O=0;O<C.length;O++){const B=C[O];k[0]=Math.min(k[0],B.x),k[1]=Math.min(k[1],B.y),k[2]=Math.max(k[2],B.x),k[3]=Math.max(k[3],B.y)}k[0]<Tn&&k[1]<Tn&&k[2]>=0&&k[3]>=0&&T.insert(b,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new I0(new nd(this.rawTileData)).layers,this.sourceLayerCoder=new aT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,a,u,d){this.loadVTLayers();const g=i.params||{},y=vu(g.filter),b=i.tileResult,T=i.transform,A=b.bufferedTilespaceBounds,C=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,(F,j,K,ce)=>Yw(b.bufferedTilespaceGeometry,F,j,K,ce));C.sort(QR);let k=null;T.elevation&&C.length>0&&(k=mg.create(T.elevation,this.tileID));const O={};let B;for(let F=0;F<C.length;F++){const j=C[F];if(j===B)continue;B=j;const K=this.featureIndexArray.get(j);let ce=null;this.loadMatchingFeature(O,K,y,g.layers,g.availableImages,a,u,d,(ve,ae,_e,Ee=0)=>(ce||(ce=wa(ve,this.tileID.canonical,i.tileTransform)),ae.queryIntersectsFeature(b,ve,_e,ce,this.z,i.transform,i.pixelPosMatrix,k,Ee)))}return O}loadMatchingFeature(i,a,u,d,g,y,b,T,A){const{featureIndex:C,bucketIndex:k,sourceLayerIndex:O,layoutVertexArrayOffset:B}=a,F=this.bucketLayerIDs[k];if(d&&!function(ve,ae){for(let _e=0;_e<ve.length;_e++)if(ae.indexOf(ve[_e])>=0)return!0;return!1}(d,F))return;const j=this.sourceLayerCoder.decode(O),K=this.vtLayers[j].feature(C);if(u.needGeometry){const ve=gc(K,!0);if(!u.filter(new Be(this.tileID.overscaledZ),ve,this.tileID.canonical))return}else if(!u.filter(new Be(this.tileID.overscaledZ),K))return;const ce=this.getId(K,j);for(let ve=0;ve<F.length;ve++){const ae=F[ve];if(d&&d.indexOf(ae)<0)continue;const _e=y[ae];if(!_e)continue;let Ee={};ce!==void 0&&T&&(Ee=T.getState(_e.sourceLayer||"_geojsonTileLayer",ce));const xe=Wn({},b[ae]);xe.paint=ET(xe.paint,_e.paint,K,Ee,g),xe.layout=ET(xe.layout,_e.layout,K,Ee,g);const He=!A||A(K,_e,Ee,B);if(!He)continue;const je=new lT(K,this.z,this.x,this.y,ce);je.layer=xe;let tt=i[ae];tt===void 0&&(tt=i[ae]=[]),tt.push({featureIndex:C,feature:je,intersectionZ:He})}}lookupSymbolFeatures(i,a,u,d,g,y,b,T){const A={};this.loadVTLayers();const C=vu(g);for(const k of i)this.loadMatchingFeature(A,{bucketIndex:u,sourceLayerIndex:d,featureIndex:k,layoutVertexArrayOffset:0},C,y,b,T,a);return A}loadFeature(i){const{featureIndex:a,sourceLayerIndex:u}=i;this.loadVTLayers();const d=this.sourceLayerCoder.decode(u),g=this.vtFeatures[d];if(g[a])return g[a];const y=this.vtLayers[d].feature(a);return g[a]=y,y}hasLayer(i){for(const a of this.bucketLayerIDs)for(const u of a)if(i===u)return!0;return!1}getId(i,a){let u=i.id;if(this.promoteId){const d=typeof this.promoteId=="string"?this.promoteId:this.promoteId[a];d!=null&&(u=i.properties[d]),typeof u=="boolean"&&(u=Number(u))}return u}}function ET(o,i,a,u,d){return Ft(o,(g,y)=>{const b=i instanceof $e?i.get(y):null;return b&&b.evaluate?b.evaluate(a,u,d):b})}function QR(o,i){return i-o}Gt(wT,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class TT{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.image=new Ea({width:i,height:a}),this.positions={},this.uploaded=!1}getDash(i,a){const u=this.getKey(i,a);return this.positions[u]}trim(){const i=this.width,a=this.height=vi(this.nextRow);this.image.resize({width:i,height:a})}getKey(i,a){return i.join(",")+a}getDashRanges(i,a,u){const d=[];let g=i.length%2==1?-i[i.length-1]*u:0,y=i[0]*u,b=!0;d.push({left:g,right:y,isDash:b,zeroLength:i[0]===0});let T=i[0];for(let A=1;A<i.length;A++){b=!b;const C=i[A];g=T*u,T+=C,y=T*u,d.push({left:g,right:y,isDash:b,zeroLength:C===0})}return d}addRoundDash(i,a,u){const d=a/2;for(let g=-u;g<=u;g++){const y=this.width*(this.nextRow+u+g);let b=0,T=i[b];for(let A=0;A<this.width;A++){A/T.right>1&&(T=i[++b]);const C=Math.abs(A-T.left),k=Math.abs(A-T.right),O=Math.min(C,k);let B;const F=g/u*(d+1);if(T.isDash){const j=d-Math.abs(F);B=Math.sqrt(O*O+j*j)}else B=d-Math.sqrt(O*O+F*F);this.image.data[y+A]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(i,a){for(let T=i.length-1;T>=0;--T){const A=i[T],C=i[T+1];A.zeroLength?i.splice(T,1):C&&C.isDash===A.isDash&&(C.left=A.left,i.splice(T,1))}const u=i[0],d=i[i.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);const g=this.width*this.nextRow;let y=0,b=i[y];for(let T=0;T<this.width;T++){T/b.right>1&&(b=i[++y]);const A=Math.abs(T-b.left),C=Math.abs(T-b.right),k=Math.min(A,C);this.image.data[g+T]=Math.max(0,Math.min(255,(b.isDash?k:-k)+a+128))}}addDash(i,a){const u=this.getKey(i,a);if(this.positions[u])return this.positions[u];const d=a==="round",g=d?7:0,y=2*g+1;if(this.nextRow+y>this.height)return ue("LineAtlas out of space"),null;i.length===0&&i.push(1);let b=0;for(let C=0;C<i.length;C++)i[C]<0&&(ue("Negative value is found in line dasharray, replacing values with 0"),i[C]=0),b+=i[C];if(b!==0){const C=this.width/b,k=this.getDashRanges(i,this.width,C);d?this.addRoundDash(k,C,g):this.addRegularDash(k,a==="square"?.5*C:0)}const T=this.nextRow+g;this.nextRow+=y;const A={tl:[T,g],br:[b,0]};return this.positions[u]=A,A}}Gt(TT,"LineAtlas");class AT{constructor(i){const a={},u=[];for(const b in i){const T=i[b],A=a[b]={};for(const C in T.glyphs){const k=T.glyphs[+C];if(!k||k.bitmap.width===0||k.bitmap.height===0)continue;const O=k.metrics.localGlyph?2:1,B={x:0,y:0,w:k.bitmap.width+2*O,h:k.bitmap.height+2*O};u.push(B),A[C]=B}}const{w:d,h:g}=k0(u),y=new Ea({width:d||1,height:g||1});for(const b in i){const T=i[b];for(const A in T.glyphs){const C=T.glyphs[+A];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const k=a[b][A],O=C.metrics.localGlyph?2:1;Ea.copy(C.bitmap,y,{x:0,y:0},{x:k.x+O,y:k.y+O},C.bitmap)}}this.image=y,this.positions=a}}Gt(AT,"GlyphAtlas");class eO{constructor(i){this.tileID=new ss(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=vc(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,a,u,d,g){this.status="parsing",this.data=i,this.collisionBoxArray=new Ky;const y=new aT(Object.keys(i.layers).sort()),b=new wT(this.tileID,this.promoteId);b.bucketLayerIDs=[];const T={},A=new TT(256,256),C={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:A,availableImages:u},k=a.familiesBySource[this.source];for(const Ee in k){const xe=i.layers[Ee];if(!xe)continue;let He=!1,je=!1;for(const Xe of k[Ee])Xe[0].type==="symbol"?He=!0:je=!0;if(this.isSymbolTile===!0&&!He||this.isSymbolTile===!1&&!je)continue;xe.version===1&&ue(`Vector tile source "${this.source}" layer "${Ee}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const tt=y.encode(Ee),vt=[];for(let Xe=0;Xe<xe.length;Xe++){const it=xe.feature(Xe),ot=b.getId(it,Ee);vt.push({feature:it,id:ot,index:Xe,sourceLayerIndex:tt})}for(const Xe of k[Ee]){const it=Xe[0];this.isSymbolTile!==void 0&&it.type==="symbol"!==this.isSymbolTile||it.minzoom&&this.zoom<Math.floor(it.minzoom)||it.maxzoom&&this.zoom>=it.maxzoom||it.visibility!=="none"&&(X0(Xe,this.zoom,u),(T[it.id]=it.createBucket({index:b.bucketLayerIDs.length,layers:Xe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:tt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(vt,C,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(Xe.map(ot=>ot.id)))}}let O,B,F,j;A.trim();const K={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ce=Ft(C.glyphDependencies,Ee=>Object.keys(Ee).map(Number));Object.keys(ce).length?d.send("getGlyphs",{uid:this.uid,stacks:ce},(Ee,xe)=>{O||(O=Ee,B=xe,_e.call(this))},void 0,!1,K):B={};const ve=Object.keys(C.iconDependencies);ve.length?d.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"icons"},(Ee,xe)=>{O||(O=Ee,F=xe,_e.call(this))},void 0,!1,K):F={};const ae=Object.keys(C.patternDependencies);function _e(){if(O)return g(O);if(B&&F&&j){const Ee=new AT(B),xe=new OE(F,j);for(const He in T){const je=T[He];je instanceof cl?(X0(je.layers,this.zoom,u),PR(je,B,Ee.positions,F,xe.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):je.hasPattern&&(je instanceof Qm||je instanceof Zm||je instanceof Jf)&&(X0(je.layers,this.zoom,u),je.addFeatures(C,this.tileID.canonical,xe.patternPositions,u,this.tileTransform))}this.status="done",g(null,{buckets:Bn(T).filter(He=>!He.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ee.image,lineAtlas:A,imageAtlas:xe,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?F:null,glyphPositions:this.returnDependencies?Ee.positions:null})}}ae.length?d.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"patterns"},(Ee,xe)=>{O||(O=Ee,j=xe,_e.call(this))},void 0,!1,K):j={},_e.call(this)}}function X0(o,i,a){const u=new Be(i);for(const d of o)d.recalculate(u,a)}class ST{constructor(i){this.entries={},this.scheduler=i}request(i,a,u,d){const g=this.entries[i]=this.entries[i]||{callbacks:[]};if(g.result){const[y,b]=g.result;return this.scheduler?this.scheduler.add(()=>{d(y,b)},a):d(y,b),()=>{}}return g.callbacks.push(d),g.cancel||(g.cancel=u((y,b)=>{g.result=[y,b];for(const T of g.callbacks)this.scheduler?this.scheduler.add(()=>{T(y,b)},a):T(y,b);setTimeout(()=>delete this.entries[i],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(y=>y!==d),g.callbacks.length||(g.cancel(),delete this.entries[i]))}}}function MT(o,i,a){const u=JSON.stringify(o.request);return o.data&&(this.deduped.entries[u]={result:[null,o.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},d=>{const g=$n(o.request,(y,b,T,A)=>{y?d(y):b&&d(null,{vectorTile:a?void 0:new I0(new nd(b)),rawData:b,cacheControl:T,expires:A})});return()=>{g.cancel(),d()}},i)}s.ARRAY_TYPE=ws,s.AUTH_ERR_MSG=_r,s.Aabb=rs,s.Actor=class{constructor(o,i,a){this.target=o,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},zt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Qe()?o:v,this.scheduler=new XR}send(o,i,a,u,d=!1,g){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=g,this.callbacks[y]=a);const b=Dt(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:o,hasCallback:!!a,targetMapId:u,mustQueue:d,sourceMapId:this.mapId,data:rc(i,b)},b),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(o){const i=o.data,a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(i.mustQueue||Qe()){const u=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,i),u&&u.metadata||{type:"message"})}else this.processTask(a,i)}processTask(o,i){if(i.type==="<response>"){const a=this.callbacks[o];delete this.callbacks[o],a&&(i.error?a(sc(i.error)):a(null,sc(i.data)))}else{const a=Dt(this.globalScope)?void 0:[],u=i.hasCallback?(g,y)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:g?rc(g):null,data:rc(y,a)},a)}:g=>{},d=sc(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,d,u);else if(this.parent.getWorkerSource){const g=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,g[0],d.source)[g[1]](d,u)}else u(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=Jm,s.Color=ze,s.ColorMode=Yo,s.CullFaceMode=wo,s.DEMData=pg,s.DataConstantProperty=De,s.DedupedRequest=ST,s.DepthMode=Zu,s.EXTENT=Tn,s.Elevation=class{isDataAvailableAtPoint(o){const i=this._source();if(this.isUsingMockSource()||!i||o.y<0||o.y>1)return!1;const a=i.getSource().maxzoom,u=1<<a,d=Math.floor(o.x),g=Math.floor((o.x-d)*u),y=Math.floor(o.y*u),b=this.findDEMTileFor(new ss(a,d,a,g,y));return!(!b||!b.dem)}getAtPointOrZero(o,i=0){return this.getAtPoint(o,i)||0}getAtPoint(o,i,a=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const u=this._source();if(!u||o.y<0||o.y>1)return i;const d=u.getSource().maxzoom,g=1<<d,y=Math.floor(o.x),b=o.x-y,T=new ss(d,y,d,Math.floor(b*g),Math.floor(o.y*g)),A=this.findDEMTileFor(T);if(!A||!A.dem)return i;const C=A.dem,k=1<<A.tileID.canonical.z,O=(b*k-A.tileID.canonical.x)*C.dim,B=(o.y*k-A.tileID.canonical.y)*C.dim,F=Math.floor(O),j=Math.floor(B);return(a?this.exaggeration():1)*Qn(Qn(C.get(F,j),C.get(F,j+1),B-j),Qn(C.get(F+1,j),C.get(F+1,j+1),B-j),O-F)}getAtTileOffset(o,i,a){const u=1<<o.canonical.z;return this.getAtPointOrZero(new Du(o.wrap+(o.canonical.x+i/Tn)/u,(o.canonical.y+a/Tn)/u))}getAtTileOffsetFunc(o,i,a,u){return d=>{const g=this.getAtTileOffset(o,d.x,d.y),y=u.upVector(o.canonical,d.x,d.y);return Bs(y,y,g*u.upVectorScale(o.canonical,i,a).metersToTile),y}}getForTilePoints(o,i,a,u){if(this.isUsingMockSource())return!1;const d=mg.create(this,o,u);return!!d&&(i.forEach(g=>{g[2]=this.exaggeration()*d.getElevationAt(g[0],g[1],a)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(o);if(!i||!i.dem)return null;const a=i.dem.tree,u=i.tileID,d=1<<o.canonical.z-u.canonical.z;let g=o.canonical.x/d-u.canonical.x,y=o.canonical.y/d-u.canonical.y,b=0;for(let T=0;T<o.canonical.z-u.canonical.z&&!a.leaves[b];T++){g*=2,y*=2;const A=2*Math.floor(y)+Math.floor(g);b=a.childOffsets[b]+A,g%=1,y%=1}return{min:this.exaggeration()*a.minimums[b],max:this.exaggeration()*a.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,i,a){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=Er,s.EvaluationParameters=Be,s.Event=Dn,s.Evented=fr,s.FillExtrusionBucket=Jf,s.Frustum=c0,s.FrustumCorners=l0,s.GLOBE_RADIUS=Go,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=6,s.GLOBE_ZOOM_THRESHOLD_MIN=5,s.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,i){const a=new hn,u=new Fr,d=[],g=o+1+2,y=i[0]+1,b=i[0]+1+(1+i.length),T=(A,C,k)=>{let O=A===g-1?A-2:A===0?A:A-1;return O+=k?24575:0,[O,C]};for(let A=0;A<g;++A)a.emplaceBack(...T(A,0,!0));for(let A=0;A<y;++A)for(let C=0;C<g;++C)a.emplaceBack(...T(C,A,(C===0||C===g-1)&&!0));for(let A=0;A<i.length;++A){const C=i[A];for(let k=0;k<g;++k)a.emplaceBack(...T(k,C,!0))}for(let A=0;A<i.length;++A){const C=u.length,k=i[A]+1+2,O=new Fr;for(let j=0;j<k-1;j++){const K=j===k-2,ce=K?g*(b-i.length+A-j):g;for(let ve=0;ve<g-1;ve++){const ae=j*g+ve;j===0||K||ve===0||ve===g-2?(O.emplaceBack(ae+1,ae,ae+ce),O.emplaceBack(ae+ce,ae+ce+1,ae+1)):(u.emplaceBack(ae+1,ae,ae+ce),u.emplaceBack(ae+ce,ae+ce+1,ae+1))}}const B=ar.simpleSegment(0,C,a.length,u.length-C);for(let j=0;j<O.uint16.length;j+=3)u.emplaceBack(O.uint16[j],O.uint16[j+1],O.uint16[j+2]);const F=ar.simpleSegment(0,C,a.length,u.length-C);d.push({withoutSkirts:B,withSkirts:F})}return{vertices:a,indices:u,segments:d}}_createGrid(o){const i=this._fillGridMeshWithLods(pc,jf);this._gridSegments=i.segments,this._gridBuffer=o.createVertexBuffer(i.vertices,Vf.members),this._gridIndexBuffer=o.createIndexBuffer(i.indices,!0)}_createPoles(o){const i=new Fr;for(let d=0;d<=pc;d++)i.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=o.createIndexBuffer(i,!0);const a=new bs,u=new bs;this._poleSegments=[];for(let d=0,g=0;d<5;d++){const y=360/(1<<d);a.emplaceBack(0,-Go,0,.5,0),u.emplaceBack(0,-Go,0,.5,1);for(let b=0;b<=pc;b++){const T=b/pc,A=Qn(0,y,T),[C,k,O]=ku(X3,Y3,A,Go);a.emplaceBack(C,k,O,T,0),u.emplaceBack(C,k,O,T,1)}this._poleSegments.push(ar.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(a,kw,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(u,kw,!1)}getGridBuffers(o,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,i){if(!this._wireframeSegments){const a=new Vo,u=pc,d=u+1+2,g=1;this._wireframeSegments=[];for(let y=0,b=0;y<jf.length;y++){const T=jf[y];for(let C=g;C<T+g;C++)for(let k=g;k<u+g;k++){const O=C*d+k;a.emplaceBack(O,O+1),a.emplaceBack(O,O+d),a.emplaceBack(O,O+d+1)}const A=T*u*3;this._wireframeSegments.push(ar.simpleSegment(0,b,(T+1)*d,A)),b+=A}this._wireframeIndexBuffer=o.createIndexBuffer(a)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[i]]}},s.GlyphManager=Hu,s.ImagePosition=R0,s.LivePerformanceUtils=at,s.LngLat=ni,s.LngLatBounds=ol,s.LocalGlyphMode=z0,s.MAX_MERCATOR_LATITUDE=Ur,s.MercatorCoordinate=Du,s.ONE_EM=Vr,s.OverscaledTileID=ss,s.PerformanceMarkers=Ne,s.Properties=_t,s.RGBAImage=Es,s.Ray=a0,s.RequestManager=class{constructor(o,i,a){this._transformRequestFn=o,this._customAccessToken=i,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const o=function(){let i="";for(let a=0;a<10;a++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",we,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,i){return this._transformRequestFn&&this._transformRequestFn(o,i)||{url:o}}normalizeStyleURL(o,i){if(!ti(o))return o;const a=ir(o);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||i)}normalizeGlyphsURL(o,i){if(!ti(o))return o;const a=ir(o);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||i)}normalizeSourceURL(o,i,a,u){if(!ti(o))return o;const d=ir(o);return d.path=`/v4/${d.authority}.json`,d.params.push("secure"),a&&d.params.push(`language=${a}`),u&&d.params.push(`worldview=${u}`),this._makeAPIURL(d,this._customAccessToken||i)}normalizeSpriteURL(o,i,a,u){const d=ir(o);return ti(o)?(d.path=`/styles/v1${d.path}/sprite${i}${a}`,this._makeAPIURL(d,this._customAccessToken||u)):(d.path+=`${i}${a}`,ys(d))}normalizeTileURL(o,i,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!ti(o))return o;const u=ir(o);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||a&&u.authority!=="raster"&&a===512?"@2x":""}${R.supported?".webp":"$1"}`),u.authority==="raster"?u.path=`/${I.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${I.TILE_URL_VERSION}${u.path}`);const d=this._customAccessToken||function(g){for(const y of g){const b=y.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(u.params)||I.ACCESS_TOKEN;return I.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,d)}canonicalizeTileURL(o,i){const a=ir(o);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return o;let u="mapbox://";a.path.match(/^\/raster\/v1\//)?u+=`raster/${a.path.replace(`/${I.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${a.path.replace(`/${I.TILE_URL_VERSION}/`,"")}`;let d=a.params;return i&&(d=d.filter(g=>!g.match(/^access_token=/))),d.length&&(u+=`?${d.join("&")}`),u}canonicalizeTileset(o,i){const a=!!i&&ti(i),u=[];for(const d of o.tiles||[])ji(d)?u.push(this.canonicalizeTileURL(d,a)):u.push(d);return u}_makeAPIURL(o,i){const a="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=ir(I.API_URL);if(o.protocol=u.protocol,o.authority=u.authority,o.protocol==="http"){const d=o.params.indexOf("secure");d>=0&&o.params.splice(d,1)}if(u.path!=="/"&&(o.path=`${u.path}${o.path}`),!I.REQUIRE_ACCESS_TOKEN)return ys(o);if(i=i||I.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return o.params=o.params.filter(d=>d.indexOf("access_token")===-1),o.params.push(`access_token=${i||""}`),ys(o)}},s.ResourceType=gt,s.SegmentVector=ar,s.SourceCache=xc,s.StencilMode=W0,s.StructArrayLayout1ui2=jo,s.StructArrayLayout2f1f2i16=zr,s.StructArrayLayout2i4=hn,s.StructArrayLayout2ui4=Vo,s.StructArrayLayout3f12=Br,s.StructArrayLayout3ui6=Fr,s.StructArrayLayout4i8=mi,s.StructArrayLayout5f20=bs,s.Texture=cd,s.Tile=$0,s.Transitionable=At,s.Uniform1f=Om,s.Uniform1i=class extends va{constructor(o){super(o),this.current=0}set(o,i,a){this.fetchUniformLocation(o,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},s.Uniform2f=class extends va{constructor(o){super(o),this.current=[0,0]}set(o,i,a){this.fetchUniformLocation(o,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}},s.Uniform3f=class extends va{constructor(o){super(o),this.current=[0,0,0]}set(o,i,a){this.fetchUniformLocation(o,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}},s.Uniform4f=gw,s.UniformColor=_w,s.UniformMatrix2f=class extends va{constructor(o){super(o),this.current=O3}set(o,i,a){if(this.fetchUniformLocation(o,i)){for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}},s.UniformMatrix3f=class extends va{constructor(o){super(o),this.current=R3}set(o,i,a){if(this.fetchUniformLocation(o,i)){for(let u=0;u<9;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},s.UniformMatrix4f=class extends va{constructor(o){super(o),this.current=k3}set(o,i,a){if(this.fetchUniformLocation(o,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}},s.UnwrappedTileID=bE,s.ValidationError=Nt,s.VectorTileFeature=Ym,s.VectorTileWorkerSource=class extends fr{constructor(o,i,a,u,d){super(),this.actor=o,this.layerIndex=i,this.availableImages=a,this.loadVectorData=d||MT,this.loading={},this.loaded={},this.deduped=new ST(o.scheduler),this.isSpriteLoaded=u,this.scheduler=o.scheduler}loadTile(o,i){const a=o.uid,u=o&&o.request,d=u&&u.collectResourceTiming,g=this.loading[a]=new eO(o);g.abort=this.loadVectorData(o,(y,b)=>{const T=!this.loading[a];if(delete this.loading[a],T||y||!b)return g.status="done",T||(this.loaded[a]=g),i(y);const A=b.rawData,C={};b.expires&&(C.expires=b.expires),b.cacheControl&&(C.cacheControl=b.cacheControl),g.vectorTile=b.vectorTile||new I0(new nd(A));const k=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(O,B)=>{if(O||!B)return i(O);const F={};if(d){const j=Kt(u);j.length>0&&(F.resourceTiming=JSON.parse(JSON.stringify(j)))}i(null,Wn({rawTileData:A.slice(0)},B,C,F))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[a]=g})}reloadTile(o,i){const a=this.loaded,u=o.uid,d=this;if(a&&a[u]){const g=a[u];g.showCollisionBoxes=o.showCollisionBoxes,g.enableTerrain=!!o.enableTerrain,g.projection=o.projection,g.tileTransform=vc(o.tileID.canonical,o.projection);const y=(b,T)=>{const A=g.reloadCallback;A&&(delete g.reloadCallback,g.parse(g.vectorTile,d.layerIndex,this.availableImages,d.actor,A)),i(b,T)};g.status==="parsing"?g.reloadCallback=y:g.status==="done"&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(o,i){const a=o.uid,u=this.loading[a];u&&(u.abort&&u.abort(),delete this.loading[a]),i()}removeTile(o,i){const a=this.loaded,u=o.uid;a&&a[u]&&delete a[u],i()}},s.WritingMode=Ns,s.ZoomDependentExpression=_a,s.add=ba,s.addDynamicAttributes=hg,s.adjoint=function(o,i){var a=i[0],u=i[1],d=i[2],g=i[3],y=i[4],b=i[5],T=i[6],A=i[7],C=i[8];return o[0]=y*C-b*A,o[1]=d*A-u*C,o[2]=u*b-d*y,o[3]=b*T-g*C,o[4]=a*C-d*T,o[5]=d*g-a*b,o[6]=g*A-y*T,o[7]=u*T-a*A,o[8]=a*y-u*g,o},s.asyncAll=vn,s.bezier=an,s.bindAll=zt,s.boundsAttributes=uT,s.bufferConvexPolygon=function(o,i){const a=[];for(let u=0;u<o.length;u++){const d=yn(u-1,-1,o.length-1),g=yn(u+1,-1,o.length-1),y=o[u],b=o[g],T=o[d].sub(y).unit(),A=b.sub(y).unit(),C=A.angleWithSep(T.x,T.y),k=T.add(A).unit().mult(-1*i/Math.sin(C/2));a.push(y.add(k))}return a},s.cacheEntryPossiblyAdded=function(o){Fe++,Fe>dn&&(o.getActor().send("enforceCacheSizeLimit",tn),Fe=0)},s.calculateGlobeLabelMatrix=function(o,i){const{x:a,y:u}=o.point,d=Fw(a,u,o.worldSize/o._pixelsPerMercatorPixel,0,0);return hc(d,d,f0($o(i)))},s.calculateGlobeMatrix=function(o){const{x:i,y:a}=o.point,{lng:u,lat:d}=o._center;return Fw(i,a,o.worldSize,u,d)},s.calculateGlobeMercatorMatrix=function(o){const i=o.pixelsPerMeter,a=i/bo(1,o.center.lat),u=vo(new Float64Array(16));return Df(u,u,[o.point.x,o.point.y,0]),fc(u,u,[a,a,i]),Float32Array.from(u)},s.circumferenceAtLatitude=p0,s.clamp=$t,s.clearTileCache=function(o){if(!et())return;const i=v.caches.delete(ht);o&&i.catch(o).then(()=>o())},s.clipLine=WE,s.clone=function(o){var i=new ws(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},s.clone$1=xn,s.collisionCircleLayout=eR,s.config=I,s.conjugate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o[3]=i[3],o},s.create=function(){var o=new ws(16);return ws!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},s.create$1=vw,s.createExpression=Ya,s.createLayout=rn,s.createStyleLayer=function(o){return o.type==="custom"?new HR(o):new qR[o.type](o)},s.cross=o0,s.degToRad=ke,s.distance=function(o,i){return Math.hypot(i[0]-o[0],i[1]-o[1],i[2]-o[2])},s.div=function(o,i,a){return o[0]=i[0]/a[0],o[1]=i[1]/a[1],o[2]=i[2]/a[2],o},s.dot=eo,s.earthRadius=Hf,s.ease=ln,s.easeCubicInOut=gn,s.ecefToLatLng=function([o,i,a]){const u=Math.hypot(o,i,a),d=Math.atan2(o,a),g=.5*Math.PI-Math.acos(-i/u);return new ni(It(d),It(g))},s.emitValidationErrors=vm,s.endsWith=yt,s.enforceCacheSizeLimit=function(o){J(),Zt&&Zt.then(i=>{i.keys().then(a=>{for(let u=0;u<a.length-o;u++)i.delete(a[u])})})},s.evaluateSizeForFeature=eg,s.evaluateSizeForZoom=Vu,s.evaluateVariableOffset=KE,s.evented=pe,s.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]},s.exactEquals$1=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]},s.exported=Fn,s.exported$1=R,s.extend=Wn,s.extend$1=yr,s.fillExtrusionHeightLift=yE,s.filterObject=Jt,s.fromMat4=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[4],o[4]=i[5],o[5]=i[6],o[6]=i[8],o[7]=i[9],o[8]=i[10],o},s.fromQuat=function(o,i){var a=i[0],u=i[1],d=i[2],g=i[3],y=a+a,b=u+u,T=d+d,A=a*y,C=u*y,k=u*b,O=d*y,B=d*b,F=d*T,j=g*y,K=g*b,ce=g*T;return o[0]=1-k-F,o[1]=C+ce,o[2]=O-K,o[3]=0,o[4]=C-ce,o[5]=1-A-F,o[6]=B+j,o[7]=0,o[8]=O+K,o[9]=B-j,o[10]=1-A-k,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},s.fromRotation=function(o,i){var a=Math.sin(i),u=Math.cos(i);return o[0]=u,o[1]=a,o[2]=0,o[3]=-a,o[4]=u,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},s.fromScaling=bw,s.furthestTileCorner=function(o){const i=Math.round((o+45+360)%360/90)%4;return xt[i]},s.getAABBPointSquareDist=function(o,i,a){let u=0;for(let d=0;d<2;++d){const g=a?a[d]:0;o[d]>g&&(u+=(o[d]-g)*(o[d]-g)),i[d]<g&&(u+=(g-i[d])*(g-i[d]))}return u},s.getAnchorAlignment=D0,s.getAnchorJustification=F0,s.getBounds=function(o){let i=1/0,a=1/0,u=-1/0,d=-1/0;for(const g of o)i=Math.min(i,g.x),a=Math.min(a,g.y),u=Math.max(u,g.x),d=Math.max(d,g.y);return{min:new ge(i,a),max:new ge(u,d)}},s.getColumn=Mt,s.getGridMatrix=function(o,i,a,u){const d=i.getNorth(),g=i.getSouth(),y=i.getWest(),b=i.getEast(),T=1<<o.z,A=b-y,C=d-g,k=A/pc,O=-C/jf[a],B=[0,k,0,O,0,0,d,y,0];if(o.z>0){const F=180/u;xw(B,B,[F/A+1,0,0,0,F/C+1,0,-.5*F/k,.5*F/O,1])}return B[2]=T,B[5]=o.x,B[8]=o.y,B},s.getImage=Hn,s.getJSON=function(o,i){return fn(Wn(o,{type:"json"}),i)},s.getLatitudinalLod=function(o){const i=Ur-5;o=$t(o,-i,i)/i*90;const a=Math.pow(Math.abs(Math.sin(ke(o))),3);return Math.round(a*(jf.length-1))},s.getMapSessionAPI=Oe,s.getPerformanceMeasurement=Kt,s.getProjection=sT,s.getRTLTextPluginStatus=Te,s.getReferrer=sn,s.getTilePoint=function(o,{x:i,y:a},u=0){return new ge(((i-u)*o.scale-o.x)*Tn,(a*o.scale-o.y)*Tn)},s.getTileVec3=function(o,i,a=0){return Lu(((i.x-a)*o.scale-o.x)*Tn,(i.y*o.scale-o.y)*Tn,jw(i.z,i.y))},s.getVideo=function(o,i){const a=v.document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(let u=0;u<o.length;u++){const d=v.document.createElement("source");nn(o[u])||(a.crossOrigin="Anonymous"),d.src=o[u],a.appendChild(d)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(o){const i=[0,0,0],a=vo(new Float64Array(16));return hc(a,o.pixelMatrix,o.globeMatrix),er(i,i,a),new ge(i[0],i[1])},s.globeDenormalizeECEF=f0,s.globeECEFOrigin=function(o,i){const a=[0,0,0];return er(a,a,$f($o(i.canonical))),er(a,a,o),a},s.globeMetersToEcef=Fm,s.globeNormalizeECEF=$f,s.globePixelsToTileUnits=function(o,i){return Tn/(512*Math.pow(2,o))*Um($o(i))},s.globePoleMatrixForTile=function(o,i,a){const u=vo(new Float64Array(16)),d=(i/(1<<o)-.5)*Math.PI*2;return Bm(u,a.globeMatrix,d),Float32Array.from(u)},s.globeTileBounds=$o,s.globeTiltAtLngLat=Nw,s.globeToMercatorTransition=Ou,s.globeUseCustomAntiAliasing=function(o,i,a){const u=Ou(a.zoom),d=o.style.map._antialias,g=!!i.extStandardDerivatives,y=i.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return u===0&&!d&&!y&&g},s.identity=vo,s.identity$1=Iw,s.invert=n0,s.isFullscreen=function(){return!!v.document.fullscreenElement||!!v.document.webkitFullscreenElement},s.isLngLatBehindGlobe=d0,s.isMapAuthenticated=function(o){return Ie.has(o)},s.isMapboxURL=ti,s.isSafariWithAntialiasingBug=function(o){const i=o.navigator?o.navigator.userAgent:null;return!!Dt(o)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=Nr,s.latLngToECEF=Ru,s.len=G3,s.length=zf,s.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},s.lngFromMercatorX=Fs,s.loadVectorTile=MT,s.makeRequest=fn,s.mapValue=function(o,i,a,u,d){return $t((o-i)/(a-i)*(d-u)+u,u,d)},s.mercatorScale=Gw,s.mercatorXfromLng=Ho,s.mercatorYfromLat=Wo,s.mercatorZfromAltitude=bo,s.mul=V3,s.mul$1=j3,s.multiply=hc,s.multiply$1=xw,s.multiply$2=Tw,s.nextPowerOfTwo=vi,s.normalize=is,s.normalize$1=$3,s.normalize$2=Mw,s.number=Qn,s.ortho=function(o,i,a,u,d,g,y){var b=1/(i-a),T=1/(u-d),A=1/(g-y);return o[0]=-2*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*A,o[11]=0,o[12]=(i+a)*b,o[13]=(d+u)*T,o[14]=(y+g)*A,o[15]=1,o},s.pbf=nd,s.perspective=function(o,i,a,u,d){var g,y=1/Math.tan(i/2);return o[0]=y/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=y,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,d!=null&&d!==1/0?(o[10]=(d+u)*(g=1/(u-d)),o[14]=2*d*u*g):(o[10]=-1,o[14]=-2*u),o},s.pick=function(o,i){const a={};for(let u=0;u<i.length;u++){const d=i[u];d in o&&(a[d]=o[d])}return a},s.plugin=Ce,s.pointGeometry=ge,s.polesInViewport=function(o){const i=vo(new Float64Array(16));hc(i,o.pixelMatrix,o.globeMatrix);const a=[0,to,0],u=[0,no,0];return er(a,a,i),er(u,u,i),[a[0]>0&&a[0]<=o.width&&a[1]>0&&a[1]<=o.height&&!d0(o,new ni(o.center.lat,90)),u[0]>0&&u[0]<=o.width&&u[1]>0&&u[1]<=o.height&&!d0(o,new ni(o.center.lat,-90))]},s.polygonContainsPoint=_c,s.polygonIntersectsBox=Yw,s.polygonIntersectsPolygon=Ww,s.polygonizeBounds=function(o,i,a=0,u=!0){const d=new ge(a,a),g=o.sub(d),y=i.add(d),b=[g,new ge(y.x,g.y),y,new ge(g.x,y.y)];return u&&b.push(g.clone()),b},s.posAttributes=Vf,s.postMapLoadEvent=se,s.postPerformanceEvent=Se,s.postTurnstileEvent=U,s.potpack=k0,s.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},s.radToDeg=It,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(o){return o({pluginStatus:ie,pluginURL:W}),pe.on("pluginStateChange",o),o},s.removeAuthState=function(o){Ie.delete(o)},s.renderColorRamp=w0,s.resample=$w,s.rotateX=i0,s.rotateX$1=Cw,s.rotateY=Bm,s.rotateY$1=Lw,s.rotateZ=function(o,i,a){var u=Math.sin(a),d=Math.cos(a),g=i[0],y=i[1],b=i[2],T=i[3],A=i[4],C=i[5],k=i[6],O=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=g*d+A*u,o[1]=y*d+C*u,o[2]=b*d+k*u,o[3]=T*d+O*u,o[4]=A*d-g*u,o[5]=C*d-y*u,o[6]=k*d-b*u,o[7]=O*d-T*u,o},s.rotateZ$1=function(o,i,a){a*=.5;var u=i[0],d=i[1],g=i[2],y=i[3],b=Math.sin(a),T=Math.cos(a);return o[0]=u*T+d*b,o[1]=d*T-u*b,o[2]=g*T+y*b,o[3]=y*T-g*b,o},s.scale=fc,s.scale$1=Sw,s.scale$2=Bs,s.scaleAndAdd=Nf,s.set=function(o,i,a,u){return o[0]=i,o[1]=a,o[2]=u,o},s.setCacheLimits=function(o,i){tn=o,dn=i},s.setColumn=function(o,i,a){o[4*i+0]=a[0],o[4*i+1]=a[1],o[4*i+2]=a[2],o[4*i+3]=a[3]},s.setRTLTextPlugin=function(o,i,a=!1){if(ie===q||ie===ee||ie===Q)throw new Error("setRTLTextPlugin cannot be called multiple times.");W=Fn.resolveURL(o),ie=q,te=i,le(),a||be()},s.smoothstep=Mn,s.spec=Ze,s.squaredLength=function(o){var i=o[0],a=o[1],u=o[2];return i*i+a*a+u*u},s.storeAuthState=function(o,i){i?Ie.add(o):Ie.delete(o)},s.sub=xo,s.subtract=s0,s.symbolSize=tR,s.tileAABB=function(o,i,a,u,d,g,y,b,T){if(T.name==="globe")return Z3(o,i,new Jm(a,u,d));const A=vc({z:a,x:u,y:d},T);return new rs([(g+A.x/A.scale)*i,i*(A.y/A.scale),y],[(g+A.x2/A.scale)*i,i*(A.y2/A.scale),b])},s.tileCornersToBounds=Nm,s.tileTransform=vc,s.transformMat3=function(o,i,a){var u=i[0],d=i[1],g=i[2];return o[0]=u*a[0]+d*a[3]+g*a[6],o[1]=u*a[1]+d*a[4]+g*a[7],o[2]=u*a[2]+d*a[5]+g*a[8],o},s.transformMat4=er,s.transformMat4$1=dc,s.transformQuat=Aw,s.transitionTileAABBinECEF=Dw,s.translate=Df,s.transpose=function(o,i){if(o===i){var a=i[1],u=i[2],d=i[5];o[1]=i[3],o[2]=i[6],o[3]=a,o[5]=i[7],o[6]=u,o[7]=d}else o[0]=i[0],o[1]=i[3],o[2]=i[6],o[3]=i[1],o[4]=i[4],o[5]=i[7],o[6]=i[2],o[7]=i[5],o[8]=i[8];return o},s.triggerPluginCompletionEvent=fe,s.uniqueId=Kn,s.updateGlobeVertexNormal=function(o,i,a,u,d){const g=5*i+2;o.float32[g+0]=a,o.float32[g+1]=u,o.float32[g+2]=d},s.validateCustomStyleLayer=function(o){const i=[],a=o.id;return a===void 0&&i.push({message:`layers.${a}: missing required property "id"`}),o.render===void 0&&i.push({message:`layers.${a}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&i.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),i},s.validateFilter=o=>po(Af(o)),s.validateFog=o=>po(gm(o)),s.validateLayer=o=>po(Mf(o)),s.validateLight=o=>po(mm(o)),s.validateSource=o=>po(nc(o)),s.validateStyle=_m,s.validateTerrain=o=>po(Pf(o)),s.values=Bn,s.vectorTile=Xm,s.version=E,s.warnOnce=ue,s.window=v,s.wrap=yn}),h(["./shared"],function(s){function v(oe){if(typeof oe=="number"||typeof oe=="boolean"||typeof oe=="string"||oe==null)return JSON.stringify(oe);if(Array.isArray(oe)){let H="[";for(const se of oe)H+=`${v(se)},`;return`${H}]`}let U="{";for(const H of Object.keys(oe).sort())U+=`${H}:${v(oe[H])},`;return`${U}}`}function E(oe){let U="";for(const H of s.refProperties)U+=`/${v(oe[H])}`;return U}class M{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U){this._layerConfigs={},this._layers={},this.update(U,[])}update(U,H){for(const de of U)this._layerConfigs[de.id]=de,(this._layers[de.id]=s.createStyleLayer(de)).compileFilter(),this.keyCache[de.id]&&delete this.keyCache[de.id];for(const de of H)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const se=function(de,Se){const Re={};for(let Ie=0;Ie<de.length;Ie++){const Ne=Se&&Se[de[Ie].id]||E(de[Ie]);Se&&(Se[de[Ie].id]=Ne);let at=Re[Ne];at||(at=Re[Ne]=[]),at.push(de[Ie])}const Oe=[];for(const Ie in Re)Oe.push(Re[Ie]);return Oe}(s.values(this._layerConfigs),this.keyCache);for(const de of se){const Se=de.map(Ot=>this._layers[Ot.id]),Re=Se[0];if(Re.visibility==="none")continue;const Oe=Re.source||"";let Ie=this.familiesBySource[Oe];Ie||(Ie=this.familiesBySource[Oe]={});const Ne=Re.sourceLayer||"_geojsonTileLayer";let at=Ie[Ne];at||(at=Ie[Ne]=[]),at.push(Se)}}}class I{loadTile(U,H){const{uid:se,encoding:de,rawImageData:Se,padding:Re,buildQuadTree:Oe}=U,Ie=s.window.ImageBitmap&&Se instanceof s.window.ImageBitmap?this.getImageData(Se,Re):Se;H(null,new s.DEMData(se,Ie,de,Re<1,Oe))}getImageData(U,H){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const se=this.offscreenCanvasContext.getImageData(-H,-H,U.width+2*H,U.height+2*H);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),se}}var R=function oe(U,H){var se,de=U&&U.type;if(de==="FeatureCollection")for(se=0;se<U.features.length;se++)oe(U.features[se],H);else if(de==="GeometryCollection")for(se=0;se<U.geometries.length;se++)oe(U.geometries[se],H);else if(de==="Feature")oe(U.geometry,H);else if(de==="Polygon")N(U.coordinates,H);else if(de==="MultiPolygon")for(se=0;se<U.coordinates.length;se++)N(U.coordinates[se],H);return U};function N(oe,U){if(oe.length!==0){$(oe[0],U);for(var H=1;H<oe.length;H++)$(oe[H],!U)}}function $(oe,U){for(var H=0,se=0,de=0,Se=oe.length,Re=Se-1;de<Se;Re=de++){var Oe=(oe[de][0]-oe[Re][0])*(oe[Re][1]+oe[de][1]),Ie=H+Oe;se+=Math.abs(H)>=Math.abs(Oe)?H-Ie+Oe:Oe-Ie+H,H=Ie}H+se>=0!=!!U&&oe.reverse()}const Z=s.VectorTileFeature.prototype.toGeoJSON;class ne{constructor(U){this._feature=U,this.extent=s.EXTENT,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))}loadGeometry(){if(this._feature.type===1){const U=[];for(const H of this._feature.geometry)U.push([new s.pointGeometry(H[0],H[1])]);return U}{const U=[];for(const H of this._feature.geometry){const se=[];for(const de of H)se.push(new s.pointGeometry(de[0],de[1]));U.push(se)}return U}}toGeoJSON(U,H,se){return Z.call(this,U,H,se)}}class me{constructor(U){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=U.length,this._features=U}feature(U){return new ne(this._features[U])}}var we={},he={get exports(){return we},set exports(oe){we=oe}},Pe=s.pointGeometry,ge=s.vectorTile.VectorTileFeature,nt=Tt;function Tt(oe,U){this.options=U||{},this.features=oe,this.length=oe.length}function Rt(oe,U){this.id=typeof oe.id=="number"?oe.id:void 0,this.type=oe.type,this.rawGeometry=oe.type===1?[oe.geometry]:oe.geometry,this.properties=oe.tags,this.extent=U||4096}Tt.prototype.feature=function(oe){return new Rt(this.features[oe],this.options.extent)},Rt.prototype.loadGeometry=function(){var oe=this.rawGeometry;this.geometry=[];for(var U=0;U<oe.length;U++){for(var H=oe[U],se=[],de=0;de<H.length;de++)se.push(new Pe(H[de][0],H[de][1]));this.geometry.push(se)}return this.geometry},Rt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var oe=this.geometry,U=1/0,H=-1/0,se=1/0,de=-1/0,Se=0;Se<oe.length;Se++)for(var Re=oe[Se],Oe=0;Oe<Re.length;Oe++){var Ie=Re[Oe];U=Math.min(U,Ie.x),H=Math.max(H,Ie.x),se=Math.min(se,Ie.y),de=Math.max(de,Ie.y)}return[U,se,H,de]},Rt.prototype.toGeoJSON=ge.prototype.toGeoJSON;var ke=s.pbf,It=nt;function xt(oe){var U=new ke;return function(H,se){for(var de in H.layers)se.writeMessage(3,gn,H.layers[de])}(oe,U),U.finish()}function gn(oe,U){var H;U.writeVarintField(15,oe.version||1),U.writeStringField(1,oe.name||""),U.writeVarintField(5,oe.extent||4096);var se={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<oe.length;H++)se.feature=oe.feature(H),U.writeMessage(2,an,se);var de=se.keys;for(H=0;H<de.length;H++)U.writeStringField(3,de[H]);var Se=se.values;for(H=0;H<Se.length;H++)U.writeMessage(4,vn,Se[H])}function an(oe,U){var H=oe.feature;H.id!==void 0&&U.writeVarintField(1,H.id),U.writeMessage(2,ln,oe),U.writeVarintField(3,H.type),U.writeMessage(4,yn,H)}function ln(oe,U){var H=oe.feature,se=oe.keys,de=oe.values,Se=oe.keycache,Re=oe.valuecache;for(var Oe in H.properties){var Ie=H.properties[Oe],Ne=Se[Oe];if(Ie!==null){Ne===void 0&&(se.push(Oe),Se[Oe]=Ne=se.length-1),U.writeVarint(Ne);var at=typeof Ie;at!=="string"&&at!=="boolean"&&at!=="number"&&(Ie=JSON.stringify(Ie));var Ot=at+":"+Ie,dt=Re[Ot];dt===void 0&&(de.push(Ie),Re[Ot]=dt=de.length-1),U.writeVarint(dt)}}}function $t(oe,U){return(U<<3)+(7&oe)}function Mn(oe){return oe<<1^oe>>31}function yn(oe,U){for(var H=oe.loadGeometry(),se=oe.type,de=0,Se=0,Re=H.length,Oe=0;Oe<Re;Oe++){var Ie=H[Oe],Ne=1;se===1&&(Ne=Ie.length),U.writeVarint($t(1,Ne));for(var at=se===3?Ie.length-1:Ie.length,Ot=0;Ot<at;Ot++){Ot===1&&se!==1&&U.writeVarint($t(2,at-1));var dt=Ie[Ot].x-de,Kt=Ie[Ot].y-Se;U.writeVarint(Mn(dt)),U.writeVarint(Mn(Kt)),de+=dt,Se+=Kt}se===3&&U.writeVarint($t(7,1))}}function vn(oe,U){var H=typeof oe;H==="string"?U.writeStringField(1,oe):H==="boolean"?U.writeBooleanField(7,oe):H==="number"&&(oe%1!=0?U.writeDoubleField(3,oe):oe<0?U.writeSVarintField(6,oe):U.writeVarintField(5,oe))}function Bn(oe,U,H,se,de,Se){if(de-se<=H)return;const Re=se+de>>1;Wn(oe,U,Re,se,de,Se%2),Bn(oe,U,H,se,Re-1,Se+1),Bn(oe,U,H,Re+1,de,Se+1)}function Wn(oe,U,H,se,de,Se){for(;de>se;){if(de-se>600){const Ne=de-se+1,at=H-se+1,Ot=Math.log(Ne),dt=.5*Math.exp(2*Ot/3),Kt=.5*Math.sqrt(Ot*dt*(Ne-dt)/Ne)*(at-Ne/2<0?-1:1);Wn(oe,U,H,Math.max(se,Math.floor(H-at*dt/Ne+Kt)),Math.min(de,Math.floor(H+(Ne-at)*dt/Ne+Kt)),Se)}const Re=U[2*H+Se];let Oe=se,Ie=de;for(pi(oe,U,se,H),U[2*de+Se]>Re&&pi(oe,U,se,de);Oe<Ie;){for(pi(oe,U,Oe,Ie),Oe++,Ie--;U[2*Oe+Se]<Re;)Oe++;for(;U[2*Ie+Se]>Re;)Ie--}U[2*se+Se]===Re?pi(oe,U,se,Ie):(Ie++,pi(oe,U,Ie,de)),Ie<=H&&(se=Ie+1),H<=Ie&&(de=Ie-1)}}function pi(oe,U,H,se){Kn(oe,H,se),Kn(U,2*H,2*se),Kn(U,2*H+1,2*se+1)}function Kn(oe,U,H){const se=oe[U];oe[U]=oe[H],oe[H]=se}function Ii(oe,U,H,se){const de=oe-H,Se=U-se;return de*de+Se*Se}he.exports=xt,we.fromVectorTileJs=xt,we.fromGeojsonVt=function(oe,U){U=U||{};var H={};for(var se in oe)H[se]=new It(oe[se].features,U),H[se].name=se,H[se].version=U.version,H[se].extent=U.extent;return xt({layers:H})},we.GeoJSONWrapper=It;const vi=oe=>oe[0],lt=oe=>oe[1];class zt{constructor(U,H=vi,se=lt,de=64,Se=Float64Array){this.nodeSize=de,this.points=U;const Re=U.length<65536?Uint16Array:Uint32Array,Oe=this.ids=new Re(U.length),Ie=this.coords=new Se(2*U.length);for(let Ne=0;Ne<U.length;Ne++)Oe[Ne]=Ne,Ie[2*Ne]=H(U[Ne]),Ie[2*Ne+1]=se(U[Ne]);Bn(Oe,Ie,de,0,Oe.length-1,0)}range(U,H,se,de){return function(Se,Re,Oe,Ie,Ne,at,Ot){const dt=[0,Se.length-1,0],Kt=[];let Yt,Wt;for(;dt.length;){const cn=dt.pop(),Pn=dt.pop(),Fn=dt.pop();if(Pn-Fn<=Ot){for(let Dn=Fn;Dn<=Pn;Dn++)Yt=Re[2*Dn],Wt=Re[2*Dn+1],Yt>=Oe&&Yt<=Ne&&Wt>=Ie&&Wt<=at&&Kt.push(Se[Dn]);continue}const pn=Math.floor((Fn+Pn)/2);Yt=Re[2*pn],Wt=Re[2*pn+1],Yt>=Oe&&Yt<=Ne&&Wt>=Ie&&Wt<=at&&Kt.push(Se[pn]);const qn=(cn+1)%2;(cn===0?Oe<=Yt:Ie<=Wt)&&(dt.push(Fn),dt.push(pn-1),dt.push(qn)),(cn===0?Ne>=Yt:at>=Wt)&&(dt.push(pn+1),dt.push(Pn),dt.push(qn))}return Kt}(this.ids,this.coords,U,H,se,de,this.nodeSize)}within(U,H,se){return function(de,Se,Re,Oe,Ie,Ne){const at=[0,de.length-1,0],Ot=[],dt=Ie*Ie;for(;at.length;){const Kt=at.pop(),Yt=at.pop(),Wt=at.pop();if(Yt-Wt<=Ne){for(let qn=Wt;qn<=Yt;qn++)Ii(Se[2*qn],Se[2*qn+1],Re,Oe)<=dt&&Ot.push(de[qn]);continue}const cn=Math.floor((Wt+Yt)/2),Pn=Se[2*cn],Fn=Se[2*cn+1];Ii(Pn,Fn,Re,Oe)<=dt&&Ot.push(de[cn]);const pn=(Kt+1)%2;(Kt===0?Re-Ie<=Pn:Oe-Ie<=Fn)&&(at.push(Wt),at.push(cn-1),at.push(pn)),(Kt===0?Re+Ie>=Pn:Oe+Ie>=Fn)&&(at.push(cn+1),at.push(Yt),at.push(pn))}return Ot}(this.ids,this.coords,U,H,se,this.nodeSize)}}const yt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:oe=>oe},Ft=Math.fround||(Jt=new Float32Array(1),oe=>(Jt[0]=+oe,Jt[0]));var Jt;class xn{constructor(U){this.options=Dt(Object.create(yt),U),this.trees=new Array(this.options.maxZoom+1)}load(U){const{log:H,minZoom:se,maxZoom:de,nodeSize:Se}=this.options;H&&console.time("total time");const Re=`prepare ${U.length} points`;H&&console.time(Re),this.points=U;let Oe=[];for(let Ie=0;Ie<U.length;Ie++)U[Ie].geometry&&Oe.push(ue(U[Ie],Ie));this.trees[de+1]=new zt(Oe,Pt,Mt,Se,Float32Array),H&&console.timeEnd(Re);for(let Ie=de;Ie>=se;Ie--){const Ne=+Date.now();Oe=this._cluster(Oe,Ie),this.trees[Ie]=new zt(Oe,Pt,Mt,Se,Float32Array),H&&console.log("z%d: %d clusters in %dms",Ie,Oe.length,+Date.now()-Ne)}return H&&console.timeEnd("total time"),this}getClusters(U,H){let se=((U[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,U[1]));let Se=U[2]===180?180:((U[2]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)se=-180,Se=180;else if(se>Se){const at=this.getClusters([se,de,180,Re],H),Ot=this.getClusters([-180,de,Se,Re],H);return at.concat(Ot)}const Oe=this.trees[this._limitZoom(H)],Ie=Oe.range(Qe(se),st(Re),Qe(Se),st(de)),Ne=[];for(const at of Ie){const Ot=Oe.points[at];Ne.push(Ot.numPoints?Me(Ot):this.points[Ot.index])}return Ne}getChildren(U){const H=this._getOriginId(U),se=this._getOriginZoom(U),de="No cluster with the specified id.",Se=this.trees[se];if(!Se)throw new Error(de);const Re=Se.points[H];if(!Re)throw new Error(de);const Oe=this.options.radius/(this.options.extent*Math.pow(2,se-1)),Ie=Se.within(Re.x,Re.y,Oe),Ne=[];for(const at of Ie){const Ot=Se.points[at];Ot.parentId===U&&Ne.push(Ot.numPoints?Me(Ot):this.points[Ot.index])}if(Ne.length===0)throw new Error(de);return Ne}getLeaves(U,H,se){const de=[];return this._appendLeaves(de,U,H=H||10,se=se||0,0),de}getTile(U,H,se){const de=this.trees[this._limitZoom(U)],Se=Math.pow(2,U),{extent:Re,radius:Oe}=this.options,Ie=Oe/Re,Ne=(se-Ie)/Se,at=(se+1+Ie)/Se,Ot={features:[]};return this._addTileFeatures(de.range((H-Ie)/Se,Ne,(H+1+Ie)/Se,at),de.points,H,se,Se,Ot),H===0&&this._addTileFeatures(de.range(1-Ie/Se,Ne,1,at),de.points,Se,se,Se,Ot),H===Se-1&&this._addTileFeatures(de.range(0,Ne,Ie/Se,at),de.points,-1,se,Se,Ot),Ot.features.length?Ot:null}getClusterExpansionZoom(U){let H=this._getOriginZoom(U)-1;for(;H<=this.options.maxZoom;){const se=this.getChildren(U);if(H++,se.length!==1)break;U=se[0].properties.cluster_id}return H}_appendLeaves(U,H,se,de,Se){const Re=this.getChildren(H);for(const Oe of Re){const Ie=Oe.properties;if(Ie&&Ie.cluster?Se+Ie.point_count<=de?Se+=Ie.point_count:Se=this._appendLeaves(U,Ie.cluster_id,se,de,Se):Se<de?Se++:U.push(Oe),U.length===se)break}return Se}_addTileFeatures(U,H,se,de,Se,Re){for(const Oe of U){const Ie=H[Oe],Ne=Ie.numPoints;let at,Ot,dt;if(Ne)at=Ve(Ie),Ot=Ie.x,dt=Ie.y;else{const Wt=this.points[Ie.index];at=Wt.properties,Ot=Qe(Wt.geometry.coordinates[0]),dt=st(Wt.geometry.coordinates[1])}const Kt={type:1,geometry:[[Math.round(this.options.extent*(Ot*Se-se)),Math.round(this.options.extent*(dt*Se-de))]],tags:at};let Yt;Ne?Yt=Ie.id:this.options.generateId?Yt=Ie.index:this.points[Ie.index].id&&(Yt=this.points[Ie.index].id),Yt!==void 0&&(Kt.id=Yt),Re.features.push(Kt)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,H){const se=[],{radius:de,extent:Se,reduce:Re,minPoints:Oe}=this.options,Ie=de/(Se*Math.pow(2,H));for(let Ne=0;Ne<U.length;Ne++){const at=U[Ne];if(at.zoom<=H)continue;at.zoom=H;const Ot=this.trees[H+1],dt=Ot.within(at.x,at.y,Ie),Kt=at.numPoints||1;let Yt=Kt;for(const Wt of dt){const cn=Ot.points[Wt];cn.zoom>H&&(Yt+=cn.numPoints||1)}if(Yt>Kt&&Yt>=Oe){let Wt=at.x*Kt,cn=at.y*Kt,Pn=Re&&Kt>1?this._map(at,!0):null;const Fn=(Ne<<5)+(H+1)+this.points.length;for(const pn of dt){const qn=Ot.points[pn];if(qn.zoom<=H)continue;qn.zoom=H;const Dn=qn.numPoints||1;Wt+=qn.x*Dn,cn+=qn.y*Dn,qn.parentId=Fn,Re&&(Pn||(Pn=this._map(at,!0)),Re(Pn,this._map(qn)))}at.parentId=Fn,se.push(wn(Wt/Yt,cn/Yt,Fn,Yt,Pn))}else if(se.push(at),Yt>1)for(const Wt of dt){const cn=Ot.points[Wt];cn.zoom<=H||(cn.zoom=H,se.push(cn))}}return se}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,H){if(U.numPoints)return H?Dt({},U.properties):U.properties;const se=this.points[U.index].properties,de=this.options.map(se);return H&&de===se?Dt({},de):de}}function wn(oe,U,H,se,de){return{x:Ft(oe),y:Ft(U),zoom:1/0,id:H,parentId:-1,numPoints:se,properties:de}}function ue(oe,U){const[H,se]=oe.geometry.coordinates;return{x:Ft(Qe(H)),y:Ft(st(se)),zoom:1/0,index:U,parentId:-1}}function Me(oe){return{type:"Feature",id:oe.id,properties:Ve(oe),geometry:{type:"Point",coordinates:[(U=oe.x,360*(U-.5)),St(oe.y)]}};var U}function Ve(oe){const U=oe.numPoints,H=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U;return Dt(Dt({},oe.properties),{cluster:!0,cluster_id:oe.id,point_count:U,point_count_abbreviated:H})}function Qe(oe){return oe/360+.5}function st(oe){const U=Math.sin(oe*Math.PI/180),H=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return H<0?0:H>1?1:H}function St(oe){const U=(180-360*oe)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function Dt(oe,U){for(const H in U)oe[H]=U[H];return oe}function Pt(oe){return oe.x}function Mt(oe){return oe.y}function ht(oe,U,H,se){for(var de,Se=se,Re=H-U>>1,Oe=H-U,Ie=oe[U],Ne=oe[U+1],at=oe[H],Ot=oe[H+1],dt=U+3;dt<H;dt+=3){var Kt=Zt(oe[dt],oe[dt+1],Ie,Ne,at,Ot);if(Kt>Se)de=dt,Se=Kt;else if(Kt===Se){var Yt=Math.abs(dt-Re);Yt<Oe&&(de=dt,Oe=Yt)}}Se>se&&(de-U>3&&ht(oe,U,de,se),oe[de+2]=Se,H-de>3&&ht(oe,de,H,se))}function Zt(oe,U,H,se,de,Se){var Re=de-H,Oe=Se-se;if(Re!==0||Oe!==0){var Ie=((oe-H)*Re+(U-se)*Oe)/(Re*Re+Oe*Oe);Ie>1?(H=de,se=Se):Ie>0&&(H+=Re*Ie,se+=Oe*Ie)}return(Re=oe-H)*Re+(Oe=U-se)*Oe}function jt(oe,U,H,se){var de={id:oe===void 0?null:oe,type:U,geometry:H,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Se){var Re=Se.geometry,Oe=Se.type;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")tn(Se,Re);else if(Oe==="Polygon"||Oe==="MultiLineString")for(var Ie=0;Ie<Re.length;Ie++)tn(Se,Re[Ie]);else if(Oe==="MultiPolygon")for(Ie=0;Ie<Re.length;Ie++)for(var Ne=0;Ne<Re[Ie].length;Ne++)tn(Se,Re[Ie][Ne])}(de),de}function tn(oe,U){for(var H=0;H<U.length;H+=3)oe.minX=Math.min(oe.minX,U[H]),oe.minY=Math.min(oe.minY,U[H+1]),oe.maxX=Math.max(oe.maxX,U[H]),oe.maxY=Math.max(oe.maxY,U[H+1])}function dn(oe,U,H,se){if(U.geometry){var de=U.geometry.coordinates,Se=U.geometry.type,Re=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2),Oe=[],Ie=U.id;if(H.promoteId?Ie=U.properties[H.promoteId]:H.generateId&&(Ie=se||0),Se==="Point")et(de,Oe);else if(Se==="MultiPoint")for(var Ne=0;Ne<de.length;Ne++)et(de[Ne],Oe);else if(Se==="LineString")J(de,Oe,Re,!1);else if(Se==="MultiLineString"){if(H.lineMetrics){for(Ne=0;Ne<de.length;Ne++)J(de[Ne],Oe=[],Re,!1),oe.push(jt(Ie,"LineString",Oe,U.properties));return}G(de,Oe,Re,!1)}else if(Se==="Polygon")G(de,Oe,Re,!0);else{if(Se!=="MultiPolygon"){if(Se==="GeometryCollection"){for(Ne=0;Ne<U.geometry.geometries.length;Ne++)dn(oe,{id:Ie,geometry:U.geometry.geometries[Ne],properties:U.properties},H,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ne=0;Ne<de.length;Ne++){var at=[];G(de[Ne],at,Re,!0),Oe.push(at)}}oe.push(jt(Ie,Se,Oe,U.properties))}}function et(oe,U){U.push(Fe(oe[0])),U.push(gt(oe[1])),U.push(0)}function J(oe,U,H,se){for(var de,Se,Re=0,Oe=0;Oe<oe.length;Oe++){var Ie=Fe(oe[Oe][0]),Ne=gt(oe[Oe][1]);U.push(Ie),U.push(Ne),U.push(0),Oe>0&&(Re+=se?(de*Ne-Ie*Se)/2:Math.sqrt(Math.pow(Ie-de,2)+Math.pow(Ne-Se,2))),de=Ie,Se=Ne}var at=U.length-3;U[2]=1,ht(U,0,at,H),U[at+2]=1,U.size=Math.abs(Re),U.start=0,U.end=U.size}function G(oe,U,H,se){for(var de=0;de<oe.length;de++){var Se=[];J(oe[de],Se,H,se),U.push(Se)}}function Fe(oe){return oe/360+.5}function gt(oe){var U=Math.sin(oe*Math.PI/180),H=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return H<0?0:H>1?1:H}function ct(oe,U,H,se,de,Se,Re,Oe){if(se/=U,Se>=(H/=U)&&Re<se)return oe;if(Re<H||Se>=se)return null;for(var Ie=[],Ne=0;Ne<oe.length;Ne++){var at=oe[Ne],Ot=at.geometry,dt=at.type,Kt=de===0?at.minX:at.minY,Yt=de===0?at.maxX:at.maxY;if(Kt>=H&&Yt<se)Ie.push(at);else if(!(Yt<H||Kt>=se)){var Wt=[];if(dt==="Point"||dt==="MultiPoint")sn(Ot,Wt,H,se,de);else if(dt==="LineString")fn(Ot,Wt,H,se,de,!1,Oe.lineMetrics);else if(dt==="MultiLineString")nn(Ot,Wt,H,se,de,!1);else if(dt==="Polygon")nn(Ot,Wt,H,se,de,!0);else if(dt==="MultiPolygon")for(var cn=0;cn<Ot.length;cn++){var Pn=[];nn(Ot[cn],Pn,H,se,de,!0),Pn.length&&Wt.push(Pn)}if(Wt.length){if(Oe.lineMetrics&&dt==="LineString"){for(cn=0;cn<Wt.length;cn++)Ie.push(jt(at.id,dt,Wt[cn],at.tags));continue}dt!=="LineString"&&dt!=="MultiLineString"||(Wt.length===1?(dt="LineString",Wt=Wt[0]):dt="MultiLineString"),dt!=="Point"&&dt!=="MultiPoint"||(dt=Wt.length===3?"Point":"MultiPoint"),Ie.push(jt(at.id,dt,Wt,at.tags))}}}return Ie.length?Ie:null}function sn(oe,U,H,se,de){for(var Se=0;Se<oe.length;Se+=3){var Re=oe[Se+de];Re>=H&&Re<=se&&(U.push(oe[Se]),U.push(oe[Se+1]),U.push(oe[Se+2]))}}function fn(oe,U,H,se,de,Se,Re){for(var Oe,Ie,Ne=$n(oe),at=de===0?qi:hi,Ot=oe.start,dt=0;dt<oe.length-3;dt+=3){var Kt=oe[dt],Yt=oe[dt+1],Wt=oe[dt+2],cn=oe[dt+3],Pn=oe[dt+4],Fn=de===0?Kt:Yt,pn=de===0?cn:Pn,qn=!1;Re&&(Oe=Math.sqrt(Math.pow(Kt-cn,2)+Math.pow(Yt-Pn,2))),Fn<H?pn>H&&(Ie=at(Ne,Kt,Yt,cn,Pn,H),Re&&(Ne.start=Ot+Oe*Ie)):Fn>se?pn<se&&(Ie=at(Ne,Kt,Yt,cn,Pn,se),Re&&(Ne.start=Ot+Oe*Ie)):ei(Ne,Kt,Yt,Wt),pn<H&&Fn>=H&&(Ie=at(Ne,Kt,Yt,cn,Pn,H),qn=!0),pn>se&&Fn<=se&&(Ie=at(Ne,Kt,Yt,cn,Pn,se),qn=!0),!Se&&qn&&(Re&&(Ne.end=Ot+Oe*Ie),U.push(Ne),Ne=$n(oe)),Re&&(Ot+=Oe)}var Dn=oe.length-3;Kt=oe[Dn],Yt=oe[Dn+1],Wt=oe[Dn+2],(Fn=de===0?Kt:Yt)>=H&&Fn<=se&&ei(Ne,Kt,Yt,Wt),Dn=Ne.length-3,Se&&Dn>=3&&(Ne[Dn]!==Ne[0]||Ne[Dn+1]!==Ne[1])&&ei(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&U.push(Ne)}function $n(oe){var U=[];return U.size=oe.size,U.start=oe.start,U.end=oe.end,U}function nn(oe,U,H,se,de,Se){for(var Re=0;Re<oe.length;Re++)fn(oe[Re],U,H,se,de,Se,!1)}function ei(oe,U,H,se){oe.push(U),oe.push(H),oe.push(se)}function qi(oe,U,H,se,de,Se){var Re=(Se-U)/(se-U);return oe.push(Se),oe.push(H+(de-H)*Re),oe.push(1),Re}function hi(oe,U,H,se,de,Se){var Re=(Se-H)/(de-H);return oe.push(U+(se-U)*Re),oe.push(Se),oe.push(1),Re}function Hn(oe,U){for(var H=[],se=0;se<oe.length;se++){var de,Se=oe[se],Re=Se.type;if(Re==="Point"||Re==="MultiPoint"||Re==="LineString")de=_r(Se.geometry,U);else if(Re==="MultiLineString"||Re==="Polygon"){de=[];for(var Oe=0;Oe<Se.geometry.length;Oe++)de.push(_r(Se.geometry[Oe],U))}else if(Re==="MultiPolygon")for(de=[],Oe=0;Oe<Se.geometry.length;Oe++){for(var Ie=[],Ne=0;Ne<Se.geometry[Oe].length;Ne++)Ie.push(_r(Se.geometry[Oe][Ne],U));de.push(Ie)}H.push(jt(Se.id,Re,de,Se.tags))}return H}function _r(oe,U){var H=[];H.size=oe.size,oe.start!==void 0&&(H.start=oe.start,H.end=oe.end);for(var se=0;se<oe.length;se+=3)H.push(oe[se]+U,oe[se+1],oe[se+2]);return H}function ti(oe,U){if(oe.transformed)return oe;var H,se,de,Se=1<<oe.z,Re=oe.x,Oe=oe.y;for(H=0;H<oe.features.length;H++){var Ie=oe.features[H],Ne=Ie.geometry,at=Ie.type;if(Ie.geometry=[],at===1)for(se=0;se<Ne.length;se+=2)Ie.geometry.push(ji(Ne[se],Ne[se+1],U,Se,Re,Oe));else for(se=0;se<Ne.length;se++){var Ot=[];for(de=0;de<Ne[se].length;de+=2)Ot.push(ji(Ne[se][de],Ne[se][de+1],U,Se,Re,Oe));Ie.geometry.push(Ot)}}return oe.transformed=!0,oe}function ji(oe,U,H,se,de,Se){return[Math.round(H*(oe*se-de)),Math.round(H*(U*se-Se))]}function _s(oe,U,H,se,de){for(var Se=U===de.maxZoom?0:de.tolerance/((1<<U)*de.extent),Re={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:H,y:se,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Oe=0;Oe<oe.length;Oe++){Re.numFeatures++,kr(Re,oe[Oe],Se,de);var Ie=oe[Oe].minX,Ne=oe[Oe].minY,at=oe[Oe].maxX,Ot=oe[Oe].maxY;Ie<Re.minX&&(Re.minX=Ie),Ne<Re.minY&&(Re.minY=Ne),at>Re.maxX&&(Re.maxX=at),Ot>Re.maxY&&(Re.maxY=Ot)}return Re}function kr(oe,U,H,se){var de=U.geometry,Se=U.type,Re=[];if(Se==="Point"||Se==="MultiPoint")for(var Oe=0;Oe<de.length;Oe+=3)Re.push(de[Oe]),Re.push(de[Oe+1]),oe.numPoints++,oe.numSimplified++;else if(Se==="LineString")Hr(Re,de,oe,H,!1,!1);else if(Se==="MultiLineString"||Se==="Polygon")for(Oe=0;Oe<de.length;Oe++)Hr(Re,de[Oe],oe,H,Se==="Polygon",Oe===0);else if(Se==="MultiPolygon")for(var Ie=0;Ie<de.length;Ie++){var Ne=de[Ie];for(Oe=0;Oe<Ne.length;Oe++)Hr(Re,Ne[Oe],oe,H,!0,Oe===0)}if(Re.length){var at=U.tags||null;if(Se==="LineString"&&se.lineMetrics){for(var Ot in at={},U.tags)at[Ot]=U.tags[Ot];at.mapbox_clip_start=de.start/de.size,at.mapbox_clip_end=de.end/de.size}var dt={geometry:Re,type:Se==="Polygon"||Se==="MultiPolygon"?3:Se==="LineString"||Se==="MultiLineString"?2:1,tags:at};U.id!==null&&(dt.id=U.id),oe.features.push(dt)}}function Hr(oe,U,H,se,de,Se){var Re=se*se;if(se>0&&U.size<(de?Re:se))H.numPoints+=U.length/3;else{for(var Oe=[],Ie=0;Ie<U.length;Ie+=3)(se===0||U[Ie+2]>Re)&&(H.numSimplified++,Oe.push(U[Ie]),Oe.push(U[Ie+1])),H.numPoints++;de&&function(Ne,at){for(var Ot=0,dt=0,Kt=Ne.length,Yt=Kt-2;dt<Kt;Yt=dt,dt+=2)Ot+=(Ne[dt]-Ne[Yt])*(Ne[dt+1]+Ne[Yt+1]);if(Ot>0===at)for(dt=0,Kt=Ne.length;dt<Kt/2;dt+=2){var Wt=Ne[dt],cn=Ne[dt+1];Ne[dt]=Ne[Kt-2-dt],Ne[dt+1]=Ne[Kt-1-dt],Ne[Kt-2-dt]=Wt,Ne[Kt-1-dt]=cn}}(Oe,Se),oe.push(Oe)}}function ts(oe,U){var H=(U=this.options=function(de,Se){for(var Re in Se)de[Re]=Se[Re];return de}(Object.create(this.options),U)).debug;if(H&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var se=function(de,Se){var Re=[];if(de.type==="FeatureCollection")for(var Oe=0;Oe<de.features.length;Oe++)dn(Re,de.features[Oe],Se,Oe);else dn(Re,de.type==="Feature"?de:{geometry:de},Se);return Re}(oe,U);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),se=function(de,Se){var Re=Se.buffer/Se.extent,Oe=de,Ie=ct(de,1,-1-Re,Re,0,-1,2,Se),Ne=ct(de,1,1-Re,2+Re,0,-1,2,Se);return(Ie||Ne)&&(Oe=ct(de,1,-Re,1+Re,0,-1,2,Se)||[],Ie&&(Oe=Hn(Ie,1).concat(Oe)),Ne&&(Oe=Oe.concat(Hn(Ne,-1)))),Oe}(se,U),se.length&&this.splitTile(se,0,0,0),H&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ir(oe,U,H){return 32*((1<<oe)*H+U)+oe}function ys(oe,U){const H=oe.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const se=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!se)return U(null,null);const de=new me(se.features);let Se=we(de);Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),U(null,{vectorTile:de,rawData:Se.buffer})}ts.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ts.prototype.splitTile=function(oe,U,H,se,de,Se,Re){for(var Oe=[oe,U,H,se],Ie=this.options,Ne=Ie.debug;Oe.length;){se=Oe.pop(),H=Oe.pop(),U=Oe.pop(),oe=Oe.pop();var at=1<<U,Ot=ir(U,H,se),dt=this.tiles[Ot];if(!dt&&(Ne>1&&console.time("creation"),dt=this.tiles[Ot]=_s(oe,U,H,se,Ie),this.tileCoords.push({z:U,x:H,y:se}),Ne)){Ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,H,se,dt.numFeatures,dt.numPoints,dt.numSimplified),console.timeEnd("creation"));var Kt="z"+U;this.stats[Kt]=(this.stats[Kt]||0)+1,this.total++}if(dt.source=oe,de){if(U===Ie.maxZoom||U===de)continue;var Yt=1<<de-U;if(H!==Math.floor(Se/Yt)||se!==Math.floor(Re/Yt))continue}else if(U===Ie.indexMaxZoom||dt.numPoints<=Ie.indexMaxPoints)continue;if(dt.source=null,oe.length!==0){Ne>1&&console.time("clipping");var Wt,cn,Pn,Fn,pn,qn,Dn=.5*Ie.buffer/Ie.extent,Er=.5-Dn,fr=.5+Dn,Ze=1+Dn;Wt=cn=Pn=Fn=null,pn=ct(oe,at,H-Dn,H+fr,0,dt.minX,dt.maxX,Ie),qn=ct(oe,at,H+Er,H+Ze,0,dt.minX,dt.maxX,Ie),oe=null,pn&&(Wt=ct(pn,at,se-Dn,se+fr,1,dt.minY,dt.maxY,Ie),cn=ct(pn,at,se+Er,se+Ze,1,dt.minY,dt.maxY,Ie),pn=null),qn&&(Pn=ct(qn,at,se-Dn,se+fr,1,dt.minY,dt.maxY,Ie),Fn=ct(qn,at,se+Er,se+Ze,1,dt.minY,dt.maxY,Ie),qn=null),Ne>1&&console.timeEnd("clipping"),Oe.push(Wt||[],U+1,2*H,2*se),Oe.push(cn||[],U+1,2*H,2*se+1),Oe.push(Pn||[],U+1,2*H+1,2*se),Oe.push(Fn||[],U+1,2*H+1,2*se+1)}}},ts.prototype.getTile=function(oe,U,H){var se=this.options,de=se.extent,Se=se.debug;if(oe<0||oe>24)return null;var Re=1<<oe,Oe=ir(oe,U=(U%Re+Re)%Re,H);if(this.tiles[Oe])return ti(this.tiles[Oe],de);Se>1&&console.log("drilling down to z%d-%d-%d",oe,U,H);for(var Ie,Ne=oe,at=U,Ot=H;!Ie&&Ne>0;)Ne--,at=Math.floor(at/2),Ot=Math.floor(Ot/2),Ie=this.tiles[ir(Ne,at,Ot)];return Ie&&Ie.source?(Se>1&&console.log("found parent tile z%d-%d-%d",Ne,at,Ot),Se>1&&console.time("drilling down"),this.splitTile(Ie.source,Ne,at,Ot,oe,U,H),Se>1&&console.timeEnd("drilling down"),this.tiles[Oe]?ti(this.tiles[Oe],de):null):null};class Rr extends s.VectorTileWorkerSource{constructor(U,H,se,de,Se){super(U,H,se,de,ys),Se&&(this.loadGeoJSON=Se)}loadData(U,H){const se=U&&U.request,de=se&&se.collectResourceTiming;this.loadGeoJSON(U,(Se,Re)=>{if(Se||!Re)return H(Se);if(typeof Re!="object")return H(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{R(Re,!0);try{if(U.filter){const Ie=s.createExpression(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(at=>`${at.key}: ${at.message}`).join(", "));Re={type:"FeatureCollection",features:Re.features.filter(at=>Ie.value.evaluate({zoom:0},at))}}this._geoJSONIndex=U.cluster?new xn(function({superclusterOptions:Ie,clusterProperties:Ne}){if(!Ne||!Ie)return Ie;const at={},Ot={},dt={accumulated:null,zoom:0},Kt={properties:null},Yt=Object.keys(Ne);for(const Wt of Yt){const[cn,Pn]=Ne[Wt],Fn=s.createExpression(Pn),pn=s.createExpression(typeof cn=="string"?[cn,["accumulated"],["get",Wt]]:cn);at[Wt]=Fn.value,Ot[Wt]=pn.value}return Ie.map=Wt=>{Kt.properties=Wt;const cn={};for(const Pn of Yt)cn[Pn]=at[Pn].evaluate(dt,Kt);return cn},Ie.reduce=(Wt,cn)=>{Kt.properties=cn;for(const Pn of Yt)dt.accumulated=Wt[Pn],Wt[Pn]=Ot[Pn].evaluate(dt,Kt)},Ie}(U)).load(Re.features):function(Ie,Ne){return new ts(Ie,Ne)}(Re,U.geojsonVtOptions)}catch(Ie){return H(Ie)}this.loaded={};const Oe={};if(de){const Ie=s.getPerformanceMeasurement(se);Ie&&(Oe.resourceTiming={},Oe.resourceTiming[U.source]=JSON.parse(JSON.stringify(Ie)))}H(null,Oe)}})}reloadTile(U,H){const se=this.loaded;return se&&se[U.uid]?super.reloadTile(U,H):this.loadTile(U,H)}loadGeoJSON(U,H){if(U.request)s.getJSON(U.request,H);else{if(typeof U.data!="string")return H(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return H(null,JSON.parse(U.data))}catch{return H(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,H){try{H(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(se){H(se)}}getClusterChildren(U,H){try{H(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(se){H(se)}}getClusterLeaves(U,H){try{H(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(se){H(se)}}}class Os{constructor(U){this.self=U,this.actor=new s.Actor(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:Rr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(H,se)=>{if(this.workerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.workerSourceTypes[H]=se},this.self.registerRTLTextPlugin=H=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=H.applyArabicShaping,s.plugin.processBidirectionalText=H.processBidirectionalText,s.plugin.processStyledBidirectionalText=H.processStyledBidirectionalText}}clearCaches(U,H,se){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],se()}checkIfReady(U,H,se){se()}setReferrer(U,H){this.referrer=H}spriteLoaded(U,H){this.isSpriteLoaded[U]=H;for(const se in this.workerSources[U]){const de=this.workerSources[U][se];for(const Se in de)de[Se]instanceof s.VectorTileWorkerSource&&(de[Se].isSpriteLoaded=H,de[Se].fire(new s.Event("isSpriteLoaded")))}}setImages(U,H,se){this.availableImages[U]=H;for(const de in this.workerSources[U]){const Se=this.workerSources[U][de];for(const Re in Se)Se[Re].availableImages=H}se()}enableTerrain(U,H,se){this.terrain=H,se()}setProjection(U,H){this.projections[U]=s.getProjection(H)}setLayers(U,H,se){this.getLayerIndex(U).replace(H),se()}updateLayers(U,H,se){this.getLayerIndex(U).update(H.layers,H.removedIds),se()}loadTile(U,H,se){const de=this.enableTerrain?s.extend({enableTerrain:this.terrain},H):H;de.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,H.type,H.source).loadTile(de,se)}loadDEMTile(U,H,se){const de=this.enableTerrain?s.extend({buildQuadTree:this.terrain},H):H;this.getDEMWorkerSource(U,H.source).loadTile(de,se)}reloadTile(U,H,se){const de=this.enableTerrain?s.extend({enableTerrain:this.terrain},H):H;de.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,H.type,H.source).reloadTile(de,se)}abortTile(U,H,se){this.getWorkerSource(U,H.type,H.source).abortTile(H,se)}removeTile(U,H,se){this.getWorkerSource(U,H.type,H.source).removeTile(H,se)}removeSource(U,H,se){if(!this.workerSources[U]||!this.workerSources[U][H.type]||!this.workerSources[U][H.type][H.source])return;const de=this.workerSources[U][H.type][H.source];delete this.workerSources[U][H.type][H.source],de.removeSource!==void 0?de.removeSource(H,se):se()}loadWorkerSource(U,H,se){try{this.self.importScripts(H.url),se()}catch(de){se(de.toString())}}syncRTLPluginState(U,H,se){try{s.plugin.setState(H);const de=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&de!=null){this.self.importScripts(de);const Se=s.plugin.isParsed();se(Se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${de}`),Se)}}catch(de){se(de.toString())}}getAvailableImages(U){let H=this.availableImages[U];return H||(H=[]),H}getLayerIndex(U){let H=this.layerIndexes[U];return H||(H=this.layerIndexes[U]=new M),H}getWorkerSource(U,H,se){if(this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][H]||(this.workerSources[U][H]={}),!this.workerSources[U][H][se]){const de={send:(Se,Re,Oe,Ie,Ne,at)=>{this.actor.send(Se,Re,Oe,U,Ne,at)},scheduler:this.actor.scheduler};this.workerSources[U][H][se]=new this.workerSourceTypes[H](de,this.getLayerIndex(U),this.getAvailableImages(U),this.isSpriteLoaded[U])}return this.workerSources[U][H][se]}getDEMWorkerSource(U,H){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][H]||(this.demWorkerSources[U][H]=new I),this.demWorkerSources[U][H]}enforceCacheSizeLimit(U,H){s.enforceCacheSizeLimit(H)}getWorkerPerformanceMetrics(U,H,se){se(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Os(self)),Os}),h(["./shared"],function(s){function v(m,l){if(Array.isArray(m)){if(!Array.isArray(l)||m.length!==l.length)return!1;for(let f=0;f<m.length;f++)if(!v(m[f],l[f]))return!1;return!0}if(typeof m=="object"&&m!==null&&l!==null){if(typeof l!="object"||Object.keys(m).length!==Object.keys(l).length)return!1;for(const f in m)if(!v(m[f],l[f]))return!1;return!0}return m===l}var E=M;function M(m){return!function(l){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,w=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(w);try{x=new Worker(S),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(S),_}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===_.width}()?(I[f=l&&l.failIfMajorPerformanceCaveat]===void 0&&(I[f]=function(_){var x,w=function(S){var P=document.createElement("canvas"),L=Object.create(M.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=S,P.getContext("webgl",L)||P.getContext("experimental-webgl",L)}(_);if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),w.getShaderParameter(x,w.COMPILE_STATUS)===!0)}(f)),I[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var f}(m)}var I={};function R(m,l,f){const _=s.window.document.createElement(m);return l!==void 0&&(_.className=l),f&&f.appendChild(_),_}function N(m,l,f){const _=s.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const x of Object.keys(l))_.setAttributeNS(null,x,l[x]);return f&&f.appendChild(_),_}M.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const $=s.window.document&&s.window.document.documentElement.style,Z=$&&$.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ne;function me(){$&&Z&&(ne=$[Z],$[Z]="none")}function we(){$&&Z&&($[Z]=ne)}function he(m){m.preventDefault(),m.stopPropagation(),s.window.removeEventListener("click",he,!0)}function Pe(){s.window.addEventListener("click",he,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",he,!0)},0)}function ge(m,l){const f=m.getBoundingClientRect();return Rt(m,f,l)}function nt(m,l){const f=m.getBoundingClientRect(),_=[];for(let x=0;x<l.length;x++)_.push(Rt(m,f,l[x]));return _}function Tt(m){return s.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function Rt(m,l,f){const _=m.offsetWidth===l.width?1:m.offsetWidth/l.width;return new s.pointGeometry((f.clientX-l.left)*_,(f.clientY-l.top)*_)}function ke(m,l){var f=l[0],_=l[1],x=l[2],w=l[3],S=f*w-x*_;return S?(m[0]=w*(S=1/S),m[1]=-_*S,m[2]=-x*S,m[3]=f*S,m):null}function It(m){const{userImage:l}=m;return!!(l&&l.render&&l.render())&&(m.data.replace(new Uint8Array(l.data.buffer)),!0)}class xt extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:f,callback:_}of this.requestors)this._notify(f,_);this.requestors=[]}}hasImage(l){return!!this.getImage(l)}getImage(l){return this.images[l]}addImage(l,f){this._validate(l,f)&&(this.images[l]=f)}_validate(l,f){let _=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),_=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),_=!1),this._validateContent(f.content,f)||(this.fire(new s.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),_=!1),_}_validateStretch(l,f){if(!l)return!0;let _=0;for(const x of l){if(x[0]<_||x[1]<x[0]||f<x[1])return!1;_=x[1]}return!0}_validateContent(l,f){return!(l&&(l.length!==4||l[0]<0||f.data.width<l[0]||l[1]<0||f.data.height<l[1]||l[2]<0||f.data.width<l[2]||l[3]<0||f.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,f){f.version=this.images[l].version+1,this.images[l]=f,this.updatedImages[l]=!0}removeImage(l){const f=this.images[l];delete this.images[l],delete this.patterns[l],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,f){let _=!0;if(!this.isLoaded())for(const x of l)this.images[x]||(_=!1);this.isLoaded()||_?this._notify(l,f):this.requestors.push({ids:l,callback:f})}_notify(l,f){const _={};for(const x of l){this.images[x]||this.fire(new s.Event("styleimagemissing",{id:x}));const w=this.images[x];w?_[x]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:Boolean(w.userImage&&w.userImage.render)}:s.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,_)}getPixelSize(){const{width:l,height:f}=this.atlasImage;return{width:l,height:f}}getPattern(l){const f=this.patterns[l],_=this.getImage(l);if(!_)return null;if(f&&f.position.version===_.version)return f.position;if(f)f.position.version=_.version;else{const x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new s.ImagePosition(x,_);this.patterns[l]={bin:x,position:w}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const f=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(l,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const w in this.patterns)l.push(this.patterns[w].bin);const{w:f,h:_}=s.potpack(l),x=this.atlasImage;x.resize({width:f||1,height:_||1});for(const w in this.patterns){const{bin:S}=this.patterns[w],P=S.x+1,L=S.y+1,D=this.images[w].data,z=D.width,V=D.height;s.RGBAImage.copy(D,x,{x:0,y:0},{x:P,y:L},{width:z,height:V}),s.RGBAImage.copy(D,x,{x:0,y:V-1},{x:P,y:L-1},{width:z,height:1}),s.RGBAImage.copy(D,x,{x:0,y:0},{x:P,y:L+V},{width:z,height:1}),s.RGBAImage.copy(D,x,{x:z-1,y:0},{x:P-1,y:L},{width:1,height:V}),s.RGBAImage.copy(D,x,{x:0,y:0},{x:P+z,y:L},{width:1,height:V})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const f of l){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const _=this.images[f];It(_)&&this.updateImage(f,_)}}}const gn=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(m,l){return function([f,_,x]){const w=s.degToRad(_+90),S=s.degToRad(x);return{x:f*Math.cos(w)*Math.sin(S),y:f*Math.sin(w)*Math.sin(S),z:f*Math.cos(S),azimuthal:_,polar:x}}(m.expression.evaluate(l))}interpolate(m,l,f){return{x:s.number(m.x,l.x,f),y:s.number(m.y,l.y,f),z:s.number(m.z,l.z,f),azimuthal:s.number(m.azimuthal,l.azimuthal,f),polar:s.number(m.polar,l.polar,f)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),an="-transition";class ln extends s.Evented{constructor(l){super(),this._transitionable=new s.Transitionable(gn),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f={}){if(!this._validate(s.validateLight,l,f))for(const _ in l){const x=l[_];s.endsWith(_,an)?this._transitionable.setTransition(_.slice(0,-an.length),x):this._transitionable.setValue(_,x)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,_){return(!_||_.validate!==!1)&&s.emitValidationErrors(this,l.call(s.validateStyle,s.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const $t=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)}),Mn="-transition";class yn extends s.Evented{constructor(l,f){super(),this._transitionable=new s.Transitionable($t),this.set(l),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=f}get(){return this._transitionable.serialize()}set(l){for(const f in l){const _=l[f];s.endsWith(f,Mn)?this._transitionable.setTransition(f.slice(0,-Mn.length),_):this._transitionable.setValue(f,_)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}}function vn(m,l,f,_){const x=s.smoothstep(45,65,f),[w,S]=Bn(m,_),P=s.length(l);let L=1-Math.min(1,Math.exp((P-w)/(S-w)*-6));return L*=L*L,L=Math.min(1,1.00747*L),L*x*m.alpha}function Bn(m,l){const f=.5/Math.tan(.5*l);return[m.range[0]+f,m.range[1]+f]}const Wn=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])}),pi="-transition";class Kn extends s.Evented{constructor(l,f){super(),this._transitionable=new s.Transitionable(Wn),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const l=this._transform,f=l.projection.name==="globe",_=s.globeToMercatorTransition(l.zoom),x=this.properties.get("range"),w=[.5,3];return{range:f?[s.number(w[0],x[0],_),s.number(w[1],x[1],_)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,f={}){if(!this._validate(s.validateFog,l,f)){for(const _ of Object.keys(s.spec.fog))l&&l[_]===void 0&&(l[_]=s.spec.fog[_].default);for(const _ in l){const x=l[_];s.endsWith(_,pi)?this._transitionable.setTransition(_.slice(0,-pi.length),x):this._transitionable.setValue(_,x)}}}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,l))*f.a}getOpacityAtLatLng(l,f){return this._transform.projection.supportsFog?function(_,x,w){const S=s.MercatorCoordinate.fromLngLat(x),P=w.elevation?w.elevation.getAtPointOrZero(S):0,L=[S.x,S.y,P];return s.transformMat4(L,L,w.mercatorFogMatrix),vn(_,L,w.pitch,w._fov)}(this.state,l,f):0}getFovAdjustedRange(l){return this._transform.projection.supportsFog?Bn(this.state,l):[0,1]}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,_){return(!_||_.validate!==!1)&&s.emitValidationErrors(this,l.call(s.validateStyle,s.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class Ii{constructor(l,f){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const _=this.workerPool.acquire(this.id);for(let x=0;x<_.length;x++){const w=new Ii.Actor(_[x],f,this.id);w.name=`Worker ${x}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,f,_){s.asyncAll(this.actors,(x,w)=>{x.send(l,f,w)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function vi(m,l,f){return l*(s.EXTENT/(m.tileSize*Math.pow(2,f-m.tileID.overscaledZ)))}Ii.Actor=s.Actor;class lt{constructor(l,f,_,x){this.screenBounds=l,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(l,f){let _,x;if(l instanceof s.pointGeometry||typeof l[0]=="number"){const w=s.pointGeometry.convert(l);_=[w],x=f.isPointAboveHorizon(w)}else{const w=s.pointGeometry.convert(l[0]),S=s.pointGeometry.convert(l[1]);_=[w,S],x=s.polygonizeBounds(w,S).every(P=>f.isPointAboveHorizon(P))}return new lt(_,f.getCameraPoint(),x,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const f=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],x=s.polygonizeBounds(f,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(x[3]=this.cameraPoint)),s.bufferConvexPolygon(x,l)}bufferedCameraGeometryGlobe(l){const f=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],x=s.polygonizeBounds(f,_,l),w=this.cameraPoint.clone();switch(3*((w.y>f.y)+(w.y>_.y))+((w.x>f.x)+(w.x>_.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(l,f,_,x=0){const w=l.queryPadding/f._pixelsPerMercatorPixel+1,S=_?this._bufferedCameraMercator(w,f):this._bufferedScreenMercator(w,f);let P=l.tileID.wrap+(S.unwrapped?x:0);const L=S.polygon.map(ie=>s.getTilePoint(l.tileTransform,ie,P));if(!s.polygonIntersectsBox(L,0,0,s.EXTENT,s.EXTENT))return;P=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const D=this.screenGeometryMercator.polygon.map(ie=>s.getTileVec3(l.tileTransform,ie,P)),z=D.map(ie=>new s.pointGeometry(ie[0],ie[1])),V=f.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),q=s.getTileVec3(l.tileTransform,V,P),ee=D.map(ie=>{const W=s.sub(ie,ie,q);return s.normalize(W,W),new s.Ray(q,W)}),Q=vi(l,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:ee,bufferedTilespaceGeometry:L,bufferedTilespaceBounds:(te=s.getBounds(L),te.min.x=s.clamp(te.min.x,0,s.EXTENT),te.min.y=s.clamp(te.min.y,0,s.EXTENT),te.max.x=s.clamp(te.max.x,0,s.EXTENT),te.max.y=s.clamp(te.max.y,0,s.EXTENT),te),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:Q};var te}_bufferedScreenMercator(l,f){const _=Ft(l);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let x;return x=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),f):{polygon:this.bufferedScreenGeometry(l).map(w=>f.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(l,f){const _=Ft(l);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let x;return x=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),f):{polygon:this.bufferedCameraGeometry(l).map(w=>f.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[_]=x,x}}_projectAndResample(l,f){const _=function(w,S){const P=s.multiply([],S.pixelMatrix,S.globeMatrix),L=[0,-s.GLOBE_RADIUS,0,1],D=[0,s.GLOBE_RADIUS,0,1],z=[0,0,0,1];s.transformMat4$1(L,L,P),s.transformMat4$1(D,D,P),s.transformMat4$1(z,z,P);const V=new s.pointGeometry(L[0]/L[3],L[1]/L[3]),q=new s.pointGeometry(D[0]/D[3],D[1]/D[3]),ee=s.polygonContainsPoint(w,V)&&L[3]<z[3],Q=s.polygonContainsPoint(w,q)&&D[3]<z[3];if(!ee&&!Q)return null;const te=function(Ce,Be,Ge){for(let We=1;We<Ce.length;We++){const At=yt(Be.pointCoordinate3D(Ce[We-1]).x),Ue=yt(Be.pointCoordinate3D(Ce[We]).x);if(Ge<0){if(At<Ue)return{idx:We,t:-At/(Ue-1-At)}}else if(Ue<At)return{idx:We,t:(1-At)/(Ue+1-At)}}return null}(w,S,ee?-1:1);if(!te)return null;const{idx:ie,t:W}=te;let fe=ie>1?zt(w.slice(0,ie),S):[],le=ie<w.length?zt(w.slice(ie),S):[];fe=fe.map(Ce=>new s.pointGeometry(yt(Ce.x),Ce.y)),le=le.map(Ce=>new s.pointGeometry(yt(Ce.x),Ce.y));const pe=[...fe];pe.length===0&&pe.push(le[le.length-1]);const Te=s.number(pe[pe.length-1].y,(le.length===0?fe[0]:le[0]).y,W);let be;return be=ee?[new s.pointGeometry(0,Te),new s.pointGeometry(0,0),new s.pointGeometry(1,0),new s.pointGeometry(1,Te)]:[new s.pointGeometry(1,Te),new s.pointGeometry(1,1),new s.pointGeometry(0,1),new s.pointGeometry(0,Te)],pe.push(...be),le.length===0?pe.push(fe[0]):pe.push(...le),{polygon:pe.map(Ce=>new s.MercatorCoordinate(Ce.x,Ce.y)),unwrapped:!1}}(l,f);if(_)return _;const x=function(w,S){let P=!1,L=-1/0,D=0;for(let V=0;V<w.length-1;V++)w[V].x>L&&(L=w[V].x,D=V);for(let V=0;V<w.length-1;V++){const q=(D+V)%(w.length-1),ee=w[q],Q=w[q+1];Math.abs(ee.x-Q.x)>.5&&(ee.x<Q.x?(ee.x+=1,q===0&&(w[w.length-1].x+=1)):(Q.x+=1,q+1===w.length-1&&(w[0].x+=1)),P=!0)}const z=s.mercatorXfromLng(S.center.lng);return P&&z<Math.abs(z-1)&&w.forEach(V=>{V.x-=1}),{polygon:w,unwrapped:P}}(zt(l,f).map(w=>new s.pointGeometry(yt(w.x),w.y)),f);return{polygon:x.polygon.map(w=>new s.MercatorCoordinate(w.x,w.y)),unwrapped:x.unwrapped}}}function zt(m,l){return s.resample(m,f=>{const _=l.pointCoordinate3D(f);f.x=_.x,f.y=_.y},1/256)}function yt(m){return m<0?1+m%1:m%1}function Ft(m){return 100*m|0}function Jt(m,l,f,_,x){const w=function(S,P){if(S)return x(S);if(P){m.url&&P.tiles&&m.tiles&&delete m.tiles;const L=s.pick(s.extend(P,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(L.vectorLayers=P.vector_layers,L.vectorLayerIds=L.vectorLayers.map(D=>D.id)),L.tiles=l.canonicalizeTileset(L,m.url),x(null,L)}};return m.url?s.getJSON(l.transformRequest(l.normalizeSourceURL(m.url,null,f,_),s.ResourceType.Source),w):s.exported.frame(()=>w(null,m))}class xn{constructor(l,f,_){this.bounds=s.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const f=Math.pow(2,l.z),_=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*f),x=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*f),w=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*f),S=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=_&&l.x<w&&l.y>=x&&l.y<S}}class wn{constructor(l,f,_){this.context=l;const x=l.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ue={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Me{constructor(l,f,_,x){this.length=f.length,this.attributes=_,this.itemSize=f.bytesPerElement,this.dynamicDraw=x,this.context=l;const w=l.gl;this.buffer=w.createBuffer(),l.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let _=0;_<this.attributes.length;_++){const x=f.attributes[this.attributes[_].name];x!==void 0&&l.enableVertexAttribArray(x)}}setVertexAttribPointers(l,f,_){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],S=f.attributes[w.name];S!==void 0&&l.vertexAttribPointer(S,w.components,l[ue[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ve{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qe extends Ve{getDefault(){return s.Color.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class st extends Ve{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class St extends Ve{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Dt extends Ve{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Pt extends Ve{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class Mt extends Ve{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class ht extends Ve{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Zt extends Ve{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class jt extends Ve{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class tn extends Ve{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class dn extends Ve{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class et extends Ve{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class J extends Ve{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class G extends Ve{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Fe extends Ve{getDefault(){return s.Color.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class gt extends Ve{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class ct extends Ve{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class sn extends Ve{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class fn extends Ve{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class $n extends Ve{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class nn extends Ve{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class ei extends Ve{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class qi extends Ve{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class hi extends Ve{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Hn extends Ve{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class _r extends Ve{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ti extends Ve{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ji extends Ve{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class _s extends Ve{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class kr extends Ve{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Hr extends Ve{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class ts extends Ve{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class ir extends ts{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class ys extends ts{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Rr extends ys{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Os{constructor(l,f,_,x){this.context=l,this.width=f,this.height=_;const w=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new ir(l,w),x&&(this.depthAttachment=new ys(l,w))}destroy(){const l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){const _=this.depthAttachment.get();_&&l.deleteRenderbuffer(_)}l.deleteFramebuffer(this.framebuffer)}}class oe{constructor(l,f=!1){if(this.gl=l,this.isWebGL2=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),f){const _=l;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(l),deleteVertexArrayOES:_.deleteVertexArray.bind(l),bindVertexArrayOES:_.bindVertexArray.bind(l)}}this.clearColor=new Qe(this),this.clearDepth=new st(this),this.clearStencil=new St(this),this.colorMask=new Dt(this),this.depthMask=new Pt(this),this.stencilMask=new Mt(this),this.stencilFunc=new ht(this),this.stencilOp=new Zt(this),this.stencilTest=new jt(this),this.depthRange=new tn(this),this.depthTest=new dn(this),this.depthFunc=new et(this),this.blend=new J(this),this.blendFunc=new G(this),this.blendColor=new Fe(this),this.blendEquation=new gt(this),this.cullFace=new ct(this),this.cullFaceSide=new sn(this),this.frontFace=new fn(this),this.program=new $n(this),this.activeTexture=new nn(this),this.viewport=new ei(this),this.bindFramebuffer=new qi(this),this.bindRenderbuffer=new hi(this),this.bindTexture=new Hn(this),this.bindVertexBuffer=new _r(this),this.bindElementBuffer=new ti(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ji(this),this.pixelStoreUnpack=new _s(this),this.pixelStoreUnpackPremultiplyAlpha=new kr(this),this.pixelStoreUnpackFlipY=new Hr(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),f||(this.extTextureHalfFloat=l.getExtension("OES_texture_half_float")),(f||this.extTextureHalfFloat&&l.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=f||l.getExtension("OES_standard_derivatives"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f){return new wn(this,l,f)}createVertexBuffer(l,f,_){return new Me(this,l,f,_)}createRenderbuffer(l,f,_){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,l,f,_),this.bindRenderbuffer.set(null),w}createFramebuffer(l,f,_){return new Os(this,l,f,_)}clear({color:l,depth:f,stencil:_}){const x=this.gl;let w=0;l&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),_!==void 0&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(w)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){v(l.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class U extends s.Evented{constructor(l,f,_,x){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(f,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(l){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=Jt(this._options,this.map._requestManager,f,_,(x,w)=>{this._tileJSONRequest=null,this._loaded=!0,x?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new s.ErrorEvent(x))):w&&(s.extend(this,w),w.bounds&&(this.tileBounds=new xn(w.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(w.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(x)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(l,f){const _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(_,s.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=f:l.request=l.actor.send("reloadTile",x,w.bind(this));else if(l.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",x,w.bind(this),void 0,!0);else{const S=s.loadVectorTile.call({deduped:this._deduped},x,(P,L)=>{P||!L?w.call(this,P):(x.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},l.actor&&l.actor.send("loadTile",x,w.bind(this),void 0,!0))},!0);l.request={cancel:S}}function w(S,P){return delete l.request,l.aborted?f(null):S&&S.status!==404?f(S):(P&&P.resourceTiming&&(l.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&l.setExpiryData(P),l.loadVectorData(P,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class H extends s.Evented{constructor(l,f,_,x){super(),this.id=l,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},f),s.extend(this,s.pick(f,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Jt(this._options,this.map._requestManager,null,null,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new s.ErrorEvent(f)):_&&(s.extend(this,_),_.bounds&&(this.tileBounds=new xn(_.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(_.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(f)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,f){const _=s.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);l.request=s.getImage(this.map._requestManager.transformRequest(x,s.ResourceType.Tile),(w,S,P,L)=>(delete l.request,l.aborted?(l.state="unloaded",f(null)):w?(l.state="errored",f(w)):S?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:P,expires:L}),l.setTexture(S,this.map.painter),l.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null)))}static loadTileData(l,f,_){l.setTexture(f,_)}static unloadTileData(l,f){l.texture&&f.saveTileTexture(l.texture)}abortTile(l,f){l.request&&(l.request.cancel(),delete l.request),f()}unloadTile(l,f){l.texture&&this.map.painter.saveTileTexture(l.texture),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let se;function de(m,l,f,_,x,w,S,P){const L=[m,f,x,l,_,w,1,1,1],D=[S,P,1],z=s.adjoint([],L),[V,q,ee]=s.transformMat3(D,D,s.transpose(z,z));return s.multiply$1(L,[V,0,0,0,q,0,0,0,ee],L)}class Se extends s.Evented{constructor(l,f,_,x){super(),this.id=l,this.dispatcher=_,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=f,this._dirty=!1}load(l,f){this._loaded=f||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(_,x)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new s.ErrorEvent(_));else if(x){const{HTMLImageElement:w}=s.window;this.image=x instanceof w?s.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading()}})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(l){this.coordinates=l,this._boundsArray=void 0;const f=l.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let x=1/0,w=1/0,S=-1/0,P=-1/0;for(const V of _)x=Math.min(x,V.x),w=Math.min(w,V.y),S=Math.max(S,V.x),P=Math.max(P,V.y);const L=Math.max(S-x,P-w),D=Math.max(0,Math.floor(-Math.log(L)/Math.LN2)),z=Math.pow(2,D);return new s.CanonicalTileID(D,Math.floor((x+S)/2*z),Math.floor((w+P)/2*z))}(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(l){for(const L in this.tiles){const D=this.tiles[L];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture)}if(this._boundsArray)return;const f=s.tileTransform(this.tileID,this.map.transform.projection),[_,x,w,S]=this.coordinates.map(L=>{const D=f.projection.project(L[0],L[1]);return s.getTilePoint(f,D)._round()});this.perspectiveTransform=function(L,D,z,V,q,ee,Q,te,ie,W){const fe=de(0,0,L,0,0,D,L,D),le=de(z,V,q,ee,Q,te,ie,W);return s.multiply$1(le,s.adjoint(fe,fe),le),[le[6]/le[8]*L/s.EXTENT,le[7]/le[8]*D/s.EXTENT]}(this.width,this.height,_.x,_.y,x.x,x.y,S.x,S.y,w.x,w.y);const P=this._boundsArray=new s.StructArrayLayout4i8;P.emplaceBack(_.x,_.y,0,0),P.emplaceBack(x.x,x.y,s.EXTENT,0),P.emplaceBack(S.x,S.y,0,s.EXTENT),P.emplaceBack(w.x,w.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=l.createVertexBuffer(P,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,f=l.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(l,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(l)}loadTile(l,f){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},f(null)):(l.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Re={vector:U,raster:H,"raster-dem":class extends H{constructor(m,l,f,_){super(m,l,f,_),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(m,l){const f=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,w){x&&(m.state="errored",l(x)),w&&(m.dem=w,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",l(null))}m.request=s.getImage(this.map._requestManager.transformRequest(f,s.ResourceType.Tile),function(x,w,S,P){if(delete m.request,m.aborted)m.state="unloaded",l(null);else if(x)m.state="errored",l(x);else if(w){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:S,expires:P});const L=s.window.ImageBitmap&&w instanceof s.window.ImageBitmap&&(se==null&&(se=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),se),D=1-(w.width-s.prevPowerOfTwo(w.width))/2;D<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const z=L?w:s.exported.getImageData(w,D),V={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:D};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",V,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const l=m.canonical,f=Math.pow(2,l.z),_=(l.x-1+f)%f,x=l.x===0?m.wrap-1:m.wrap,w=(l.x+1+f)%f,S=l.x+1===f?m.wrap+1:m.wrap,P={};return P[new s.OverscaledTileID(m.overscaledZ,x,l.z,_,l.y).key]={backfilled:!1},P[new s.OverscaledTileID(m.overscaledZ,S,l.z,w,l.y).key]={backfilled:!1},l.y>0&&(P[new s.OverscaledTileID(m.overscaledZ,x,l.z,_,l.y-1).key]={backfilled:!1},P[new s.OverscaledTileID(m.overscaledZ,m.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},P[new s.OverscaledTileID(m.overscaledZ,S,l.z,w,l.y-1).key]={backfilled:!1}),l.y+1<f&&(P[new s.OverscaledTileID(m.overscaledZ,x,l.z,_,l.y+1).key]={backfilled:!1},P[new s.OverscaledTileID(m.overscaledZ,m.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},P[new s.OverscaledTileID(m.overscaledZ,S,l.z,w,l.y+1).key]={backfilled:!1}),P}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends s.Evented{constructor(m,l,f,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(_),this._data=l.data,this._options=s.extend({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const x=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*x,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*x,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:s.EXTENT,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*x,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},l),this}getClusterChildren(m,l){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},l),this}getClusterLeaves(m,l,f,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:l,offset:f},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=s.extend({},this.workerOptions),l=this._data;typeof l=="string"?(m.request=this.map._requestManager.transformRequest(s.exported.resolveURL(l),s.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new s.ErrorEvent(f));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),this.fire(new s.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,l){const f=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(f,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,x)=>(delete m.request,m.unloadVectorData(),m.aborted?l(null):_?l(_):(m.loadVectorData(x,this.map.painter,f==="reloadTile"),l(null))),void 0,f==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Se{constructor(m,l,f,_){super(m,l,f,_),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const l of m.urls)this.urls.push(this.map._requestManager.transformRequest(l,s.ResourceType.Source).url);s.getVideo(this.urls,(l,f)=>{this._loaded=!0,l?this.fire(new s.ErrorEvent(l)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const l=this.video.seekable;m<l.start(0)||m>l.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,l=m.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(m,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Se,canvas:class extends Se{constructor(m,l,f,_){super(m,l,f,_),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(w=>typeof w!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends s.Evented{constructor(m,l,f,_){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=l,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new xn(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:l,y:f,z:_}=m.canonical;return this._implementation.hasTile({x:l,y:f,z:_})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,l){const{x:f,y:_,z:x}=m.tileID.canonical,w=new s.window.AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:f,y:_,z:x},{signal:w.signal})).then(function(S){return delete m.request,m.aborted?(m.state="unloaded",l(null)):S===void 0?(m.state="errored",l(null)):S===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",l(null)):function(P){return P instanceof s.window.ImageData||P instanceof s.window.HTMLCanvasElement||P instanceof s.window.ImageBitmap||P instanceof s.window.HTMLImageElement}(S)?(this.loadTileData(m,S),m.state="loaded",void l(null)):(m.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(S=>{S.code!==20&&(m.state="errored",l(S))}),m.request.cancel=()=>w.abort()}loadTileData(m,l){H.loadTileData(m,l,this._map.painter)}unloadTileData(m){H.unloadTileData(m,this._map.painter)}unloadTile(m,l){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:f,y:_,z:x}=m.tileID.canonical;this._implementation.unloadTile({x:f,y:_,z:x})}l()}abortTile(m,l){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Oe=function(m,l,f,_){const x=new Re[l.type](m,l,f,_);if(x.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${x.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],x),x};function Ie(m,l){const f=s.identity([]);return s.scale(f,f,[.5*m.width,.5*-m.height,1]),s.translate(f,f,[1,-1,0]),s.multiply(f,f,m.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(f)}function Ne(m,l,f,_,x,w,S,P=!1){const L=m.tilesIn(_,S,P);L.sort(Ot);const D=[];for(const V of L)D.push({wrappedTileID:V.tile.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(l,f,m._state,V,x,w,Ie(m.transform,V.tile.tileID),P)});const z=function(V){const q={},ee={};for(const Q of V){const te=Q.queryResults,ie=Q.wrappedTileID,W=ee[ie]=ee[ie]||{};for(const fe in te){const le=te[fe],pe=W[fe]=W[fe]||{},Te=q[fe]=q[fe]||[];for(const be of le)pe[be.featureIndex]||(pe[be.featureIndex]=!0,Te.push(be))}}return q}(D);for(const V in z)z[V].forEach(q=>{const ee=q.feature,Q=ee.layer;Q&&Q.type!=="background"&&Q.type!=="sky"&&(ee.source=Q.source,Q["source-layer"]&&(ee.sourceLayer=Q["source-layer"]),ee.state=ee.id!==void 0?m.getFeatureState(Q["source-layer"],ee.id):{})});return z}function at(m,l){const f=m.getRenderableIds().map(w=>m.getTileByID(w)),_=[],x={};for(let w=0;w<f.length;w++){const S=f[w],P=S.tileID.canonical.key;x[P]||(x[P]=!0,S.querySourceFeatures(_,l))}return _}function Ot(m,l){const f=m.tileID,_=l.tileID;return f.overscaledZ-_.overscaledZ||f.canonical.y-_.canonical.y||f.wrap-_.wrap||f.canonical.x-_.canonical.x}function dt(){return lc.workerClass!=null?new lc.workerClass:new s.window.Worker(lc.workerUrl)}const Kt="mapboxgl_preloaded_worker_pool";class Yt{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<Yt.workerCount;)this.workers.push(new dt);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Kt]}numActive(){return Object.keys(this.active).length}}let Wt;function cn(){return Wt||(Wt=new Yt),Wt}function Pn(m,l){const f={};for(const _ in m)_!=="ref"&&(f[_]=m[_]);return s.refProperties.forEach(_=>{_ in l&&(f[_]=l[_])}),f}function Fn(m){m=m.slice();const l=Object.create(null);for(let f=0;f<m.length;f++)l[m[f].id]=m[f];for(let f=0;f<m.length;f++)"ref"in m[f]&&(m[f]=Pn(m[f],l[m[f].ref]));return m}Yt.workerCount=2;const pn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qn(m,l,f){f.push({command:pn.addSource,args:[m,l[m]]})}function Dn(m,l,f){l.push({command:pn.removeSource,args:[m]}),f[m]=!0}function Er(m,l,f,_){Dn(m,f,_),qn(m,l,f)}function fr(m,l,f){let _;for(_ in m[f])if(m[f].hasOwnProperty(_)&&_!=="data"&&!v(m[f][_],l[f][_]))return!1;for(_ in l[f])if(l[f].hasOwnProperty(_)&&_!=="data"&&!v(m[f][_],l[f][_]))return!1;return!0}function Ze(m,l,f,_,x,w){let S;for(S in l=l||{},m=m||{})m.hasOwnProperty(S)&&(v(m[S],l[S])||f.push({command:w,args:[_,S,l[S],x]}));for(S in l)l.hasOwnProperty(S)&&!m.hasOwnProperty(S)&&(v(m[S],l[S])||f.push({command:w,args:[_,S,l[S],x]}))}function yr(m){return m.id}function ai(m,l){return m[l.id]=l,m}class dr{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.clamp(l,0,1);let f=1,_=this._distances[f];const x=l*this.paddedLength+this.padding;for(;_<x&&f<this._distances.length;)_=this._distances[++f];const w=f-1,S=this._distances[w],P=_-S,L=P>0?(x-S)/P:0;return this.points[w].mult(1-L).add(this.points[f].mult(L))}}class da{constructor(l,f,_){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(f/_);for(let S=0;S<this.xCellCount*this.yCellCount;S++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,_,x,w){this._forEachCell(f,_,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(l,f,_,x){this._forEachCell(f-x,_-x,f+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(_),this.circles.push(x)}_insertBoxCell(l,f,_,x,w,S){this.boxCells[w].push(S)}_insertCircleCell(l,f,_,x,w,S){this.circleCells[w].push(S)}_query(l,f,_,x,w,S){if(_<0||l>this.width||x<0||f>this.height)return!w&&[];const P=[];if(l<=0&&f<=0&&this.width<=_&&this.height<=x){if(w)return!0;for(let L=0;L<this.boxKeys.length;L++)P.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const D=this.circles[3*L],z=this.circles[3*L+1],V=this.circles[3*L+2];P.push({key:this.circleKeys[L],x1:D-V,y1:z-V,x2:D+V,y2:z+V})}return S?P.filter(S):P}return this._forEachCell(l,f,_,x,this._queryCell,P,{hitTest:w,seenUids:{box:{},circle:{}}},S),w?P.length>0:P}_queryCircle(l,f,_,x,w){const S=l-_,P=l+_,L=f-_,D=f+_;if(P<0||S>this.width||D<0||L>this.height)return!x&&[];const z=[];return this._forEachCell(S,L,P,D,this._queryCellCircle,z,{hitTest:x,circle:{x:l,y:f,radius:_},seenUids:{box:{},circle:{}}},w),x?z.length>0:z}query(l,f,_,x,w){return this._query(l,f,_,x,!1,w)}hitTest(l,f,_,x,w){return this._query(l,f,_,x,!0,w)}hitTestCircle(l,f,_,x){return this._queryCircle(l,f,_,!0,x)}_queryCell(l,f,_,x,w,S,P,L){const D=P.seenUids,z=this.boxCells[w];if(z!==null){const q=this.bboxes;for(const ee of z)if(!D.box[ee]){D.box[ee]=!0;const Q=4*ee;if(l<=q[Q+2]&&f<=q[Q+3]&&_>=q[Q+0]&&x>=q[Q+1]&&(!L||L(this.boxKeys[ee]))){if(P.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[ee],x1:q[Q],y1:q[Q+1],x2:q[Q+2],y2:q[Q+3]})}}}const V=this.circleCells[w];if(V!==null){const q=this.circles;for(const ee of V)if(!D.circle[ee]){D.circle[ee]=!0;const Q=3*ee;if(this._circleAndRectCollide(q[Q],q[Q+1],q[Q+2],l,f,_,x)&&(!L||L(this.circleKeys[ee]))){if(P.hitTest)return S.push(!0),!0;{const te=q[Q],ie=q[Q+1],W=q[Q+2];S.push({key:this.circleKeys[ee],x1:te-W,y1:ie-W,x2:te+W,y2:ie+W})}}}}}_queryCellCircle(l,f,_,x,w,S,P,L){const D=P.circle,z=P.seenUids,V=this.boxCells[w];if(V!==null){const ee=this.bboxes;for(const Q of V)if(!z.box[Q]){z.box[Q]=!0;const te=4*Q;if(this._circleAndRectCollide(D.x,D.y,D.radius,ee[te+0],ee[te+1],ee[te+2],ee[te+3])&&(!L||L(this.boxKeys[Q])))return S.push(!0),!0}}const q=this.circleCells[w];if(q!==null){const ee=this.circles;for(const Q of q)if(!z.circle[Q]){z.circle[Q]=!0;const te=3*Q;if(this._circlesCollide(ee[te],ee[te+1],ee[te+2],D.x,D.y,D.radius)&&(!L||L(this.circleKeys[Q])))return S.push(!0),!0}}}_forEachCell(l,f,_,x,w,S,P,L){const D=this._convertToXCellCoord(l),z=this._convertToYCellCoord(f),V=this._convertToXCellCoord(_),q=this._convertToYCellCoord(x);for(let ee=D;ee<=V;ee++)for(let Q=z;Q<=q;Q++)if(w.call(this,l,f,_,x,this.xCellCount*Q+ee,S,P,L))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,_,x,w,S){const P=x-l,L=w-f,D=_+S;return D*D>P*P+L*L}_circleAndRectCollide(l,f,_,x,w,S,P){const L=(S-x)/2,D=Math.abs(l-(x+L));if(D>L+_)return!1;const z=(P-w)/2,V=Math.abs(f-(w+z));if(V>z+_)return!1;if(D<=L||V<=z)return!0;const q=D-L,ee=V-z;return q*q+ee*ee<=_*_}}const Wr=Math.tan(85*Math.PI/180);function qr(m,l,f,_,x,w,S){const P=s.create();if(f)if(w.name==="globe"){const L=s.calculateGlobeLabelMatrix(x,l);s.multiply(P,P,L)}else{const L=ke([],S);P[0]=L[0],P[1]=L[1],P[4]=L[2],P[5]=L[3],_||s.rotateZ(P,P,x.angle)}else s.multiply(P,x.labelPlaneMatrix,m);return P}function Or(m,l,f,_,x,w,S){const P=qr(m,l,f,_,x,w,S);return w.name==="globe"&&f||(P[2]=P[6]=P[10]=P[14]=0),P}function Tr(m,l,f,_,x,w,S){if(f){if(w.name==="globe"){const P=qr(m,l,f,_,x,w,S);return s.invert(P,P),s.multiply(P,m,P),P}{const P=s.clone(m),L=s.identity([]);return L[0]=S[0],L[1]=S[1],L[4]=S[2],L[5]=S[3],s.multiply(P,P,L),_||s.rotateZ(P,P,-x.angle),P}}return x.glCoordMatrix}function ft(m,l,f,_){const x=[m,l,f,1];f?s.transformMat4$1(x,x,_):Va(x,x,_);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function Cn(m,l){return Math.min(.5+m/l*.5,1.5)}function Ln(m,l){const f=m[0]/m[3],_=m[1]/m[3];return f>=-l[0]&&f<=l[0]&&_>=-l[1]&&_<=l[1]}function Ar(m,l,f,_,x,w,S,P,L,D){const z=f.transform,V=_?m.textSizeData:m.iconSizeData,q=s.evaluateSizeForZoom(V,f.transform.zoom),ee=z.projection.name==="globe",Q=[256/f.width*2+1,256/f.height*2+1],te=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;te.clear();let ie=null;ee&&(ie=_?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const W=m.lineVertexArray,fe=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,le=f.transform.width/f.transform.height;let pe,Te=!1;for(let be=0;be<fe.length;be++){const Ce=fe.get(be),{numGlyphs:Be,writingMode:Ge}=Ce;if(Ge!==s.WritingMode.vertical||Te||pe===s.WritingMode.horizontal||(Te=!0),pe=Ge,(Ce.hidden||Ge===s.WritingMode.vertical)&&!Te){ii(Be,te);continue}Te=!1;const We=new s.pointGeometry(Ce.tileAnchorX,Ce.tileAnchorY);let{x:At,y:Ue,z:rt}=z.projection.projectTilePoint(We.x,We.y,D.canonical);if(L){const[zn,Ht,Ut]=L(We);At+=zn,Ue+=Ht,rt+=Ut}const Ye=[At,Ue,rt,1];if(s.transformMat4$1(Ye,Ye,l),!Ln(Ye,Q)){ii(Be,te);continue}const pt=Cn(f.transform.cameraToCenterDistance,Ye[3]),$e=s.evaluateSizeForFeature(V,q,Ce),De=S?$e/pt:$e*pt,qe=ft(At,Ue,rt,x);if(qe[3]<=0){ii(Be,te);continue}let ut={};const _t=S?null:L,Qt=Ds(Ce,De,!1,P,l,x,w,m.glyphOffsetArray,W,te,ie,qe,We,ut,le,_t,z.projection,D,S);Te=Qt.useVertical,_t&&Qt.needsFlipping&&(ut={}),(Qt.notEnoughRoom||Te||Qt.needsFlipping&&Ds(Ce,De,!0,P,l,x,w,m.glyphOffsetArray,W,te,ie,qe,We,ut,le,_t,z.projection,D,S).notEnoughRoom)&&ii(Be,te)}_?(m.text.dynamicLayoutVertexBuffer.updateData(te),ie&&m.text.globeExtVertexBuffer.updateData(ie)):(m.icon.dynamicLayoutVertexBuffer.updateData(te),ie&&m.icon.globeExtVertexBuffer.updateData(ie))}function Zr(m,l,f,_,x,w,S,P,L,D,z,V,q,ee,Q,te){const{lineStartIndex:ie,glyphStartIndex:W,segment:fe}=P,le=W+P.numGlyphs,pe=ie+P.lineLength,Te=l.getoffsetX(W),be=l.getoffsetX(le-1),Ce=rr(m*Te,f,_,x,w,S,fe,ie,pe,L,D,z,V,q,!0,ee,Q,te);if(!Ce)return null;const Be=rr(m*be,f,_,x,w,S,fe,ie,pe,L,D,z,V,q,!0,ee,Q,te);return Be?{first:Ce,last:Be}:null}function Sn(m,l,f,_){return m===s.WritingMode.horizontal&&Math.abs(_)>Math.abs(f)?{useVertical:!0}:m===s.WritingMode.vertical?_>0?{needsFlipping:!0}:null:l!==0&&function(x,w){return x===0||Math.abs(w/x)>Wr}(f,_)?l===1?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function Ds(m,l,f,_,x,w,S,P,L,D,z,V,q,ee,Q,te,ie,W,fe){const le=l/24,pe=m.lineOffsetX*le,Te=m.lineOffsetY*le,{lineStartIndex:be,glyphStartIndex:Ce,numGlyphs:Be,segment:Ge,writingMode:We,flipState:At}=m,Ue=be+m.lineLength,rt=Ye=>{if(z){const[qe,ut,_t]=Ye.up,Qt=D.length;s.updateGlobeVertexNormal(z,Qt+0,qe,ut,_t),s.updateGlobeVertexNormal(z,Qt+1,qe,ut,_t),s.updateGlobeVertexNormal(z,Qt+2,qe,ut,_t),s.updateGlobeVertexNormal(z,Qt+3,qe,ut,_t)}const[pt,$e,De]=Ye.point;s.addDynamicAttributes(D,pt,$e,De,Ye.angle)};if(Be>1){const Ye=Zr(le,P,pe,Te,f,V,q,m,L,w,ee,te,!1,ie,W,fe);if(!Ye)return{notEnoughRoom:!0};if(_&&!f){let[pt,$e,De]=Ye.first.point,[qe,ut,_t]=Ye.last.point;[pt,$e]=ft(pt,$e,De,S),[qe,ut]=ft(qe,ut,_t,S);const Qt=Sn(We,At,(qe-pt)*Q,ut-$e);if(m.flipState=Qt&&Qt.needsFlipping?1:2,Qt)return Qt}rt(Ye.first);for(let pt=Ce+1;pt<Ce+Be-1;pt++){const $e=rr(le*P.getoffsetX(pt),pe,Te,f,V,q,Ge,be,Ue,L,w,ee,te,!1,!1,ie,W,fe);if(!$e)return D.length-=4*(pt-Ce),{notEnoughRoom:!0};rt($e)}rt(Ye.last)}else{if(_&&!f){const pt=ft(q.x,q.y,0,x),$e=be+Ge+1,De=new s.pointGeometry(L.getx($e),L.gety($e)),qe=ft(De.x,De.y,0,x),ut=qe[3]>0?qe:us(q,De,pt,1,x,void 0,ie,W.canonical),_t=Sn(We,At,(ut[0]-pt[0])*Q,ut[1]-pt[1]);if(m.flipState=_t&&_t.needsFlipping?1:2,_t)return _t}const Ye=rr(le*P.getoffsetX(Ce),pe,Te,f,V,q,Ge,be,Ue,L,w,ee,te,!1,!1,ie,W,fe);if(!Ye)return{notEnoughRoom:!0};rt(Ye)}return{}}function Sr(m,l,f,_,x){const{x:w,y:S,z:P}=_.projectTilePoint(m.x,m.y,l);if(!x)return ft(w,S,P,f);const[L,D,z]=x(m);return ft(w+L,S+D,P+z,f)}function us(m,l,f,_,x,w,S,P){const L=Sr(m.sub(l)._unit()._add(m),P,x,S,w);return s.sub(L,f,L),s.normalize(L,L),s.scaleAndAdd(L,f,L,_)}function rr(m,l,f,_,x,w,S,P,L,D,z,V,q,ee,Q,te,ie,W){const fe=_?m-l:m+l;let le=fe>0?1:-1,pe=0;_&&(le*=-1,pe=Math.PI),le<0&&(pe+=Math.PI);let Te=P+S+(le>0?0:1)|0,be=x,Ce=x,Be=0,Ge=0;const We=Math.abs(fe),At=[],Ue=[];let rt=w,Ye=rt;const pt=()=>us(Ye,rt,Ce,We-Be+1,z,q,te,ie.canonical);for(;Be+Ge<=We;){if(Te+=le,Te<P||Te>=L)return null;if(Ce=be,Ye=rt,At.push(Ce),ee&&Ue.push(Ye),rt=new s.pointGeometry(D.getx(Te),D.gety(Te)),be=V[Te],!be){const Ut=Sr(rt,ie.canonical,z,te,q);be=Ut[3]>0?V[Te]=Ut:pt()}Be+=Ge,Ge=s.distance(Ce,be)}Q&&q&&(V[Te]&&(be=pt(),Ge=s.distance(Ce,be)),V[Te]=be);const $e=(We-Be)/Ge,De=rt.sub(Ye)._mult($e)._add(Ye),qe=s.sub([],be,Ce),ut=s.scaleAndAdd([],Ce,qe,$e);let _t=[0,0,1],Qt=qe[0],zn=qe[1];if(W&&(_t=te.upVector(ie.canonical,De.x,De.y),_t[0]!==0||_t[1]!==0||_t[2]!==1)){const Ut=[_t[2],0,-_t[0]],rn=s.cross([],_t,Ut);s.normalize(Ut,Ut),s.normalize(rn,rn),Qt=s.dot(qe,Ut),zn=s.dot(qe,rn)}if(f){const Ut=s.cross([],_t,qe);s.normalize(Ut,Ut),s.scaleAndAdd(ut,ut,Ut,f*le)}const Ht=pe+Math.atan2(zn,Qt);return At.push(ut),ee&&Ue.push(De),{point:ut,angle:Ht,path:At,tilePath:Ue,up:_t}}function ii(m,l){const f=l.length,_=f+4*m;l.resize(_),l.float32.fill(-1/0,4*f,4*_)}function Va(m,l,f){const _=l[0],x=l[1];return m[0]=f[0]*_+f[4]*x+f[12],m[1]=f[1]*_+f[5]*x+f[13],m[3]=f[3]*_+f[7]*x+f[15],m}const X=100;class re{constructor(l,f,_=new da(l.width+200,l.height+200,25),x=new da(l.width+200,l.height+200,25)){this.transform=l,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+X,this.screenBottomBoundary=l.height+X,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=f}placeCollisionBox(l,f,_,x,w,S,P,L){let D=_.projectedAnchorX,z=_.projectedAnchorY,V=_.projectedAnchorZ;const q=_.elevation,ee=_.tileID,Q=l.getProjection();if(q&&ee){const[be,Ce,Be]=Q.upVector(ee.canonical,_.tileAnchorX,_.tileAnchorY),Ge=Q.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=be*q*Ge,z+=Ce*q*Ge,V+=Be*q*Ge}const te=this.projectAndGetPerspectiveRatio(P,D,z,V,_.tileID,Q.name==="globe"||!!q||this.transform.pitch>0,Q),ie=S*te.perspectiveRatio,W=(_.x1*f+x.x-_.padding)*ie+te.point.x,fe=(_.y1*f+x.y-_.padding)*ie+te.point.y,le=(_.x2*f+x.x+_.padding)*ie+te.point.x,pe=(_.y2*f+x.y+_.padding)*ie+te.point.y,Te=te.perspectiveRatio<=.55||te.occluded;return!this.isInsideGrid(W,fe,le,pe)||!w&&this.grid.hitTest(W,fe,le,pe,L)||Te?{box:[],offscreen:!1,occluded:te.occluded}:{box:[W,fe,le,pe],offscreen:this.isOffscreen(W,fe,le,pe),occluded:!1}}placeCollisionCircles(l,f,_,x,w,S,P,L,D,z,V,q,ee,Q,te){const ie=[],W=this.transform.elevation,fe=l.getProjection(),le=W?W.getAtTileOffsetFunc(te,this.transform.center.lat,this.transform.worldSize,fe):null,pe=new s.pointGeometry(_.tileAnchorX,_.tileAnchorY);let{x:Te,y:be,z:Ce}=fe.projectTilePoint(pe.x,pe.y,te.canonical);if(le){const[De,qe,ut]=le(pe);Te+=De,be+=qe,Ce+=ut}const Be=fe.name==="globe",Ge=this.projectAndGetPerspectiveRatio(P,Te,be,Ce,te,Be||!!W||this.transform.pitch>0,fe),{perspectiveRatio:We}=Ge,At=(V?S/We:S*We)/s.ONE_EM,Ue=ft(Te,be,Ce,L),rt=Ge.signedDistanceFromCamera>0?Zr(At,w,_.lineOffsetX*At,_.lineOffsetY*At,!1,Ue,pe,_,x,L,{},W&&!V?le:null,V&&!!W,fe,te,V):null;let Ye=!1,pt=!1,$e=!0;if(rt&&!Ge.occluded){const De=.5*ee*We+Q,qe=new s.pointGeometry(-100,-100),ut=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),_t=new dr,{first:Qt,last:zn}=rt,Ht=Qt.path.length;let Ut=[];for(let hn=Ht-1;hn>=1;hn--)Ut.push(Qt.path[hn]);for(let hn=1;hn<zn.path.length;hn++)Ut.push(zn.path[hn]);const rn=2.5*De;D&&(Ut=Ut.map(([hn,ci,mi],Si)=>(le&&!Be&&(mi=le(Si<Ht-1?Qt.tilePath[Ht-1-Si]:zn.tilePath[Si-Ht+2])[2]),ft(hn,ci,mi,D))),Ut.some(hn=>hn[3]<=0)&&(Ut=[]));let Vn=[];if(Ut.length>0){let hn=1/0,ci=-1/0,mi=1/0,Si=-1/0;for(const wi of Ut)hn=Math.min(hn,wi[0]),mi=Math.min(mi,wi[1]),ci=Math.max(ci,wi[0]),Si=Math.max(Si,wi[1]);ci>=qe.x&&hn<=ut.x&&Si>=qe.y&&mi<=ut.y&&(Vn=[Ut.map(wi=>new s.pointGeometry(wi[0],wi[1]))],(hn<qe.x||ci>ut.x||mi<qe.y||Si>ut.y)&&(Vn=s.clipLine(Vn,qe.x,qe.y,ut.x,ut.y)))}for(const hn of Vn){_t.reset(hn,.25*De);let ci=0;ci=_t.length<=.5*De?1:Math.ceil(_t.paddedLength/rn)+1;for(let mi=0;mi<ci;mi++){const Si=mi/Math.max(ci-1,1),wi=_t.lerp(Si),or=wi.x+X,ns=wi.y+X;ie.push(or,ns,De,0);const zs=or-De,mo=ns-De,Bi=or+De,Ei=ns+De;if($e=$e&&this.isOffscreen(zs,mo,Bi,Ei),pt=pt||this.isInsideGrid(zs,mo,Bi,Ei),!f&&this.grid.hitTestCircle(or,ns,De,q)&&(Ye=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ye,occluded:!1}}}}return{circles:!z&&Ye||!pt?[]:ie,offscreen:$e,collisionDetected:Ye,occluded:Ge.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let _=1/0,x=1/0,w=-1/0,S=-1/0;for(const z of l){const V=new s.pointGeometry(z.x+X,z.y+X);_=Math.min(_,V.x),x=Math.min(x,V.y),w=Math.max(w,V.x),S=Math.max(S,V.y),f.push(V)}const P=this.grid.query(_,x,w,S).concat(this.ignoredGrid.query(_,x,w,S)),L={},D={};for(const z of P){const V=z.key;if(L[V.bucketInstanceId]===void 0&&(L[V.bucketInstanceId]={}),L[V.bucketInstanceId][V.featureIndex])continue;const q=[new s.pointGeometry(z.x1,z.y1),new s.pointGeometry(z.x2,z.y1),new s.pointGeometry(z.x2,z.y2),new s.pointGeometry(z.x1,z.y2)];s.polygonIntersectsPolygon(f,q)&&(L[V.bucketInstanceId][V.featureIndex]=!0,D[V.bucketInstanceId]===void 0&&(D[V.bucketInstanceId]=[]),D[V.bucketInstanceId].push(V.featureIndex))}return D}insertCollisionBox(l,f,_,x,w){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:w},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,_,x,w){const S=f?this.ignoredGrid:this.grid,P={bucketInstanceId:_,featureIndex:x,collisionGroupID:w};for(let L=0;L<l.length;L+=4)S.insertCircle(P,l[L],l[L+1],l[L+2])}projectAndGetPerspectiveRatio(l,f,_,x,w,S,P){const L=[f,_,x,1];let D=!1;if(x||this.transform.pitch>0){s.transformMat4$1(L,L,l);const V=P.name==="globe";this.fogState&&w&&!V&&(D=function(ee,Q,te,ie,W,fe){const le=fe.calculateFogTileMatrix(W),pe=[Q,te,ie];return s.transformMat4(pe,pe,le),vn(ee,pe,fe.pitch,fe._fov)}(this.fogState,f,_,x,w.toUnwrapped(),this.transform)>.9)}else Va(L,L,l);const z=L[3];return{point:new s.pointGeometry((L[0]/z+1)/2*this.transform.width+X,(-L[1]/z+1)/2*this.transform.height+X),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/z*.5,1.5),signedDistanceFromCamera:z,occluded:S&&L[2]>z||D}}isOffscreen(l,f,_,x){return _<X||l>=this.screenRightBoundary||x<X||f>this.screenBottomBoundary}isInsideGrid(l,f,_,x){return _>=0&&l<this.gridRightBoundary&&x>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=s.identity([]);return s.translate(l,l,[-100,-100,0]),l}}function Ae(m,l,f){const _=l.createTileMatrix(m,m.worldSize,f.toUnwrapped());return s.multiply(new Float32Array(16),m.projMatrix,_)}function Je(m,l,f){if(l.projection.name===f.projection.name)return m.projMatrix;const _=f.clone();return _.setProjection(l.projection),Ae(_,l.getProjection(),m)}function Et(m,l,f){return l.name===f.projection.name?m.projMatrix:Ae(f,l,m)}class qt{constructor(l,f,_,x){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):x&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Rn{constructor(l,f,_,x,w,S=!1){this.text=new qt(l?l.text:null,f,_,w),this.icon=new qt(l?l.icon:null,f,x,w),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xi{constructor(l,f,_,x=!1){this.text=l,this.icon=f,this.skipFade=_,this.clipped=x}}class ye{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Le{constructor(l,f,_,x,w){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=w}}class ze{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:_=>_.collisionGroupID===f}}return this.collisionGroups[l]}}function wt(m,l,f,_,x){const{horizontalAlign:w,verticalAlign:S}=s.getAnchorAlignment(m),P=-(w-.5)*l,L=-(S-.5)*f,D=s.evaluateVariableOffset(m,_);return new s.pointGeometry(P+D[0]*x,L+D[1]*x)}function Vt(m,l,f,_,x){const w=new s.pointGeometry(m,l);return f&&w._rotate(_?x:-x),w}class Lt{constructor(l,f,_,x,w){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new re(this.transform,w),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new ze(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,f,_,x){const w=_.getBucket(f),S=_.latestFeatureIndex;if(!w||!S||f.id!==w.layerIds[0])return;const P=w.layers[0].layout,L=_.collisionBoxArray,D=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),z=_.tileSize/s.EXTENT,V=_.tileID.toUnwrapped();this.transform.setProjection(w.projection);const q=(ee=_.tileID,Q=w.getProjection(),te=this.transform,Q.name===this.projection?te.calculateProjMatrix(ee.toUnwrapped()):Ae(te,Q,ee));var ee,Q,te;const ie=P.get("text-pitch-alignment")==="map",W=P.get("text-rotation-alignment")==="map";f.compileFilter();const fe=f.dynamicFilter(),le=f.dynamicFilterNeedsFeature(),pe=this.transform.calculatePixelsToTileUnitsMatrix(_),Te=Or(q,_.tileID.canonical,ie,W,this.transform,w.getProjection(),pe);let be=null;if(ie){const Ge=Tr(q,_.tileID.canonical,ie,W,this.transform,w.getProjection(),pe);be=s.multiply([],this.transform.labelPlaneMatrix,Ge)}let Ce=null;fe&&_.latestFeatureIndex&&(Ce={unwrappedTileID:V,dynamicFilter:fe,dynamicFilterNeedsFeature:le,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new Le(w.bucketInstanceId,S,w.sourceLayerIndex,w.index,_.tileID);const Be={bucket:w,layout:P,posMatrix:q,textLabelPlaneMatrix:Te,labelToScreenMatrix:be,clippingData:Ce,scale:D,textPixelRatio:z,holdingForFade:_.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(x)for(const Ge of w.sortKeyRanges){const{sortKey:We,symbolInstanceStart:At,symbolInstanceEnd:Ue}=Ge;l.push({sortKey:We,symbolInstanceStart:At,symbolInstanceEnd:Ue,parameters:Be})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Be})}attemptAnchorPlacement(l,f,_,x,w,S,P,L,D,z,V,q,ee,Q,te,ie,W,fe){const{textOffset0:le,textOffset1:pe,crossTileID:Te}=q,be=[le,pe],Ce=wt(l,_,x,be,w),Be=this.collisionIndex.placeCollisionBox(Q,w,f,Vt(Ce.x,Ce.y,S,P,this.transform.angle),V,L,D,z.predicate);if(ie){const Ge=Q.getSymbolInstanceIconSize(fe,this.transform.zoom,q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Q,Ge,ie,Vt(Ce.x,Ce.y,S,P,this.transform.angle),V,L,D,z.predicate).box.length===0)return}if(Be.box.length>0){let Ge;return this.prevPlacement&&this.prevPlacement.variableOffsets[Te]&&this.prevPlacement.placements[Te]&&this.prevPlacement.placements[Te].text&&(Ge=this.prevPlacement.variableOffsets[Te].anchor),this.variableOffsets[Te]={textOffset:be,width:_,height:x,anchor:l,textScale:w,prevAnchor:Ge},this.markUsedJustification(Q,l,q,te),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,te,q),this.placedOrientations[Te]=te),{shift:Ce,placedGlyphBoxes:Be}}}placeLayerBucketPart(l,f,_,x){const{bucket:w,layout:S,posMatrix:P,textLabelPlaneMatrix:L,labelToScreenMatrix:D,clippingData:z,textPixelRatio:V,holdingForFade:q,collisionBoxArray:ee,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:te,collisionGroup:ie}=l.parameters,W=S.get("text-optional"),fe=S.get("icon-optional"),le=S.get("text-allow-overlap"),pe=S.get("icon-allow-overlap"),Te=S.get("text-rotation-alignment")==="map",be=S.get("text-pitch-alignment")==="map",Ce=S.get("icon-text-fit")!=="none",Be=S.get("symbol-z-order")==="viewport-y";this.transform.setProjection(w.projection);let Ge=le&&(pe||!w.hasIconData()||fe),We=pe&&(le||!w.hasTextData()||W);!w.collisionArrays&&ee&&w.deserializeCollisionBoxes(ee),_&&x&&w.updateCollisionDebugBuffers(this.transform.zoom,ee);const At=(Ue,rt,Ye)=>{const{crossTileID:pt,numVerticalGlyphVertices:$e}=Ue;if(z){const Bi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ei=null;if(z.dynamicFilterNeedsFeature){const si=this.retainedQueryData[w.bucketInstanceId];Ei=z.featureIndex.loadFeature({featureIndex:Ue.featureIndex,bucketIndex:si.bucketIndex,sourceLayerIndex:si.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(Bi,Ei,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new s.pointGeometry(Ue.tileAnchorX,Ue.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[pt]=new xi(!1,!1,!1,!0),void(f[pt]=!0)}if(f[pt])return;if(q)return void(this.placements[pt]=new xi(!1,!1,!1));let De=!1,qe=!1,ut=!0,_t=!1,Qt=!1,zn=null,Ht={box:null,offscreen:null,occluded:null},Ut={box:null,offscreen:null,occluded:null},rn=null,Vn=null,hn=null,ci=0,mi=0,Si=0;Ye.textFeatureIndex?ci=Ye.textFeatureIndex:Ue.useRuntimeCollisionCircles&&(ci=Ue.featureIndex),Ye.verticalTextFeatureIndex&&(mi=Ye.verticalTextFeatureIndex);const wi=Bi=>{Bi.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Ei=this.transform.elevation;(Ei||Bi.elevation)&&(Bi.elevation=Ei?Ei.getAtTileOffset(Bi.tileID,Bi.tileAnchorX,Bi.tileAnchorY):0)},or=Ye.textBox;if(or){wi(or);const Bi=si=>{let Zi=s.WritingMode.horizontal;if(w.allowVerticalPlacement&&!si&&this.prevPlacement){const zr=this.prevPlacement.placedOrientations[pt];zr&&(this.placedOrientations[pt]=zr,Zi=zr,this.markUsedOrientation(w,Zi,Ue))}return Zi},Ei=(si,Zi)=>{if(w.allowVerticalPlacement&&$e>0&&Ye.verticalTextBox){for(const zr of w.writingModes)if(zr===s.WritingMode.vertical?(Ht=Zi(),Ut=Ht):Ht=si(),Ht&&Ht.box&&Ht.box.length)break}else Ht=si()};if(S.get("text-variable-anchor")){let si=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[pt]){const Ci=this.prevPlacement.variableOffsets[pt];si.indexOf(Ci.anchor)>0&&(si=si.filter(Br=>Br!==Ci.anchor),si.unshift(Ci.anchor))}const Zi=(Ci,Br,Fr)=>{const Uo=w.getSymbolInstanceTextSize(Q,Ue,this.transform.zoom,rt),nl=(Ci.x2-Ci.x1)*Uo+2*Ci.padding,hs=(Ci.y2-Ci.y1)*Uo+2*Ci.padding,bs=Ce&&!pe?Br:null;bs&&wi(bs);let go={box:[],offscreen:!1,occluded:!1};const Vo=le?2*si.length:si.length;for(let jo=0;jo<Vo;++jo){const il=this.attemptAnchorPlacement(si[jo%si.length],Ci,nl,hs,Uo,Te,be,V,P,ie,jo>=si.length,Ue,rt,w,Fr,bs,Q,te);if(il&&(go=il.placedGlyphBoxes,go&&go.box&&go.box.length)){De=!0,zn=il.shift;break}}return go};Ei(()=>Zi(or,Ye.iconBox,s.WritingMode.horizontal),()=>{const Ci=Ye.verticalTextBox;return Ci&&wi(Ci),w.allowVerticalPlacement&&!(Ht&&Ht.box&&Ht.box.length)&&$e>0&&Ci?Zi(Ci,Ye.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Ht&&(De=Ht.box,ut=Ht.offscreen,_t=Ht.occluded);const zr=Bi(Ht&&Ht.box);if(!De&&this.prevPlacement){const Ci=this.prevPlacement.variableOffsets[pt];Ci&&(this.variableOffsets[pt]=Ci,this.markUsedJustification(w,Ci.anchor,Ue,zr))}}else{const si=(Zi,zr)=>{const Ci=w.getSymbolInstanceTextSize(Q,Ue,this.transform.zoom,rt),Br=this.collisionIndex.placeCollisionBox(w,Ci,Zi,new s.pointGeometry(0,0),le,V,P,ie.predicate);return Br&&Br.box&&Br.box.length&&(this.markUsedOrientation(w,zr,Ue),this.placedOrientations[pt]=zr),Br};Ei(()=>si(or,s.WritingMode.horizontal),()=>{const Zi=Ye.verticalTextBox;return w.allowVerticalPlacement&&$e>0&&Zi?(wi(Zi),si(Zi,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Bi(Ht&&Ht.box&&Ht.box.length)}}if(rn=Ht,De=rn&&rn.box&&rn.box.length>0,ut=rn&&rn.offscreen,_t=rn&&rn.occluded,Ue.useRuntimeCollisionCircles){const Bi=w.text.placedSymbolArray.get(Ue.centerJustifiedTextSymbolIndex>=0?Ue.centerJustifiedTextSymbolIndex:Ue.verticalPlacedTextSymbolIndex),Ei=s.evaluateSizeForFeature(w.textSizeData,Q,Bi),si=S.get("text-padding");Vn=this.collisionIndex.placeCollisionCircles(w,le,Bi,w.lineVertexArray,w.glyphOffsetArray,Ei,P,L,D,_,be,ie.predicate,Ue.collisionCircleDiameter*Ei/s.ONE_EM,si,this.retainedQueryData[w.bucketInstanceId].tileID),De=le||Vn.circles.length>0&&!Vn.collisionDetected,ut=ut&&Vn.offscreen,_t=Vn.occluded}if(Ye.iconFeatureIndex&&(Si=Ye.iconFeatureIndex),Ye.iconBox){const Bi=Ei=>{wi(Ei);const si=Ce&&zn?Vt(zn.x,zn.y,Te,be,this.transform.angle):new s.pointGeometry(0,0),Zi=w.getSymbolInstanceIconSize(te,this.transform.zoom,Ue.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Zi,Ei,si,pe,V,P,ie.predicate)};Ut&&Ut.box&&Ut.box.length&&Ye.verticalIconBox?(hn=Bi(Ye.verticalIconBox),qe=hn.box.length>0):(hn=Bi(Ye.iconBox),qe=hn.box.length>0),ut=ut&&hn.offscreen,Qt=hn.occluded}const ns=W||Ue.numHorizontalGlyphVertices===0&&$e===0,zs=fe||Ue.numIconVertices===0;if(ns||zs?zs?ns||(qe=qe&&De):De=qe&&De:qe=De=qe&&De,De&&rn&&rn.box&&this.collisionIndex.insertCollisionBox(rn.box,S.get("text-ignore-placement"),w.bucketInstanceId,Ut&&Ut.box&&mi?mi:ci,ie.ID),qe&&hn&&this.collisionIndex.insertCollisionBox(hn.box,S.get("icon-ignore-placement"),w.bucketInstanceId,Si,ie.ID),Vn&&(De&&this.collisionIndex.insertCollisionCircles(Vn.circles,S.get("text-ignore-placement"),w.bucketInstanceId,ci,ie.ID),_)){const Bi=w.bucketInstanceId;let Ei=this.collisionCircleArrays[Bi];Ei===void 0&&(Ei=this.collisionCircleArrays[Bi]=new ye);for(let si=0;si<Vn.circles.length;si+=4)Ei.circles.push(Vn.circles[si+0]),Ei.circles.push(Vn.circles[si+1]),Ei.circles.push(Vn.circles[si+2]),Ei.circles.push(Vn.collisionDetected?1:0)}const mo=w.projection.name!=="globe";Ge=Ge&&(mo||!_t),We=We&&(mo||!Qt),this.placements[pt]=new xi(De||Ge,qe||We,ut||w.justReloaded),f[pt]=!0};if(Be){const Ue=w.getSortedSymbolIndexes(this.transform.angle);for(let rt=Ue.length-1;rt>=0;--rt){const Ye=Ue[rt];At(w.symbolInstances.get(Ye),Ye,w.collisionArrays[Ye])}}else for(let Ue=l.symbolInstanceStart;Ue<l.symbolInstanceEnd;Ue++)At(w.symbolInstances.get(Ue),Ue,w.collisionArrays[Ue]);if(_&&w.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[w.bucketInstanceId];s.invert(Ue.invProjMatrix,P),Ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(l,f,_,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:L,crossTileID:D}=_,z=s.getAnchorJustification(f),V=x===s.WritingMode.vertical?L:z==="left"?w:z==="center"?S:z==="right"?P:-1;w>=0&&(l.text.placedSymbolArray.get(w).crossTileID=V>=0&&w!==V?0:D),S>=0&&(l.text.placedSymbolArray.get(S).crossTileID=V>=0&&S!==V?0:D),P>=0&&(l.text.placedSymbolArray.get(P).crossTileID=V>=0&&P!==V?0:D),L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=V>=0&&L!==V?0:D)}markUsedOrientation(l,f,_){const x=f===s.WritingMode.horizontal||f===s.WritingMode.horizontalOnly?f:0,w=f===s.WritingMode.vertical?f:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:D}=_,z=l.text.placedSymbolArray;S>=0&&(z.get(S).placedOrientation=x),P>=0&&(z.get(P).placedOrientation=x),L>=0&&(z.get(L).placedOrientation=x),D>=0&&(z.get(D).placedOrientation=w)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let _=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const x=f?f.symbolFadeChange(l):1,w=f?f.opacities:{},S=f?f.variableOffsets:{},P=f?f.placedOrientations:{};for(const L in this.placements){const D=this.placements[L],z=w[L];z?(this.opacities[L]=new Rn(z,x,D.text,D.icon,null,D.clipped),_=_||D.text!==z.text.placed||D.icon!==z.icon.placed):(this.opacities[L]=new Rn(null,x,D.text,D.icon,D.skipFade,D.clipped),_=_||D.text||D.icon)}for(const L in w){const D=w[L];if(!this.opacities[L]){const z=new Rn(D,x,!1,!1);z.isHidden()||(this.opacities[L]=z,_=_||D.text.placed||D.icon.placed)}}for(const L in S)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=S[L]);for(const L in P)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=P[L]);_?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f){const _={};for(const x of f){const w=x.getBucket(l);w&&x.latestFeatureIndex&&l.id===w.layerIds[0]&&this.updateBucketOpacities(w,_,x.collisionBoxArray)}}updateBucketOpacities(l,f,_){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const x=l.layers[0].layout,w=!!l.layers[0].dynamicFilter(),S=new Rn(null,0,!1,!1,!0),P=x.get("text-allow-overlap"),L=x.get("icon-allow-overlap"),D=x.get("text-variable-anchor"),z=x.get("text-rotation-alignment")==="map",V=x.get("text-pitch-alignment")==="map",q=x.get("icon-text-fit")!=="none",ee=new Rn(null,0,P&&(L||!l.hasIconData()||x.get("icon-optional")),L&&(P||!l.hasTextData()||x.get("text-optional")),!0);!l.collisionArrays&&_&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(_);const Q=(ie,W,fe)=>{for(let le=0;le<W/4;le++)ie.opacityVertexArray.emplaceBack(fe)};let te=0;for(let ie=0;ie<l.symbolInstances.length;ie++){const W=l.symbolInstances.get(ie),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:le,crossTileID:pe,numIconVertices:Te}=W;let be=this.opacities[pe];f[pe]?be=S:be||(be=ee,this.opacities[pe]=be),f[pe]=!0;const Ce=fe>0||le>0,Be=Te>0,Ge=this.placedOrientations[pe],We=Ge===s.WritingMode.vertical,At=Ge===s.WritingMode.horizontal||Ge===s.WritingMode.horizontalOnly;if(!Ce&&!Be||be.isHidden()||te++,Ce){const Ue=sr(be.text);Q(l.text,fe,We?Gi:Ue),Q(l.text,le,At?Gi:Ue);const rt=be.text.isHidden(),{leftJustifiedTextSymbolIndex:Ye,centerJustifiedTextSymbolIndex:pt,rightJustifiedTextSymbolIndex:$e,verticalPlacedTextSymbolIndex:De}=W,qe=l.text.placedSymbolArray,ut=rt||We?1:0;Ye>=0&&(qe.get(Ye).hidden=ut),pt>=0&&(qe.get(pt).hidden=ut),$e>=0&&(qe.get($e).hidden=ut),De>=0&&(qe.get(De).hidden=rt||At?1:0);const _t=this.variableOffsets[pe];_t&&this.markUsedJustification(l,_t.anchor,W,Ge);const Qt=this.placedOrientations[pe];Qt&&(this.markUsedJustification(l,"left",W,Qt),this.markUsedOrientation(l,Qt,W))}if(Be){const Ue=sr(be.icon),{placedIconSymbolIndex:rt,verticalPlacedIconSymbolIndex:Ye}=W,pt=l.icon.placedSymbolArray,$e=be.icon.isHidden()?1:0;rt>=0&&(Q(l.icon,Te,We?Gi:Ue),pt.get(rt).hidden=$e),Ye>=0&&(Q(l.icon,W.numVerticalIconVertices,At?Gi:Ue),pt.get(Ye).hidden=$e)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Ue=l.collisionArrays[ie];if(Ue){let rt=new s.pointGeometry(0,0),Ye=!0;if(Ue.textBox||Ue.verticalTextBox){if(D){const $e=this.variableOffsets[pe];$e?(rt=wt($e.anchor,$e.width,$e.height,$e.textOffset,$e.textScale),z&&rt._rotate(V?this.transform.angle:-this.transform.angle)):Ye=!1}w&&(Ye=!be.clipped),Ue.textBox&&mn(l.textCollisionBox.collisionVertexArray,be.text.placed,!Ye||We,rt.x,rt.y),Ue.verticalTextBox&&mn(l.textCollisionBox.collisionVertexArray,be.text.placed,!Ye||At,rt.x,rt.y)}const pt=Ye&&Boolean(!At&&Ue.verticalIconBox);Ue.iconBox&&mn(l.iconCollisionBox.collisionVertexArray,be.icon.placed,pt,q?rt.x:0,q?rt.y:0),Ue.verticalIconBox&&mn(l.iconCollisionBox.collisionVertexArray,be.icon.placed,!pt,q?rt.x:0,q?rt.y:0)}}}if(l.fullyClipped=te===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=ie.invProjMatrix,l.placementViewportMatrix=ie.viewportMatrix,l.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const _=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function mn(m,l,f,_,x){m.emplaceBack(l?1:0,f?1:0,_||0,x||0),m.emplaceBack(l?1:0,f?1:0,_||0,x||0),m.emplaceBack(l?1:0,f?1:0,_||0,x||0),m.emplaceBack(l?1:0,f?1:0,_||0,x||0)}const un=Math.pow(2,25),bi=Math.pow(2,24),kn=Math.pow(2,17),Ai=Math.pow(2,16),Di=Math.pow(2,9),ri=Math.pow(2,8),Jn=Math.pow(2,1);function sr(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const l=m.placed?1:0,f=Math.floor(127*m.opacity);return f*un+l*bi+f*kn+l*Ai+f*Di+l*ri+f*Jn+l}const Gi=0;class zi{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,f,_,x,w){const S=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(S,x,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((P,L)=>P.sortKey-L.sortKey));this._currentPartIndex<S.length;){const P=S[this._currentPartIndex];if(f.placeLayerBucketPart(P,this._seenCrossTileIDs,_,P.symbolInstanceStart===0),this._currentPartIndex++,w())return!0}return!1}}class ho{constructor(l,f,_,x,w,S,P,L){this.placement=new Lt(l,w,S,P,L),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(l,f,_){const x=s.exported.now(),w=()=>{const S=s.exported.now()-x;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=f[l[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=P)&&(!S.maxzoom||S.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new zi(S)),this._inProgressLayer.continuePlacement(_[S.source],this.placement,this._showCollisionBoxes,S,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Oo=512/s.EXTENT/2;class Fl{constructor(l,f,_){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let x=0;x<f.length;x++){const w=f.get(x),S=w.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,l)})}}getScaledCoordinates(l,f){const _=Oo/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*s.EXTENT+l.tileAnchorX)*_),y:Math.floor((f.canonical.y*s.EXTENT+l.tileAnchorY)*_)}}findMatches(l,f,_){const x=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let w=0;w<l.length;w++){const S=l.get(w);if(S.crossTileID)continue;const P=this.indexedSymbolInstances[S.key];if(!P)continue;const L=this.getScaledCoordinates(S,f);for(const D of P)if(Math.abs(D.coord.x-L.x)<=x&&Math.abs(D.coord.y-L.y)<=x&&!_[D.crossTileID]){_[D.crossTileID]=!0,S.crossTileID=D.crossTileID;break}}}}class ja{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ks{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(f!==0)for(const _ in this.indexes){const x=this.indexes[_],w={};for(const S in x){const P=x[S];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+f),w[P.tileID.key]=P}this.indexes[_]=w}this.lng=l}addBucket(l,f,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let w=0;w<f.symbolInstances.length;w++)f.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const x=this.usedCrossTileIDs[l.overscaledZ];for(const w in this.indexes){const S=this.indexes[w];if(Number(w)>l.overscaledZ)for(const P in S){const L=S[P];L.tileID.isChildOf(l)&&L.findMatches(f.symbolInstances,l,x)}else{const P=S[l.scaledTo(Number(w)).key];P&&P.findMatches(f.symbolInstances,l,x)}}for(let w=0;w<f.symbolInstances.length;w++){const S=f.symbolInstances.get(w);S.crossTileID||(S.crossTileID=_.generate(),x[S.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Fl(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const _ in f.indexedSymbolInstances)for(const x of f.indexedSymbolInstances[_])delete this.usedCrossTileIDs[l][x.crossTileID]}removeStaleBuckets(l){let f=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const w in x)l[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[w]),delete x[w],f=!0)}return f}}class Nl{constructor(){this.layerIndexes={},this.crossTileIDs=new ja,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,_,x){let w=this.layerIndexes[l.id];w===void 0&&(w=this.layerIndexes[l.id]=new Ks);let S=!1;const P={};x.name!=="globe"&&w.handleWrapJump(_);for(const L of f){const D=L.getBucket(l);D&&l.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(L.tileID,D,this.crossTileIDs)&&(S=!0),P[D.bucketInstanceId]=!0)}return w.removeStaleBuckets(P)&&(S=!0),S}pruneUnusedLayers(l){const f={};l.forEach(_=>{f[_]=!0});for(const _ in this.layerIndexes)f[_]||delete this.layerIndexes[_]}}const Do=(m,l)=>s.emitValidationErrors(m,l&&l.filter(f=>f.identifier!=="source.canvas")),Ga=s.pick(pn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),zo=s.pick(pn,["setCenter","setZoom","setBearing","setPitch"]),eu={version:8,layers:[],sources:{}},Bo={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class vs extends s.Evented{constructor(l,f={}){super(),this.map=l,this.dispatcher=new Ii(cn(),this),this.imageManager=new xt,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(l._requestManager,f.localFontFamily?s.LocalGlyphMode.all:f.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.crossTileSymbolIndex=new Nl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const _=this;this._rtlTextPluginCallback=vs.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,S)=>{if(s.triggerPluginCompletionEvent(w),S&&S.every(P=>P))for(const P in _._sourceCaches){const L=_._sourceCaches[P],D=L.getSource().type;D!=="vector"&&D!=="geojson"||L.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const w=this.getSource(x.sourceId);if(w&&w.vectorLayerIds)for(const S in this._layers){const P=this._layers[S];P.source===w.id&&this._validateLayer(P)}})}loadURL(l,f={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const _=typeof f.validate=="boolean"?f.validate:!s.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,f.accessToken);const x=this.map._requestManager.transformRequest(l,s.ResourceType.Style);this._request=s.getJSON(x,(w,S)=>{this._request=null,w?this.fire(new s.ErrorEvent(w)):S&&this._load(S,_)})}loadJSON(l,f={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(l,f.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(eu,!1)}_updateLayerCount(l,f){const _=f?1:-1;l.is3D()&&(this._num3DLayers+=_),l.type==="circle"&&(this._numCircleLayers+=_),l.type==="symbol"&&(this._numSymbolLayers+=_)}_load(l,f){if(f&&Do(this,s.validateStyle(l)))return;this._loaded=!0,this.stylesheet=s.clone$1(l),this._updateMapProjection();for(const x in l.sources)this.addSource(x,l.sources[x],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);const _=Fn(this.stylesheet.layers);this._order=_.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of _)x=s.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ln(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(l){this._spriteRequest=function(f,_,x){let w,S,P;const L=s.exported.devicePixelRatio>1?"@2x":"";let D=s.getJSON(_.transformRequest(_.normalizeSpriteURL(f,L,".json"),s.ResourceType.SpriteJSON),(q,ee)=>{D=null,P||(P=q,w=ee,V())}),z=s.getImage(_.transformRequest(_.normalizeSpriteURL(f,L,".png"),s.ResourceType.SpriteImage),(q,ee)=>{z=null,P||(P=q,S=ee,V())});function V(){if(P)x(P);else if(w&&S){const q=s.exported.getImageData(S),ee={};for(const Q in w){const{width:te,height:ie,x:W,y:fe,sdf:le,pixelRatio:pe,stretchX:Te,stretchY:be,content:Ce}=w[Q],Be=new s.RGBAImage({width:te,height:ie});s.RGBAImage.copy(q,Be,{x:W,y:fe},{x:0,y:0},{width:te,height:ie}),ee[Q]={data:Be,pixelRatio:pe,sdf:le,stretchX:Te,stretchY:be,content:Ce}}x(null,ee)}}return{cancel(){D&&(D.cancel(),D=null),z&&(z.cancel(),z=null)}}}(l,this.map._requestManager,(f,_)=>{if(this._spriteRequest=null,f)this.fire(new s.ErrorEvent(f));else if(_)for(const x in _)this.imageManager.addImage(x,_[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(l){const f=this.getSource(l.source);if(!f)return;const _=l.sourceLayer;_&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(_)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${f.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){const f=[];for(const _ of l){const x=this._layers[_];x.type!=="custom"&&f.push(x.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&(typeof l.isLayerDraped=="function"?l.isLayerDraped():Bo[l.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;const f=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(x.length||w.length)&&this._updateWorkerLayers(x,w);for(const S in this._updatedSources){const P=this._updatedSources[S];P==="reload"?this._reloadSource(S):P==="clear"&&this._clearSource(S)}this._updateTilesForChangedImages();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}const _={};for(const x in this._sourceCaches){const w=this._sourceCaches[x];_[x]=w.used,w.used=!1}for(const x of this._order){const w=this._layers[x];if(w.recalculate(l,this._availableImages),!w.isHidden(l.zoom)){const P=this._getLayerSourceCache(w);P&&(P.used=!0)}const S=this.map.painter;if(S){const P=w.getProgramIds();if(!P)continue;const L=w.getProgramConfiguration(l.zoom);for(const D of P)S.useProgram(D,L)}}for(const x in _){const w=this._sourceCaches[x];_[x]!==w.used&&w.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),Do(this,s.validateStyle(l)))return!1;(l=s.clone$1(l)).layers=Fn(l.layers);const f=function(x,w){if(!x)return[{command:pn.setStyle,args:[w]}];let S=[];try{if(!v(x.version,w.version))return[{command:pn.setStyle,args:[w]}];v(x.center,w.center)||S.push({command:pn.setCenter,args:[w.center]}),v(x.zoom,w.zoom)||S.push({command:pn.setZoom,args:[w.zoom]}),v(x.bearing,w.bearing)||S.push({command:pn.setBearing,args:[w.bearing]}),v(x.pitch,w.pitch)||S.push({command:pn.setPitch,args:[w.pitch]}),v(x.sprite,w.sprite)||S.push({command:pn.setSprite,args:[w.sprite]}),v(x.glyphs,w.glyphs)||S.push({command:pn.setGlyphs,args:[w.glyphs]}),v(x.transition,w.transition)||S.push({command:pn.setTransition,args:[w.transition]}),v(x.light,w.light)||S.push({command:pn.setLight,args:[w.light]}),v(x.fog,w.fog)||S.push({command:pn.setFog,args:[w.fog]}),v(x.projection,w.projection)||S.push({command:pn.setProjection,args:[w.projection]});const P={},L=[];(function(V,q,ee,Q){let te;for(te in q=q||{},V=V||{})V.hasOwnProperty(te)&&(q.hasOwnProperty(te)||Dn(te,ee,Q));for(te in q)q.hasOwnProperty(te)&&(V.hasOwnProperty(te)?v(V[te],q[te])||(V[te].type==="geojson"&&q[te].type==="geojson"&&fr(V,q,te)?ee.push({command:pn.setGeoJSONSourceData,args:[te,q[te].data]}):Er(te,q,ee,Q)):qn(te,q,ee))})(x.sources,w.sources,L,P);const D=[];x.layers&&x.layers.forEach(V=>{V.source&&P[V.source]?S.push({command:pn.removeLayer,args:[V.id]}):D.push(V)});let z=x.terrain;z&&P[z.source]&&(S.push({command:pn.setTerrain,args:[void 0]}),z=void 0),S=S.concat(L),v(z,w.terrain)||S.push({command:pn.setTerrain,args:[w.terrain]}),function(V,q,ee){q=q||[];const Q=(V=V||[]).map(yr),te=q.map(yr),ie=V.reduce(ai,{}),W=q.reduce(ai,{}),fe=Q.slice(),le=Object.create(null);let pe,Te,be,Ce,Be,Ge,We;for(pe=0,Te=0;pe<Q.length;pe++)be=Q[pe],W.hasOwnProperty(be)?Te++:(ee.push({command:pn.removeLayer,args:[be]}),fe.splice(fe.indexOf(be,Te),1));for(pe=0,Te=0;pe<te.length;pe++)be=te[te.length-1-pe],fe[fe.length-1-pe]!==be&&(ie.hasOwnProperty(be)?(ee.push({command:pn.removeLayer,args:[be]}),fe.splice(fe.lastIndexOf(be,fe.length-Te),1)):Te++,Ge=fe[fe.length-pe],ee.push({command:pn.addLayer,args:[W[be],Ge]}),fe.splice(fe.length-pe,0,be),le[be]=!0);for(pe=0;pe<te.length;pe++)if(be=te[pe],Ce=ie[be],Be=W[be],!le[be]&&!v(Ce,Be))if(v(Ce.source,Be.source)&&v(Ce["source-layer"],Be["source-layer"])&&v(Ce.type,Be.type)){for(We in Ze(Ce.layout,Be.layout,ee,be,null,pn.setLayoutProperty),Ze(Ce.paint,Be.paint,ee,be,null,pn.setPaintProperty),v(Ce.filter,Be.filter)||ee.push({command:pn.setFilter,args:[be,Be.filter]}),v(Ce.minzoom,Be.minzoom)&&v(Ce.maxzoom,Be.maxzoom)||ee.push({command:pn.setLayerZoomRange,args:[be,Be.minzoom,Be.maxzoom]}),Ce)Ce.hasOwnProperty(We)&&We!=="layout"&&We!=="paint"&&We!=="filter"&&We!=="metadata"&&We!=="minzoom"&&We!=="maxzoom"&&(We.indexOf("paint.")===0?Ze(Ce[We],Be[We],ee,be,We.slice(6),pn.setPaintProperty):v(Ce[We],Be[We])||ee.push({command:pn.setLayerProperty,args:[be,We,Be[We]]}));for(We in Be)Be.hasOwnProperty(We)&&!Ce.hasOwnProperty(We)&&We!=="layout"&&We!=="paint"&&We!=="filter"&&We!=="metadata"&&We!=="minzoom"&&We!=="maxzoom"&&(We.indexOf("paint.")===0?Ze(Ce[We],Be[We],ee,be,We.slice(6),pn.setPaintProperty):v(Ce[We],Be[We])||ee.push({command:pn.setLayerProperty,args:[be,We,Be[We]]}))}else ee.push({command:pn.removeLayer,args:[be]}),Ge=fe[fe.lastIndexOf(be)+1],ee.push({command:pn.addLayer,args:[Be,Ge]})}(D,w.layers,S)}catch(P){console.warn("Unable to compute style diff:",P),S=[{command:pn.setStyle,args:[w]}]}return S}(this.serialize(),l).filter(x=>!(x.command in zo));if(f.length===0)return!1;const _=f.filter(x=>!(x.command in Ga));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);return f.forEach(x=>{x.command!=="setTransition"&&x.command!=="setProjection"&&this[x.command].apply(this,x.args)}),this.stylesheet=l,this._updateMapProjection(),!0}addImage(l,f){return this.getImage(l)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,f),this._afterImageUpdated(l),this)}updateImage(l,f){this.imageManager.updateImage(l,f)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l),this._afterImageUpdated(l),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,f,_={}){if(this._checkLoaded(),this.getSource(l)!==void 0)throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(s.validateSource,`sources.${l}`,f,null,_))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const x=Oe(l,f,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(l),source:x.serialize(),sourceId:l}));const w=S=>{const P=(S?"symbol:":"other:")+l,L=this._sourceCaches[P]=new s.SourceCache(P,x,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[l]=L,L.style=this,L.onAdd(this.map)};w(!1),f.type!=="vector"&&f.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();const f=this.getSource(l);if(!f)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===l)return this.fire(new s.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new s.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(l);for(const x of _)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(l,f){this._checkLoaded(),this.getSource(l).setData(f),this._changed=!0}getSource(l){const f=this._getSourceCache(l);return f&&f.getSource()}_getSources(){const l=[];for(const f in this._otherSourceCaches){const _=this._getSourceCache(f);_&&l.push(_.getSource())}return l}addLayer(l,f,_={}){this._checkLoaded();const x=l.id;if(this.getLayer(x))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(l.type==="custom"){if(Do(this,s.validateCustomStyleLayer(l)))return;w=s.createStyleLayer(l)}else{if(typeof l.source=="object"&&(this.addSource(x,l.source),l=s.clone$1(l),l=s.extend(l,{source:x})),this._validate(s.validateLayer,`layers.${x}`,l,{arrayIndex:-1},_))return;w=s.createStyleLayer(l),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}const S=f?this._order.indexOf(f):this._order.length;if(f&&S===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(S,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const P=this._getLayerSourceCache(w);if(this._removedLayers[x]&&w.source&&P&&w.type!=="custom"){const L=this._removedLayers[x];delete this._removedLayers[x],L.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",P.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,f){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===f)return;const _=this._order.indexOf(l);this._order.splice(_,1);const x=f?this._order.indexOf(f):this._order.length;f&&x===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(x,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();const f=this._layers[l];if(!f)return void this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const _=this._order.indexOf(l);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=f,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(const f in this._layers)if(this._layers[f].type===l)return!0;return!1}setLayerZoomRange(l,f,_){this._checkLoaded();const x=this.getLayer(l);x?x.minzoom===f&&x.maxzoom===_||(f!=null&&(x.minzoom=f),_!=null&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,f,_={}){this._checkLoaded();const x=this.getLayer(l);if(x){if(!v(x.filter,f))return f==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(s.validateFilter,`layers.${x.id}.filter`,f,{layerType:x.type},_)||(x.filter=s.clone$1(f),this._updateLayer(x)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){const f=this.getLayer(l);return f&&s.clone$1(f.filter)}setLayoutProperty(l,f,_,x={}){this._checkLoaded();const w=this.getLayer(l);w?v(w.getLayoutProperty(f),_)||(w.setLayoutProperty(f,_,x),this._updateLayer(w)):this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,f){const _=this.getLayer(l);if(_)return _.getLayoutProperty(f);this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,f,_,x={}){this._checkLoaded();const w=this.getLayer(l);w?v(w.getPaintProperty(f),_)||(w.setPaintProperty(f,_,x)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,f){const _=this.getLayer(l);return _&&_.getPaintProperty(f)}setFeatureState(l,f){this._checkLoaded();const _=l.source,x=l.sourceLayer,w=this.getSource(_);if(!w)return void this.fire(new s.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const S=w.type;if(S==="geojson"&&x)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!x)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const P=this._getSourceCaches(_);for(const L of P)L.setFeatureState(x,l.id,f)}removeFeatureState(l,f){this._checkLoaded();const _=l.source,x=this.getSource(_);if(!x)return void this.fire(new s.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const w=x.type,S=w==="vector"?l.sourceLayer:void 0;if(w==="vector"&&!S)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const P=this._getSourceCaches(_);for(const L of P)L.removeFeatureState(S,l.id,f)}getFeatureState(l){this._checkLoaded();const f=l.source,_=l.sourceLayer,x=this.getSource(f);if(x){if(x.type!=="vector"||_)return l.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(_,l.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const l={};for(const f in this._sourceCaches){const _=this._sourceCaches[f].getSource();l[_.id]||(l[_.id]=_.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0;const f=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&f&&f.getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",f.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const f=S=>this._layers[S].type==="fill-extrusion",_={},x=[];for(let S=this._order.length-1;S>=0;S--){const P=this._order[S];if(f(P)){_[P]=S;for(const L of l){const D=L[P];if(D)for(const z of D)x.push(z)}}}x.sort((S,P)=>P.intersectionZ-S.intersectionZ);const w=[];for(let S=this._order.length-1;S>=0;S--){const P=this._order[S];if(f(P))for(let L=x.length-1;L>=0;L--){const D=x[L].feature;if(_[D.layer.id]<S)break;w.push(D),x.pop()}else for(const L of l){const D=L[P];if(D)for(const z of D)w.push(z.feature)}}return w}queryRenderedFeatures(l,f,_){f&&f.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const x={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const L of f.layers){const D=this._layers[L];if(!D)return this.fire(new s.ErrorEvent(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];x[D.source]=!0}}const w=[];f.availableImages=this._availableImages;const S=f&&f.layers?f.layers.some(L=>{const D=this.getLayer(L);return D&&D.is3D()}):this.has3DLayers(),P=lt.createFromScreenPoints(l,_);for(const L in this._sourceCaches){const D=this._sourceCaches[L].getSource().id;f.layers&&!x[D]||w.push(Ne(this._sourceCaches[L],this._layers,this._serializedLayers,P,f,_,S,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(L,D,z,V,q,ee,Q){const te={},ie=ee.queryRenderedSymbols(V),W=[];for(const fe of Object.keys(ie).map(Number))W.push(Q[fe]);W.sort(Ot);for(const fe of W){const le=fe.featureIndex.lookupSymbolFeatures(ie[fe.bucketInstanceId],D,fe.bucketIndex,fe.sourceLayerIndex,q.filter,q.layers,q.availableImages,L);for(const pe in le){const Te=te[pe]=te[pe]||[],be=le[pe];be.sort((Ce,Be)=>{const Ge=fe.featureSortOrder;if(Ge){const We=Ge.indexOf(Ce.featureIndex);return Ge.indexOf(Be.featureIndex)-We}return Be.featureIndex-Ce.featureIndex});for(const Ce of be)Te.push(Ce)}}for(const fe in te)te[fe].forEach(le=>{const pe=le.feature,Te=z(L[fe]).getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=Te});return te}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),P.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(l,f){f&&f.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const _=this._getSourceCaches(l);let x=[];for(const w of _)x=x.concat(at(w,f));return x}addSourceType(l,f,_){return vs.getSourceType(l)?_(new Error(`A source type called "${l}" already exists.`)):(vs.setSourceType(l,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:f.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(l,f={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const S in l)if(!v(l[S],_[S])){x=!0;break}if(!x)return;const w=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(l,f),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,f=1){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(f===1){if(typeof l.source=="object"){const _="terrain-dem-src";this.addSource(_,l.source),l=s.clone$1(l),l=s.extend(l,{source:_})}if(this._validate(s.validateTerrain,"terrain",l))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode)this._createTerrain(l,f);else{const _=this.terrain,x=_.get();for(const w of Object.keys(s.spec.terrain))!l.hasOwnProperty(w)&&s.spec.terrain[w].default&&(l[w]=s.spec.terrain[w].default);for(const w in l)if(!v(l[w],x[w])){_.set(l),this.stylesheet.terrain=l;const S=this._setTransitionParameters({duration:0});_.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const f=this.fog=new Kn(l,this.map.transform);this.stylesheet.fog=l;const _=this._setTransitionParameters({duration:0});f.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,_=f.get();Object.keys(l).length===0&&f.set(l);for(const x in l)if(!v(l[x],_[x])){f.set(l),this.stylesheet.fog=l;const w=this._setTransitionParameters({duration:0});f.updateTransitions(w);break}}else this._createFog(l);this._markersNeedUpdate=!0}_setTransitionParameters(l){return{now:s.exported.now(),transition:s.extend(l,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const l=this._order.filter(_=>this.isLayerDraped(this._layers[_])),f=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...f)}_createTerrain(l,f){const _=this.terrain=new yn(l,f);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});_.updateTransitions(x)}_force3DLayerUpdate(){for(const l in this._layers){const f=this._layers[l];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const f=this._layers[l];f.type==="symbol"&&this._updateLayer(f)}}_validate(l,f,_,x,w={}){return(!w||w.validate!==!1)&&Do(this,l.call(s.validateStyle,s.extend({key:f,style:this.serialize(),value:_,styleSpec:s.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){const f=this._getSourceCaches(l);for(const _ of f)_.clearTiles()}_reloadSource(l){const f=this._getSourceCaches(l);for(const _ of f)_.resume(),_.reload()}_reloadSources(){for(const l of this._getSources())l.reload&&l.reload()}_updateSources(l){for(const f in this._sourceCaches)this._sourceCaches[f].update(l)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const f=this._sourceCaches[l];f.resume(),f.reload()}}_updatePlacement(l,f,_,x,w=!1){let S=!1,P=!1;const L={};for(const D of this._order){const z=this._layers[D];if(z.type!=="symbol")continue;if(!L[z.source]){const q=this._getLayerSourceCache(z);if(!q)continue;L[z.source]=q.getRenderableIds(!0).map(ee=>q.getTileByID(ee)).sort((ee,Q)=>Q.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(Q.tileID)?-1:1))}const V=this.crossTileSymbolIndex.addLayer(z,L[z.source],l.center.lng,l.projection);S=S||V}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),w=w||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),l.zoom))&&(this.pauseablePlacement=new ho(l,this._order,w,f,_,x,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),P=!0),S&&this.pauseablePlacement.placement.setStale()),P||S)for(const D of this._order){const z=this._layers[D];z.type==="symbol"&&this.placement.updateLayerOpacities(z,L[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,f,_){this.imageManager.getImages(f.icons,_),this._updateTilesForChangedImages();const x=w=>{w&&w.setDependencies(f.tileID.key,f.type,f.icons)};x(this._otherSourceCaches[f.source]),x(this._symbolSourceCaches[f.source])}getGlyphs(l,f,_){this.glyphManager.getGlyphs(f.stacks,_)}getResource(l,f,_){return s.makeRequest(f,_)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){const f=[];return this._otherSourceCaches[l]&&f.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&f.push(this._symbolSourceCaches[l]),f}_isSourceCacheLoaded(l){const f=this._getSourceCaches(l);return f.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${l}'`))),!1):f.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}vs.getSourceType=function(m){return Re[m]},vs.setSourceType=function(m,l){Re[m]=l},vs.registerForPluginStateChange=s.registerForPluginStateChange;var Ul=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Np="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Up=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,tu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Vp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Kh={},Jh={};const $a=[];pa(Ul,$a),pa(Up,$a),pa(tu,$a),pa(Vp,$a),Kh=li("",Up),Jh=li(Vp,tu);const jp=li(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),nu=Ul,iu=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Qh={background:li(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:li(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:li(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:li("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:li(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:li(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:li("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:li("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:li("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:li(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:li(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:li(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:li(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:li(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:li(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:li(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:li(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:li(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:li(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:li(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:li(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:li(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:li(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:li(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:li(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:li(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Np),skyboxGradient:li(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Np),skyboxCapture:li(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:li(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:li(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function pa(m,l){const f=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of f)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=_.split(" ");for(const w of x)l.includes(w)||l.push(w)}}function li(m,l){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},w=[...$a];return pa(m,w),pa(l,w),{fragmentSource:m=m.replace(f,(S,P,L,D,z)=>(x[z]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${z}
varying ${L} ${D} ${z};
#else
uniform ${L} ${D} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${L} ${D} ${z} = u_${z};
#endif
`)),vertexSource:l=l.replace(f,(S,P,L,D,z)=>{const V=D==="float"?"vec2":"vec4",q=z.match(/color/)?"color":V;return x[z]?P==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${L} ${V} a_${z};
varying ${L} ${D} ${z};
#else
uniform ${L} ${D} u_${z};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${L} ${D} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${q}(a_${z}, u_${z}_t);
#else
    ${L} ${D} ${z} = u_${z};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${L} ${V} a_${z};
#else
uniform ${L} ${D} u_${z};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${L} ${D} ${z} = a_${z};
#else
    ${L} ${D} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${L} ${D} ${z} = unpack_mix_${q}(a_${z}, u_${z}_t);
#else
    ${L} ${D} ${z} = u_${z};
#endif
`}),staticAttributes:_,usedDefines:w}}class Vl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,f,_,x,w,S,P){this.context=l;let L=this.boundPaintVertexBuffers.length!==x.length;for(let z=0;!L&&z<x.length;z++)this.boundPaintVertexBuffers[z]!==x[z]&&(L=!0);let D=this.boundDynamicVertexBuffers.length!==P.length;for(let z=0;!D&&z<P.length;z++)this.boundDynamicVertexBuffers[z]!==P[z]&&(D=!0);if(!l.extVertexArrayObject||!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==_||L||D||this.boundIndexBuffer!==w||this.boundVertexOffset!==S)this.freshBind(f,_,x,w,S,P);else{l.bindVertexArrayOES.set(this.vao);for(const z of P)z&&z.bind();w&&w.dynamicDraw&&w.bind()}}freshBind(l,f,_,x,w,S){let P;const L=l.numAttributes,D=this.context,z=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=S;else{P=D.currentNumAttributes||0;for(let V=L;V<P;V++)z.disableVertexAttribArray(V)}f.enableAttributes(z,l),f.bind(),f.setVertexAttribPointers(z,l,w);for(const V of _)V.enableAttributes(z,l),V.bind(),V.setVertexAttribPointers(z,l,w);for(const V of S)V&&(V.enableAttributes(z,l),V.bind(),V.setVertexAttribPointers(z,l,w));x&&x.bind(),D.currentNumAttributes=L}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ef(m,l){const f=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new s.MercatorCoordinate(0,_/f).toLngLat().lat,new s.MercatorCoordinate(0,(_+1)/f).toLngLat().lat]}function jl(m,l,f,_,x,w,S){const P=m.context,L=P.gl,D=f.fbo;if(!D)return;m.prepareDrawTile();const z=m.useProgram("hillshade");P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,D.colorAttachment.get());const V=((te,ie,W,fe)=>{const le=W.paint.get("hillshade-shadow-color"),pe=W.paint.get("hillshade-highlight-color"),Te=W.paint.get("hillshade-accent-color");let be=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(be-=te.transform.angle);const Ce=!te.options.moving;return{u_matrix:fe||te.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),Ce),u_image:0,u_latrange:ef(0,ie.tileID),u_light:[W.paint.get("hillshade-exaggeration"),be],u_shadow:le,u_highlight:pe,u_accent:Te}})(m,f,_,m.terrain?l.projMatrix:null);m.prepareDrawProgram(P,z,l.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:ee,tileBoundsSegments:Q}=m.getTileBoundsBuffers(f);z.draw(P,L.TRIANGLES,x,w,S,s.CullFaceMode.disabled,V,_.id,q,ee,Q)}function Gl(m,l,f){if(!l.needsDEMTextureUpload)return;const _=m.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||m.getTileTexture(f.stride);const w=f.getPixels();l.demTexture?l.demTexture.update(w,{premultiply:!1}):l.demTexture=new s.Texture(_,w,x.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function ru(m,l,f,_,x,w){const S=m.context,P=S.gl;if(!l.dem)return;const L=l.dem;if(S.activeTexture.set(P.TEXTURE1),Gl(m,l,L),!l.demTexture)return;l.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);const D=L.dim;S.activeTexture.set(P.TEXTURE0);let z=l.fbo;if(!z){const Q=new s.Texture(S,{width:D,height:D,data:null},P.RGBA);Q.bind(P.LINEAR,P.CLAMP_TO_EDGE),z=l.fbo=S.createFramebuffer(D,D,!0),z.colorAttachment.set(Q.texture)}S.bindFramebuffer.set(z.framebuffer),S.viewport.set([0,0,D,D]);const{tileBoundsBuffer:V,tileBoundsIndexBuffer:q,tileBoundsSegments:ee}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(S,P.TRIANGLES,_,x,w,s.CullFaceMode.disabled,((Q,te)=>{const ie=te.stride,W=s.create();return s.ortho(W,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(W,W,[0,-s.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[ie,ie],u_zoom:Q.overscaledZ,u_unpack:te.unpackVector}})(l.tileID,L),f.id,V,q,ee),l.needsHillshadePrepare=!1}const su=m=>({u_matrix:new s.UniformMatrix4f(m),u_image0:new s.Uniform1i(m),u_skirt_height:new s.Uniform1f(m)}),tf=(m,l)=>({u_matrix:m,u_image0:0,u_skirt_height:l}),ou=(m,l,f,_,x,w,S,P,L,D,z,V,q,ee,Q)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:f,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:S,u_frustum_tr:P,u_frustum_br:L,u_frustum_bl:D,u_globe_pos:z,u_globe_radius:V,u_viewport:q,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:ee});function nf(m,l){return m!=null&&l!=null&&!(!m.hasData()||!l.hasData())&&m.demTexture!=null&&l.demTexture!=null&&m.tileID.key!==l.tileID.key}const Fo=new class{constructor(){this.operations={}}newMorphing(m,l,f,_,x){if(m in this.operations){const w=this.operations[m];w.to.tileID.key!==f.tileID.key&&(w.queued=f)}else this.operations[m]={startTime:_,phase:0,duration:x,from:l,to:f,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const l=this.operations[m];return{from:l.from,to:l.to,phase:l.phase}}update(m){for(const l in this.operations){const f=this.operations[l];for(f.phase=(m-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,m)){delete this.operations[l];break}}}_nextOp(m,l){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=l,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},ma={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function au(m){return 6*Math.pow(1.5,22-m)}function rf(m,l){const f=1<<m.z;return!l&&(m.x===0||m.x===f-1)||m.y===0||m.y===f-1}const Qn=m=>({u_matrix:m});function $l(m,l,f,_,x){if(x>0){const w=s.exported.now(),S=(w-m.timeAdded)/x,P=l?(w-l.timeAdded)/x:-1,L=f.getSource(),D=_.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),z=!l||Math.abs(l.tileID.overscaledZ-D)>Math.abs(m.tileID.overscaledZ-D),V=z&&m.refreshedUponExpiration?1:s.clamp(z?S:1-P,0,1);return m.refreshedUponExpiration&&S>=1&&(m.refreshedUponExpiration=!1),l?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class Gp extends s.SourceCache{constructor(l){const f={type:"raster-dem",maxzoom:l.transform.maxZoom},_=new Ii(cn(),null),x=Oe("mock-dem",f,_,l.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,f){l.state="loaded",f(null)}}class $p extends s.SourceCache{constructor(l){const f=Oe("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new Ii(cn(),null),l.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,f,_){if(l.freezeTileCoverage)return;this.transform=l;const x=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,S)=>{if(w[S.key]="",!this._tiles[S.key]){const P=new s.Tile(S,this._source.tileSize*S.overscaleFactor(),l.tileZoom);P.state="loaded",this._tiles[S.key]=P}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(l){const f=this.proxyCachedFBO[l];if(f!==void 0){const _=Object.values(f);this.renderCachePool.push(..._),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class sf extends s.OverscaledTileID{constructor(l,f,_){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=f,this.projMatrix=_}}class of extends s.Elevation{constructor(l,f){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,x,w]=function(L){const D=new s.StructArrayLayout2i4,z=new s.StructArrayLayout3ui6,V=131;D.reserve(17161),z.reserve(33800);const q=s.EXTENT/128,ee=s.EXTENT+q/2,Q=ee+q;for(let ie=-q;ie<Q;ie+=q)for(let W=-q;W<Q;W+=q){const fe=W<0||W>ee||ie<0||ie>ee?24575:0,le=s.clamp(Math.round(W),0,s.EXTENT),pe=s.clamp(Math.round(ie),0,s.EXTENT);D.emplaceBack(le+fe,pe)}const te=(ie,W)=>{const fe=W*V+ie;z.emplaceBack(fe+1,fe,fe+V),z.emplaceBack(fe+V,fe+V+1,fe+1)};for(let ie=1;ie<129;ie++)for(let W=1;W<129;W++)te(W,ie);return[0,129].forEach(ie=>{for(let W=0;W<130;W++)te(W,ie),te(ie,W)}),[D,z,32768]}(),S=l.context;this.gridBuffer=S.createVertexBuffer(_,s.posAttributes.members),this.gridIndexBuffer=S.createIndexBuffer(x),this.gridSegments=s.SegmentVector.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,_.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new $p(f.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const P=S.gl;this._overlapStencilMode=new s.StencilMode({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Gp(f.map)}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,f,_){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;const x=l.terrain.properties;this.sourceCache=l.terrain.drapeRenderMode===0?this._mockSourceCache:l._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const w=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const S=this.getScaledDemTileSize();this.sourceCache.update(f,S,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,w(),this._initializing=!0),w(),f.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||l.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=f.getIds().map(L=>{const D=f.getTileByID(L).tileID;return D.projMatrix=_.calculateProjMatrix(D.toUnwrapped()),D});(function(L,D){const z=D.transform.pointCoordinate(D.transform.getCameraPoint()),V=new s.pointGeometry(z.x,z.y);L.sort((q,ee)=>{if(ee.overscaledZ-q.overscaledZ)return ee.overscaledZ-q.overscaledZ;const Q=new s.pointGeometry(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),te=new s.pointGeometry(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),ie=V.mult(1<<q.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(Q)-ie.distSqr(te)})})(x,this.painter),this._previousZoom=_.zoom;const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(L=>{this.proxyToSource[L.key]={}}),this.terrainTileForTile={};const S=this._style._sourceCaches;for(const L in S){const D=S[L];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,l[L],w),D.usedForTerrain))continue;const z=l[L];D.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[f.id]=x.map(L=>new sf(L,L.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const P={};this._visibleDemTiles=[];for(const L of this.proxyCoords){const D=this.terrainTileForTile[L.key];if(!D)continue;const z=D.tileID.key;z in P||(this._visibleDemTiles.push(D),P[z]=z)}}_assignTerrainTiles(l){this._initializing||l.forEach(f=>{if(this.terrainTileForTile[f.key])return;const _=this._findTileCoveringTileID(f,this.sourceCache);_&&(this.terrainTileForTile[f.key]=_)})}_prepareDEMTextures(){const l=this.painter.context,f=l.gl;for(const _ in this.terrainTileForTile){const x=this.terrainTileForTile[_],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(l.activeTexture.set(f.TEXTURE1),Gl(this.painter,x,w))}}_prepareDemTileUniforms(l,f,_,x){if(!f||f.demTexture==null)return!1;const w=l.tileID.canonical,S=Math.pow(2,f.tileID.canonical.z-w.z),P=x||"";return _[`u_dem_tl${P}`]=[w.x*S%1,w.y*S%1],_[`u_dem_scale${P}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,f=l.gl;if(!this._emptyDepthBufferTexture){const _=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(l,_,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const f=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;const w=x.dem.tree.minimums[0];return w>0&&l++,_+w},0);return l?f/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,f=l.gl;l.activeTexture.set(f.TEXTURE2);const _=this._getLoadedAreaMinimum(),x=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new s.Texture(l,x,f.RGBA,{premultiply:!1}),w}setupElevationDraw(l,f,_){const x=this.painter.context,w=x.gl,S=(P=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(P),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var P;S.u_dem_size=this.sourceCache.getSource().tileSize,S.u_exaggeration=this.exaggeration();let L=null,D=null,z=1;if(_&&_.morphing&&this._useVertexMorphing){const V=_.morphing.srcDemTile,q=_.morphing.dstDemTile;z=_.morphing.phase,V&&q&&(this._prepareDemTileUniforms(l,V,S,"_prev")&&(D=V),this._prepareDemTileUniforms(l,q,S)&&(L=q))}if(D&&L?(x.activeTexture.set(w.TEXTURE2),L.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),x.activeTexture.set(w.TEXTURE4),D.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),S.u_dem_lerp=z):(L=this.terrainTileForTile[l.tileID.key],x.activeTexture.set(w.TEXTURE2),(this._prepareDemTileUniforms(l,L,S)?L.demTexture:this.emptyDEMTexture).bind(w.NEAREST,w.CLAMP_TO_EDGE)),x.activeTexture.set(w.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&L){const V=(1<<L.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=V}if(_&&_.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),f.setTerrainUniformValues(x,S),this.painter.transform.projection.name==="globe"){const V=this.globeUniformValues(this.painter.transform,l.tileID.canonical,_&&_.useDenormalizedUpVectorScale);f.setGlobeUniformValues(x,V)}}globeUniformValues(l,f,_){const x=l.projection;return{u_tile_tl_up:x.upVector(f,0,0),u_tile_tr_up:x.upVector(f,s.EXTENT,0),u_tile_br_up:x.upVector(f,s.EXTENT,s.EXTENT),u_tile_bl_up:x.upVector(f,0,s.EXTENT),u_tile_up_scale:_?s.globeMetersToEcef(1):x.upVectorScale(f,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const f=this.painter,_=this.painter.context;l.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,S,P,L){if(x.transform.projection.name==="globe")(function(D,z,V,q,ee){const Q=D.context,te=Q.gl;let ie,W;const fe=D.options.showTerrainWireframe?2:0,le=D.transform,pe=s.globeUseCustomAntiAliasing(D,Q,le),Te=(pt,$e)=>{if(W===pt)return;const De=[ma[pt],"PROJECTION_GLOBE_VIEW"];pe&&De.push("CUSTOM_ANTIALIASING"),$e&&De.push(ma[fe]),ie=D.useProgram("globeRaster",null,De),W=pt},be=D.colorModeForRenderPass(),Ce=new s.DepthMode(te.LEQUAL,s.DepthMode.ReadWrite,D.depthRangeFor3D);Fo.update(ee);const Be=s.calculateGlobeMercatorMatrix(le),Ge=[s.mercatorXfromLng(le.center.lng),s.mercatorYfromLat(le.center.lat)],We=fe?[!1,!0]:[!1],At=D.globeSharedBuffers,Ue=[le.width*s.exported.devicePixelRatio,le.height*s.exported.devicePixelRatio],rt=Float32Array.from(le.globeMatrix),Ye={useDenormalizedUpVectorScale:!0};if(We.forEach(pt=>{const $e=D.transform,De=au($e.zoom)*z.exaggeration();W=-1;const qe=pt?te.LINES:te.TRIANGLES;for(const ut of q){const _t=V.getTile(ut),Qt=s.StencilMode.disabled,zn=z.prevTerrainTileForTile[ut.key],Ht=z.terrainTileForTile[ut.key];nf(zn,Ht)&&Fo.newMorphing(ut.key,zn,Ht,ee,250),Q.activeTexture.set(te.TEXTURE0),_t.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);const Ut=Fo.getMorphValuesForProxy(ut.key),rn=Ut?1:0;Ut&&s.extend$1(Ye,{morphing:{srcDemTile:Ut.from,dstDemTile:Ut.to,phase:s.easeCubicInOut(Ut.phase)}});const Vn=s.tileCornersToBounds(ut.canonical),hn=s.getLatitudinalLod(Vn.getCenter().lat),ci=s.getGridMatrix(ut.canonical,Vn,hn,$e.worldSize/$e._pixelsPerMercatorPixel),mi=s.globeNormalizeECEF(s.globeTileBounds(ut.canonical)),Si=ou($e.projMatrix,rt,Be,mi,s.globeToMercatorTransition($e.zoom),Ge,$e.frustumCorners.TL,$e.frustumCorners.TR,$e.frustumCorners.BR,$e.frustumCorners.BL,$e.globeCenterInViewSpace,$e.globeRadius,Ue,De,ci);if(Te(rn,pt),z.setupElevationDraw(_t,ie,Ye),D.prepareDrawProgram(Q,ie,ut.toUnwrapped()),At){const[wi,or,ns]=pt?At.getWirefameBuffers(D.context,hn):At.getGridBuffers(hn,De!==0);ie.draw(Q,qe,Ce,Qt,be,s.CullFaceMode.backCCW,Si,"globe_raster",wi,or,ns)}}}),At){const pt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&pt.push("CUSTOM_ANTIALIASING"),ie=D.useProgram("globeRaster",null,pt);for(const $e of q){const{x:De,y:qe,z:ut}=$e.canonical,_t=qe===0,Qt=qe===(1<<ut)-1,[zn,Ht,Ut,rn]=At.getPoleBuffers(ut);if(rn&&(_t||Qt)){const Vn=V.getTile($e);Q.activeTexture.set(te.TEXTURE0),Vn.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);let hn=s.globePoleMatrixForTile(ut,De,le);const ci=s.globeNormalizeECEF(s.globeTileBounds($e.canonical)),mi=(Si,wi)=>Si.draw(Q,te.TRIANGLES,Ce,s.StencilMode.disabled,be,s.CullFaceMode.disabled,ou(le.projMatrix,hn,hn,ci,0,Ge,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,Ue,0),"globe_pole_raster",wi,Ut,rn);z.setupElevationDraw(Vn,ie,Ye),D.prepareDrawProgram(Q,ie,$e.toUnwrapped()),_t&&mi(ie,zn),Qt&&(hn=s.scale(s.create(),hn,[1,-1,1]),mi(ie,Ht))}}}})(x,w,S,P,L);else{const D=x.context,z=D.gl;let V,q;const ee=x.options.showTerrainWireframe?2:0,Q=(le,pe)=>{if(q===le)return;const Te=[ma[le]];pe&&Te.push(ma[ee]),V=x.useProgram("terrainRaster",null,Te),q=le},te=x.colorModeForRenderPass(),ie=new s.DepthMode(z.LEQUAL,s.DepthMode.ReadWrite,x.depthRangeFor3D);Fo.update(L);const W=x.transform,fe=au(W.zoom)*w.exaggeration();(ee?[!1,!0]:[!1]).forEach(le=>{q=-1;const pe=le?z.LINES:z.TRIANGLES,[Te,be]=le?w.getWirefameBuffer():[w.gridIndexBuffer,w.gridSegments];for(const Ce of P){const Be=S.getTile(Ce),Ge=s.StencilMode.disabled,We=w.prevTerrainTileForTile[Ce.key],At=w.terrainTileForTile[Ce.key];nf(We,At)&&Fo.newMorphing(Ce.key,We,At,L,250),D.activeTexture.set(z.TEXTURE0),Be.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const Ue=Fo.getMorphValuesForProxy(Ce.key),rt=Ue?1:0;let Ye;Ue&&(Ye={morphing:{srcDemTile:Ue.from,dstDemTile:Ue.to,phase:s.easeCubicInOut(Ue.phase)}});const pt=tf(Ce.projMatrix,rf(Ce.canonical,W.renderWorldCopies)?fe/10:fe);Q(rt,le),w.setupElevationDraw(Be,V,Ye),x.prepareDrawProgram(D,V,Ce.toUnwrapped()),V.draw(D,pe,ie,Ge,te,s.CullFaceMode.backCCW,pt,"terrain_raster",w.gridBuffer,Te,be)}})}}(f,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const f=this.painter,_=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],S=this._drapedRenderBatches.shift(),P=[],L=f.style.order;let D=0;for(const z of w){const V=x.getTileByID(z.proxyTileKey),q=x.proxyCachedFBO[z.key]?x.proxyCachedFBO[z.key][l]:void 0,ee=q!==void 0?x.renderCache[q]:this.pool[D++],Q=q!==void 0;if(V.texture=ee.tex,Q&&!ee.dirty){P.push(V.tileID);continue}let te;_.bindFramebuffer.set(ee.fb.framebuffer),this.renderedToTile=!1,ee.dirty&&(_.clear({color:s.Color.transparent,stencil:0}),ee.dirty=!1);for(let ie=S.start;ie<=S.end;++ie){const W=f.style._layers[L[ie]];if(W.isHidden(f.transform.zoom))continue;const fe=f.style._getLayerSourceCache(W),le=fe?this.proxyToSource[z.key][fe.id]:[z];if(!le)continue;const pe=le;_.viewport.set([0,0,ee.fb.width,ee.fb.height]),te!==(fe?fe.id:null)&&(this._setupStencil(ee,le,W,fe),te=fe?fe.id:null),f.renderLayer(f,fe,W,pe)}this.renderedToTile?(ee.dirty=!0,P.push(V.tileID)):Q||--D,D===5&&(D=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,f.width,f.height]),S.end+1}postRender(){}renderCacheEfficiency(l){const f=l.order.length;if(f===0)return{efficiency:100};let _,x=0,w=0,S=!1;for(let P=0;P<f;++P){const L=l._layers[l.order[P]];this._style.isLayerDraped(L)?(S&&++x,++w):S||(S=!0,_=L.id)}return w===0?{efficiency:100}:{efficiency:100*(1-x/w),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{l=Math.min(l,f.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,f,_){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const S=w.tileID,P=1<<S.overscaledZ,{x:L,y:D}=S.canonical,z=L/P,V=(L+1)/P,q=D/P,ee=(D+1)/P;return{minx:z,miny:q,maxx:V,maxy:ee,t:w.dem.tree.raycastRoot(z,q,V,ee,l,f,_),tile:w}});x.sort((w,S)=>(w.t!==null?w.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const w of x){if(w.t==null)return null;const S=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,l,f,_);if(S!=null)return S}return null}_createFBO(){const l=this.painter.context,f=l.gl,_=this.drapeBufferSize;l.activeTexture.set(f.TEXTURE0);const x=new s.Texture(l,{width:_[0],height:_[1],data:null},f.RGBA);x.bind(f.LINEAR,f.CLAMP_TO_EDGE);const w=l.createFramebuffer(_[0],_[1],!1);return w.colorAttachment.set(x.texture),w.depthAttachment=new Rr(l,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const f=this._style._layers[l],_=f.isHidden(this.painter.transform.zoom);return f.type==="custom"?!_&&f.shouldRedrape():!_&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const _ of this._style._getSources())if(_ instanceof U){l=!0;break}if(!l)return;const f={};for(let _=0;_<this._style.order.length;++_){const x=this._style._layers[this._style.order[_]],w=this._style._getLayerSourceCache(x);if(w&&!f[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof s.ZoomDependentExpression){f[w.id]=!0;for(const S of this.proxyCoords){const P=this.proxyToSource[S.key][w.id];if(P)for(const L of P)this._clearRenderCacheForTile(w.id,L)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof H){l=!0;break}if(!l)return;const f={};for(let _=0;_<this._style.order.length;++_){const x=this._style._layers[this._style.order[_]],w=this._style._getLayerSourceCache(x);if(!w||f[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const S=x.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const L=this.proxyToSource[P.key][w.id];if(L)for(const D of L){const z=$l(w.getTile(D),w.findLoadedParent(D,0),w,this.painter.transform,S);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(w.id,D)}}}}_setupDrapedRenderBatches(){const l=this._style.order,f=l.length;if(f===0)return;const _=[];let x,w=0,S=this._style._layers[l[w]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++w<f;)S=this._style._layers[l[w]];for(;w<f;++w){const P=this._style._layers[l[w]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?x===void 0&&(x=w):x!==void 0&&(_.push({start:x,end:w-1}),x=void 0))}x!==void 0&&_.push({start:x,end:w-1}),this._drapedRenderBatches=_}_setupRenderCache(l){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const S=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let P=0;P<S.length;++P){const L=Object.values(S[P]);f.renderCachePool.push(...L)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,x=this._tilesDirty;for(let S=_.length-1;S>=0;S--){const P=_[S];if(f.getTileByID(P.key),f.proxyCachedFBO[P.key]!==void 0){const L=l[P.key],D=this.proxyToSource[P.key];let z=0;for(const V in D){const q=D[V],ee=L[V];if(!ee||ee.length!==q.length||q.some((Q,te)=>Q!==ee[te]||x[V]&&x[V].hasOwnProperty(Q.key))){z=-1;break}++z}for(const V in f.proxyCachedFBO[P.key])f.renderCache[f.proxyCachedFBO[P.key][V]].dirty=z<0||z!==Object.values(L).length}}const w=[...this._drapedRenderBatches];w.sort((S,P)=>P.end-P.start-(S.end-S.start));for(const S of w)for(const P of _){if(f.proxyCachedFBO[P.key])continue;let L=f.renderCachePool.pop();L===void 0&&f.renderCache.length<50&&(L=f.renderCache.length,f.renderCache.push(this._createFBO())),L!==void 0&&(f.proxyCachedFBO[P.key]={},f.proxyCachedFBO[P.key][S.start]=L,f.renderCache[L].dirty=!0)}this._tilesDirty={}}_setupStencil(l,f,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,S=w.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let P;if(_.isTileClipped())P=f.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(l,f){const _=this.painter,x=this.painter.context,w=x.gl;_._tileClippingMaskIDs={},x.setColorMode(s.ColorMode.disabled),x.setDepthMode(s.DepthMode.disabled);const S=_.useProgram("clippingMask");for(const P of l){const L=_._tileClippingMaskIDs[P.key]=--f;S.draw(x,w.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:w.ALWAYS,mask:0},L,255,w.KEEP,w.KEEP,w.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Qn(P.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(l){const f=this.painter.transform;if(l.x<0||l.x>f.width||l.y<0||l.y>f.height)return null;const _=[l.x,l.y,1,1];s.transformMat4$1(_,_,f.pixelMatrixInverse),s.scale$1(_,_,1/_[3]),_[0]/=f.worldSize,_[1]/=f.worldSize;const x=f._camera.position,w=s.mercatorZfromAltitude(1,f.center.lat),S=[x[0],x[1],x[2]/w,0],P=s.subtract([],_.slice(0,3),S);s.normalize(P,P);const L=this.raycast(S,P,this._exaggeration);return L!==null&&L?(s.scaleAndAdd(S,S,P,L),S[3]=S[2],S[2]*=w,S):null}drawDepth(){const l=this.painter,f=l.context,_=this.proxySourceCache,x=Math.ceil(l.width),w=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const S=f.gl,P=f.createFramebuffer(x,w,!0);f.activeTexture.set(S.TEXTURE0);const L=new s.Texture(f,{width:x,height:w,data:null},S.RGBA);L.bind(S.NEAREST,S.CLAMP_TO_EDGE),P.colorAttachment.set(L.texture);const D=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,x,w);P.depthAttachment.set(D),this._depthFBO=P,this._depthTexture=L}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,x,w]),function(S,P,L,D){if(S.transform.projection.name==="globe")return;const z=S.context,V=z.gl;z.clear({depth:1});const q=S.useProgram("terrainDepth"),ee=new s.DepthMode(V.LESS,s.DepthMode.ReadWrite,S.depthRangeFor3D);for(const Q of D){const te=L.getTile(Q),ie=tf(Q.projMatrix,0);P.setupElevationDraw(te,q),q.draw(z,V.TRIANGLES,ee,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,ie,"terrain_depth",P.gridBuffer,P.gridIndexBuffer,P.gridNoSkirtSegments)}}(l,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,f,_){if(l.getSource()instanceof Se)return this._setupProxiedCoordsForImageSource(l,f,_);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const x=this.proxiedCoords[l.id]=[],w=this.proxyCoords;for(let P=0;P<w.length;P++){const L=w[P],D=this._findTileCoveringTileID(L,l);if(D){const z=this._createProxiedId(L,D,_[L.key]&&_[L.key][l.id]);x.push(z),this.proxyToSource[L.key][l.id]=[z]}}let S=!1;for(let P=0;P<f.length;P++){const L=l.getTile(f[P]);if(!L||!L.hasData())continue;const D=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==L.tileID.canonical.z){const z=this.proxyToSource[D.tileID.key][l.id],V=this._createProxiedId(D.tileID,L,_[D.tileID.key]&&_[D.tileID.key][l.id]);z?z.splice(z.length-1,0,V):this.proxyToSource[D.tileID.key][l.id]=[V],x.push(V),S=!0}}this._sourceTilesOverlap[l.id]=S}_setupProxiedCoordsForImageSource(l,f,_){if(!l.getSource().loaded())return;const x=this.proxiedCoords[l.id]=[],w=this.proxyCoords,S=l.getSource(),P=new s.pointGeometry(S.tileID.x,S.tileID.y)._div(1<<S.tileID.z),L=S.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((z,V)=>(z.min.x=Math.min(z.min.x,V.x-P.x),z.min.y=Math.min(z.min.y,V.y-P.y),z.max.x=Math.max(z.max.x,V.x-P.x),z.max.y=Math.max(z.max.y,V.y-P.y),z),{min:new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(z,V)=>{const q=z.wrap+z.canonical.x/(1<<z.canonical.z),ee=z.canonical.y/(1<<z.canonical.z),Q=s.EXTENT/(1<<z.canonical.z),te=V.wrap+V.canonical.x/(1<<V.canonical.z),ie=V.canonical.y/(1<<V.canonical.z);return q+Q<te+L.min.x||q>te+L.max.x||ee+Q<ie+L.min.y||ee>ie+L.max.y};for(let z=0;z<w.length;z++){const V=w[z];for(let q=0;q<f.length;q++){const ee=l.getTile(f[q]);if(!ee||!ee.hasData()||D(V,ee.tileID))continue;const Q=this._createProxiedId(V,ee,_[V.key]&&_[V.key][l.id]),te=this.proxyToSource[V.key][l.id];te?te.push(Q):this.proxyToSource[V.key][l.id]=[Q],x.push(Q)}}}_createProxiedId(l,f,_){let x=this.orthoMatrix;if(_){const w=_.find(S=>S.key===f.tileID.key);if(w)return w}if(f.tileID.key!==l.key){const w=l.canonical.z-f.tileID.canonical.z;let S,P,L;x=s.create();const D=f.tileID.wrap-l.wrap<<l.overscaledZ;w>0?(S=s.EXTENT>>w,P=S*((f.tileID.canonical.x<<w)-l.canonical.x+D),L=S*((f.tileID.canonical.y<<w)-l.canonical.y)):(S=s.EXTENT<<-w,P=s.EXTENT*(f.tileID.canonical.x-(l.canonical.x+D<<-w)),L=s.EXTENT*(f.tileID.canonical.y-(l.canonical.y<<-w))),s.ortho(x,0,S,0,S,0,1),s.translate(x,x,[P,L,0])}return new sf(f.tileID,l.key,x)}_findTileCoveringTileID(l,f){let _=f.getTile(l);if(_&&_.hasData())return _;const x=this._findCoveringTileCache[f.id],w=x[l.key];if(_=w?f.getTileByID(w):null,_&&_.hasData()||w===null)return _;let S=_?_.tileID:l,P=S.overscaledZ;const L=f.getSource().minzoom,D=[];if(!w){const V=f.getSource().maxzoom;if(l.canonical.z>=V){const q=l.canonical.z-V;f.getSource().reparseOverscaled?(P=Math.max(l.canonical.z+2,f.transform.tileZoom),S=new s.OverscaledTileID(P,l.wrap,V,l.canonical.x>>q,l.canonical.y>>q)):q!==0&&(P=V,S=new s.OverscaledTileID(P,l.wrap,V,l.canonical.x>>q,l.canonical.y>>q))}S.key!==l.key&&(D.push(S.key),_=f.getTile(S))}const z=V=>{D.forEach(q=>{x[q]=V}),D.length=0};for(P-=1;P>=L&&(!_||!_.hasData());P--){_&&z(_.tileID.key);const V=S.calculateScaledKey(P);if(_=f.getTileByID(V),_&&_.hasData())break;const q=x[V];if(q===null)break;q===void 0?D.push(V):_=f.getTileByID(q)}return z(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,f){let _=this._tilesDirty[l];_||(_=this._tilesDirty[l]={}),_[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const l=function(f){let _=0;const x=new s.StructArrayLayout2ui4,w=131;for(let S=1;S<129;S++){for(let P=1;P<129;P++)_=S*w+P,x.emplaceBack(_,_+1),x.emplaceBack(_,_+w),x.emplaceBack(_+1,_+w),S===128&&x.emplaceBack(_+w,_+w+1);x.emplaceBack(_+1,_+1+w)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class af{static cacheKey(l,f,_,x){let w=`${f}${x?x.cacheKey:""}`;for(const S of _)l.usedDefines.includes(S)&&(w+=`/${S}`);return w}constructor(l,f,_,x,w,S){const P=l.gl;this.program=P.createProgram();const L=function(W){const fe=[];for(let le=0;le<W.length;le++){if(W[le]===null)continue;const pe=W[le].split(" ");fe.push(pe.pop())}return fe}(_.staticAttributes),D=x?x.getBinderAttributes():[],z=L.concat(D);let V=x?x.defines():[];V=V.concat(S.map(W=>`#define ${W}`));const q=l.isWebGL2?`#version 300 es
`:"",ee=q+V.concat(l.extStandardDerivatives&&q.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(iu):iu,iu,nu,jp.fragmentSource,Jh.fragmentSource,_.fragmentSource).join(`
`),Q=q+V.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,nu,jp.vertexSource,Jh.vertexSource,Kh.vertexSource,_.vertexSource).join(`
`),te=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(te,ee),P.compileShader(te),P.attachShader(this.program,te);const ie=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(ie,Q),P.compileShader(ie),P.attachShader(this.program,ie),this.attributes={},this.numAttributes=z.length;for(let W=0;W<this.numAttributes;W++)z[W]&&(P.bindAttribLocation(this.program,W,z[W]),this.attributes[z[W]]=W);P.linkProgram(this.program),P.deleteShader(ie),P.deleteShader(te),this.fixedUniforms=w(l),this.binderUniforms=x?x.getUniforms(l):[],S.includes("TERRAIN")&&(this.terrainUniforms=(W=>({u_dem:new s.Uniform1i(W),u_dem_prev:new s.Uniform1i(W),u_dem_unpack:new s.Uniform4f(W),u_dem_tl:new s.Uniform2f(W),u_dem_scale:new s.Uniform1f(W),u_dem_tl_prev:new s.Uniform2f(W),u_dem_scale_prev:new s.Uniform1f(W),u_dem_size:new s.Uniform1f(W),u_dem_lerp:new s.Uniform1f(W),u_exaggeration:new s.Uniform1f(W),u_depth:new s.Uniform1i(W),u_depth_size_inv:new s.Uniform2f(W),u_meter_to_dem:new s.Uniform1f(W),u_label_plane_matrix_inv:new s.UniformMatrix4f(W)}))(l)),S.includes("GLOBE")&&(this.globeUniforms=(W=>({u_tile_tl_up:new s.Uniform3f(W),u_tile_tr_up:new s.Uniform3f(W),u_tile_br_up:new s.Uniform3f(W),u_tile_bl_up:new s.Uniform3f(W),u_tile_up_scale:new s.Uniform1f(W)}))(l)),S.includes("FOG")&&(this.fogUniforms=(W=>({u_fog_matrix:new s.UniformMatrix4f(W),u_fog_range:new s.Uniform2f(W),u_fog_color:new s.Uniform4f(W),u_fog_horizon_blend:new s.Uniform1f(W),u_fog_temporal_offset:new s.Uniform1f(W),u_frustum_tl:new s.Uniform3f(W),u_frustum_tr:new s.Uniform3f(W),u_frustum_br:new s.Uniform3f(W),u_frustum_bl:new s.Uniform3f(W),u_globe_pos:new s.Uniform3f(W),u_globe_radius:new s.Uniform1f(W),u_globe_transition:new s.Uniform1f(W),u_is_globe:new s.Uniform1i(W),u_viewport:new s.Uniform2f(W)}))(l))}}setTerrainUniformValues(l,f){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in f)_[x]&&_[x].set(this.program,x,f[x])}}setGlobeUniformValues(l,f){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in f)_[x]&&_[x].set(this.program,x,f[x])}}setFogUniformValues(l,f){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in f)_[x].set(this.program,x,f[x])}}draw(l,f,_,x,w,S,P,L,D,z,V,q,ee,Q,te){const ie=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(_),l.setStencilMode(x),l.setColorMode(w),l.setCullFace(S);for(const fe of Object.keys(this.fixedUniforms))this.fixedUniforms[fe].set(this.program,fe,P[fe]);Q&&Q.setUniforms(this.program,l,this.binderUniforms,q,{zoom:ee});const W={[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[f];for(const fe of V.get()){const le=fe.vaos||(fe.vaos={});(le[L]||(le[L]=new Vl)).bind(l,this,D,Q?Q.getPaintVertexBuffers():[],z,fe.vertexOffset,te||[]),ie.drawElements(f,fe.primitiveLength*W,ie.UNSIGNED_SHORT,fe.primitiveOffset*W*2)}}}function Hp(m,l){const f=Math.pow(2,l.tileID.overscaledZ),_=l.tileSize*Math.pow(2,m.transform.tileZoom)/f,x=_*(l.tileID.canonical.x+l.tileID.wrap*f),w=_*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_tile_units_to_pixels:1/vi(l,1,m.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const Uy=s.create(),lu=(m,l,f,_,x,w,S,P,L,D,z)=>{const V=l.style.light,q=V.properties.get("position"),ee=[q.x,q.y,q.z],Q=s.create$1();V.properties.get("anchor")==="viewport"&&(s.fromRotation(Q,-l.transform.angle),s.transformMat3(ee,ee,Q));const te=V.properties.get("color"),ie=l.transform,W={u_matrix:m,u_lightpos:ee,u_lightintensity:V.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_vertical_gradient:+f,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Uy,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:w};return ie.projection.name==="globe"&&(W.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],W.u_zoom_transition=L,W.u_inv_rot_matrix=z,W.u_merc_center=D,W.u_up_dir=ie.projection.upVector(new s.CanonicalTileID(0,0,0),D[0]*s.EXTENT,D[1]*s.EXTENT),W.u_height_lift=P),W},lf=(m,l,f,_,x,w,S,P,L,D,z,V)=>{const q=lu(m,l,f,_,x,w,S,L,D,z,V),ee={u_height_factor:-Math.pow(2,S.overscaledZ)/P.tileSize/8};return s.extend(q,Hp(l,P),ee)},cu=m=>({u_matrix:m}),uu=(m,l,f)=>s.extend(cu(m),Hp(l,f)),Wp=(m,l)=>({u_matrix:m,u_world:l}),qp=(m,l,f,_)=>s.extend(uu(m,l,f),{u_world:_}),Vy=s.create(),Hl=(m,l,f,_,x,w)=>{const S=m.transform,P=S.projection.name==="globe";let L;if(w.paint.get("circle-pitch-alignment")==="map")if(P){const z=s.globePixelsToTileUnits(S.zoom,l.canonical)*S._pixelsPerMercatorPixel;L=Float32Array.from([z,0,0,z])}else L=S.calculatePixelsToTileUnitsMatrix(f);else L=new Float32Array([S.pixelsToGLUnits[0],0,0,S.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:S.cameraToCenterDistance,u_matrix:m.translatePosMatrix(l.projMatrix,f,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:L,u_inv_rot_matrix:Vy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){D.u_inv_rot_matrix=_,D.u_merc_center=x,D.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],D.u_zoom_transition=s.globeToMercatorTransition(S.zoom);const z=x[0]*s.EXTENT,V=x[1]*s.EXTENT;D.u_up_dir=S.projection.upVector(new s.CanonicalTileID(0,0,0),z,V)}return D},Wl=m=>{const l=[];return m.paint.get("circle-pitch-alignment")==="map"&&l.push("PITCH_WITH_MAP"),m.paint.get("circle-pitch-scale")==="map"&&l.push("SCALE_WITH_MAP"),l},Zp=(m,l,f,_)=>{const x=s.EXTENT/f.tileSize;return{u_matrix:m,u_camera_to_center_distance:l.getCameraToCenterDistance(_),u_extrude_scale:[l.pixelsToGLUnits[0]/x,l.pixelsToGLUnits[1]/x]}},ql=(m,l,f=1)=>({u_matrix:m,u_color:l,u_overlay:0,u_overlay_scale:f}),cf=s.create(),Js=(m,l,f,_,x,w,S)=>{const P=m.transform,L=P.projection.name==="globe",D=L?s.globePixelsToTileUnits(P.zoom,l.canonical)*P._pixelsPerMercatorPixel:vi(f,1,w),z={u_matrix:l.projMatrix,u_extrude_scale:D,u_intensity:S,u_inv_rot_matrix:cf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){z.u_inv_rot_matrix=_,z.u_merc_center=x,z.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],z.u_zoom_transition=s.globeToMercatorTransition(P.zoom);const V=x[0]*s.EXTENT,q=x[1]*s.EXTENT;z.u_up_dir=P.projection.upVector(new s.CanonicalTileID(0,0,0),V,q)}return z},uf=(m,l,f,_,x,w,S)=>{const P=m.transform,L=P.calculatePixelsToTileUnitsMatrix(l);return{u_matrix:hf(m,l,f,_),u_pixels_to_tile_units:L,u_device_pixel_ratio:w,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:fu(f)?l.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:hu(l,m.transform),u_alpha_discard_threshold:0,u_trim_offset:S}},Xp=(m,l,f,_,x)=>{const w=m.transform;return{u_matrix:hf(m,l,f,_),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:hu(l,w),u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function hu(m,l){return 1/vi(m,1,l.tileZoom)}function hf(m,l,f,_){return m.translatePosMatrix(_||l.tileID.projMatrix,l,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function fu(m){const l=m.paint.get("line-dasharray").value;return l.value||l.kind!=="constant"}const jy=(m,l,f,_,x,w)=>{return{u_matrix:m,u_tl_parent:l,u_scale_parent:f,u_fade_t:_.mix,u_opacity:_.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(P=x.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(S=x.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:ff(x.paint.get("raster-hue-rotate")),u_perspective_transform:w};var S,P};function ff(m){m*=Math.PI/180;const l=Math.sin(m),f=Math.cos(m);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}const Yp=s.create(),Zl=(m,l,f,_,x,w,S,P,L,D,z,V,q,ee,Q,te)=>{const ie=x.transform,W={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:ie.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:ie.width/ie.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:P,u_is_text:+L,u_pitch_with_map:+_,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Yp,u_up_vector:[0,-1,0]};return te.name==="globe"&&(W.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],W.u_zoom_transition=V,W.u_inv_rot_matrix=ee,W.u_merc_center=q,W.u_camera_forward=ie._camera.forward(),W.u_ecef_origin=s.globeECEFOrigin(ie.globeMatrix,z.toUnwrapped()),W.u_tile_matrix=Float32Array.from(ie.globeMatrix),W.u_up_vector=Q),W},Kp=(m,l,f,_,x,w,S,P,L,D,z,V,q,ee,Q,te,ie)=>s.extend(Zl(m,l,f,_,x,w,S,P,L,D,V,q,ee,Q,te,ie),{u_gamma_scale:_?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+z}),df=(m,l,f,_,x,w,S,P,L,D,z,V,q,ee,Q,te)=>s.extend(Kp(m,l,f,_,x,w,S,P,!0,L,!0,z,V,q,ee,Q,te),{u_texsize_icon:D,u_texture_icon:1}),Gy=(m,l,f)=>({u_matrix:m,u_opacity:l,u_color:f}),pf=(m,l,f,_,x)=>s.extend(function(w,S,P){const L=S.imageManager.getPattern(w.toString()),{width:D,height:z}=S.imageManager.getPixelSize(),V=Math.pow(2,P.tileID.overscaledZ),q=P.tileSize*Math.pow(2,S.transform.tileZoom)/V,ee=q*(P.tileID.canonical.x+P.tileID.wrap*V),Q=q*P.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[D,z],u_pattern_size:L.displaySize,u_tile_units_to_pixels:1/vi(P,1,S.transform.tileZoom),u_pixel_coord_upper:[ee>>16,Q>>16],u_pixel_coord_lower:[65535&ee,65535&Q]}}(_,f,x),{u_matrix:m,u_opacity:l}),$y={fillExtrusion:m=>({u_matrix:new s.UniformMatrix4f(m),u_lightpos:new s.Uniform3f(m),u_lightintensity:new s.Uniform1f(m),u_lightcolor:new s.Uniform3f(m),u_vertical_gradient:new s.Uniform1f(m),u_opacity:new s.Uniform1f(m),u_edge_radius:new s.Uniform1f(m),u_ao:new s.Uniform2f(m),u_tile_id:new s.Uniform3f(m),u_zoom_transition:new s.Uniform1f(m),u_inv_rot_matrix:new s.UniformMatrix4f(m),u_merc_center:new s.Uniform2f(m),u_up_dir:new s.Uniform3f(m),u_height_lift:new s.Uniform1f(m)}),fillExtrusionPattern:m=>({u_matrix:new s.UniformMatrix4f(m),u_lightpos:new s.Uniform3f(m),u_lightintensity:new s.Uniform1f(m),u_lightcolor:new s.Uniform3f(m),u_vertical_gradient:new s.Uniform1f(m),u_height_factor:new s.Uniform1f(m),u_edge_radius:new s.Uniform1f(m),u_ao:new s.Uniform2f(m),u_tile_id:new s.Uniform3f(m),u_zoom_transition:new s.Uniform1f(m),u_inv_rot_matrix:new s.UniformMatrix4f(m),u_merc_center:new s.Uniform2f(m),u_up_dir:new s.Uniform3f(m),u_height_lift:new s.Uniform1f(m),u_image:new s.Uniform1i(m),u_texsize:new s.Uniform2f(m),u_pixel_coord_upper:new s.Uniform2f(m),u_pixel_coord_lower:new s.Uniform2f(m),u_tile_units_to_pixels:new s.Uniform1f(m),u_opacity:new s.Uniform1f(m)}),fill:m=>({u_matrix:new s.UniformMatrix4f(m)}),fillPattern:m=>({u_matrix:new s.UniformMatrix4f(m),u_image:new s.Uniform1i(m),u_texsize:new s.Uniform2f(m),u_pixel_coord_upper:new s.Uniform2f(m),u_pixel_coord_lower:new s.Uniform2f(m),u_tile_units_to_pixels:new s.Uniform1f(m)}),fillOutline:m=>({u_matrix:new s.UniformMatrix4f(m),u_world:new s.Uniform2f(m)}),fillOutlinePattern:m=>({u_matrix:new s.UniformMatrix4f(m),u_world:new s.Uniform2f(m),u_image:new s.Uniform1i(m),u_texsize:new s.Uniform2f(m),u_pixel_coord_upper:new s.Uniform2f(m),u_pixel_coord_lower:new s.Uniform2f(m),u_tile_units_to_pixels:new s.Uniform1f(m)}),circle:m=>({u_camera_to_center_distance:new s.Uniform1f(m),u_extrude_scale:new s.UniformMatrix2f(m),u_device_pixel_ratio:new s.Uniform1f(m),u_matrix:new s.UniformMatrix4f(m),u_inv_rot_matrix:new s.UniformMatrix4f(m),u_merc_center:new s.Uniform2f(m),u_tile_id:new s.Uniform3f(m),u_zoom_transition:new s.Uniform1f(m),u_up_dir:new s.Uniform3f(m)}),collisionBox:m=>({u_matrix:new s.UniformMatrix4f(m),u_camera_to_center_distance:new s.Uniform1f(m),u_extrude_scale:new s.Uniform2f(m)}),collisionCircle:m=>({u_matrix:new s.UniformMatrix4f(m),u_inv_matrix:new s.UniformMatrix4f(m),u_camera_to_center_distance:new s.Uniform1f(m),u_viewport_size:new s.Uniform2f(m)}),debug:m=>({u_color:new s.UniformColor(m),u_matrix:new s.UniformMatrix4f(m),u_overlay:new s.Uniform1i(m),u_overlay_scale:new s.Uniform1f(m)}),clippingMask:m=>({u_matrix:new s.UniformMatrix4f(m)}),heatmap:m=>({u_extrude_scale:new s.Uniform1f(m),u_intensity:new s.Uniform1f(m),u_matrix:new s.UniformMatrix4f(m),u_inv_rot_matrix:new s.UniformMatrix4f(m),u_merc_center:new s.Uniform2f(m),u_tile_id:new s.Uniform3f(m),u_zoom_transition:new s.Uniform1f(m),u_up_dir:new s.Uniform3f(m)}),heatmapTexture:m=>({u_image:new s.Uniform1i(m),u_color_ramp:new s.Uniform1i(m),u_opacity:new s.Uniform1f(m)}),hillshade:m=>({u_matrix:new s.UniformMatrix4f(m),u_image:new s.Uniform1i(m),u_latrange:new s.Uniform2f(m),u_light:new s.Uniform2f(m),u_shadow:new s.UniformColor(m),u_highlight:new s.UniformColor(m),u_accent:new s.UniformColor(m)}),hillshadePrepare:m=>({u_matrix:new s.UniformMatrix4f(m),u_image:new s.Uniform1i(m),u_dimension:new s.Uniform2f(m),u_zoom:new s.Uniform1f(m),u_unpack:new s.Uniform4f(m)}),line:m=>({u_matrix:new s.UniformMatrix4f(m),u_pixels_to_tile_units:new s.UniformMatrix2f(m),u_device_pixel_ratio:new s.Uniform1f(m),u_units_to_pixels:new s.Uniform2f(m),u_dash_image:new s.Uniform1i(m),u_gradient_image:new s.Uniform1i(m),u_image_height:new s.Uniform1f(m),u_texsize:new s.Uniform2f(m),u_tile_units_to_pixels:new s.Uniform1f(m),u_alpha_discard_threshold:new s.Uniform1f(m),u_trim_offset:new s.Uniform2f(m)}),linePattern:m=>({u_matrix:new s.UniformMatrix4f(m),u_texsize:new s.Uniform2f(m),u_pixels_to_tile_units:new s.UniformMatrix2f(m),u_device_pixel_ratio:new s.Uniform1f(m),u_image:new s.Uniform1i(m),u_units_to_pixels:new s.Uniform2f(m),u_tile_units_to_pixels:new s.Uniform1f(m),u_alpha_discard_threshold:new s.Uniform1f(m)}),raster:m=>({u_matrix:new s.UniformMatrix4f(m),u_tl_parent:new s.Uniform2f(m),u_scale_parent:new s.Uniform1f(m),u_fade_t:new s.Uniform1f(m),u_opacity:new s.Uniform1f(m),u_image0:new s.Uniform1i(m),u_image1:new s.Uniform1i(m),u_brightness_low:new s.Uniform1f(m),u_brightness_high:new s.Uniform1f(m),u_saturation_factor:new s.Uniform1f(m),u_contrast_factor:new s.Uniform1f(m),u_spin_weights:new s.Uniform3f(m),u_perspective_transform:new s.Uniform2f(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new s.Uniform1i(m),u_is_size_feature_constant:new s.Uniform1i(m),u_size_t:new s.Uniform1f(m),u_size:new s.Uniform1f(m),u_camera_to_center_distance:new s.Uniform1f(m),u_rotate_symbol:new s.Uniform1i(m),u_aspect_ratio:new s.Uniform1f(m),u_fade_change:new s.Uniform1f(m),u_matrix:new s.UniformMatrix4f(m),u_label_plane_matrix:new s.UniformMatrix4f(m),u_coord_matrix:new s.UniformMatrix4f(m),u_is_text:new s.Uniform1i(m),u_pitch_with_map:new s.Uniform1i(m),u_texsize:new s.Uniform2f(m),u_tile_id:new s.Uniform3f(m),u_zoom_transition:new s.Uniform1f(m),u_inv_rot_matrix:new s.UniformMatrix4f(m),u_merc_center:new s.Uniform2f(m),u_camera_forward:new s.Uniform3f(m),u_tile_matrix:new s.UniformMatrix4f(m),u_up_vector:new s.Uniform3f(m),u_ecef_origin:new s.Uniform3f(m),u_texture:new s.Uniform1i(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new s.Uniform1i(m),u_is_size_feature_constant:new s.Uniform1i(m),u_size_t:new s.Uniform1f(m),u_size:new s.Uniform1f(m),u_camera_to_center_distance:new s.Uniform1f(m),u_rotate_symbol:new s.Uniform1i(m),u_aspect_ratio:new s.Uniform1f(m),u_fade_change:new s.Uniform1f(m),u_matrix:new s.UniformMatrix4f(m),u_label_plane_matrix:new s.UniformMatrix4f(m),u_coord_matrix:new s.UniformMatrix4f(m),u_is_text:new s.Uniform1i(m),u_pitch_with_map:new s.Uniform1i(m),u_texsize:new s.Uniform2f(m),u_texture:new s.Uniform1i(m),u_gamma_scale:new s.Uniform1f(m),u_device_pixel_ratio:new s.Uniform1f(m),u_tile_id:new s.Uniform3f(m),u_zoom_transition:new s.Uniform1f(m),u_inv_rot_matrix:new s.UniformMatrix4f(m),u_merc_center:new s.Uniform2f(m),u_camera_forward:new s.Uniform3f(m),u_tile_matrix:new s.UniformMatrix4f(m),u_up_vector:new s.Uniform3f(m),u_ecef_origin:new s.Uniform3f(m),u_is_halo:new s.Uniform1i(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new s.Uniform1i(m),u_is_size_feature_constant:new s.Uniform1i(m),u_size_t:new s.Uniform1f(m),u_size:new s.Uniform1f(m),u_camera_to_center_distance:new s.Uniform1f(m),u_rotate_symbol:new s.Uniform1i(m),u_aspect_ratio:new s.Uniform1f(m),u_fade_change:new s.Uniform1f(m),u_matrix:new s.UniformMatrix4f(m),u_label_plane_matrix:new s.UniformMatrix4f(m),u_coord_matrix:new s.UniformMatrix4f(m),u_is_text:new s.Uniform1i(m),u_pitch_with_map:new s.Uniform1i(m),u_texsize:new s.Uniform2f(m),u_texsize_icon:new s.Uniform2f(m),u_texture:new s.Uniform1i(m),u_texture_icon:new s.Uniform1i(m),u_gamma_scale:new s.Uniform1f(m),u_device_pixel_ratio:new s.Uniform1f(m),u_is_halo:new s.Uniform1i(m)}),background:m=>({u_matrix:new s.UniformMatrix4f(m),u_opacity:new s.Uniform1f(m),u_color:new s.UniformColor(m)}),backgroundPattern:m=>({u_matrix:new s.UniformMatrix4f(m),u_opacity:new s.Uniform1f(m),u_image:new s.Uniform1i(m),u_pattern_tl:new s.Uniform2f(m),u_pattern_br:new s.Uniform2f(m),u_texsize:new s.Uniform2f(m),u_pattern_size:new s.Uniform2f(m),u_pixel_coord_upper:new s.Uniform2f(m),u_pixel_coord_lower:new s.Uniform2f(m),u_tile_units_to_pixels:new s.Uniform1f(m)}),terrainRaster:su,terrainDepth:su,skybox:m=>({u_matrix:new s.UniformMatrix4f(m),u_sun_direction:new s.Uniform3f(m),u_cubemap:new s.Uniform1i(m),u_opacity:new s.Uniform1f(m),u_temporal_offset:new s.Uniform1f(m)}),skyboxGradient:m=>({u_matrix:new s.UniformMatrix4f(m),u_color_ramp:new s.Uniform1i(m),u_center_direction:new s.Uniform3f(m),u_radius:new s.Uniform1f(m),u_opacity:new s.Uniform1f(m),u_temporal_offset:new s.Uniform1f(m)}),skyboxCapture:m=>({u_matrix_3f:new s.UniformMatrix3f(m),u_sun_direction:new s.Uniform3f(m),u_sun_intensity:new s.Uniform1f(m),u_color_tint_r:new s.Uniform4f(m),u_color_tint_m:new s.Uniform4f(m),u_luminance:new s.Uniform1f(m)}),globeRaster:m=>({u_proj_matrix:new s.UniformMatrix4f(m),u_globe_matrix:new s.UniformMatrix4f(m),u_normalize_matrix:new s.UniformMatrix4f(m),u_merc_matrix:new s.UniformMatrix4f(m),u_zoom_transition:new s.Uniform1f(m),u_merc_center:new s.Uniform2f(m),u_image0:new s.Uniform1i(m),u_grid_matrix:new s.UniformMatrix3f(m),u_skirt_height:new s.Uniform1f(m),u_frustum_tl:new s.Uniform3f(m),u_frustum_tr:new s.Uniform3f(m),u_frustum_br:new s.Uniform3f(m),u_frustum_bl:new s.Uniform3f(m),u_globe_pos:new s.Uniform3f(m),u_globe_radius:new s.Uniform1f(m),u_viewport:new s.Uniform2f(m)}),globeAtmosphere:m=>({u_frustum_tl:new s.Uniform3f(m),u_frustum_tr:new s.Uniform3f(m),u_frustum_br:new s.Uniform3f(m),u_frustum_bl:new s.Uniform3f(m),u_horizon:new s.Uniform1f(m),u_transition:new s.Uniform1f(m),u_fadeout_range:new s.Uniform1f(m),u_color:new s.Uniform4f(m),u_high_color:new s.Uniform4f(m),u_space_color:new s.Uniform4f(m),u_star_intensity:new s.Uniform1f(m),u_star_density:new s.Uniform1f(m),u_star_size:new s.Uniform1f(m),u_temporal_offset:new s.Uniform1f(m),u_horizon_angle:new s.Uniform1f(m),u_rotation_matrix:new s.UniformMatrix4f(m)})};let ga;function Jp(m,l,f,_,x,w,S){const P=m.context,L=P.gl,D=m.transform,z=m.useProgram("collisionBox"),V=[];let q=0,ee=0;for(let pe=0;pe<_.length;pe++){const Te=_[pe],be=l.getTile(Te),Ce=be.getBucket(f);if(!Ce)continue;const Be=Je(Te,Ce,D);let Ge=Be;x[0]===0&&x[1]===0||(Ge=m.translatePosMatrix(Be,be,x,w));const We=S?Ce.textCollisionBox:Ce.iconCollisionBox,At=Ce.collisionCircleArray;if(At.length>0){const Ue=s.create(),rt=Ge;s.mul(Ue,Ce.placementInvProjMatrix,D.glCoordMatrix),s.mul(Ue,Ue,Ce.placementViewportMatrix),V.push({circleArray:At,circleOffset:ee,transform:rt,invTransform:Ue,projection:Ce.getProjection()}),q+=At.length/4,ee=q}We&&(m.terrain&&m.terrain.setupElevationDraw(be,z),z.draw(P,L.LINES,s.DepthMode.disabled,s.StencilMode.disabled,m.colorModeForRenderPass(),s.CullFaceMode.disabled,Zp(Ge,D,be,Ce.getProjection()),f.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,D.zoom,null,[We.collisionVertexBuffer,We.collisionVertexBufferExt]))}if(!S||!V.length)return;const Q=m.useProgram("collisionCircle"),te=new s.StructArrayLayout2f1f2i16;te.resize(4*q),te._trim();let ie=0;for(const pe of V)for(let Te=0;Te<pe.circleArray.length/4;Te++){const be=4*Te,Ce=pe.circleArray[be+0],Be=pe.circleArray[be+1],Ge=pe.circleArray[be+2],We=pe.circleArray[be+3];te.emplace(ie++,Ce,Be,Ge,We,0),te.emplace(ie++,Ce,Be,Ge,We,1),te.emplace(ie++,Ce,Be,Ge,We,2),te.emplace(ie++,Ce,Be,Ge,We,3)}(!ga||ga.length<2*q)&&(ga=function(pe){const Te=2*pe,be=new s.StructArrayLayout3ui6;be.resize(Te),be._trim();for(let Ce=0;Ce<Te;Ce++){const Be=6*Ce;be.uint16[Be+0]=4*Ce+0,be.uint16[Be+1]=4*Ce+1,be.uint16[Be+2]=4*Ce+2,be.uint16[Be+3]=4*Ce+2,be.uint16[Be+4]=4*Ce+3,be.uint16[Be+5]=4*Ce+0}return be}(q));const W=P.createIndexBuffer(ga,!0),fe=P.createVertexBuffer(te,s.collisionCircleLayout.members,!0);for(const pe of V){const Te={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(le=D).getCameraToCenterDistance(pe.projection),u_viewport_size:[le.width,le.height]};Q.draw(P,L.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,m.colorModeForRenderPass(),s.CullFaceMode.disabled,Te,f.id,fe,W,s.SegmentVector.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,D.zoom)}var le;fe.destroy(),W.destroy()}const mf=s.create();function Qp({width:m,height:l,anchor:f,textOffset:_,textScale:x},w){const{horizontalAlign:S,verticalAlign:P}=s.getAnchorAlignment(f),L=-(S-.5)*m,D=-(P-.5)*l,z=s.evaluateVariableOffset(f,_);return new s.pointGeometry((L/x+z[0])*w,(D/x+z[1])*w)}function Ha(m,l,f,_,x,w,S,P,L,D,z){const V=m.text.placedSymbolArray,q=m.text.dynamicLayoutVertexArray,ee=m.icon.dynamicLayoutVertexArray,Q={},te=m.getProjection(),ie=Et(P,te,w),W=w.elevation,fe=te.upVectorScale(P.canonical,w.center.lat,w.worldSize).metersToTile;q.clear();for(let le=0;le<V.length;le++){const pe=V.get(le),{tileAnchorX:Te,tileAnchorY:be,numGlyphs:Ce}=pe,Be=m.allowVerticalPlacement&&!pe.placedOrientation,Ge=pe.hidden||!pe.crossTileID||Be?null:_[pe.crossTileID];if(Ge){let We=0,At=0,Ue=0;if(W){const Qt=W?W.getAtTileOffset(P,Te,be):0,[zn,Ht,Ut]=te.upVector(P.canonical,Te,be);We=Qt*zn*fe,At=Qt*Ht*fe,Ue=Qt*Ut*fe}let[rt,Ye,pt,$e]=ft(pe.projectedAnchorX+We,pe.projectedAnchorY+At,pe.projectedAnchorZ+Ue,f?ie:S);const De=Cn(w.getCameraToCenterDistance(te),$e);let qe=x.evaluateSizeForFeature(m.textSizeData,D,pe)*De/s.ONE_EM;f&&(qe*=m.tilePixelRatio/L);const ut=Qp(Ge,qe);f?({x:rt,y:Ye,z:pt}=te.projectTilePoint(Te+ut.x,be+ut.y,P.canonical),[rt,Ye,pt]=ft(rt+We,Ye+At,pt+Ue,S)):(l&&ut._rotate(-w.angle),rt+=ut.x,Ye+=ut.y,pt=0);const _t=m.allowVerticalPlacement&&pe.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let Qt=0;Qt<Ce;Qt++)s.addDynamicAttributes(q,rt,Ye,pt,_t);z&&pe.associatedIconIndex>=0&&(Q[pe.associatedIconIndex]={x:rt,y:Ye,z:pt,angle:_t})}else ii(Ce,q)}if(z){ee.clear();const le=m.icon.placedSymbolArray;for(let pe=0;pe<le.length;pe++){const Te=le.get(pe),{numGlyphs:be}=Te,Ce=Q[pe];if(Te.hidden||!Ce)ii(be,ee);else{const{x:Be,y:Ge,z:We,angle:At}=Ce;for(let Ue=0;Ue<be;Ue++)s.addDynamicAttributes(ee,Be,Ge,We,At)}}m.icon.dynamicLayoutVertexBuffer.updateData(ee)}m.text.dynamicLayoutVertexBuffer.updateData(q)}function Hy(m,l,f){return f.iconsInText&&l?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function em(m,l,f,_,x,w,S,P,L,D,z,V){const q=m.context,ee=q.gl,Q=m.transform,te=P==="map",ie=L==="map",W=te&&f.layout.get("symbol-placement")!=="point",fe=te&&!ie&&!W,le=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let pe=!1;const Te=m.depthModeForSublayer(0,s.DepthMode.ReadOnly),be=[s.mercatorXfromLng(Q.center.lng),s.mercatorYfromLat(Q.center.lat)],Ce=f.layout.get("text-variable-anchor"),Be=Q.projection.name==="globe",Ge=[],We=[0,-1,0];let At=We;!Be&&!Q.mercatorFromTransition||te||(At=function(Ue){const rt=Ue._camera.getWorldToCamera(Ue.worldSize,1),Ye=s.multiply([],rt,Ue.globeMatrix);s.invert(Ye,Ye);const pt=[0,0,0],$e=[0,1,0,0];return s.transformMat4$1($e,$e,Ye),pt[0]=$e[0],pt[1]=$e[1],pt[2]=$e[2],s.normalize(pt,pt),pt}(Q));for(const Ue of _){const rt=l.getTile(Ue),Ye=rt.getBucket(f);if(!Ye||Ye.projection.name==="mercator"&&Be)continue;const pt=x?Ye.text:Ye.icon;if(!pt||Ye.fullyClipped||!pt.segments.get().length)continue;const $e=pt.programConfigurations.get(f.id),De=x||Ye.sdfIcons,qe=x?Ye.textSizeData:Ye.iconSizeData,ut=ie||Q.pitch!==0,_t=s.evaluateSizeForZoom(qe,Q.zoom);let Qt,zn,Ht,Ut,rn=[0,0],Vn=null;if(x){if(zn=rt.glyphAtlasTexture,Ht=ee.LINEAR,Qt=rt.glyphAtlasTexture.size,Ye.iconsInText){rn=rt.imageAtlasTexture.size,Vn=rt.imageAtlasTexture;const hs=qe.kind==="composite"||qe.kind==="camera";Ut=ut||m.options.rotating||m.options.zooming||hs?ee.LINEAR:ee.NEAREST}}else{const hs=f.layout.get("icon-size").constantOr(0)!==1||Ye.iconsNeedLinear;zn=rt.imageAtlasTexture,Ht=De||m.options.rotating||m.options.zooming||hs||ut?ee.LINEAR:ee.NEAREST,Qt=rt.imageAtlasTexture.size}const hn=Ye.projection.name==="globe",ci=hn?At:We,mi=hn?s.globeToMercatorTransition(Q.zoom):0,Si=Et(Ue,Ye.getProjection(),Q),wi=Q.calculatePixelsToTileUnitsMatrix(rt),or=qr(Si,rt.tileID.canonical,ie,te,Q,Ye.getProjection(),wi),ns=m.terrain&&ie&&W?s.invert(s.create(),or):mf,zs=Tr(Si,rt.tileID.canonical,ie,te,Q,Ye.getProjection(),wi),mo=Ce&&Ye.hasTextData(),Bi=f.layout.get("icon-text-fit")!=="none"&&mo&&Ye.hasIconData();if(W){const hs=Q.elevation,bs=hs?hs.getAtTileOffsetFunc(Ue,Q.center.lat,Q.worldSize,Ye.getProjection()):null,go=Or(Si,rt.tileID.canonical,ie,te,Q,Ye.getProjection(),wi);Ar(Ye,Si,m,x,go,zs,ie,D,bs,Ue)}const Ei=W||x&&Ce||Bi,si=m.translatePosMatrix(Si,rt,w,S),Zi=Ei?mf:or,zr=m.translatePosMatrix(zs,rt,w,S,!0),Ci=Ye.getProjection().createInversionMatrix(Q,Ue.canonical),Br=[];m.terrainRenderModeElevated()&&ie&&Br.push("PITCH_WITH_MAP_TERRAIN"),hn&&Br.push("PROJECTION_GLOBE_VIEW"),Ei&&Br.push("PROJECTED_POS_ON_VIEWPORT");const Fr=De&&f.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Uo;Uo=De?Ye.iconsInText?df(qe.kind,_t,fe,ie,m,si,Zi,zr,Qt,rn,Ue,mi,be,Ci,ci,Ye.getProjection()):Kp(qe.kind,_t,fe,ie,m,si,Zi,zr,x,Qt,!0,Ue,mi,be,Ci,ci,Ye.getProjection()):Zl(qe.kind,_t,fe,ie,m,si,Zi,zr,x,Qt,Ue,mi,be,Ci,ci,Ye.getProjection());const nl={program:m.useProgram(Hy(De,x,Ye),$e,Br),buffers:pt,uniformValues:Uo,atlasTexture:zn,atlasTextureIcon:Vn,atlasInterpolation:Ht,atlasInterpolationIcon:Ut,isSDF:De,hasHalo:Fr,tile:rt,labelPlaneMatrixInv:ns};if(le&&Ye.canOverlap){pe=!0;const hs=pt.segments.get();for(const bs of hs)Ge.push({segments:new s.SegmentVector([bs]),sortKey:bs.sortKey,state:nl})}else Ge.push({segments:pt.segments,sortKey:0,state:nl})}pe&&Ge.sort((Ue,rt)=>Ue.sortKey-rt.sortKey);for(const Ue of Ge){const rt=Ue.state;if(m.terrain&&m.terrain.setupElevationDraw(rt.tile,rt.program,{useDepthForOcclusion:!Be,labelPlaneMatrixInv:rt.labelPlaneMatrixInv}),q.activeTexture.set(ee.TEXTURE0),rt.atlasTexture.bind(rt.atlasInterpolation,ee.CLAMP_TO_EDGE),rt.atlasTextureIcon&&(q.activeTexture.set(ee.TEXTURE1),rt.atlasTextureIcon&&rt.atlasTextureIcon.bind(rt.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),rt.isSDF){const Ye=rt.uniformValues;rt.hasHalo&&(Ye.u_is_halo=1,tm(rt.buffers,Ue.segments,f,m,rt.program,Te,z,V,Ye)),Ye.u_is_halo=0}tm(rt.buffers,Ue.segments,f,m,rt.program,Te,z,V,rt.uniformValues)}}function tm(m,l,f,_,x,w,S,P,L){const D=_.context,z=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer];x.draw(D,D.gl.TRIANGLES,w,S,P,s.CullFaceMode.disabled,L,f.id,m.layoutVertexBuffer,m.indexBuffer,l,f.paint,_.transform.zoom,m.programConfigurations.get(f.id),z)}function nm(m,l,f,_,x,w,S){const P=m.context.gl,L=f.paint.get("fill-pattern"),D=L&&L.constantOr(1);let z,V,q,ee,Q;S?(V=D&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=P.LINES):(V=D?"fillPattern":"fill",z=P.TRIANGLES);for(const te of _){const ie=l.getTile(te);if(D&&!ie.patternsLoaded())continue;const W=ie.getBucket(f);if(!W)continue;m.prepareDrawTile();const fe=W.programConfigurations.get(f.id),le=m.useProgram(V,fe);D&&(m.context.activeTexture.set(P.TEXTURE0),ie.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),fe.updatePaintBuffers());const pe=L.constantOr(null);if(pe&&ie.imageAtlas){const be=ie.imageAtlas.patternPositions[pe.toString()];be&&fe.setConstantPatternPositions(be)}const Te=m.translatePosMatrix(te.projMatrix,ie,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(S){ee=W.indexBuffer2,Q=W.segments2;const be=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[P.drawingBufferWidth,P.drawingBufferHeight];q=V==="fillOutlinePattern"&&D?qp(Te,m,ie,be):Wp(Te,be)}else ee=W.indexBuffer,Q=W.segments,q=D?uu(Te,m,ie):cu(Te);m.prepareDrawProgram(m.context,le,te.toUnwrapped()),le.draw(m.context,z,x,m.stencilModeForClipping(te),w,s.CullFaceMode.disabled,q,f.id,W.layoutVertexBuffer,ee,Q,f.paint,m.transform.zoom,fe)}}function gf(m,l,f,_,x,w,S){const P=m.context,L=P.gl,D=m.transform,z=f.paint.get("fill-extrusion-pattern"),V=z.constantOr(1),q=f.paint.get("fill-extrusion-opacity"),ee=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),f.paint.get("fill-extrusion-ambient-occlusion-radius")],Q=f.layout.get("fill-extrusion-edge-radius"),te=D.projection.name==="globe"?s.fillExtrusionHeightLift():0,ie=D.projection.name==="globe",W=ie?s.globeToMercatorTransition(D.zoom):0,fe=[s.mercatorXfromLng(D.center.lng),s.mercatorYfromLat(D.center.lat)],le=[];ie&&le.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&le.push("FAUX_AO");for(const pe of _){const Te=l.getTile(pe),be=Te.getBucket(f);if(!be||be.projection.name!==D.projection.name)continue;const Ce=be.programConfigurations.get(f.id),Be=m.useProgram(V?"fillExtrusionPattern":"fillExtrusion",Ce,le);if(m.terrain){const pt=m.terrain;if(m.style.terrainSetForDrapingOnly())pt.setupElevationDraw(Te,Be,{useMeterToDem:!0});else{if(!be.enableTerrain)continue;if(pt.setupElevationDraw(Te,Be,{useMeterToDem:!0}),Wy(P,l,pe,be,f,pt),!be.centroidVertexBuffer){const $e=Be.attributes.a_centroid_pos;$e!==void 0&&L.vertexAttrib2f($e,0,0)}}}V&&(m.context.activeTexture.set(L.TEXTURE0),Te.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Ce.updatePaintBuffers());const Ge=z.constantOr(null);if(Ge&&Te.imageAtlas){const pt=Te.imageAtlas.patternPositions[Ge.toString()];pt&&Ce.setConstantPatternPositions(pt)}const We=m.translatePosMatrix(pe.projMatrix,Te,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),At=D.projection.createInversionMatrix(D,pe.canonical),Ue=f.paint.get("fill-extrusion-vertical-gradient"),rt=V?lf(We,m,Ue,q,ee,Q,pe,Te,te,W,fe,At):lu(We,m,Ue,q,ee,Q,pe,te,W,fe,At);m.prepareDrawProgram(P,Be,pe.toUnwrapped());const Ye=[];m.terrain&&Ye.push(be.centroidVertexBuffer),ie&&Ye.push(be.layoutVertexExtBuffer),Be.draw(P,P.gl.TRIANGLES,x,w,S,s.CullFaceMode.backCCW,rt,f.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,f.paint,m.transform.zoom,Ce,Ye)}}function Wy(m,l,f,_,x,w){const S=[W=>{let fe=W.canonical.x-1,le=W.wrap;return fe<0&&(fe=(1<<W.canonical.z)-1,le--),new s.OverscaledTileID(W.overscaledZ,le,W.canonical.z,fe,W.canonical.y)},W=>{let fe=W.canonical.x+1,le=W.wrap;return fe===1<<W.canonical.z&&(fe=0,le++),new s.OverscaledTileID(W.overscaledZ,le,W.canonical.z,fe,W.canonical.y)},W=>new s.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(W.canonical.y===0?1<<W.canonical.z:W.canonical.y)-1),W=>new s.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],P=W=>{const fe=l.getSource().minzoom,le=Te=>{const be=l.getTileByID(Te);if(be&&be.hasData())return be.getBucket(x)},pe=[0,-1,1];for(const Te of pe){if(W.overscaledZ+Te<fe)continue;const be=le(W.calculateScaledKey(W.overscaledZ+Te));if(be)return be}},L=[0,0,0],D=(W,fe)=>(L[0]=Math.min(W.min.y,fe.min.y),L[1]=Math.max(W.max.y,fe.max.y),L[2]=s.EXTENT-fe.min.x>W.max.x?fe.min.x-s.EXTENT:W.max.x,L),z=(W,fe)=>(L[0]=Math.min(W.min.x,fe.min.x),L[1]=Math.max(W.max.x,fe.max.x),L[2]=s.EXTENT-fe.min.y>W.max.y?fe.min.y-s.EXTENT:W.max.y,L),V=[(W,fe)=>D(W,fe),(W,fe)=>D(fe,W),(W,fe)=>z(W,fe),(W,fe)=>z(fe,W)],q=new s.pointGeometry(0,0);let ee,Q,te;const ie=(W,fe,le,pe,Te)=>{const be=[[pe?le:W,pe?W:le,0],[pe?le:fe,pe?fe:le,0]],Ce=Te<0?s.EXTENT+Te:Te,Be=[pe?Ce:(W+fe)/2,pe?(W+fe)/2:Ce,0];return le===0&&Te<0||le!==0&&Te>0?w.getForTilePoints(te,[Be],!0,Q):be.push(Be),w.getForTilePoints(f,be,!0,ee),Math.max(be[0][2],be[1][2],Be[2])/w.exaggeration()};for(let W=0;W<4;W++){const fe=(W<2?1:5)-W,le=_.borders[W];if(le.length===0)continue;const pe=te=S[W](f),Te=P(pe);if(!(Te&&Te instanceof s.FillExtrusionBucket&&Te.enableTerrain)||_.borderDoneWithNeighborZ[W]===Te.canonical.z&&Te.borderDoneWithNeighborZ[fe]===_.canonical.z||(Q=w.findDEMTileFor(pe),!Q||!Q.dem))continue;if(!ee){const Ge=w.findDEMTileFor(f);if(!Ge||!Ge.dem)return;ee=Ge}const be=Te.borders[fe];let Ce=0;const Be=Te.borderDoneWithNeighborZ[fe]!==_.canonical.z;if(_.canonical.z===Te.canonical.z){for(let Ge=0;Ge<le.length;Ge++){const We=_.featuresOnBorder[le[Ge]],At=We.borders[W];let Ue;for(;Ce<be.length&&(Ue=Te.featuresOnBorder[be[Ce]],!(Ue.borders[fe][1]>At[0]+3));)Be&&Te.encodeCentroid(void 0,Ue,!1),Ce++;if(Ue&&Ce<be.length){const rt=Ce;let Ye=0;for(;!(Ue.borders[fe][0]>At[1]-3)&&(Ye++,++Ce!==be.length);)Ue=Te.featuresOnBorder[be[Ce]];if(Ue=Te.featuresOnBorder[be[rt]],We.intersectsCount()>1||Ue.intersectsCount()>1||Ye!==1){Ye!==1&&(Ce=rt),_.encodeCentroid(void 0,We,!1),Be&&Te.encodeCentroid(void 0,Ue,!1);continue}const pt=V[W](We,Ue),$e=W%2?s.EXTENT-1:0;q.x=ie(pt[0],Math.min(s.EXTENT-1,pt[1]),$e,W<2,pt[2]),q.y=0,_.encodeCentroid(q,We,!1),Be&&Te.encodeCentroid(q,Ue,!1)}else _.encodeCentroid(void 0,We,!1)}_.borderDoneWithNeighborZ[W]=Te.canonical.z,_.needsCentroidUpdate=!0,Be&&(Te.borderDoneWithNeighborZ[fe]=_.canonical.z,Te.needsCentroidUpdate=!0)}else{for(const Ge of le)_.encodeCentroid(void 0,_.featuresOnBorder[Ge],!1);if(Be){for(const Ge of be)Te.encodeCentroid(void 0,Te.featuresOnBorder[Ge],!1);Te.borderDoneWithNeighborZ[fe]=_.canonical.z,Te.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[W]=Te.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(m)}const _f=new s.Color(1,0,0,1),yf=new s.Color(0,1,0,1),im=new s.Color(0,0,1,1),rm=new s.Color(1,0,1,1),sm=new s.Color(0,1,1,1);function vf(m,l,f){const _=m.context,x=m.transform,w=_.gl,S=x.projection.name==="globe",P=S?["PROJECTION_GLOBE_VIEW"]:null;let L=f.projMatrix;if(S&&s.globeToMercatorTransition(x.zoom)>0){const We=s.transitionTileAABBinECEF(f.canonical,x),At=s.globeDenormalizeECEF(We);L=s.multiply(new Float32Array(16),x.globeMatrix,At),s.multiply(L,x.projMatrix,L)}const D=m.useProgram("debug",null,P),z=l.getTileByID(f.key);m.terrain&&m.terrain.setupElevationDraw(z,D);const V=s.DepthMode.disabled,q=s.StencilMode.disabled,ee=m.colorModeForRenderPass(),Q="$debug";_.activeTexture.set(w.TEXTURE0),m.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),S?z._makeGlobeTileDebugBuffers(m.context,x):z._makeDebugTileBoundsBuffers(m.context,x.projection);const te=z._tileDebugBuffer||m.debugBuffer,ie=z._tileDebugIndexBuffer||m.debugIndexBuffer,W=z._tileDebugSegments||m.debugSegments;D.draw(_,w.LINE_STRIP,V,q,ee,s.CullFaceMode.disabled,ql(L,s.Color.red),Q,te,ie,W,null,null,null,[z._globeTileDebugBorderBuffer]);const fe=z.latestRawTileData,le=Math.floor((fe&&fe.byteLength||0)/1024),pe=l.getTile(f).tileSize,Te=512/Math.min(pe,512)*(f.overscaledZ/x.zoom)*.5;let be=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(be+=` => ${f.overscaledZ}`),be+=` ${le}kb`,function(We,At){We.initDebugOverlayCanvas();const Ue=We.debugOverlayCanvas,rt=We.context.gl,Ye=We.debugOverlayCanvas.getContext("2d");Ye.clearRect(0,0,Ue.width,Ue.height),Ye.shadowColor="white",Ye.shadowBlur=2,Ye.lineWidth=1.5,Ye.strokeStyle="white",Ye.textBaseline="top",Ye.font="bold 36px Open Sans, sans-serif",Ye.fillText(At,5,5),Ye.strokeText(At,5,5),We.debugOverlayTexture.update(Ue),We.debugOverlayTexture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE)}(m,be);const Ce=z._tileDebugTextBuffer||m.debugBuffer,Be=z._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Ge=z._tileDebugTextSegments||m.debugSegments;D.draw(_,w.TRIANGLES,V,q,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,ql(L,s.Color.transparent,Te),Q,Ce,Be,Ge,null,null,null,[z._globeTileDebugTextBuffer])}function No(m,l,f,_){Xl(m,0,l+f/2,m.transform.width,f,_)}function Wa(m,l,f,_){Xl(m,l-f/2,0,f,m.transform.height,_)}function Xl(m,l,f,_,x,w){const S=m.context,P=S.gl;P.enable(P.SCISSOR_TEST),P.scissor(l*s.exported.devicePixelRatio,f*s.exported.devicePixelRatio,_*s.exported.devicePixelRatio,x*s.exported.devicePixelRatio),S.clear({color:w}),P.disable(P.SCISSOR_TEST)}const qa=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Za}=qa;function fo(m,l,f,_){m.emplaceBack(l,f,_)}class du{constructor(l){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,fo(this.vertexArray,-1,-1,1),fo(this.vertexArray,1,-1,1),fo(this.vertexArray,-1,1,1),fo(this.vertexArray,1,1,1),fo(this.vertexArray,-1,-1,-1),fo(this.vertexArray,1,-1,-1),fo(this.vertexArray,-1,1,-1),fo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,Za),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function Zn(m,l,f,_,x,w){const S=m.gl,P=l.paint.get("sky-atmosphere-color"),L=l.paint.get("sky-atmosphere-halo-color"),D=l.paint.get("sky-atmosphere-sun-intensity"),z=((V,q,ee,Q,te)=>({u_matrix_3f:V,u_sun_direction:q,u_sun_intensity:ee,u_color_tint_r:[Q.r,Q.g,Q.b,Q.a],u_color_tint_m:[te.r,te.g,te.b,te.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),_),x,D,P,L);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+w,l.skyboxTexture,0),f.draw(m,S.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,z,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const pu=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class qy{constructor(l){const f=new s.StructArrayLayout5f20;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const _=new s.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(f,pu.members),this.indexBuffer=l.createIndexBuffer(_),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const xf={symbol:function(m,l,f,_,x){if(m.renderPass!=="translucent")return;const w=s.StencilMode.disabled,S=m.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(P,L,D,z,V,q,ee){const Q=L.transform,te=V==="map",ie=q==="map";for(const W of P){const fe=z.getTile(W),le=fe.getBucket(D);if(!le||!le.text||!le.text.segments.get().length)continue;const pe=s.evaluateSizeForZoom(le.textSizeData,Q.zoom),Te=Et(W,le.getProjection(),Q),be=Q.calculatePixelsToTileUnitsMatrix(fe),Ce=qr(Te,fe.tileID.canonical,ie,te,Q,le.getProjection(),be),Be=D.layout.get("icon-text-fit")!=="none"&&le.hasIconData();if(pe){const Ge=Math.pow(2,Q.zoom-fe.tileID.overscaledZ);Ha(le,te,ie,ee,s.symbolSize,Q,Ce,W,Ge,pe,Be)}}}(_,m,f,l,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),x),f.paint.get("icon-opacity").constantOr(1)!==0&&em(m,l,f,_,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),w,S),f.paint.get("text-opacity").constantOr(1)!==0&&em(m,l,f,_,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),w,S),l.map.showCollisionBoxes&&(Jp(m,l,f,_,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),Jp(m,l,f,_,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(m,l,f,_){if(m.renderPass!=="translucent")return;const x=f.paint.get("circle-opacity"),w=f.paint.get("circle-stroke-width"),S=f.paint.get("circle-stroke-opacity"),P=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(w.constantOr(1)===0||S.constantOr(1)===0))return;const L=m.context,D=L.gl,z=m.transform,V=m.depthModeForSublayer(0,s.DepthMode.ReadOnly),q=s.StencilMode.disabled,ee=m.colorModeForRenderPass(),Q=z.projection.name==="globe",te=[s.mercatorXfromLng(z.center.lng),s.mercatorYfromLat(z.center.lat)],ie=[];for(let fe=0;fe<_.length;fe++){const le=_[fe],pe=l.getTile(le),Te=pe.getBucket(f);if(!Te||Te.projection.name!==z.projection.name)continue;const be=Te.programConfigurations.get(f.id),Ce=Wl(f);Q&&Ce.push("PROJECTION_GLOBE_VIEW");const Be=m.useProgram("circle",be,Ce),Ge=Te.layoutVertexBuffer,We=Te.globeExtVertexBuffer,At=Te.indexBuffer,Ue=z.projection.createInversionMatrix(z,le.canonical),rt={programConfiguration:be,program:Be,layoutVertexBuffer:Ge,globeExtVertexBuffer:We,indexBuffer:At,uniformValues:Hl(m,le,pe,Ue,te,f),tile:pe};if(P){const Ye=Te.segments.get();for(const pt of Ye)ie.push({segments:new s.SegmentVector([pt]),sortKey:pt.sortKey,state:rt})}else ie.push({segments:Te.segments,sortKey:0,state:rt})}P&&ie.sort((fe,le)=>fe.sortKey-le.sortKey);const W={useDepthForOcclusion:!Q};for(const fe of ie){const{programConfiguration:le,program:pe,layoutVertexBuffer:Te,globeExtVertexBuffer:be,indexBuffer:Ce,uniformValues:Be,tile:Ge}=fe.state,We=fe.segments;m.terrain&&m.terrain.setupElevationDraw(Ge,pe,W),m.prepareDrawProgram(L,pe,Ge.tileID.toUnwrapped()),pe.draw(L,D.TRIANGLES,V,q,ee,s.CullFaceMode.disabled,Be,f.id,Te,Ce,We,f.paint,z.zoom,le,[be])}},heatmap:function(m,l,f,_){if(f.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const x=m.context,w=x.gl,S=s.StencilMode.disabled,P=new s.ColorMode([w.ONE,w.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(ee,Q,te,ie){const W=ee.gl,fe=Q.width*ie,le=Q.height*ie;ee.activeTexture.set(W.TEXTURE1),ee.viewport.set([0,0,fe,le]);let pe=te.heatmapFbo;if(!pe||pe&&(pe.width!==fe||pe.height!==le)){pe&&pe.destroy();const Te=W.createTexture();W.bindTexture(W.TEXTURE_2D,Te),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),pe=te.heatmapFbo=ee.createFramebuffer(fe,le,!1),function(be,Ce,Be,Ge,We,At){const Ue=be.gl;Ue.texImage2D(Ue.TEXTURE_2D,0,be.isWebGL2&&be.extRenderToTextureHalfFloat?Ue.RGBA16F:Ue.RGBA,We,At,0,Ue.RGBA,be.extRenderToTextureHalfFloat?be.isWebGL2?Ue.HALF_FLOAT:be.extTextureHalfFloat.HALF_FLOAT_OES:Ue.UNSIGNED_BYTE,null),Ge.colorAttachment.set(Be)}(ee,0,Te,pe,fe,le)}else W.bindTexture(W.TEXTURE_2D,pe.colorAttachment.get()),ee.bindFramebuffer.set(pe.framebuffer)})(x,m,f,m.transform.projection.name==="globe"?.5:.25),x.clear({color:s.Color.transparent});const L=m.transform,D=L.projection.name==="globe",z=D?["PROJECTION_GLOBE_VIEW"]:null,V=D?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,q=[s.mercatorXfromLng(L.center.lng),s.mercatorYfromLat(L.center.lat)];for(let ee=0;ee<_.length;ee++){const Q=_[ee];if(l.hasRenderableParent(Q))continue;const te=l.getTile(Q),ie=te.getBucket(f);if(!ie||ie.projection.name!==L.projection.name)continue;const W=ie.programConfigurations.get(f.id),fe=m.useProgram("heatmap",W,z),{zoom:le}=m.transform;m.terrain&&m.terrain.setupElevationDraw(te,fe),m.prepareDrawProgram(x,fe,Q.toUnwrapped());const pe=L.projection.createInversionMatrix(L,Q.canonical);fe.draw(x,w.TRIANGLES,s.DepthMode.disabled,S,P,V,Js(m,Q,te,pe,q,le,f.paint.get("heatmap-intensity")),f.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,f.paint,m.transform.zoom,W,D?[ie.globeExtVertexBuffer]:null)}x.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(x,w){const S=x.context,P=S.gl,L=w.heatmapFbo;if(!L)return;S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,L.colorAttachment.get()),S.activeTexture.set(P.TEXTURE1);let D=w.colorRampTexture;D||(D=w.colorRampTexture=new s.Texture(S,w.colorRamp,P.RGBA)),D.bind(P.LINEAR,P.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(S,P.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,x.colorModeForRenderPass(),s.CullFaceMode.disabled,((z,V,q,ee)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(m,f))},line:function(m,l,f,_){if(m.renderPass!=="translucent")return;const x=f.paint.get("line-opacity"),w=f.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;const S=m.depthModeForSublayer(0,s.DepthMode.ReadOnly),P=m.colorModeForRenderPass(),L=m.terrain&&m.terrain.renderingToTexture?1:s.exported.devicePixelRatio,D=f.paint.get("line-dasharray"),z=D.constantOr(1),V=f.layout.get("line-cap"),q=f.paint.get("line-pattern"),ee=q.constantOr(1),Q=f.paint.get("line-gradient"),te=ee?"linePattern":"line",ie=m.context,W=ie.gl,fe=(pe=>{const Te=[];fu(pe)&&Te.push("RENDER_LINE_DASH"),pe.paint.get("line-gradient")&&Te.push("RENDER_LINE_GRADIENT");const be=pe.paint.get("line-trim-offset");be[0]===0&&be[1]===0||Te.push("RENDER_LINE_TRIM_OFFSET");const Ce=pe.paint.get("line-pattern").constantOr(1),Be=pe.paint.get("line-opacity").constantOr(1)!==1;return!Ce&&Be&&Te.push("RENDER_LINE_ALPHA_DISCARD"),Te})(f);let le=fe.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(le=!1);for(const pe of _){const Te=l.getTile(pe);if(ee&&!Te.patternsLoaded())continue;const be=Te.getBucket(f);if(!be)continue;m.prepareDrawTile();const Ce=be.programConfigurations.get(f.id),Be=m.useProgram(te,Ce,fe),Ge=q.constantOr(null);if(Ge&&Te.imageAtlas){const De=Te.imageAtlas.patternPositions[Ge.toString()];De&&Ce.setConstantPatternPositions(De)}const We=D.constantOr(null),At=V.constantOr(null);if(!ee&&We&&At&&Te.lineAtlas){const De=Te.lineAtlas.getDash(We,At);De&&Ce.setConstantPatternPositions(De)}let[Ue,rt]=f.paint.get("line-trim-offset");(At==="round"||At==="square")&&Ue!==rt&&(Ue===0&&(Ue-=1),rt===1&&(rt+=1));const Ye=m.terrain?pe.projMatrix:null,pt=ee?Xp(m,Te,f,Ye,L):uf(m,Te,f,Ye,be.lineClipsArray.length,L,[Ue,rt]);if(Q){const De=be.gradients[f.id];let qe=De.texture;if(f.gradientVersion!==De.version){let ut=256;if(f.stepInterpolant){const _t=l.getSource().maxzoom,Qt=pe.canonical.z===_t?Math.ceil(1<<m.transform.maxZoom-pe.canonical.z):1;ut=s.clamp(s.nextPowerOfTwo(be.maxLineLength/s.EXTENT*1024*Qt),256,ie.maxTextureSize)}De.gradient=s.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:ut,image:De.gradient||void 0,clips:be.lineClipsArray}),De.texture?De.texture.update(De.gradient):De.texture=new s.Texture(ie,De.gradient,W.RGBA),De.version=f.gradientVersion,qe=De.texture}ie.activeTexture.set(W.TEXTURE1),qe.bind(f.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}z&&(ie.activeTexture.set(W.TEXTURE0),Te.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),Ce.updatePaintBuffers()),ee&&(ie.activeTexture.set(W.TEXTURE0),Te.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Ce.updatePaintBuffers()),m.prepareDrawProgram(ie,Be,pe.toUnwrapped());const $e=De=>{Be.draw(ie,W.TRIANGLES,S,De,P,s.CullFaceMode.disabled,pt,f.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,f.paint,m.transform.zoom,Ce,[be.layoutVertexBuffer2])};if(le){const De=m.stencilModeForClipping(pe).ref;De===0&&m.terrain&&ie.clear({stencil:0});const qe={func:W.EQUAL,mask:255};pt.u_alpha_discard_threshold=.8,$e(new s.StencilMode(qe,De,255,W.KEEP,W.KEEP,W.INVERT)),pt.u_alpha_discard_threshold=0,$e(new s.StencilMode(qe,De,255,W.KEEP,W.KEEP,W.KEEP))}else $e(m.stencilModeForClipping(pe))}le&&(m.resetStencilClippingMasks(),m.terrain&&ie.clear({stencil:0}))},fill:function(m,l,f,_){const x=f.paint.get("fill-color"),w=f.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const S=m.colorModeForRenderPass(),P=f.paint.get("fill-pattern"),L=m.opaquePassEnabledForLayer()&&!P.constantOr(1)&&x.constantOr(s.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===L){const D=m.depthModeForSublayer(1,m.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);nm(m,l,f,_,D,S,!1)}if(m.renderPass==="translucent"&&f.paint.get("fill-antialias")){const D=m.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);nm(m,l,f,_,D,S,!0)}},"fill-extrusion":function(m,l,f,_){const x=f.paint.get("fill-extrusion-opacity");if(x!==0&&m.renderPass==="translucent"){const w=new s.DepthMode(m.context.gl.LEQUAL,s.DepthMode.ReadWrite,m.depthRangeFor3D);if(x!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))gf(m,l,f,_,w,s.StencilMode.disabled,s.ColorMode.disabled),gf(m,l,f,_,w,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const S=m.colorModeForRenderPass();gf(m,l,f,_,w,s.StencilMode.disabled,S)}}},hillshade:function(m,l,f,_){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const x=m.context,w=m.depthModeForSublayer(0,s.DepthMode.ReadOnly),S=m.colorModeForRenderPass(),P=m.terrain&&m.terrain.renderingToTexture,[L,D]=m.renderPass!=="translucent"||P?[{},_]:m.stencilConfigForOverlap(_);for(const z of D){const V=l.getTile(z);if(V.needsHillshadePrepare&&m.renderPass==="offscreen")ru(m,V,f,w,s.StencilMode.disabled,S);else if(m.renderPass==="translucent"){const q=P&&m.terrain?m.terrain.stencilModeForRTTOverlap(z):L[z.overscaledZ];jl(m,z,V,f,w,q,S)}}x.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,l,f,_,x,w){if(m.renderPass!=="translucent"||f.paint.get("raster-opacity")===0||!_.length)return;const S=m.context,P=S.gl,L=l.getSource(),D=m.useProgram("raster"),z=m.colorModeForRenderPass(),V=m.terrain&&m.terrain.renderingToTexture,[q,ee]=L instanceof Se||V?[{},_]:m.stencilConfigForOverlap(_),Q=ee[ee.length-1].overscaledZ,te=!m.options.moving;for(const ie of ee){const W=V?s.DepthMode.disabled:m.depthModeForSublayer(ie.overscaledZ-Q,f.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,P.LESS),fe=ie.toUnwrapped(),le=l.getTile(ie);if(V&&(!le||!le.hasData()))continue;const pe=V?ie.projMatrix:m.transform.calculateProjMatrix(fe,te),Te=m.terrain&&V?m.terrain.stencilModeForRTTOverlap(ie):q[ie.overscaledZ],be=w?0:f.paint.get("raster-fade-duration");le.registerFadeDuration(be);const Ce=l.findLoadedParent(ie,0),Be=$l(le,Ce,l,m.transform,be);let Ge,We;m.terrain&&m.terrain.prepareDrawTile();const At=f.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;S.activeTexture.set(P.TEXTURE0),le.texture.bind(At,P.CLAMP_TO_EDGE),S.activeTexture.set(P.TEXTURE1),Ce?(Ce.texture.bind(At,P.CLAMP_TO_EDGE),Ge=Math.pow(2,Ce.tileID.overscaledZ-le.tileID.overscaledZ),We=[le.tileID.canonical.x*Ge%1,le.tileID.canonical.y*Ge%1]):le.texture.bind(At,P.CLAMP_TO_EDGE);const Ue=jy(pe,We||[0,0],Ge||1,Be,f,L instanceof Se?L.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(S,D,fe),L instanceof Se)L.boundsBuffer&&L.boundsSegments&&D.draw(S,P.TRIANGLES,W,s.StencilMode.disabled,z,s.CullFaceMode.disabled,Ue,f.id,L.boundsBuffer,m.quadTriangleIndexBuffer,L.boundsSegments);else{const{tileBoundsBuffer:rt,tileBoundsIndexBuffer:Ye,tileBoundsSegments:pt}=m.getTileBoundsBuffers(le);D.draw(S,P.TRIANGLES,W,Te,z,s.CullFaceMode.disabled,Ue,f.id,rt,Ye,pt)}}m.resetStencilClippingMasks()},background:function(m,l,f,_){const x=f.paint.get("background-color"),w=f.paint.get("background-opacity");if(w===0)return;const S=m.context,P=S.gl,L=m.transform,D=L.tileSize,z=f.paint.get("background-pattern");if(m.isPatternMissing(z))return;const V=!z&&x.a===1&&w===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==V)return;const q=s.StencilMode.disabled,ee=m.depthModeForSublayer(0,V==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),Q=m.colorModeForRenderPass(),te=m.useProgram(z?"backgroundPattern":"background");let ie,W=_;W||(ie=m.getBackgroundTiles(),W=Object.values(ie).map(fe=>fe.tileID)),z&&(S.activeTexture.set(P.TEXTURE0),m.imageManager.bind(m.context));for(const fe of W){const le=fe.toUnwrapped(),pe=_?fe.projMatrix:m.transform.calculateProjMatrix(le);m.prepareDrawTile();const Te=l?l.getTile(fe):ie?ie[fe.key]:new s.Tile(fe,D,L.zoom,m),be=z?pf(pe,w,m,z,{tileID:fe,tileSize:D}):Gy(pe,w,x);m.prepareDrawProgram(S,te,le);const{tileBoundsBuffer:Ce,tileBoundsIndexBuffer:Be,tileBoundsSegments:Ge}=m.getTileBoundsBuffers(Te);te.draw(S,P.TRIANGLES,ee,q,Q,s.CullFaceMode.disabled,be,f.id,Ce,Be,Ge)}},sky:function(m,l,f){const _=m.transform,x=_.projection.name==="mercator"||_.projection.name==="globe"?1:s.smoothstep(7,8,_.zoom),w=f.paint.get("sky-opacity")*x;if(w===0)return;const S=m.context,P=f.paint.get("sky-type"),L=new s.DepthMode(S.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),D=m.frameCounter/1e3%1;P==="atmosphere"?m.renderPass==="offscreen"?f.needsSkyboxCapture(m)&&(function(z,V,q,ee){const Q=z.context,te=Q.gl;let ie=V.skyboxFbo;if(!ie){ie=V.skyboxFbo=Q.createFramebuffer(32,32,!1),V.skyboxGeometry=new du(Q),V.skyboxTexture=Q.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,V.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let pe=0;pe<6;++pe)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(ie.framebuffer),Q.viewport.set([0,0,32,32]);const W=V.getCenter(z,!0),fe=z.useProgram("skyboxCapture"),le=new Float64Array(16);s.identity(le),s.rotateY(le,le,.5*-Math.PI),Zn(Q,V,fe,le,W,0),s.identity(le),s.rotateY(le,le,.5*Math.PI),Zn(Q,V,fe,le,W,1),s.identity(le),s.rotateX(le,le,.5*-Math.PI),Zn(Q,V,fe,le,W,2),s.identity(le),s.rotateX(le,le,.5*Math.PI),Zn(Q,V,fe,le,W,3),s.identity(le),Zn(Q,V,fe,le,W,4),s.identity(le),s.rotateY(le,le,Math.PI),Zn(Q,V,fe,le,W,5),Q.viewport.set([0,0,z.width,z.height])}(m,f),f.markSkyboxValid(m)):m.renderPass==="sky"&&function(z,V,q,ee,Q){const te=z.context,ie=te.gl,W=z.transform,fe=z.useProgram("skybox");te.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_CUBE_MAP,V.skyboxTexture);const le=((pe,Te,be,Ce,Be)=>({u_matrix:pe,u_sun_direction:Te,u_cubemap:0,u_opacity:Ce,u_temporal_offset:Be}))(W.skyboxMatrix,V.getCenter(z,!1),0,ee,Q);z.prepareDrawProgram(te,fe),fe.draw(te,ie.TRIANGLES,q,s.StencilMode.disabled,z.colorModeForRenderPass(),s.CullFaceMode.backCW,le,"skybox",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(m,f,L,w,D):P==="gradient"&&m.renderPass==="sky"&&function(z,V,q,ee,Q){const te=z.context,ie=te.gl,W=z.transform,fe=z.useProgram("skyboxGradient");V.skyboxGeometry||(V.skyboxGeometry=new du(te)),te.activeTexture.set(ie.TEXTURE0);let le=V.colorRampTexture;le||(le=V.colorRampTexture=new s.Texture(te,V.colorRamp,ie.RGBA)),le.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const pe=((Te,be,Ce,Be,Ge)=>({u_matrix:Te,u_color_ramp:0,u_center_direction:be,u_radius:s.degToRad(Ce),u_opacity:Be,u_temporal_offset:Ge}))(W.skyboxMatrix,V.getCenter(z,!1),V.paint.get("sky-gradient-radius"),ee,Q);z.prepareDrawProgram(te,fe),fe.draw(te,ie.TRIANGLES,q,s.StencilMode.disabled,z.colorModeForRenderPass(),s.CullFaceMode.backCW,pe,"skyboxGradient",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(m,f,L,w,D)},debug:function(m,l,f){for(let _=0;_<f.length;_++)vf(m,l,f[_])},custom:function(m,l,f,_){const x=m.context,w=f.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&f.isLayerDraped()){if(m.renderPass==="offscreen"){const S=w.prerender;if(S){if(m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const P=m.transform.pointMerc;S.call(w,x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(m.transform.zoom),[P.x,P.y],m.transform.pixelsPerMeterRatio)}else S.call(w,x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const P=w.renderToTile;if(P){const L=_[0].canonical,D=new s.MercatorCoordinate(L.x+_[0].wrap*(1<<L.z),L.y,L.z);x.setDepthMode(s.DepthMode.disabled),x.setStencilMode(s.StencilMode.disabled),x.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),P.call(w,x.gl,D),x.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),x.setStencilMode(s.StencilMode.disabled);const S=w.renderingMode==="3d"?new s.DepthMode(m.context.gl.LEQUAL,s.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(x.setDepthMode(S),m.transform.projection.name==="globe"){const P=m.transform.pointMerc;w.render(x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(m.transform.zoom),[P.x,P.y],m.transform.pixelsPerMeterRatio)}else w.render(x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState(),x.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Yl{constructor(l,f,_=!1){this.context=new oe(l,_),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Nl,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,f){const _=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new of(this,l));const x=this._terrain;this.transform.elevation=_?x:null,x.update(l,this.transform,f)}_updateFog(l){const f=l.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,x]=f.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);const w=_+.78*(x-_);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,f){if(this.width=l*s.exported.devicePixelRatio,this.height=f*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const l=this.context,f=new s.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(s.EXTENT,0),f.emplaceBack(0,s.EXTENT),f.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const _=new s.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(s.EXTENT,0),_.emplaceBack(0,s.EXTENT),_.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=l.createVertexBuffer(_,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const x=new s.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(x,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const w=new s.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(s.EXTENT,0,s.EXTENT,0),w.emplaceBack(0,s.EXTENT,0,s.EXTENT),w.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(w,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const S=new s.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(S);const P=new s.StructArrayLayout1ui2;for(const D of[0,1,3,2,0])P.emplaceBack(D);this.debugIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new s.Texture(l,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=s.create();const L=this.context.gl;this.stencilClearMode=new s.StencilMode({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new qy(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(l,f.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,Qn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,f,_){if(!f||this.currentStencilSource===f.id||!l.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const L of _)if(this._tileClippingMaskIDs[L.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=f.id;const x=this.context,w=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(s.ColorMode.disabled),x.setDepthMode(s.DepthMode.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of _){const L=f.getTile(P),D=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:V,tileBoundsSegments:q}=this.getTileBoundsBuffers(L);S.draw(x,w.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:w.ALWAYS,mask:0},D,255,w.KEEP,w.KEEP,w.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Qn(P.projMatrix),"$clipping",z,V,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new s.StencilMode({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const f=this.context.gl;return new s.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(l){const f=this.context.gl,_=l.sort((S,P)=>P.overscaledZ-S.overscaledZ),x=_[_.length-1].overscaledZ,w=_[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const S={};for(let P=0;P<w;P++)S[P+x]=new s.StencilMode({func:f.GEQUAL,mask:255},P+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=w,[S,_]}return[{[x]:s.StencilMode.disabled},_]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([l.CONSTANT_COLOR,l.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(l,f,_){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new s.DepthMode(_||this.context.gl.LEQUAL,f,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,f){this.style=l,this.options=f,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const _=this.style.order,x=this.style._sourceCaches;for(const L in x){const D=x[L];D.used&&D.prepare(this.context)}const w={},S={},P={};for(const L in x){const D=x[L];w[L]=D.getVisibleCoordinates(),S[L]=w[L].slice().reverse(),P[L]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<_.length;L++)if(this.style._layers[_[L]].is3D()){this.opaquePassCutoff=L;break}if(this.terrain&&(this.terrain.updateTileBinding(P),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),s.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const L of _){const D=this.style._layers[L],z=l._getLayerSourceCache(D);if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const V=z?S[z.id]:void 0;(D.type==="custom"||D.isSky()||V&&V.length)&&this.renderLayer(this,z,D,V)}if(this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:f.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[_[this.currentLayer]],D=l._getLayerSourceCache(L);if(L.isSky())continue;const z=D?S[D.id]:void 0;this._renderTileClippingMasks(L,D,z),this.renderLayer(this,D,L,z)}if(this.style.fog&&this.transform.projection.supportsFog&&function(L,D){const z=L.context,V=z.gl,q=L.transform,ee=new s.DepthMode(V.LEQUAL,s.DepthMode.ReadOnly,[0,1]),Q=L.useProgram("globeAtmosphere",null,q.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),te=s.globeToMercatorTransition(q.zoom),ie=D.properties.get("color").toArray01(),W=D.properties.get("high-color").toArray01(),fe=D.properties.get("space-color").toArray01PremultipliedAlpha(),le=s.identity$1([]);s.rotateY$1(le,le,-s.degToRad(q._center.lng)),s.rotateX$1(le,le,s.degToRad(q._center.lat)),s.rotateZ$1(le,le,q.angle),s.rotateX$1(le,le,-q._pitch);const pe=s.fromQuat(new Float32Array(16),le),Te=s.mapValue(D.properties.get("star-intensity"),0,1,0,.25),be=5e-4,Ce=s.mapValue(D.properties.get("horizon-blend"),0,1,be,.25),Be=s.globeUseCustomAntiAliasing(L,z,q)&&Ce===be?q.worldSize/(2*Math.PI*1.025)-1:q.globeRadius,Ge=L.frameCounter/1e3%1,We=s.length(q.globeCenterInViewSpace),At=Math.sqrt(Math.pow(We,2)-Math.pow(Be,2)),Ue=Math.acos(At/We),rt=((pt,$e,De,qe,ut,_t,Qt,zn,Ht,Ut,rn,Vn,hn,ci)=>({u_frustum_tl:pt,u_frustum_tr:$e,u_frustum_br:De,u_frustum_bl:qe,u_horizon:ut,u_transition:_t,u_fadeout_range:Qt,u_color:zn,u_high_color:Ht,u_space_color:Ut,u_star_intensity:rn,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Vn,u_horizon_angle:hn,u_rotation_matrix:ci}))(q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.frustumCorners.horizon,te,Ce,ie,W,fe,Te,Ge,Ue,pe);L.prepareDrawProgram(z,Q);const Ye=L.atmosphereBuffer;Ye&&Q.draw(z,V.TRIANGLES,ee,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,rt,"skybox",Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const L=this.style._layers[_[this.currentLayer]],D=l._getLayerSourceCache(L);L.isSky()&&this.renderLayer(this,D,L,D?S[D.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const L=this.style._layers[_[this.currentLayer]],D=l._getLayerSourceCache(L);if(L.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(L)){if(L.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=D?(L.type==="symbol"?P:S)[D.id]:void 0;this._renderTileClippingMasks(L,D,D?w[D.id]:void 0),this.renderLayer(this,D,L,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let L=null;s.values(this.style._layers).forEach(D=>{const z=l._getLayerSourceCache(D);z&&!D.isHidden(this.transform.zoom)&&(!L||L.getSource().maxzoom<z.getSource().maxzoom)&&(L=z)}),L&&this.options.showTileBoundaries&&xf.debug(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const D=L.transform.padding;No(L,L.transform.height-(D.top||0),3,_f),No(L,D.bottom||0,3,yf),Wa(L,D.left||0,3,im),Wa(L,L.transform.width-(D.right||0),3,rm);const z=L.transform.centerPoint;(function(V,q,ee,Q){Xl(V,q-1,ee-10,2,20,Q),Xl(V,q-10,ee-1,20,2,Q)})(L,z.x,L.transform.height-z.y,sm)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}}renderLayer(l,f,_,x){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(_.type)||l.terrain&&_.type==="custom")&&xf[_.type](l,f,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let _=this.gpuTimers[l.id];_||(_=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),_.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,f=l.createQueryEXT();this.deferredRenderGpuTimeQueries.push(f),l.beginQueryEXT(l.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const f={};for(const _ in l){const x=l[_],w=this.context.extTimerQuery,S=w.getQueryObjectEXT(x.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(x.query),f[_]=S}return f}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery;let _=0;for(const x of l)_+=f.getQueryObjectEXT(x,f.QUERY_RESULT_EXT)/1e6,f.deleteQueryEXT(x);return _}translatePosMatrix(l,f,_,x,w){if(!_[0]&&!_[1])return l;const S=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(S){const D=Math.sin(S),z=Math.cos(S);_=[_[0]*z-_[1]*D,_[0]*D+_[1]*z]}const P=[w?_[0]:vi(f,_[0],this.transform.zoom),w?_[1]:vi(f,_[1],this.transform.zoom),0],L=new Float32Array(16);return s.translate(L,l,P),L}saveTileTexture(l){const f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}isPatternMissing(l){return l===null||l!==void 0&&!this.imageManager.getPattern(l.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const l=this.terrain&&this.terrain.renderingToTexture,f=this.terrain&&this.terrain.exaggeration()===0,_=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),this.transform.projection.name==="globe"&&x.push("GLOBE"),f&&x.push("ZERO_EXAGGERATION"),_&&!l&&_.getOpacity(this.transform.pitch)!==0&&x.push("FOG"),l&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(l,f,_){this.cache=this.cache||{};const x=_||[],w=this.currentGlobalDefines().concat(x),S=af.cacheKey(Qh[l],l,w,f);return this.cache[S]||(this.cache[S]=new af(this.context,l,Qh[l],f,$y[l],w)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(l,f,_){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const w=x.getOpacity(this.transform.pitch),S=((P,L,D,z,V,q,ee,Q,te,ie,W)=>{const fe=P.transform,le=L.properties.get("color").toArray01();le[3]=z;const pe=P.frameCounter/1e3%1;return{u_fog_matrix:D?fe.calculateFogTileMatrix(D):P.identityMat,u_fog_range:L.getFovAdjustedRange(fe._fov),u_fog_color:le,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_temporal_offset:pe,u_frustum_tl:V,u_frustum_tr:q,u_frustum_br:ee,u_frustum_bl:Q,u_globe_pos:te,u_globe_radius:ie,u_viewport:W,u_globe_transition:s.globeToMercatorTransition(fe.zoom),u_is_globe:+(fe.projection.name==="globe")}})(this,x,_,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);f.setFogUniformValues(l,S)}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,f=l.createTexture();return l.bindTexture(l.TEXTURE_2D,f),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,f=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const x of _)f[x.key]=l[x.key]||new s.Tile(x,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class bf{constructor(l=0,f=0,_=0,x=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=_,this.right=x}interpolate(l,f,_){return f.top!=null&&l.top!=null&&(this.top=s.number(l.top,f.top,_)),f.bottom!=null&&l.bottom!=null&&(this.bottom=s.number(l.bottom,f.bottom,_)),f.left!=null&&l.left!=null&&(this.left=s.number(l.left,f.left,_)),f.right!=null&&l.right!=null&&(this.right=s.number(l.right,f.right,_)),this}getCenter(l,f){const _=s.clamp((this.left+l-this.right)/2,0,l),x=s.clamp((this.top+f-this.bottom)/2,0,f);return new s.pointGeometry(_,x)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new bf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function om(m,l){const f=s.getColumn(m,3);s.fromQuat(m,l),s.setColumn(m,3,f)}function mu(m,l){const f=s.identity$1([]);return s.rotateZ$1(f,f,-l),s.rotateX$1(f,f,-m),f}function am(m,l){const f=[m[0],m[1],0],_=[l[0],l[1],0];if(s.length(f)>=1e-15){const S=s.normalize([],f);s.scale$2(_,S,s.dot(_,S)),l[0]=_[0],l[1]=_[1]}const x=s.cross([],l,m);if(s.len(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return mu(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),w)}class gu{constructor(l,f){this.position=l,this.orientation=f}get position(){return this._position}set position(l){if(l){const f=l instanceof s.MercatorCoordinate?l:new s.MercatorCoordinate(l[0],l[1],l[2]);this._renderWorldCopies&&(f.x=s.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(l,f){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(l)):0,x=this.position,w=s.MercatorCoordinate.fromLngLat(l,_),S=[w.x-x.x,w.y-x.y,w.z-x.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=am(S,f)}setPitchBearing(l,f){this.orientation=mu(s.degToRad(l),s.degToRad(-f))}}class Xa{constructor(l,f){this._transform=s.identity([]),this.orientation=f,this.position=l}get mercatorPosition(){const l=this.position;return new s.MercatorCoordinate(l[0],l[1],l[2])}get position(){const l=s.getColumn(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var f;l&&s.setColumn(this._transform,3,[(f=l)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||s.identity$1([]),l&&om(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,f){this._orientation=mu(l,f),om(this._transform,this._orientation)}forward(){const l=s.getColumn(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=s.getColumn(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=s.getColumn(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,f){const _=new Float64Array(16);return s.invert(_,this.getWorldToCamera(l,f)),_}getWorldToCameraPosition(l,f,_){const x=this.position;s.scale$2(x,x,-l);const w=new Float64Array(16);return s.fromScaling(w,[_,_,_]),s.translate(w,w,x),w[10]*=f,w}getWorldToCamera(l,f){const _=new Float64Array(16),x=new Float64Array(4),w=this.position;return s.conjugate(x,this._orientation),s.scale$2(w,w,-l),s.fromQuat(_,x),s.translate(_,_,w),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=f,_[9]*=f,_[10]*=f,_[11]*=f,_}getCameraToClipPerspective(l,f,_,x){const w=new Float64Array(16);return s.perspective(w,l,f,_,x),w}getDistanceToElevation(l,f=!1){const _=l===0?0:s.mercatorZfromAltitude(l,f?s.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(_-this.position[2])/x[2]}clone(){return new Xa([...this.position],[...this.orientation])}}function Ya(m,l){const f=_a(m.projection,m.zoom,m.width,m.height),_=function(w,S,P,L,D){const z=new s.LngLat(P.lng-180*ya,P.lat),V=new s.LngLat(P.lng+180*ya,P.lat),q=w.project(z.lng,z.lat),ee=w.project(V.lng,V.lat),Q=-Math.atan2(ee.y-q.y,ee.x-q.x),te=s.MercatorCoordinate.fromLngLat(P);te.y=s.clamp(te.y,-.999975,.999975);const ie=te.toLngLat(),W=w.project(ie.lng,ie.lat),fe=s.MercatorCoordinate.fromLngLat(ie);fe.x+=ya;const le=fe.toLngLat(),pe=w.project(le.lng,le.lat),Te=Jl(pe.x-W.x,pe.y-W.y,Q),be=s.MercatorCoordinate.fromLngLat(ie);be.y+=ya;const Ce=be.toLngLat(),Be=w.project(Ce.lng,Ce.lat),Ge=Jl(Be.x-W.x,Be.y-W.y,Q),We=Math.abs(Te.x)/Math.abs(Ge.y),At=s.identity([]);s.rotateZ(At,At,-Q*(1-(D?0:L)));const Ue=s.identity([]);return s.scale(Ue,Ue,[1,1-(1-We)*L,1]),Ue[4]=-Ge.x/Ge.y*L,s.rotateZ(Ue,Ue,Q),s.multiply(Ue,At,Ue),Ue}(m.projection,0,m.center,f,l),x=_u(m);return s.scale(_,_,[x,x,1]),_}function _u(m){const l=m.projection,f=_a(m.projection,m.zoom,m.width,m.height),_=Kl(l,m.center),x=Kl(l,s.LngLat.convert(l.center));return Math.pow(2,_*f+(1-f)*x)}function _a(m,l,f,_,x=1/0){const w=m.range;if(!w)return 0;const S=Math.min(x,Math.max(f,_)),P=Math.log(S/1024)/Math.LN2;return s.smoothstep(w[0]+P,w[1]+P,l)}const ya=1/4e4;function Kl(m,l){const f=s.clamp(l.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),_=new s.LngLat(l.lng-180*ya,f),x=new s.LngLat(l.lng+180*ya,f),w=m.project(_.lng,f),S=m.project(x.lng,f),P=s.MercatorCoordinate.fromLngLat(_),L=s.MercatorCoordinate.fromLngLat(x),D=S.x-w.x,z=S.y-w.y,V=L.x-P.x,q=L.y-P.y,ee=Math.sqrt((V*V+q*q)/(D*D+z*z));return Math.log(ee)/Math.LN2}function Jl(m,l,f){const _=Math.cos(f),x=Math.sin(f);return{x:m*_-l*x,y:m*x+l*_}}class Nt{constructor(l,f,_,x,w,S,P){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=_??0,this._maxPitch=x??60,this.setProjection(S),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new bf,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Xa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const l=new Nt(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(l,f=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(l||_)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const _=!v(f,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const f=l!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const f=-l*Math.PI/180;var _;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(_=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),function(x,w,S){var P=w[0],L=w[1],D=w[2],z=w[3],V=Math.sin(S),q=Math.cos(S);x[0]=P*q+D*V,x[1]=L*q+z*V,x[2]=P*-V+D*q,x[3]=L*-V+z*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const f=s.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=s.degToRad(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const l=this._elevation;this._centerAltitude=l.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=l.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let x=0,w=0;for(let S=0;S<f.length;S++){const P=new s.pointGeometry(f[S][0]*this.width,_+f[S][1]*(this.height-_)),L=l.pointCoordinate(P);if(!L)continue;const D=1/Math.hypot(L[0]-this._camera.position[0],L[1]-this._camera.position[1]);x+=L[3]*D,w+=D}return w===0?NaN:x/w}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*f,x=this._mercatorZfromZoom(l),w=this._mercatorZfromZoom(this._maxZoom),S=Math.max(x-_,w);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let _;_=l.z<this._camera.position[2]?[f.x,f.y,f.z]:[l.x,l.y,l.z];const x=s.length(s.sub([],this._camera.position,_));return s.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let f=!1;if(l.orientation&&!s.exactEquals(l.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(l.orientation)),l.position){const _=[l.position.x,l.position.y,l.position.z];s.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,f=new gu;return f.position=new s.MercatorCoordinate(l[0],l[1],l[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(l){if(!s.length$1(l))return!1;s.normalize$1(l,l);const f=s.transformQuat([],[0,0,-1],l),_=s.transformQuat([],[0,-1,0],l);if(_[2]<0)return!1;const x=am(f,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(l){const f=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;l[2]=s.clamp(l[2],x/_,x/f),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,_){this._unmodified=!1,this._edgeInsets.interpolate(l,f,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(l){const f=[new s.UnwrappedTileID(0,l)];if(this.renderWorldCopies){const _=this.pointCoordinate(new s.pointGeometry(0,0)),x=this.pointCoordinate(new s.pointGeometry(this.width,0)),w=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),S=this.pointCoordinate(new s.pointGeometry(0,this.height)),P=Math.floor(Math.min(_.x,x.x,w.x,S.x)),L=Math.floor(Math.max(_.x,x.x,w.x,S.x)),D=1;for(let z=P-D;z<=L+D;z++)z!==0&&f.push(new s.UnwrappedTileID(z,l))}return f}coveringTiles(l){let f=this.coveringZoomLevel(l);const _=f,x=this.elevation&&!l.isTerrainDEM,w=this.projection.name==="mercator";if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);const S=this.locationCoordinate(this.center),P=this.center.lat,L=1<<f,D=[L*S.x,L*S.y,0],z=this.projection.name==="globe",V=!z,q=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,V),ee=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=L*s.mercatorZfromAltitude(1,this.center.lat),te=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),ie=[L*ee.x,L*ee.y,te*(V?1:Q)],W=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),fe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,le=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,pe=l.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?_u(this):1,be=$e=>{const qe=new s.MercatorCoordinate($e.x+25e-6,$e.y,$e.z),ut=new s.MercatorCoordinate($e.x,$e.y+25e-6,$e.z),_t=$e.toLngLat(),Qt=qe.toLngLat(),zn=ut.toLngLat(),Ht=this.locationCoordinate(_t),Ut=this.locationCoordinate(Qt),rn=this.locationCoordinate(zn),Vn=Math.hypot(Ut.x-Ht.x,Ut.y-Ht.y),hn=Math.hypot(rn.x-Ht.x,rn.y-Ht.y);return Math.sqrt(Vn*hn)*Te/25e-6},Ce=$e=>{const De=le,qe=pe;return{aabb:s.tileAABB(this,L,0,0,0,$e,qe,De,this.projection),zoom:0,x:0,y:0,minZ:qe,maxZ:De,wrap:$e,fullyVisible:!1}},Be=[];let Ge=[];const We=f,At=l.reparseOverscaled?_:f,Ue=$e=>$e*$e,rt=Ue((te-this._centerAltitude)*Q),Ye=$e=>{if(!this._elevation||!$e.tileID||!w)return;const De=this._elevation.getMinMaxForTile($e.tileID),qe=$e.aabb;De?(qe.min[2]=De.min,qe.max[2]=De.max,qe.center[2]=(qe.min[2]+qe.max[2])/2):($e.shouldSplit=pt($e),$e.shouldSplit||(qe.min[2]=qe.max[2]=qe.center[2]=this._centerAltitude))},pt=$e=>{if($e.zoom<fe)return!0;if($e.zoom===We)return!1;if($e.shouldSplit!=null)return $e.shouldSplit;const De=$e.aabb.distanceX(ie),qe=$e.aabb.distanceY(ie);let ut=rt,_t=1;if(z){ut=Ue($e.aabb.distanceZ(ie));const Ht=Math.pow(2,$e.zoom),Ut=s.latFromMercatorY(($e.y+1)/Ht),rn=s.latFromMercatorY($e.y/Ht),Vn=Math.min(Math.max(P,Ut),rn),hn=s.circumferenceAtLatitude(Vn)/s.circumferenceAtLatitude(P);if(_t=Vn===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,hn/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&$e.zoom===We-1&&hn>=.9)return!0}else if(x&&(ut=Ue($e.aabb.distanceZ(ie)*Q)),this.projection.isReprojectedInTileSpace&&_<=5){const Ht=Math.pow(2,$e.zoom),Ut=be(new s.MercatorCoordinate(($e.x+.5)/Ht,($e.y+.5)/Ht));_t=Ut>.85?1:Ut}const Qt=De*De+qe*qe+ut,zn=Ue((1<<We-$e.zoom)*W*_t*((Ht,Ut)=>{if(Ut*Ue(.707)<Ht)return 1;const rn=Math.sqrt(Ut/Ht);return rn/(1.4144271570014144+(Math.pow(1.1,rn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ut,rt),Qt));return Qt<zn};if(this.renderWorldCopies)for(let $e=1;$e<=3;$e++)Be.push(Ce(-$e)),Be.push(Ce($e));for(Be.push(Ce(0));Be.length>0;){const $e=Be.pop(),De=$e.x,qe=$e.y;let ut=$e.fullyVisible;if(!ut){const _t=$e.aabb.intersects(q);if(_t===0)continue;ut=_t===2}if($e.zoom!==We&&pt($e))for(let _t=0;_t<4;_t++){const Qt=(De<<1)+_t%2,zn=(qe<<1)+(_t>>1),Ht={aabb:w?$e.aabb.quadrant(_t):s.tileAABB(this,L,$e.zoom+1,Qt,zn,$e.wrap,$e.minZ,$e.maxZ,this.projection),zoom:$e.zoom+1,x:Qt,y:zn,wrap:$e.wrap,fullyVisible:ut,tileID:void 0,shouldSplit:void 0,minZ:$e.minZ,maxZ:$e.maxZ};x&&!z&&(Ht.tileID=new s.OverscaledTileID($e.zoom+1===We?At:$e.zoom+1,$e.wrap,$e.zoom+1,Qt,zn),Ye(Ht)),Be.push(Ht)}else{const _t=$e.zoom===We?At:$e.zoom;if(l.minzoom&&l.minzoom>_t)continue;const Qt=D[0]-(.5+De+($e.wrap<<$e.zoom))*(1<<f-$e.zoom),zn=D[1]-.5-qe,Ht=$e.tileID?$e.tileID:new s.OverscaledTileID(_t,$e.wrap,$e.zoom,De,qe);Ge.push({tileID:Ht,distanceSq:Qt*Qt+zn*zn})}}if(this.fogCullDistSq){const $e=this.fogCullDistSq,De=this.horizonLineFromTop();Ge=Ge.filter(qe=>{const ut=[0,0,0,1],_t=[s.EXTENT,s.EXTENT,0,1],Qt=this.calculateFogTileMatrix(qe.tileID.toUnwrapped());s.transformMat4$1(ut,ut,Qt),s.transformMat4$1(_t,_t,Qt);const zn=s.getAABBPointSquareDist(ut,_t);if(zn===0)return!0;let Ht=!1;const Ut=this._elevation;if(Ut&&zn>$e&&De!==0){const rn=this.calculateProjMatrix(qe.tileID.toUnwrapped());let Vn;l.isTerrainDEM||(Vn=Ut.getMinMaxForTile(qe.tileID)),Vn||(Vn={min:pe,max:le});const hn=s.furthestTileCorner(this.rotation),ci=[hn[0]*s.EXTENT,hn[1]*s.EXTENT,Vn.max];s.transformMat4(ci,ci,rn),Ht=(1-ci[1])*this.height*.5<De}return zn<$e||Ht})}return Ge.sort(($e,De)=>$e.distanceSq-De.distanceSq).map($e=>$e.tileID)}resize(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const f=s.clamp(l.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),_=this.projection.project(l.lng,f);return new s.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,f){let _,x;const w=this.centerPoint;if(this.projection.name==="globe"){const P=this.worldSize;_=(f.x-w.x)/P,x=(f.y-w.y)/P}else{const P=this.pointCoordinate(f),L=this.pointCoordinate(w);_=P.x-L.x,x=P.y-L.y}const S=this.locationCoordinate(l);this.setLocation(new s.MercatorCoordinate(S.x-_,S.y-x))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,f){const _=f?s.mercatorZfromAltitude(f,l.lat):void 0,x=this.projection.project(l.lng,l.lat);return new s.MercatorCoordinate(x.x,x.y,_)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,f){const _=f??this._centerAltitude,x=[l.x,l.y,0,1],w=[l.x,l.y,1,1];s.transformMat4$1(x,x,this.pixelMatrixInverse),s.transformMat4$1(w,w,this.pixelMatrixInverse);const S=w[3];s.scale$1(x,x,1/x[3]),s.scale$1(w,w,1/S);const P=x[2],L=w[2];return{p0:x,p1:w,t:P===L?0:(_-P)/(L-P)}}screenPointToMercatorRay(l){const f=[l.x,l.y,0,1],_=[l.x,l.y,1,1];return s.transformMat4$1(f,f,this.pixelMatrixInverse),s.transformMat4$1(_,_,this.pixelMatrixInverse),s.scale$1(f,f,1/f[3]),s.scale$1(_,_,1/_[3]),f[2]=s.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,_[2]=s.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,s.scale$1(f,f,1/this.worldSize),s.scale$1(_,_,1/this.worldSize),new s.Ray([f[0],f[1],f[2]],s.normalize([],s.sub([],_,f)))}rayIntersectionCoordinate(l){const{p0:f,p1:_,t:x}=l,w=s.mercatorZfromAltitude(f[2],this._center.lat),S=s.mercatorZfromAltitude(_[2],this._center.lat);return new s.MercatorCoordinate(s.number(f[0],_[0],x)/this.worldSize,s.number(f[1],_[1],x)/this.worldSize,s.number(w,S,x))}pointCoordinate(l,f=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,f)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let f=this.projection.pointCoordinate3D(this,l.x,l.y);if(f)return new s.MercatorCoordinate(f[0],f[1],f[2]);let _=0,x=this.horizonLineFromTop();if(l.y>x)return this.pointCoordinate(l);const w=.02*x,S=l.clone();for(let P=0;P<10&&x-_>w;P++){S.y=s.number(_,x,.66);const L=this.projection.pointCoordinate3D(this,S.x,S.y);L?(x=S.y,f=L):_=S.y}return f?new s.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}_coordinatePoint(l,f){const _=f&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,x=[l.x*this.worldSize,l.y*this.worldSize,_+l.toAltitude(),1];return s.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new s.pointGeometry(x[0]/x[3],x[1]/x[3]):new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:f}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new s.pointGeometry(f,l)),S=this.pointLocation3D(new s.pointGeometry(x,l)),P=this.pointLocation3D(new s.pointGeometry(x,_)),L=this.pointLocation3D(new s.pointGeometry(f,_));let D=Math.min(w.lng,S.lng,P.lng,L.lng),z=Math.max(w.lng,S.lng,P.lng,L.lng),V=Math.min(w.lat,S.lat,P.lat,L.lat),q=Math.max(w.lat,S.lat,P.lat,L.lat);const ee=Math.pow(2,-this.zoom)/16*270,Q=this.projection.name==="globe"?1:4,te=(ie,W,fe,le,pe)=>{const Te=(ie+fe)/2,be=(W+le)/2,Ce=new s.pointGeometry(Te,be),{lng:Be,lat:Ge}=this.pointLocation3D(Ce),We=Math.max(0,D-Be,V-Ge,Be-z,Ge-q);D=Math.min(D,Be),z=Math.max(z,Be),V=Math.min(V,Ge),q=Math.max(q,Ge),(pe<Q||We>ee)&&(te(ie,W,Te,be,pe+1),te(Te,be,fe,le,pe+1))};if(te(f,l,x,l,1),te(x,l,x,_,1),te(x,_,f,_,1),te(f,_,f,l,1),this.projection.name==="globe"){const[ie,W]=s.polesInViewport(this);ie?(q=90,z=180,D=-180):W&&(V=-90,z=180,D=-180)}return new s.LngLatBounds(new s.LngLat(D,V),new s.LngLat(z,q))}_getBoundsRectangular(l,f){const{top:_,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,P=new s.pointGeometry(x,_),L=new s.pointGeometry(S,_),D=new s.pointGeometry(S,w),z=new s.pointGeometry(x,w);let V=this.pointCoordinate(P,l),q=this.pointCoordinate(L,l);const ee=this.pointCoordinate(D,f),Q=this.pointCoordinate(z,f),te=(ie,W)=>(W.y-ie.y)/(W.x-ie.x);return V.y>1&&q.y>=0?V=new s.MercatorCoordinate((1-Q.y)/te(Q,V)+Q.x,1):V.y<0&&q.y<=1&&(V=new s.MercatorCoordinate(-Q.y/te(Q,V)+Q.x,0)),q.y>1&&V.y>=0?q=new s.MercatorCoordinate((1-ee.y)/te(ee,q)+ee.x,1):q.y<0&&V.y<=1&&(q=new s.MercatorCoordinate(-ee.y/te(ee,q)+ee.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(ee))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=l.visibleDemTiles.reduce((_,x)=>{if(x.dem){const w=x.dem.tree;_.min=Math.min(_.min,w.minimums[0]),_.max=Math.max(_.max,w.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*l.exaggeration(),f.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-f*(1-this._horizonShift);return l?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,f){return this.projection.createTileMatrix(this,f,l)}calculateDistanceTileData(l){const f=l.key,_=this._distanceTileDataCache;if(_[f])return _[f];const x=l.canonical,w=1/this.height,S=this.cameraWorldSize,P=S/this.zoomScale(x.z),L=(x.x+Math.pow(2,x.z)*l.wrap)*P,D=x.y*P,z=this.point;z.x*=S/this.worldSize,z.y*=S/this.worldSize;const V=this.angle,q=Math.sin(-V),ee=-Math.cos(-V);return _[f]={bearing:[q,ee],center:[(z.x-L)*w,(z.y-D)*w],scale:P/s.EXTENT*w},_[f]}calculateFogTileMatrix(l){const f=l.key,_=this._fogTileMatrixCache;if(_[f])return _[f];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return s.multiply(x,this.worldToFogMatrix,x),_[f]=new Float32Array(x),_[f]}calculateProjMatrix(l,f=!1){const _=l.key,x=f?this._alignedProjMatrixCache:this._projMatrixCache;if(x[_])return x[_];const w=this.calculatePosMatrix(l,this.worldSize);return s.multiply(w,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,w),x[_]=new Float32Array(w),x[_]}calculatePixelsToTileUnitsMatrix(l){const f=l.tileID.key,_=this._pixelsToTileUnitsCache;if(_[f])return _[f];const x=function(w,S){const{scale:P}=w.tileTransform,L=P*s.EXTENT/(w.tileSize*Math.pow(2,S.zoom-w.tileID.overscaledZ+w.tileID.canonical.z));return D=new Float32Array(4),q=(z=S.inverseAdjustmentMatrix)[1],ee=z[2],Q=z[3],ie=(V=[L,L])[1],D[0]=z[0]*(te=V[0]),D[1]=q*te,D[2]=ee*ie,D[3]=Q*ie,D;var D,z,V,q,ee,Q,te,ie}(l,this);return _[f]=x,_[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,f=s.fromScaling([],[l,l,l]);return s.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const f=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),x=this._camera.forward(),w=s.mercatorZfromAltitude(1,this._center.lat);_[2]/=w,x[2]/=w,s.normalize(x,x);const S=l.raycast(_,x,l.exaggeration());if(S){const P=s.scaleAndAdd([],_,x,S),L=new s.MercatorCoordinate(P[0],P[1],s.mercatorZfromAltitude(P[2],s.latFromMercatorY(P[1]))),D=(L.z+s.length([L.x-_[0],L.y-_[1],L.z-_[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=L.toAltitude(),this._center=this.coordinateLocation(L),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const f=this._elevation,_=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(_),w=f.getAtPointOrZero(new s.MercatorCoordinate(...x)),S=this.pixelsPerMeter/this.worldSize*w,P=this._minimumHeightOverTerrain(),L=x[2]-S;if(L<=P)if(L<0||l){const D=this.locationCoordinate(this._center,this._centerAltitude),z=[x[0],x[1],D.z-x[2]],V=s.length(z);z[2]-=(P-L)/this._pixelsPerMercatorPixel;const q=s.length(z);if(q===0)return;s.scale$2(z,z,V/q*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],D.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const q=this.center;return q.lat=s.clamp(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(q.lng=s.clamp(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const f=this._unmodified,{x:_,y:x}=this.point;let w=0,S=_,P=x;const L=this.width/2,D=this.height/2,z=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(x-D<z&&(P=z+D),x+D>V&&(P=V-D),V-z<this.height&&(w=Math.max(w,this.height/(V-z)),P=(V+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,ee=this.worldMaxX*this.scale,Q=this.worldSize/2-(q+ee)/2;S=(_+Q+this.worldSize)%this.worldSize-Q,S-L<q&&(S=q+L),S+L>ee&&(S=ee-L),ee-q<this.width&&(w=Math.max(w,this.width/(ee-q)),S=(ee+q)/2)}S===_&&P===x||(this.center=this.unproject(new s.pointGeometry(S,P))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const _=_a(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?f:1,w=this._camera.getWorldToCamera(this.worldSize,x),S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);S[8]=2*-l.x/this.width,S[9]=2*l.y/this.height;let P=s.mul([],S,w);if(this.projection.isReprojectedInTileSpace){const be=this.locationCoordinate(this.center),Ce=s.identity([]);s.translate(Ce,Ce,[be.x*this.worldSize,be.y*this.worldSize,0]),s.multiply(Ce,Ce,Ya(this)),s.translate(Ce,Ce,[-be.x*this.worldSize,-be.y*this.worldSize,0]),s.multiply(P,P,Ce),this.inverseAdjustmentMatrix=function(Be){const Ge=Ya(Be,!0);return ke([],[Ge[0],Ge[1],Ge[4],Ge[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],P,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=P,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const L=s.invert([],S);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(L,this.horizonLineFromTop(),this.height);const D=new Float32Array(16);s.identity(D),s.scale(D,D,[1,-1,1]),s.rotateX(D,D,this._pitch),s.rotateZ(D,D,this.angle);const z=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),V=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-l.x/this.width,z[9]=2*(l.y+V)/this.height,this.skyboxMatrix=s.multiply(D,z,D);const q=this.point,ee=q.x,Q=q.y,te=this.width%2/2,ie=this.height%2/2,W=Math.cos(this.angle),fe=Math.sin(this.angle),le=ee-Math.round(ee)+W*te+fe*ie,pe=Q-Math.round(Q)+W*ie+fe*te,Te=new Float64Array(P);if(s.translate(Te,Te,[le>.5?le-1:le,pe>.5?pe-1:pe,0]),this.alignedProjMatrix=Te,P=s.create(),s.scale(P,P,[this.width/2,-this.height/2,1]),s.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=s.create(),s.scale(P,P,[1,-1,1]),s.translate(P,P,[-1,-1,0]),s.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},P=s.invert(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(be,be,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[l,l,f];s.scale$2(w,w,x),s.scale$2(_,_,-1),s.multiply$2(_,_,w);const S=s.create();s.translate(S,S,_),s.scale(S,S,w),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,f,x)}_computeCameraPosition(l){const f=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-l/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*w,x.y/this.worldSize-_[1]*w,l/this.worldSize*this._centerAltitude-_[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],x=l[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((f-_)/x,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,l,w),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,f=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),w=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),P=Math.max((l[2]-w)/Math.cos(_),S),L=this._zoomFromMercatorZ(P);s.scaleAndAdd(l,l,f,P),this._pitch=s.clamp(_,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(x,-Math.PI,Math.PI),this._setZoom(s.clamp(L,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let f=0,_=s.GLOBE_ZOOM_THRESHOLD_MAX,x=0,w=1/0;for(;_-f>1e-6&&_>f;){const S=f+.5*(_-f),P=this.tileSize*Math.pow(2,S),L=this.getCameraToCenterDistance(this.projection,S,P),D=this.scaleZoom(L/(l*this.tileSize)),z=Math.abs(S-D);z<w&&(w=z,x=S),S<D?f=S:_=S}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,f){const _=Math.min(l.x,f.x),x=Math.max(l.x,f.x),w=Math.min(l.y,f.y),S=Math.max(l.y,f.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const P=[new s.pointGeometry(_,w),new s.pointGeometry(x,S),new s.pointGeometry(_,S),new s.pointGeometry(x,w)],L=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const z of P){const V=this.pointRayIntersection(z);if(V.t<0)return!0;const q=this.rayIntersectionCoordinate(V);if(q.x<L||q.y<0||q.x>D||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.pointGeometry(0,0),new s.pointGeometry(this.width,this.height))}zoomDeltaToMovement(l,f){const _=s.length(s.sub([],this._camera.position,l)),x=this._zoomFromMercatorZ(_)+f;return _-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([f,_,x],w){const S=[f,_,x,1];s.transformMat4$1(S,S,w);const P=S[3]=Math.max(S[3],1e-6);return S[0]/=P,S[1]/=P,S[2]/=P,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.pointGeometry(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,l))}}getCameraToCenterDistance(l,f=this.zoom,_=this.worldSize){const x=_a(l,f,this.width,this.height,1024),w=l.pixelSpaceConversion(this.center.lat,_,x);return .5/Math.tan(.5*this._fov)*this.height*w}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(l,l,this.globeMatrix),l}}function xs(m,l){let f=!1,_=null;const x=()=>{_=null,f&&(m(),_=setTimeout(x,l),f=!1)};return()=>(f=!0,_||x(),_)}class lm{constructor(l){this._hashName=l&&encodeURIComponent(l),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=xs(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,s.window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const f=wf(l);if(this._hashName){const _=this._hashName;let x=!1;const w=s.window.location.hash.slice(1).split("&").map(S=>{const P=S.split("=")[0];return P===_?(x=!0,`${P}=${f}`):S}).filter(S=>S);return x||w.push(`${_}=${f}`),`#${w.join("&")}`}return`#${f}`}_getCurrentHash(){const l=s.window.location.hash.replace("#","");if(this._hashName){let f;return l.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(f=_)}),(f&&f[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(_=>isNaN(_))){const _=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(f[3]||0):l.getBearing();return l.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:_,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const l=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,l)}}function wf(m,l){const f=m.getCenter(),_=Math.round(100*m.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),S=Math.round(f.lng*w)/w,P=Math.round(f.lat*w)/w,L=m.getBearing(),D=m.getPitch();let z=l?`/${S}/${P}/${_}`:`${_}/${P}/${S}`;return(L||D)&&(z+="/"+Math.round(10*L)/10),D&&(z+=`/${Math.round(D)}`),z}const Ql={linearity:.3,easing:s.bezier(0,0,.3,1)},Ka=s.extend({deceleration:2500,maxSpeed:1400},Ql),cm=s.extend({deceleration:20,maxSpeed:1400},Ql),yu=s.extend({deceleration:1e3,maxSpeed:360},Ql),Ef=s.extend({deceleration:1e3,maxSpeed:90},Ql);class vu{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=s.exported.now();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)f.zoom+=w.zoomDelta||0,f.bearing+=w.bearingDelta||0,f.pitch+=w.pitchDelta||0,w.panDelta&&f.pan._add(w.panDelta),w.around&&(f.around=w.around),w.pinchAround&&(f.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(f.pan.mag()){const w=tc(f.pan.mag(),_,s.extend({},Ka,l||{}));x.offset=f.pan.mult(w.amount/f.pan.mag()),x.center=this._map.transform.center,ec(x,w)}if(f.zoom){const w=tc(f.zoom,_,cm);x.zoom=this._map.transform.zoom+w.amount,ec(x,w)}if(f.bearing){const w=tc(f.bearing,_,yu);x.bearing=this._map.transform.bearing+s.clamp(w.amount,-179,179),ec(x,w)}if(f.pitch){const w=tc(f.pitch,_,Ef);x.pitch=this._map.transform.pitch+w.amount,ec(x,w)}if(x.zoom||x.bearing){const w=f.pinchAround===void 0?f.around:f.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function ec(m,l){(!m.duration||m.duration<l.duration)&&(m.duration=l.duration,m.easing=l.easing)}function tc(m,l,f){const{maxSpeed:_,linearity:x,deceleration:w}=f,S=s.clamp(m*x/(l/1e3),-_,_),P=Math.abs(S)/(w*x);return{easing:f.easing,duration:1e3*P,amount:S*(P/2)}}class xr extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_,x={}){const w=ge(f.getCanvasContainer(),_),S=f.unproject(w);super(l,s.extend({point:w,lngLat:S,originalEvent:_},x)),this._defaultPrevented=!1,this.target=f}}class xu extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_){const x=l==="touchend"?_.changedTouches:_.touches,w=nt(f.getCanvasContainer(),x),S=w.map(L=>f.unproject(L)),P=w.reduce((L,D,z,V)=>L.add(D.div(V.length)),new s.pointGeometry(0,0));super(l,{points:w,point:P,lngLats:S,lngLat:f.unproject(P),originalEvent:_}),this._defaultPrevented=!1}}class Zy extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_){super(l,{originalEvent:_}),this._defaultPrevented=!1}}class um{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new Zy(l.type,this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new xr(l.type,this._map,l))}mouseup(l){this._map.fire(new xr(l.type,this._map,l))}preclick(l){const f=s.extend({},l);f.type="preclick",this._map.fire(new xr(f.type,this._map,f))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(l),this._map.fire(new xr(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new xr(l.type,this._map,l))}mouseover(l){this._map.fire(new xr(l.type,this._map,l))}mouseout(l){this._map.fire(new xr(l.type,this._map,l))}touchstart(l){return this._firePreventable(new xu(l.type,this._map,l))}touchmove(l){this._map.fire(new xu(l.type,this._map,l))}touchend(l){this._map.fire(new xu(l.type,this._map,l))}touchcancel(l){this._map.fire(new xu(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bu{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new xr(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new xr(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tf{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(me(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const _=f,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(_)||!this._box&&_.dist(x)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=R("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const S=Math.min(x.x,_.x),P=Math.max(x.x,_.x),L=Math.min(x.y,_.y),D=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${L}px)`,this._box.style.width=P-S+"px",this._box.style.height=D-L+"px")})}mouseupWindow(l,f){if(!this._active)return;const _=this._startPos,x=f;if(_&&l.button===0){if(this.reset(),Pe(),_.x!==x.x||_.y!==x.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:w=>w.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),we(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new s.Event(l,{originalEvent:f}))}}function wu(m,l){const f={};for(let _=0;_<m.length;_++)f[m[_].identifier]=l[_];return f}class hm{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,f,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const w=new s.pointGeometry(0,0);for(const S of x)w._add(S);return w.div(x.length)}(f),this.touches=wu(_,f)))}touchmove(l,f,_){if(this.aborted||!this.centroid)return;const x=wu(_,f);for(const w in this.touches){const S=this.touches[w],P=x[w];(!P||P.dist(S)>30)&&(this.aborted=!0)}}touchend(l,f,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Ja{constructor(l){this.singleTap=new hm(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,f,_){this.singleTap.touchstart(l,f,_)}touchmove(l,f,_){this.singleTap.touchmove(l,f,_)}touchend(l,f,_){const x=this.singleTap.touchend(l,f,_);if(x){const w=l.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(x)<30;if(w&&S||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Af{constructor(){this._zoomIn=new Ja({numTouches:1,numTaps:2}),this._zoomOut=new Ja({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,_){this._zoomIn.touchstart(l,f,_),this._zoomOut.touchstart(l,f,_)}touchmove(l,f,_){this._zoomIn.touchmove(l,f,_),this._zoomOut.touchmove(l,f,_)}touchend(l,f,_){const x=this._zoomIn.touchend(l,f,_),w=this._zoomOut.touchend(l,f,_);return x?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(x)},{originalEvent:l})}):w?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(w)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fm={0:1,2:2};class Eu{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,f){return!1}_move(l,f){return{}}mousedown(l,f){if(this._lastPoint)return;const _=Tt(l);this._correctButton(l,_)&&(this._lastPoint=f,this._eventButton=_)}mousemoveWindow(l,f){const _=this._lastPoint;if(_){if(l.preventDefault(),this._eventButton!=null&&function(x,w){const S=fm[w];return x.buttons===void 0||(x.buttons&S)!==S}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(_,f)}}mouseupWindow(l){this._lastPoint&&Tt(l)===this._eventButton&&(this._moved&&Pe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dm extends Eu{mousedown(l,f){super.mousedown(l,f),this._lastPoint&&(this._active=!0)}_correctButton(l,f){return f===0&&!l.ctrlKey}_move(l,f){return{around:f,panDelta:f.sub(l)}}}class Sf extends Eu{_correctButton(l,f){return f===0&&l.ctrlKey||f===2}_move(l,f){const _=.8*(f.x-l.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(l){l.preventDefault()}}class Mf extends Eu{_correctButton(l,f){return f===0&&l.ctrlKey||f===2}_move(l,f){const _=-.5*(f.y-l.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(l){l.preventDefault()}}class Qa{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0)}touchstart(l,f,_){return this._calculateTransform(l,f,_)}touchmove(l,f,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,f,_)}}touchend(l,f,_){this._calculateTransform(l,f,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,_){_.length>0&&(this._active=!0);const x=wu(_,f),w=new s.pointGeometry(0,0),S=new s.pointGeometry(0,0);let P=0;for(const D in x){const z=x[D],V=this._touches[D];V&&(w._add(z),S._add(z.sub(V)),P++,x[D]=z)}if(this._touches=x,P<this._minTouches||!S.mag())return;const L=S.div(P);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(P),panDelta:L}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=R("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Tu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,f,_){return{}}touchstart(l,f,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,_){const x=this._firstTwoTouches;if(!x)return;l.preventDefault();const[w,S]=x,P=nc(_,f,w),L=nc(_,f,S);if(!P||!L)return;const D=this._aroundCenter?null:P.add(L).div(2);return this._move([P,L],D,l)}touchend(l,f,_){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,S=nc(_,f,x),P=nc(_,f,w);S&&P||(this._active&&Pe(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function nc(m,l,f){for(let _=0;_<m.length;_++)if(m[_].identifier===f)return l[_]}function pm(m,l){return Math.log(m/l)/Math.LN2}class mm extends Tu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(pm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:pm(this._distance,_),pinchAround:f}}}function Pf(m,l){return 180*m.angleWith(l)/Math.PI}class gm extends Tu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f){const _=this._vector;if(this._vector=l[0].sub(l[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Pf(this._vector,_),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const x=Pf(l,_);return Math.abs(x)<f}}function Au(m){return Math.abs(m.y)>Math.abs(m.x)}class Dr extends Tu{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,Au(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,_){const x=this._lastPoints;if(!x)return;const w=l[0].sub(x[0]),S=l[1].sub(x[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(w,S,_.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(w.y+S.y)/2*-.5})}gestureBeginsVertically(l,f,_){if(this._valid!==void 0)return this._valid;const x=l.mag()>=2,w=f.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const S=l.y>0==f.y>0;return Au(l)&&Au(f)&&S}}const Xy={panStep:100,bearingStep:15,pitchStep:10};class _m{constructor(){const l=Xy;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,_=0,x=0,w=0,S=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?x=1:(l.preventDefault(),S=-1);break;case 40:l.shiftKey?x=-1:(l.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:P=>{const L=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Yy,zoom:f?Math.round(L)+f*(l.shiftKey?2:1):L,bearing:P.getBearing()+_*this._bearingStep,pitch:P.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-S*this._panStep],center:P.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Yy(m){return m*(2-m)}const ym=4.000244140625;class po{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=l.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const _=s.exported.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,f!==0&&f%ym==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(x*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=ge(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>ym?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&D!==0&&(D=1/D);const z=f(),V=Math.pow(2,z),q=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(q*D))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:f(),x=this._startZoom,w=this._easing;let S,P=!1;if(this._type==="wheel"&&x&&w){const L=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),D=w(L);S=s.number(x,_,D),L<1?this._frameId||(this._frameId=!0):P=!0}else S=_,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:S-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=s.ease;if(this._prevEase){const _=this._prevEase,x=(s.exported.now()-_.start)/_.duration,w=_.easing(x+.01)-_.easing(x),S=.27/Math.sqrt(w*w+1e-4)*.01,P=Math.sqrt(.0729-S*S);f=s.bezier(S,P,.25,1)}return this._prevEase={start:s.exported.now(),duration:l,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=R("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class vm{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class el{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,f){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(l.shiftKey?-1:1),around:_.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qs{constructor(){this._tap=new Ja({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,f,_){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=f[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(l,f,_))}touchmove(l,f,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=f[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,l.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(l,f,_)}touchend(l,f,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(l,f,_)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Su{constructor(l,f,_){this._el=l,this._mousePan=f,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gt{constructor(l,f,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xm{constructor(l,f,_,x){this._el=l,this._touchZoom=f,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ic=m=>m.zoom||m.drag||m.pitch||m.rotate;class rc extends s.Event{}class sc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,f){const _=s.sub([],f,l);this.radius=s.length(_[2]<0?s.div([],_,this.constants):[_[0],_[1],0])}projectRay(l){s.div(l,l,this.constants),s.normalize(l,l),s.mul$1(l,l,this.constants);const f=s.scale$2([],l,this.radius);if(f[2]>0){const _=s.scale$2([],[0,0,1],s.dot(f,[0,0,1])),x=s.scale$2([],s.normalize([],[f[0],f[1],0]),this.radius),w=s.add([],f,s.scale$2([],s.sub([],s.add([],x,_),f),2));f[0]=w[0],f[1]=w[1]}return f}}function oc(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class bm{constructor(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vu(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new sc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),s.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[x,w,S]of this._listeners)x.addEventListener(w,x===s.window.document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[l,f,_]of this._listeners)l.removeEventListener(f,l===s.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(l){const f=this._map,_=f.getCanvasContainer();this._add("mapEvent",new um(f,l));const x=f.boxZoom=new Tf(f,l);this._add("boxZoom",x);const w=new Af,S=new el;f.doubleClickZoom=new vm(S,w),this._add("tapZoom",w),this._add("clickZoom",S);const P=new Qs;this._add("tapDragZoom",P);const L=f.touchPitch=new Dr(f);this._add("touchPitch",L);const D=new Sf(l),z=new Mf(l);f.dragRotate=new Gt(l,D,z),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const V=new dm(l),q=new Qa(f,l);f.dragPan=new Su(_,V,q),this._add("mousePan",V),this._add("touchPan",q,["touchZoom","touchRotate"]);const ee=new gm,Q=new mm;f.touchZoomRotate=new xm(_,Q,ee,P),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new bu(f));const te=f.scrollZoom=new po(f,this);this._add("scrollZoom",te,["mousePan"]);const ie=f.keyboard=new _m;this._add("keyboard",ie);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[W]&&f[W].enable(l[W])}_add(l,f,_){this._handlers.push({handlerName:l,handler:f,allowed:_}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ic(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,f,_){for(const x in l)if(x!==_&&(!f||f.indexOf(x)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const f=[];for(const _ of l)this._el.contains(_.target)&&f.push(_);return f}handleEvent(l,f){this._updatingCamera=!0;const _=l.type==="renderFrame",x=_?void 0:l,w={needsRenderFrame:!1},S={},P={},L=l.touches?this._getMapTouches(l.touches):void 0,D=L?nt(this._el,L):_?void 0:ge(this._el,l);for(const{handlerName:q,handler:ee,allowed:Q}of this._handlers){if(!ee.isEnabled())continue;let te;this._blockedByActive(P,Q,q)?ee.reset():ee[f||l.type]&&(te=ee[f||l.type](l,D,L),this.mergeHandlerResult(w,S,te,q,x),te&&te.needsRenderFrame&&this._triggerRenderFrame()),(te||ee.isActive())&&(P[q]=ee)}const z={};for(const q in this._previousActiveHandlers)P[q]||(z[q]=x);this._previousActiveHandlers=P,(Object.keys(z).length||oc(w))&&(this._changes.push([w,S,z]),this._triggerRenderFrame()),(Object.keys(P).length||oc(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=w;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(l,f,_,x,w){if(!_)return;s.extend(l,_);const S={handlerName:x,originalEvent:_.originalEvent||w};_.zoomDelta!==void 0&&(f.zoom=S),_.panDelta!==void 0&&(f.drag=S),_.pitchDelta!==void 0&&(f.pitch=S),_.bearingDelta!==void 0&&(f.rotate=S)}_applyChanges(){const l={},f={},_={};for(const[x,w,S]of this._changes)x.panDelta&&(l.panDelta=(l.panDelta||new s.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(l.around=x.around),x.aroundCoord!==void 0&&(l.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(l.pinchAround=x.pinchAround),x.noInertia&&(l.noInertia=x.noInertia),s.extend(f,w),s.extend(_,S);this._updateMapTransform(l,f,_),this._changes=[]}_updateMapTransform(l,f,_){const x=this._map,w=x.transform,S=fe=>[fe.x,fe.y,fe.z];if((fe=>{const le=this._eventsInProgress.drag;return le&&!this._handlersById[le.handlerName].isActive()})()&&!oc(l)){const fe=w.zoom;w.cameraElevationReference="sea",w.recenterOnTerrain(),w.cameraElevationReference="ground",fe!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!oc(l))return void this._fireEvents(f,_,!0);let{panDelta:P,zoomDelta:L,bearingDelta:D,pitchDelta:z,around:V,aroundCoord:q,pinchAround:ee}=l;w._isCameraConstrained&&(L>0&&(L=0),w._isCameraConstrained=!1),ee!==void 0&&(V=ee),(L||(fe=>f.drag&&!this._eventsInProgress.drag)())&&V&&(this._dragOrigin=S(w.pointCoordinate3D(V)),this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),V=V||x.transform.centerPoint,D&&(w.bearing+=D),z&&(w.pitch+=z),w._updateCameraState();const Q=[0,0,0];if(P)if(w.projection.name==="mercator"){const fe=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(V).dir),le=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(V.sub(P)).dir);Q[0]=le[0]-fe[0],Q[1]=le[1]-fe[1]}else{const fe=w.pointCoordinate(V);if(w.projection.name==="globe"){P=P.rotate(-w.angle);const le=w._pixelsPerMercatorPixel/w.worldSize;Q[0]=-P.x*s.mercatorScale(s.latFromMercatorY(fe.y))*le,Q[1]=-P.y*s.mercatorScale(w.center.lat)*le}else{const le=w.pointCoordinate(V.sub(P));fe&&le&&(Q[0]=le.x-fe.x,Q[1]=le.y-fe.y)}}const te=w.zoom,ie=[0,0,0];if(L){const fe=S(q||w.pointCoordinate3D(V)),le={dir:s.normalize([],s.sub([],fe,w._camera.position))};if(le.dir[2]<0){const pe=w.zoomDeltaToMovement(fe,L);s.scale$2(ie,le.dir,pe)}}const W=s.add(Q,Q,ie);w._translateCameraConstrained(W),L&&Math.abs(w.zoom-te)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,_,!0)}_fireEvents(l,f,_){const x=ic(this._eventsInProgress),w=ic(l),S={};for(const z in l){const{originalEvent:V}=l[z];this._eventsInProgress[z]||(S[`${z}start`]=V),this._eventsInProgress[z]=l[z]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const z in S)this._fireEvent(z,S[z]);w&&this._fireEvent("move",w.originalEvent);for(const z in l){const{originalEvent:V}=l[z];this._fireEvent(z,V)}const P={};let L;for(const z in this._eventsInProgress){const{handlerName:V,originalEvent:q}=this._eventsInProgress[z];this._handlersById[V].isActive()||(delete this._eventsInProgress[z],L=f[V]||q,P[`${z}end`]=L)}for(const z in P)this._fireEvent(z,P[z]);const D=ic(this._eventsInProgress);if(_&&(x||w)&&!D){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;z?(V(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:L})):(this._map.fire(new s.Event("moveend",{originalEvent:L})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new s.Event(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new rc("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const If="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class wm extends s.Evented{constructor(l,f){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=f.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}panBy(l,f,_){return l=s.pointGeometry.convert(l).mult(-1),this.panTo(this.transform.center,s.extend({offset:l},f),_)}panTo(l,f,_){return this.easeTo(s.extend({center:l},f),_)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,_){return this.easeTo(s.extend({zoom:l},f),_)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,_){return this.easeTo(s.extend({bearing:l},f),_)}resetNorth(l,f){return this.rotateTo(0,s.extend({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}cameraForBounds(l,f){l=s.LngLatBounds.convert(l);const _=f&&f.bearing||0,x=f&&f.pitch||0,w=l.getNorthWest(),S=l.getSouthEast();return this._cameraForBounds(this.transform,w,S,_,x,f)}_extendCameraOptions(l){const f={top:0,bottom:0,right:0,left:0};if(typeof(l=s.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const _=l.padding;l.padding={top:_,bottom:_,right:_,left:_}}return l.padding=s.extend(f,l.padding),l}_minimumAABBFrustumDistance(l,f){const _=f.max[0]-f.min[0],x=f.max[1]-f.min[1];return _/x>l.aspect?_/(2*Math.tan(.5*l.fovX)*l.aspect):x/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,f,_,x,w,S){const P=l.clone(),L=this._extendCameraOptions(S);P.bearing=x,P.pitch=w;const D=s.LngLat.convert(f),z=s.LngLat.convert(_),V=.5*(D.lat+z.lat),q=.5*(D.lng+z.lng),ee=s.latLngToECEF(V,q),Q=s.normalize([],ee),te=s.normalize([],s.cross([],Q,[0,1,0])),ie=s.cross([],te,Q),W=[te[0],te[1],te[2],0,ie[0],ie[1],ie[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],fe=[ee,s.latLngToECEF(D.lat,D.lng),s.latLngToECEF(z.lat,D.lng),s.latLngToECEF(z.lat,z.lng),s.latLngToECEF(D.lat,z.lng),s.latLngToECEF(V,D.lng),s.latLngToECEF(V,z.lng),s.latLngToECEF(D.lat,q),s.latLngToECEF(z.lat,q)];let le=s.Aabb.fromPoints(fe.map(ut=>[s.dot(te,ut),s.dot(ie,ut),s.dot(Q,ut)]));const pe=s.transformMat4([],le.center,W);s.squaredLength(pe)===0&&s.set(pe,0,0,1),s.normalize(pe,pe),s.scale$2(pe,pe,s.GLOBE_RADIUS),P.center=s.ecefToLatLng(pe);const Te=P.getWorldToCameraMatrix(),be=s.invert(new Float64Array(16),Te);le=s.Aabb.applyTransform(le,s.multiply([],Te,W)),s.transformMat4(pe,pe,Te);const Ce=.5*(le.max[2]-le.min[2]),Be=this._minimumAABBFrustumDistance(P,le),Ge=s.scale$2([],[0,0,1],Ce),We=s.add(Ge,pe,Ge),At=Be+(P.pitch===0?0:s.distance(pe,We)),Ue=P.globeCenterInViewSpace,rt=s.sub([],pe,[Ue[0],Ue[1],Ue[2]]);s.normalize(rt,rt),s.scale$2(rt,rt,At);const Ye=s.add([],pe,rt);s.transformMat4(Ye,Ye,be);const pt=s.earthRadius/s.GLOBE_RADIUS,$e=s.length(Ye),De=s.mercatorZfromAltitude(Math.max($e*pt-s.earthRadius,Number.EPSILON),0),qe=Math.min(P.zoomFromMercatorZAdjusted(De),L.maxZoom);return qe>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(P.setProjection({name:"mercator"}),P.zoom=qe,this._cameraForBounds(P,f,_,x,w,S)):{center:P.center,zoom:qe,bearing:x,pitch:w}}queryTerrainElevation(l,f){const _=this.transform.elevation;return _?(f=s.extend({},{exaggerated:!0},f),_.getAtPoint(s.MercatorCoordinate.fromLngLat(l),null,f.exaggerated)):null}_cameraForBounds(l,f,_,x,w,S){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,f,_,x,w,S);const P=l.clone(),L=this._extendCameraOptions(S),D=P.padding;P.bearing=x,P.pitch=w;const z=s.LngLat.convert(f),V=s.LngLat.convert(_),q=new s.LngLat(z.lng,V.lat),ee=new s.LngLat(V.lng,z.lat),Q=P.project(z),te=P.project(V),ie=this.queryTerrainElevation(z),W=this.queryTerrainElevation(V),fe=this.queryTerrainElevation(q),le=this.queryTerrainElevation(ee),pe=[[Q.x,Q.y,Math.min(ie||0,W||0,fe||0,le||0)],[te.x,te.y,Math.max(ie||0,W||0,fe||0,le||0)]];let Te=s.Aabb.fromPoints(pe);const be=P.getWorldToCameraMatrix(),Ce=s.invert(new Float64Array(16),be);Te=s.Aabb.applyTransform(Te,be);const Be=s.sub([],Te.max,Te.min),Ge=D.left||0,We=D.right||0,At=D.bottom||0,Ue=D.top||0,{left:rt,right:Ye,top:pt,bottom:$e}=L.padding,De=.5*(Ge+We),qe=.5*(Ue+At),ut=Math.min(P.scaleZoom(P.scale*Math.min((P.width-(Ge+We+rt+Ye))/Be[0],(P.height-(At+Ue+$e+pt))/Be[1])),L.maxZoom),_t=P.scale/P.zoomScale(ut);Te=new s.Aabb([Te.min[0]-(rt+De)*_t,Te.min[1]-($e+qe)*_t,Te.min[2]],[Te.max[0]+(Ye+De)*_t,Te.max[1]+(pt+qe)*_t,Te.max[2]]);const Qt=.5*Be[2],zn=this._minimumAABBFrustumDistance(P,Te),Ht=[0,0,1,0];s.transformMat4$1(Ht,Ht,be),s.normalize$2(Ht,Ht);const Ut=s.scale$2([],Ht,zn+Qt),rn=s.add([],Te.center,Ut),Vn=(typeof L.offset.x=="number"&&typeof L.offset.y=="number"?new s.pointGeometry(L.offset.x,L.offset.y):s.pointGeometry.convert(L.offset)).rotate(-s.degToRad(x));Te.center[0]-=Vn.x*_t,Te.center[1]+=Vn.y*_t,s.transformMat4(Te.center,Te.center,Ce),s.transformMat4(rn,rn,Ce);const hn=[Te.center[0],Te.center[1],rn[2]*P.pixelsPerMeter];s.scale$2(hn,hn,1/P.worldSize);const ci=s.lngFromMercatorX(hn[0]),mi=s.latFromMercatorY(hn[1]),Si=Math.min(P._zoomFromMercatorZ(hn[2]),L.maxZoom),wi=new s.LngLat(ci,mi);return P.mercatorFromTransition&&Si<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(P.setProjection({name:"globe"}),P.zoom=Si,this._cameraForBounds(P,f,_,x,w,S)):{center:wi,zoom:Si,bearing:x,pitch:w}}fitBounds(l,f,_){const x=this.cameraForBounds(l,f);return this._fitInternal(x,f,_)}fitScreenCoordinates(l,f,_,x,w){const S=s.pointGeometry.convert(l),P=s.pointGeometry.convert(f),L=new s.pointGeometry(Math.min(S.x,P.x),Math.min(S.y,P.y)),D=new s.pointGeometry(Math.max(S.x,P.x),Math.max(S.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,P))return this;const z=this.transform.pointLocation3D(L),V=this.transform.pointLocation3D(D),q=this.transform.pointLocation3D(new s.pointGeometry(L.x,D.y)),ee=this.transform.pointLocation3D(new s.pointGeometry(D.x,L.y)),Q=[Math.min(z.lng,V.lng,q.lng,ee.lng),Math.min(z.lat,V.lat,q.lat,ee.lat)],te=[Math.max(z.lng,V.lng,q.lng,ee.lng),Math.max(z.lat,V.lat,q.lat,ee.lat)],ie=x&&x.pitch?x.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,Q,te,_,ie,x);return this._fitInternal(W,x,w)}_fitInternal(l,f,_){return l?(delete(f=s.extend(l,f)).padding,f.linear?this.easeTo(f,_):this.flyTo(f,_)):this}jumpTo(l,f){this.stop();const _=l.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,S=!1;return"zoom"in l&&_.zoom!==+l.zoom&&(x=!0,_.zoom=+l.zoom),l.center!==void 0&&(_.center=s.LngLat.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(w=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(S=!0,_.pitch=+l.pitch),l.padding==null||_.isPaddingEqual(l.padding)||(_.padding=l.padding),l.preloadOnly?(this._preloadTiles(_),this):(this.fire(new s.Event("movestart",f)).fire(new s.Event("move",f)),x&&this.fire(new s.Event("zoomstart",f)).fire(new s.Event("zoom",f)).fire(new s.Event("zoomend",f)),w&&this.fire(new s.Event("rotatestart",f)).fire(new s.Event("rotate",f)).fire(new s.Event("rotateend",f)),S&&this.fire(new s.Event("pitchstart",f)).fire(new s.Event("pitch",f)).fire(new s.Event("pitchend",f)),this.fire(new s.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(If),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,f){const _=this.transform;if(!_.projection.supportsFreeCamera)return s.warnOnce(If),this;this.stop();const x=_.zoom,w=_.pitch,S=_.bearing;_.setFreeCameraOptions(l);const P=x!==_.zoom,L=w!==_.pitch,D=S!==_.bearing;return this.fire(new s.Event("movestart",f)).fire(new s.Event("move",f)),P&&this.fire(new s.Event("zoomstart",f)).fire(new s.Event("zoom",f)).fire(new s.Event("zoomend",f)),D&&this.fire(new s.Event("rotatestart",f)).fire(new s.Event("rotate",f)).fire(new s.Event("rotateend",f)),L&&this.fire(new s.Event("pitchstart",f)).fire(new s.Event("pitch",f)).fire(new s.Event("pitchend",f)),this.fire(new s.Event("moveend",f)),this}easeTo(l,f){this._stop(!1,l.easeId),((l=s.extend({offset:[0,0],duration:500,easing:s.ease},l)).animate===!1||!l.essential&&s.exported.prefersReducedMotion)&&(l.duration=0);const _=this.transform,x=this.getZoom(),w=this.getBearing(),S=this.getPitch(),P=this.getPadding(),L="zoom"in l?+l.zoom:x,D="bearing"in l?this._normalizeBearing(l.bearing,w):w,z="pitch"in l?+l.pitch:S,V="padding"in l?l.padding:_.padding,q=s.pointGeometry.convert(l.offset);let ee,Q,te;if(_.projection.name==="globe"){const Ge=s.MercatorCoordinate.fromLngLat(_.center),We=q.rotate(-_.angle);Ge.x+=We.x/_.worldSize,Ge.y+=We.y/_.worldSize;const At=Ge.toLngLat(),Ue=s.LngLat.convert(l.center||At);this._normalizeCenter(Ue),ee=_.centerPoint.add(We),Q=new s.pointGeometry(Ge.x,Ge.y).mult(_.worldSize),te=new s.pointGeometry(s.mercatorXfromLng(Ue.lng),s.mercatorYfromLat(Ue.lat)).mult(_.worldSize).sub(Q)}else{ee=_.centerPoint.add(q);const Ge=_.pointLocation(ee),We=s.LngLat.convert(l.center||Ge);this._normalizeCenter(We),Q=_.project(Ge),te=_.project(We).sub(Q)}const ie=_.zoomScale(L-x);let W,fe;l.around&&(W=s.LngLat.convert(l.around),fe=_.locationPoint(W));const le=this._zooming||L!==x,pe=this._rotating||w!==D,Te=this._pitching||z!==S,be=!_.isPaddingEqual(V),Ce=Ge=>We=>{if(le&&(Ge.zoom=s.number(x,L,We)),pe&&(Ge.bearing=s.number(w,D,We)),Te&&(Ge.pitch=s.number(S,z,We)),be&&(Ge.interpolatePadding(P,V,We),ee=Ge.centerPoint.add(q)),W)Ge.setLocationAtPoint(W,fe);else{const At=Ge.zoomScale(Ge.zoom-x),Ue=L>x?Math.min(2,ie):Math.max(.5,ie),rt=Math.pow(Ue,1-We),Ye=Ge.unproject(Q.add(te.mult(We*rt)).mult(At));Ge.setLocationAtPoint(Ge.renderWorldCopies?Ye.wrap():Ye,ee)}return l.preloadOnly||this._fireMoveEvents(f),Ge};if(l.preloadOnly){const Ge=this._emulate(Ce,l.duration,_);return this._preloadTiles(Ge),this}const Be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=le,this._rotating=pe,this._pitching=Te,this._padding=be,this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,Be),this._ease(Ce(_),Ge=>{_.recenterOnTerrain(),this._afterEase(f,Ge)},l),this}_prepareEase(l,f,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||_.moving||this.fire(new s.Event("movestart",l)),this._zooming&&!_.zooming&&this.fire(new s.Event("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new s.Event("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new s.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new s.Event("move",l)),this._zooming&&this.fire(new s.Event("zoom",l)),this._rotating&&this.fire(new s.Event("rotate",l)),this._pitching&&this.fire(new s.Event("pitch",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new s.Event("zoomend",l)),x&&this.fire(new s.Event("rotateend",l)),w&&this.fire(new s.Event("pitchend",l)),this.fire(new s.Event("moveend",l))}flyTo(l,f){if(!l.essential&&s.exported.prefersReducedMotion){const ut=s.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ut,f)}this.stop(),l=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},l);const _=this.transform,x=this.getZoom(),w=this.getBearing(),S=this.getPitch(),P=this.getPadding(),L="zoom"in l?s.clamp(+l.zoom,_.minZoom,_.maxZoom):x,D="bearing"in l?this._normalizeBearing(l.bearing,w):w,z="pitch"in l?+l.pitch:S,V="padding"in l?l.padding:_.padding,q=_.zoomScale(L-x),ee=s.pointGeometry.convert(l.offset);let Q=_.centerPoint.add(ee);const te=_.pointLocation(Q),ie=s.LngLat.convert(l.center||te);this._normalizeCenter(ie);const W=_.project(te),fe=_.project(ie).sub(W);let le=l.curve;const pe=Math.max(_.width,_.height),Te=pe/q,be=fe.mag();if("minZoom"in l){const ut=s.clamp(Math.min(l.minZoom,x,L),_.minZoom,_.maxZoom),_t=pe/_.zoomScale(ut-x);le=Math.sqrt(_t/be*2)}const Ce=le*le;function Be(ut){const _t=(Te*Te-pe*pe+(ut?-1:1)*Ce*Ce*be*be)/(2*(ut?Te:pe)*Ce*be);return Math.log(Math.sqrt(_t*_t+1)-_t)}function Ge(ut){return(Math.exp(ut)-Math.exp(-ut))/2}function We(ut){return(Math.exp(ut)+Math.exp(-ut))/2}const At=Be(0);let Ue=function(ut){return We(At)/We(At+le*ut)},rt=function(ut){return pe*((We(At)*(Ge(_t=At+le*ut)/We(_t))-Ge(At))/Ce)/be;var _t},Ye=(Be(1)-At)/le;if(Math.abs(be)<1e-6||!isFinite(Ye)){if(Math.abs(pe-Te)<1e-6)return this.easeTo(l,f);const ut=Te<pe?-1:1;Ye=Math.abs(Math.log(Te/pe))/le,rt=function(){return 0},Ue=function(_t){return Math.exp(ut*le*_t)}}l.duration="duration"in l?+l.duration:1e3*Ye/("screenSpeed"in l?+l.screenSpeed/le:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const pt=w!==D,$e=z!==S,De=!_.isPaddingEqual(V),qe=ut=>_t=>{const Qt=_t*Ye,zn=1/Ue(Qt);ut.zoom=_t===1?L:x+ut.scaleZoom(zn),pt&&(ut.bearing=s.number(w,D,_t)),$e&&(ut.pitch=s.number(S,z,_t)),De&&(ut.interpolatePadding(P,V,_t),Q=ut.centerPoint.add(ee));const Ht=_t===1?ie:ut.unproject(W.add(fe.mult(rt(Qt))).mult(zn));return ut.setLocationAtPoint(ut.renderWorldCopies?Ht.wrap():Ht,Q),ut._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(f),ut};if(l.preloadOnly){const ut=this._emulate(qe,l.duration,_);return this._preloadTiles(ut),this}return this._zooming=!0,this._rotating=pt,this._pitching=$e,this._padding=De,this._prepareEase(f,!1),this._ease(qe(_),()=>this._afterEase(f),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,f)}if(!l){const _=this.handlers;_&&_.stop(!1)}return this}_ease(l,f,_){_.animate===!1||_.duration===0?(l(1),f()):(this._easeStart=s.exported.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,f){l=s.wrap(l,-180,180);const _=Math.abs(l-f);return Math.abs(l-360-f)<_&&(l-=360),Math.abs(l+360-f)<_&&(l+=360),l}_normalizeCenter(l){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const _=l.lng-f.center.lng;l.lng+=_>180?-360:_<-180?360:0}_emulate(l,f,_){const x=Math.ceil(15*f/1e3),w=[],S=l(_.clone());for(let P=0;P<=x;P++){const L=S(P/x);w.push(L.clone())}return w}}class Cf{constructor(l={}){this.options=l,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const f=this.options&&this.options.compact;return this._map=l,this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=R("button","mapboxgl-ctrl-attrib-button",this._container),R("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,f){const _=this._map._getUIString(`AttributionControl.${f}`);l.setAttribute("aria-label",_),l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(l){const _=f.reduce((x,w,S)=>(w.value&&(x+=`${w.key}=${w.value}${S<f.length-1?"&":""}`),x),"?");l.href=`${s.config.FEEDBACK_URL}/${_}#${wf(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const f=this._map.style._sourceCaches;for(const x in f){const w=f[x];if(w.used){const S=w.getSource();S.attribution&&l.indexOf(S.attribution)<0&&l.push(S.attribution)}}l.sort((x,w)=>x.length-w.length),l=l.filter((x,w)=>{for(let S=w+1;S<l.length;S++)if(l[S].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Lf{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=R("div","mapboxgl-ctrl");const f=R("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const f in l){const _=l[f].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class ac{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,_=f?this._queue.concat(f):this._queue;for(const x of _)if(x.id===l)return void(x.cancelled=!0)}run(l=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const _ of f)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Mu(m,l,f){if(m=new s.LngLat(m.lng,m.lat),l){const _=new s.LngLat(m.lng-360,m.lat),x=new s.LngLat(m.lng+360,m.lat),w=360*Math.ceil(Math.abs(m.lng-f.center.lng)/360),S=f.locationPoint(m).distSqr(l),P=l.x<0||l.y<0||l.x>f.width||l.y>f.height;f.locationPoint(_).distSqr(l)<S&&(P||Math.abs(_.lng-f.center.lng)<w)?m=_:f.locationPoint(x).distSqr(l)<S&&(P||Math.abs(x.lng-f.center.lng)<w)&&(m=x)}for(;Math.abs(m.lng-f.center.lng)>180;){const _=f.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=f.width&&_.y<=f.height)break;m.lng>f.center.lng?m.lng-=360:m.lng+=360}return m}const tl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Pu extends s.Evented{constructor(l,f){if(super(),(l instanceof s.window.HTMLElement||f)&&(l=s.extend({element:l},f)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=s.pointGeometry.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=R("div");const x=41,w=27,S=N("svg",{display:"block",height:x*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${x}`},this._element),P=N("radialGradient",{id:"shadowGradient"},N("defs",{},S));N("stop",{offset:"10%","stop-opacity":.4},P),N("stop",{offset:"100%","stop-opacity":.05},P),N("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),N("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),N("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),N("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=s.pointGeometry.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const _=this._element.classList;for(const x in tl)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const f=l.code,_=l.charCode||l.keyCode;f!=="Space"&&f!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(l){const f=l.originalEvent.target,_=this._element;this._popup&&(f===_||_.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,f=this._pos;if(!l||!f)return!1;const _=l.unproject(f),x=l.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(_)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const f=this._pos;if(!f||f.x<0||f.x>l.transform.width||f.y<0||f.y>l.transform.height)return void this._clearFadeTimer();const _=l.unproject(f);let x;l._showingGlobe()&&s.isLngLatBehindGlobe(l.transform,this._lngLat)?x=0:(x=1-l._queryFogOpacity(_),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${tl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const l=this._pos,f=this._map,_=this.getPitchAlignment();if(!f||!l||_!=="map")return"";if(!f._showingGlobe()){const L=f.getPitch();return L?`rotateX(${L}deg)`:""}const x=s.radToDeg(s.globeTiltAtLngLat(f.transform,this._lngLat)),w=l.sub(s.globeCenterToScreenPoint(f.transform)),S=Math.abs(w.x)+Math.abs(w.y);if(S===0)return"";const P=x/S;return`rotateX(${-w.y*P}deg) rotateY(${w.x*P}deg)`}_calculateZTransform(){const l=this._pos,f=this._map;if(!f||!l)return"";let _=0;const x=this.getRotationAlignment();if(x==="map")if(f._showingGlobe()){const w=f.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),S=f.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);_=s.radToDeg(Math.atan2(S.y,S.x))-90}else _=-f.getBearing();else if(x==="horizon"){const w=s.smoothstep(4,6,f.getZoom()),S=s.globeCenterToScreenPoint(f.transform);S.y+=w*f.transform.height;const P=l.sub(S),L=s.radToDeg(Math.atan2(P.y,P.x));_=(L>90?L-270:L+90)*(1-w)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(l){s.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=Mu(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),l===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=s.pointGeometry.convert(l),this._update(),this}_onMove(l){const f=this._map;if(!f)return;const _=this._pointerdownPos,x=this._positionDelta;if(_&&x){if(!this._isDragging){const w=this._clickTolerance||f._clickTolerance;if(l.point.dist(_)<w)return;this._isDragging=!0}this._pos=l.point.sub(x),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(l){const f=this._map,_=this._pos;f&&_&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(_),this._pointerdownPos=l.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const f=this._map;return f&&(l?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Em={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Tm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function kf(m=new s.pointGeometry(0,0),l="bottom"){if(typeof m=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(l){case"top":return new s.pointGeometry(0,m);case"top-left":return new s.pointGeometry(f,f);case"top-right":return new s.pointGeometry(-f,f);case"bottom":return new s.pointGeometry(0,-m);case"bottom-left":return new s.pointGeometry(f,-f);case"bottom-right":return new s.pointGeometry(-f,-f);case"left":return new s.pointGeometry(m,0);case"right":return new s.pointGeometry(-m,0)}return new s.pointGeometry(0,0)}return m instanceof s.pointGeometry||Array.isArray(m)?s.pointGeometry.convert(m):s.pointGeometry.convert(m[l]||[0,0])}class Am{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const f=s.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,f,_){this._start=this.getValue(f),this._end=l,this._startTime=f,this._endTime=f+_}}const Sm={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Mm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Rf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Pm{constructor(l,f,_=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new Sf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,_&&(this.mousePitch=new Mf({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),me()}move(l,f){const _=this.map,x=this.mouseRotate.mousemoveWindow(l,f),w=x&&x.bearingDelta;if(w&&_.setBearing(_.getBearing()+w),this.mousePitch){const S=this.mousePitch.mousemoveWindow(l,f),P=S&&S.pitchDelta;P&&_.setPitch(_.getPitch()+P)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){we(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(s.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),ge(this.element,l)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,ge(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=nt(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=nt(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Im={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Cm={maxWidth:100,unit:"metric"};function Lm(m,l,f){const _=Iu(l),x=_/l,w={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[f];this._map._requestDomTask(()=>{this._container.style.width=m*x+"px",this._container.innerHTML=`${_}&nbsp;${w}`})}function Iu(m){const l=Math.pow(10,`${Math.floor(m)}`.length-1);let f=m/l;return f=f>=10?10:f>=5?5:f>=3?3:f>=2?2:f>=1?1:function(_){const x=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*x)/x}(f),l*f}const lc={version:s.version,supported:E,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends wm{constructor(m){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(m=s.extend({},Mm,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(m.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Nt(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._useWebGL2=m.useWebGL2,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new ac,this._domRenderTaskQueue=new ac,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Sm,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Am(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,typeof m.container=="string"){if(this._container=s.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new bm(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new lm(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,s.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Cf({customAttribution:m.customAttribution})),this._logoControl=new Lf,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new s.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new s.Event(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(m,l){if(l===void 0&&(l=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=m.onAdd(this);this._controls.push(m);const _=this._controlPositions[l];return l.indexOf("bottom")!==-1?_.insertBefore(f,_.firstChild):_.appendChild(f),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(m);return l>-1&&this._controls.splice(l,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new s.Event("movestart",m)).fire(new s.Event("move",m)),this.fire(new s.Event("resize",m)),l&&this.fire(new s.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(s.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?s.window.navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(l=>l==="auto"?s.window.navigator.language:l):m}setLanguage(m){const l=this._parseLanguage(m);if(!this.style||l===this._language)return this;this._language=l,this.style._reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,l=m.projection.name;let f;l==="globe"&&m.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(m.setMercatorFromTransition(),f=!0):l==="mercator"&&m.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(m.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,l){return this._updateProjection(m||l||{name:"mercator"})}_updateProjection(m){let l;if(l=m.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),l){this.painter.clearBackgroundTiles();for(const f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(m){return this.transform.locationPoint3D(s.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(s.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,l,f){if(m==="mouseenter"||m==="mouseover"){let _=!1;const x=S=>{const P=l.filter(D=>this.getLayer(D)),L=P.length?this.queryRenderedFeatures(S.point,{layers:P}):[];L.length?_||(_=!0,f.call(this,new xr(m,this,S.originalEvent,{features:L}))):_=!1},w=()=>{_=!1};return{layers:new Set(l),listener:f,delegates:{mousemove:x,mouseout:w}}}if(m==="mouseleave"||m==="mouseout"){let _=!1;const x=S=>{const P=l.filter(L=>this.getLayer(L));(P.length?this.queryRenderedFeatures(S.point,{layers:P}):[]).length?_=!0:_&&(_=!1,f.call(this,new xr(m,this,S.originalEvent)))},w=S=>{_&&(_=!1,f.call(this,new xr(m,this,S.originalEvent)))};return{layers:new Set(l),listener:f,delegates:{mousemove:x,mouseout:w}}}{const _=x=>{const w=l.filter(P=>this.getLayer(P)),S=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];S.length&&(x.features=S,f.call(this,x),delete x.features)};return{layers:new Set(l),listener:f,delegates:{[m]:_}}}}on(m,l,f){if(f===void 0)return super.on(m,l);Array.isArray(l)||(l=[l]);const _=this._createDelegatedListener(m,l,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(m,l,f){if(f===void 0)return super.once(m,l);Array.isArray(l)||(l=[l]);const _=this._createDelegatedListener(m,l,f);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(m,l,f){if(f===void 0)return super.off(m,l);l=new Set(Array.isArray(l)?l:[l]);const _=(w,S)=>{if(w.size!==S.size)return!1;for(const P of w)if(!S.has(P))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[m]:void 0;return x&&(w=>{for(let S=0;S<w.length;S++){const P=w[S];if(P.listener===f&&_(P.layers,l)){for(const L in P.delegates)this.off(L,P.delegates[L]);return w.splice(S,1),this}}})(x),this}queryRenderedFeatures(m,l){return this.style?(l!==void 0||m===void 0||m instanceof s.pointGeometry||Array.isArray(m)||(l=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(m,l){return this.style.querySourceFeatures(m,l)}setStyle(m,l){return(l=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(m,l))}_getUIString(m){const l=this._locale[m];if(l==null)throw new Error(`Missing UI string '${m}'`);return l}_updateStyle(m,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new vs(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new vs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,l){if(typeof m=="string"){const f=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(f,s.ResourceType.Style);s.getJSON(_,(x,w)=>{x?this.fire(new s.ErrorEvent(x)):w&&this._updateDiff(w,l)})}else typeof m=="object"&&this._updateDiff(m,l)}_updateDiff(m,l){try{this.style.setState(m)&&this._update(!0)}catch(f){s.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(m,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(m,l){return this._lazyInitEmptyStyle(),this.style.addSource(m,l),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const l in m){const f=m[l]._tiles;for(const _ in f){const x=f[_];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(m,l,f){this._lazyInitEmptyStyle(),this.style.addSourceType(m,l,f)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,l,{pixelRatio:f=1,sdf:_=!1,stretchX:x,stretchY:w,content:S}={}){if(this._lazyInitEmptyStyle(),l instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&l instanceof s.window.ImageBitmap){const{width:P,height:L,data:D}=s.exported.getImageData(l);this.style.addImage(m,{data:new s.RGBAImage({width:P,height:L},D),pixelRatio:f,stretchX:x,stretchY:w,content:S,sdf:_,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:P,height:L}=l,D=l;this.style.addImage(m,{data:new s.RGBAImage({width:P,height:L},new Uint8Array(D.data)),pixelRatio:f,stretchX:x,stretchY:w,content:S,sdf:_,version:0,userImage:D}),D.onAdd&&D.onAdd(this,m)}}updateImage(m,l){const f=this.style.getImage(m);if(!f)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=l instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&l instanceof s.window.ImageBitmap?s.exported.getImageData(l):l,{width:x,height:w}=_;x!==void 0&&w!==void 0?x===f.data.width&&w===f.data.height?(f.data.replace(_.data,!(l instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&l instanceof s.window.ImageBitmap)),this.style.updateImage(m,f)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,l){s.getImage(this._requestManager.transformRequest(m,s.ResourceType.Image),(f,_)=>{l(f,_ instanceof s.window.HTMLImageElement?s.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,l){return this._lazyInitEmptyStyle(),this.style.addLayer(m,l),this._update(!0)}moveLayer(m,l){return this.style.moveLayer(m,l),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,l,f){return this.style.setLayerZoomRange(m,l,f),this._update(!0)}setFilter(m,l,f={}){return this.style.setFilter(m,l,f),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,l,f,_={}){return this.style.setPaintProperty(m,l,f,_),this._update(!0)}getPaintProperty(m,l){return this.style.getPaintProperty(m,l)}setLayoutProperty(m,l,f,_={}){return this.style.setLayoutProperty(m,l,f,_),this._update(!0)}getLayoutProperty(m,l){return this.style.getLayoutProperty(m,l)}setLight(m,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(m),this.transform):0}setFeatureState(m,l){return this.style.setFeatureState(m,l),this._update()}removeFeatureState(m,l){return this.style.removeFeatureState(m,l),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let f,_,x,w=this._container;for(;w&&(!_||!x);){const S=s.window.getComputedStyle(w).transform;S&&S!=="none"&&(f=S.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(_=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(x=f[3])),w=w.parentElement}this._containerWidth=_?Math.abs(m/_):m,this._containerHeight=x?Math.abs(l/x):l}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=R("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=R("div","mapboxgl-canvas-container",m);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=R("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=R("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=R("div",`mapboxgl-ctrl-${x}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,l){const f=s.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(m),this._canvas.height=f*Math.ceil(l),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${l}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const l=this._markers.indexOf(m);l!==-1&&this._markers.splice(l,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const l=this._popups.indexOf(m);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const m=s.extend({},E.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._useWebGL2&&this._canvas.getContext("webgl2",m),f=l||this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);f?(this._useWebGL2&&!l&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(f,!0),this.painter=new Yl(f,this.transform,!!l),this.on("data",_=>{_.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(f)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let l;const f=this.painter.context.extTimerQuery,_=s.exported.now();if(this.listens("gpu-timing-frame")&&(l=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,L=this.transform.pitch,D=s.exported.now(),z=new s.EvaluationParameters(P,{now:D,fadeDuration:x,pitch:L,transition:this.style.getTransition()});this.style.update(z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const P=s.exported.now()-_;f.endQueryEXT(f.TIME_ELAPSED_EXT,l),setTimeout(()=>{const L=f.getQueryObjectEXT(l,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(l),this.fire(new s.Event("gpu-timing-frame",{cpuTime:P,gpuTime:L})),s.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:L}})},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(P);this.fire(new s.Event("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(P);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:L}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(S||this._repaint)this.triggerRepaint();else{const P=!this.isMoving()&&this.loaded();if(P&&(w=this._updateAverageElevation(_,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const l of this._markers)m&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!m||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(m,l=!1){const f=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);if((l||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),w=!1;this.transform.elevation&&(w=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=m;const S=Math.abs(_-x);if(S>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(x),f(x);this._averageElevation.easeTo(x,m,300)}else if(S>1e-4)return this._averageElevation.jumpTo(x),f(x)}return!!this._averageElevation.isEasing(m)&&f(this._averageElevation.getValue(m))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===s.AUTH_ERR_MSG||m.status===401)){const l=this.painter.context.gl;s.storeAuthState(l,!1),this._logoControl instanceof Lf&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const f=this.painter.context.gl,_=f.createFramebuffer();function x(w){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,w,0);const S=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,S),S}return f.bindFramebuffer(f.FRAMEBUFFER,_),this._canvasPixelComparison(x(m),l.canvasCopies.map(x),l.timeStamps)}_canvasPixelComparison(m,l,f){let _=f[1]-f[0];const x=m.length/4;for(let w=0;w<l.length;w++){const S=l[w];let P=0;for(let L=0;L<S.length;L+=4)S[L]===m[L]&&S[L+1]===m[L+1]&&S[L+2]===m[L+2]&&S[L+3]===m[L+3]&&(P+=1);_+=(f[w+2]-f[w+1])*(1-P/x)}return _}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=s.exported.frame(l=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(l)}))}_preloadTiles(m){const l=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(l,(f,_)=>f._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,l){s.setCacheLimits(m,l)}get version(){return s.version}},NavigationControl:class{constructor(m){this.options=s.extend({},Rf,m),this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),R("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),R("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:l}):f.resetNorth({},{originalEvent:l}))}),this._compassIcon=R("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const l=m.getZoom(),f=l===m.getMaxZoom(),_=l===m.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pm(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,l){const f=R("button",m,this._container);return f.type="button",f.addEventListener("click",l),f}_setButtonTitle(m,l){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${l}`);m.setAttribute("aria-label",f),m.firstElementChild&&m.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends s.Evented{constructor(m){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},Im,m),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=xs(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const l=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,m(f)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(f=>l(f.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(m){const l=this._map.getMaxBounds(),f=m.coords;return!!l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",m)),this._finish()}}_updateCamera(m){const l=new s.LngLat(m.coords.longitude,m.coords.latitude),f=m.coords.accuracy,_=this._map.getBearing(),x=s.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(f),x,{geolocateSource:!0})}_updateMarker(m){if(m){const l=new s.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,l=s.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,f=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=R("button","mapboxgl-ctrl-geolocate",this._container),R("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R("div","mapboxgl-user-location"),this._dotElement.appendChild(R("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(R("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Pu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=R("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Cf,ScaleControl:class{constructor(m){this.options=s.extend({},Cm,m),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Lm.bind(this)),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,l=this._map,f=l._containerHeight/2,_=l._containerWidth/2-m/2,x=l.unproject([_,f]),w=l.unproject([_+m,f]),S=x.distanceTo(w);if(this.options.unit==="imperial"){const P=3.2808*S;P>5280?this._setScale(m,P/5280,"mile"):this._setScale(m,P,"foot")}else this.options.unit==="nautical"?this._setScale(m,S/1852,"nautical-mile"):S>=1e3?this._setScale(m,S/1e3,"kilometer"):this._setScale(m,S,"meter")}_setScale(m,l,f){const _=Iu(l),x=_/l;this._map._requestDomTask(()=>{this._container.style.width=m*x+"px",this._container.innerHTML=f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:f}).format(_):`${_}&nbsp;nm`})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof s.window.HTMLElement?this._container=m.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=R("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=R("button","mapboxgl-ctrl-fullscreen",this._controlContainer);R("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(m){super(),this.options=s.extend(Object.create(Em),m),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=s.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(s.window.document.createTextNode(m))}setHTML(m){const l=s.window.document.createDocumentFragment(),f=s.window.document.createElement("body");let _;for(f.innerHTML=m;_=f.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=R("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(m),this.options.closeButton){const f=this._closeButton=R("button","mapboxgl-popup-close-button",l);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let l;return this._classList.delete(m)?l=!1:(this._classList.add(m),l=!0),this._updateClassList(),l}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const l=this._map,f=this._container,_=this._pos;if(!l||!f||!_)return"bottom";const x=f.offsetWidth,w=f.offsetHeight,S=_.x<x/2,P=_.x>l.transform.width-x/2;if(_.y+m<w)return S?"top-left":P?"top-right":"top";if(_.y>l.transform.height-w){if(S)return"bottom-left";if(P)return"bottom-right"}return S?"left":P?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),m.className=l.join(" ")}_update(m){const l=this._map,f=this._content;if(!l||!this._lngLat&&!this._trackPointer||!f)return;let _=this._container;if(_||(_=this._container=R("div","mapboxgl-popup",l.getContainer()),this._tip=R("div","mapboxgl-popup-tip",_),_.appendChild(f)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Mu(this._lngLat,this._pos,l.transform)),!this._trackPointer||m){const x=this._pos=this._trackPointer&&m?m:l.project(this._lngLat),w=kf(this.options.offset),S=this._anchor=this._getAnchor(w.y),P=kf(this.options.offset,S),L=x.add(P).round();l._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${tl[S]} translate(${L.x}px,${L.y}px)`)})}if(!this._marker&&l._showingGlobe()){const x=s.isLngLatBehindGlobe(l.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Tm);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Pu,Style:vs,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:gu,Evented:s.Evented,config:s.config,prewarm:function(){cn().acquire(Kt)},clearPrewarmedResources:function(){const m=Wt;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Kt),Wt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(m){s.config.ACCESS_TOKEN=m},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(m){s.config.API_URL=m},get workerCount(){return Yt.workerCount},set workerCount(m){Yt.workerCount=m},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){s.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){s.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return lc});var p=c;return p})})(pb);const QI=pb.exports,uN=t=>t,lA=ap(hr),vv=t=>({center:{lng:t.longitude,lat:t.latitude},bearing:t.bearing,pitch:t.pitch,zoom:t.zoom}),hN=t=>({longitude:t.center.lng,latitude:t.center.lat,bearing:t.bearing,pitch:t.pitch,zoom:t.zoom});function fN(t,e){const n={instance:hy(null)},r=()=>{const h=n.instance;h.value||(h.value=new t)},c=()=>{const h=n.instance;h.value&&(h.value=null)};return qc(r),Kc(c),n}function dN(t){const e={instance:hy(null),props:D1(t),viewState:{get value(){const v=e.instance?.value;if(v){const E={center:v.getCenter(),bearing:v.getBearing(),pitch:v.getPitch(),zoom:v.getZoom()};return hN(E)}},set value(v){const E=e.instance?.value;if(E){const M=vv(v);E.jumpTo(M)}}}};let n;const r=v=>v.controls.map(E=>hr(E.instance)).filter(uN),c=v=>v.on,h=v=>{const E=e.instance;if(!E.value){const M=Object.assign(lA(v),vv(v.viewState));E.value=new QI.Map(M);for(const I of r(M))E.value.addControl(I);for(const[I,R]of Object.entries(c(M)))E.value.on(I,R);n=M}},p=v=>{const E=e.instance;if(E.value){let M=lA(v);n.style!==M.style&&E.value.setStyle(M.style),n.projection!==M.projection&&E.value.setProjection(M.projection),n.viewState!==M.viewState&&E.value.jumpTo(vv(M.viewState)),n=M}},s=()=>{const v=e.instance;v.value&&(v.value.remove(),v.value=null)};return qc(()=>h(e.props)),Kc(s),nr(e.props,p),e}QI.accessToken="pk.eyJ1Ijoic3VyZW5kcmEyOSIsImEiOiJjbG82eG43dDMwMGd1MmtwZDc1aWwwOWMyIn0.731Ly7_uC9yBDcQ-_DPtjQ";function lp(t){return lp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lp(t)}function pN(t,e){if(lp(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(lp(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function mN(t){var e=pN(t,"string");return lp(e)==="symbol"?e:String(e)}function Y(t,e,n){return e=mN(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function z_(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const mb=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),cA=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);cA&&parseFloat(cA[1]);const gN="3.2.12";function Oa(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const s_=typeof process!="object"||String(process)!=="[object process]"||process.browser,_N=typeof window<"u"&&typeof window.orientation<"u",uA=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);uA&&parseFloat(uA[1]);class yN{constructor(e,n){Y(this,"name",void 0),Y(this,"workerThread",void 0),Y(this,"isRunning",!0),Y(this,"result",void 0),Y(this,"_resolve",()=>{}),Y(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((r,c)=>{this._resolve=r,this._reject=c})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Oa(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Oa(this.isRunning),this.isRunning=!1,this._reject(e)}}class xv{}const bv=new Map;function vN(t){Oa(t.source&&!t.url||!t.source&&t.url);let e=bv.get(t.source||t.url);return e||(t.url&&(e=xN(t.url),bv.set(t.url,e)),t.source&&(e=eC(t.source),bv.set(t.source,e))),Oa(e),e}function xN(t){if(!t.startsWith("http"))return t;const e=bN(t);return eC(e)}function eC(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function bN(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function tC(t,e=!0,n){const r=n||new Set;if(t){if(hA(t))r.add(t);else if(hA(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const c in t)tC(t[c],e,r)}}return n===void 0?Array.from(r):[]}function hA(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const wv=()=>{};class Ux{static isSupported(){return typeof Worker<"u"&&s_||typeof xv<"u"&&!s_}constructor(e){Y(this,"name",void 0),Y(this,"source",void 0),Y(this,"url",void 0),Y(this,"terminated",!1),Y(this,"worker",void 0),Y(this,"onMessage",void 0),Y(this,"onError",void 0),Y(this,"_loadableURL","");const{name:n,source:r,url:c}=e;Oa(r||c),this.name=n,this.source=r,this.url=c,this.onMessage=wv,this.onError=h=>console.log(h),this.worker=s_?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=wv,this.onError=wv,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,n){n=n||tC(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=vN({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new xv(r,{eval:!1})}else if(this.source)e=new xv(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class wN{static isSupported(){return Ux.isSupported()}constructor(e){Y(this,"name","unnamed"),Y(this,"source",void 0),Y(this,"url",void 0),Y(this,"maxConcurrency",1),Y(this,"maxMobileConcurrency",1),Y(this,"onDebug",()=>{}),Y(this,"reuseWorkers",!0),Y(this,"props",{}),Y(this,"jobQueue",[]),Y(this,"idleQueue",[]),Y(this,"count",0),Y(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(c,h,p)=>c.done(p),r=(c,h)=>c.error(h)){const c=new Promise(h=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:h}),this));return this._startQueuedJob(),await c}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new yN(n.name,e);e.onMessage=c=>n.onMessage(r,c.type,c.payload),e.onError=c=>n.onError(r,c),n.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Ux({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return _N?this.maxMobileConcurrency:this.maxConcurrency}}const EN={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class La{static isSupported(){return Ux.isSupported()}static getWorkerFarm(e={}){return La._workerFarm=La._workerFarm||new La({}),La._workerFarm.setProps(e),La._workerFarm}constructor(e){Y(this,"props",void 0),Y(this,"workerPools",new Map),this.props={...EN},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:c}=e;let h=this.workerPools.get(n);return h||(h=new wN({name:n,source:r,url:c}),h.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,h)),h}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}Y(La,"_workerFarm",void 0);const TN="latest";function AN(t,e={}){const n=e[t.id]||{},r="".concat(t.id,"-worker.js");let c=n.workerUrl;if(!c&&t.id==="compression"&&(c=e.workerUrl),e._workerType==="test"&&(c="modules/".concat(t.module,"/dist/").concat(r)),!c){let h=t.version;h==="latest"&&(h=TN);const p=h?"@".concat(h):"";c="https://unpkg.com/@loaders.gl/".concat(t.module).concat(p,"/dist/").concat(r)}return Oa(c),c}function SN(t,e=gN){Oa(t,"no worker provided");const n=t.version;return!(!e||!n)}function MN(t,e){return!La.isSupported()||!s_&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&e?.worker}async function PN(t,e,n,r,c){const h=t.id,p=AN(t,n),v=La.getWorkerFarm(n).getWorkerPool({name:h,url:p});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const E=await v.startJob("process-on-worker",IN.bind(null,c));return E.postMessage("process",{input:e,options:n,context:r}),await(await E.result).result}async function IN(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:c,input:h,options:p}=r;try{const s=await t(h,p);e.postMessage("done",{id:c,result:s})}catch(s){const v=s instanceof Error?s.message:"unknown error";e.postMessage("error",{id:c,error:v})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function nC(t){return t&&typeof t=="object"&&t.isBuffer}function CN(t){return nC(t)?new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer:t}function iC(t){if(nC(t))return CN(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function LN(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),c=new Uint8Array(e);for(let h=0;h<r.length;++h)if(r[h]!==c[h])return!1;return!0}function kN(...t){const e=t.map(h=>h instanceof ArrayBuffer?new Uint8Array(h):h),n=e.reduce((h,p)=>h+p.byteLength,0),r=new Uint8Array(n);let c=0;for(const h of e)r.set(h,c),c+=h.byteLength;return r.buffer}async function RN(t){const e=[];for await(const n of t)e.push(n);return kN(...e)}function fA(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class dA{constructor(e,n){Y(this,"name",void 0),Y(this,"type",void 0),Y(this,"sampleSize",1),Y(this,"time",void 0),Y(this,"count",void 0),Y(this,"samples",void 0),Y(this,"lastTiming",void 0),Y(this,"lastSampleTime",void 0),Y(this,"lastSampleCount",void 0),Y(this,"_count",0),Y(this,"_time",0),Y(this,"_samples",0),Y(this,"_startTime",0),Y(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=fA(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(fA()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class gb{constructor(e){Y(this,"id",void 0),Y(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:r}=e;return this.stats[n]||(e instanceof dA?this.stats[n]=e:this.stats[n]=new dA(n,r)),this.stats[n]}}let ON="";const pA={};function DN(t){for(const e in pA)if(t.startsWith(e)){const n=pA[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(ON).concat(t)),t}function zN(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}const BN=t=>typeof t=="boolean",jd=t=>typeof t=="function",Pp=t=>t!==null&&typeof t=="object",mA=t=>Pp(t)&&t.constructor==={}.constructor,FN=t=>t&&typeof t[Symbol.iterator]=="function",NN=t=>t&&typeof t[Symbol.asyncIterator]=="function",Wh=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,qh=t=>typeof Blob<"u"&&t instanceof Blob,UN=t=>t&&typeof t=="object"&&t.isBuffer,VN=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Pp(t)&&jd(t.tee)&&jd(t.cancel)&&jd(t.getReader),jN=t=>Pp(t)&&jd(t.read)&&jd(t.pipe)&&BN(t.readable),rC=t=>VN(t)||jN(t),GN=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,$N=/^([-\w.]+\/[-\w.+]+)/;function HN(t){const e=$N.exec(t);return e?e[1]:t}function gA(t){const e=GN.exec(t);return e?e[1]:""}const WN=/\?.*/;function Ay(t){if(Wh(t)){const e=Ev(t.url||""),n=t.headers.get("content-type")||"";return{url:e,type:HN(n)||gA(e)}}return qh(t)?{url:Ev(t.name||""),type:t.type||""}:typeof t=="string"?{url:Ev(t),type:gA(t)}:{url:"",type:""}}function qN(t){return Wh(t)?t.headers["content-length"]||-1:qh(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function Ev(t){return t.replace(WN,"")}async function sC(t){if(Wh(t))return t;const e={},n=qN(t);n>=0&&(e["content-length"]=String(n));const{url:r,type:c}=Ay(t);c&&(e["content-type"]=c);const h=await YN(t);h&&(e["x-first-bytes"]=h),typeof t=="string"&&(t=new TextEncoder().encode(t));const p=new Response(t,{headers:e});return Object.defineProperty(p,"url",{value:r}),p}async function ZN(t){if(!t.ok){const e=await XN(t);throw new Error(e)}}async function XN(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let r=t.statusText;n.includes("application/json")&&(r+=" ".concat(await t.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function YN(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const c=new FileReader;c.onload=h=>{var p;return r(h==null||(p=h.target)===null||p===void 0?void 0:p.result)},c.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),r=KN(n);return"data:base64,".concat(r)}return null}function KN(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}async function _A(t,e){if(typeof t=="string"){t=DN(t);let n=e;return e!=null&&e.fetch&&typeof e?.fetch!="function"&&(n=e.fetch),await fetch(t,n)}return await sC(t)}function oC(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Na(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||oC()}const o_={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Cg=o_.window||o_.self||o_.global,yd=o_.process||{},aC=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Na();const Tv=globalThis;function lC(t){if(!t&&!Na())return"Node";if(oC(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const r=n.indexOf("MSIE ")!==-1,c=n.indexOf("Trident/")!==-1;return r||c?"IE":Tv.chrome?"Chrome":Tv.safari?"Safari":Tv.mozInnerScreenX?"Firefox":"Unknown"}function JN(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class QN{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";Y(this,"storage",void 0),Y(this,"id",void 0),Y(this,"config",void 0),this.storage=JN(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function eU(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function tU(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Av(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const c=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const h=t.width*n,p=t.height*n,s=["font-size:1px;","padding:".concat(Math.floor(p/2),"px ").concat(Math.floor(h/2),"px;"),"line-height:".concat(p,"px;"),"background:url(".concat(c,");"),"background-size:".concat(h,"px ").concat(p,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}let B_;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(B_||(B_={}));function yA(t){return typeof t=="string"?B_[t.toUpperCase()]||B_.WHITE:t}function nU(t,e,n){return!Na&&typeof t=="string"&&(e&&(e=yA(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=yA(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function iU(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n);for(const c of r)typeof t[c]=="function"&&(e.find(h=>c===h)||(t[c]=t[c].bind(t)))}function F_(t,e){if(!t)throw new Error(e||"Assertion failed")}function Ku(){let t;if(Na&&"performance"in Cg){var e,n;t=Cg==null||(e=Cg.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in yd){var r;const c=yd==null||(r=yd.hrtime)===null||r===void 0?void 0:r.call(yd);t=c[0]*1e3+c[1]/1e6}else t=Date.now();return t}const Ju={debug:Na&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},rU={enabled:!0,level:0};function ro(){}const vA={},xA={once:!0};class Ip{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};Y(this,"id",void 0),Y(this,"VERSION",aC),Y(this,"_startTs",Ku()),Y(this,"_deltaTs",Ku()),Y(this,"_storage",void 0),Y(this,"userData",{}),Y(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new QN("__probe-".concat(this.id,"__"),rU),this.timeStamp("".concat(this.id," started")),iU(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ku()-this._startTs).toPrecision(10))}getDelta(){return Number((Ku()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){F_(e,n)}warn(e){return this._getLogFunction(0,e,Ju.warn,arguments,xA)}error(e){return this._getLogFunction(0,e,Ju.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Ju.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Ju.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var r=arguments.length,c=new Array(r>2?r-2:0),h=2;h<r;h++)c[h-2]=arguments[h];return this._getLogFunction(e,n,Ju.debug||Ju.info,arguments,xA)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||ro,r&&[r],{tag:lU(n)}):ro}image(e){let{logLevel:n,priority:r,image:c,message:h="",scale:p=1}=e;return this._shouldLog(n||r)?Na?aU({image:c,message:h,scale:p}):oU():ro}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||ro)}group(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const c=bA({logLevel:e,message:n,opts:r}),{collapsed:h}=r;return c.method=(h?console.groupCollapsed:console.group)||console.info,this._getLogFunction(c)}groupCollapsed(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ro)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=cC(e)}_getLogFunction(e,n,r,c,h){if(this._shouldLog(e)){h=bA({logLevel:e,message:n,args:c,opts:h}),r=r||h.method,F_(r),h.total=this.getTotal(),h.delta=this.getDelta(),this._deltaTs=Ku();const p=h.tag||h.message;if(h.once)if(!vA[p])vA[p]=Ku();else return ro;return n=sU(this.id,h.message,h),r.bind(console,n,...h.args)}return ro}}Y(Ip,"VERSION",aC);function cC(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return F_(Number.isFinite(e)&&e>=0),e}function bA(t){const{logLevel:e,message:n}=t;t.logLevel=cC(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const c=typeof t.message;return F_(c==="string"||c==="object"),Object.assign(t,{args:r},t.opts)}function sU(t,e,n){if(typeof e=="string"){const r=n.time?tU(eU(n.total)):"";e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=nU(e,n.color,n.background)}return e}function oU(t){return console.warn("removed"),ro}function aU(t){let{image:e,message:n="",scale:r=1}=t;if(typeof e=="string"){const h=new Image;return h.onload=()=>{const p=Av(h,n,r);console.log(...p)},h.src=e,ro}const c=e.nodeName||"";if(c.toLowerCase()==="img")return console.log(...Av(e,n,r)),ro;if(c.toLowerCase()==="canvas"){const h=new Image;return h.onload=()=>console.log(...Av(h,n,r)),h.src=e.toDataURL(),ro}return ro}function lU(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const wA=new Ip({id:"loaders.gl"});class cU{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class uU{constructor(){Y(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const uC={fetch:null,mimeType:void 0,nothrow:!1,log:new uU,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:mb,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},hU={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function hC(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const fC=()=>{const t=hC();return t.globalOptions=t.globalOptions||{...uC},t.globalOptions};function fU(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],dU(t,n),mU(e,t,r)}function dC(t,e){const n=fC(),r=t||n;return typeof r.fetch=="function"?r.fetch:Pp(r.fetch)?c=>_A(c,r):e!=null&&e.fetch?e?.fetch:_A}function dU(t,e){EA(t,null,uC,hU,e);for(const n of e){const r=t&&t[n.id]||{},c=n.options&&n.options[n.id]||{},h=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};EA(r,n.id,c,h,e)}}function EA(t,e,n,r,c){const h=e||"Top level",p=e?"".concat(e,"."):"";for(const s in t){const v=!e&&Pp(t[s]),E=s==="baseUri"&&!e,M=s==="workerUrl"&&e;if(!(s in n)&&!E&&!M){if(s in r)wA.warn("".concat(h," loader option '").concat(p).concat(s,"' no longer supported, use '").concat(r[s],"'"))();else if(!v){const I=pU(s,c);wA.warn("".concat(h," loader option '").concat(p).concat(s,"' not recognized. ").concat(I))()}}}}function pU(t,e){const n=t.toLowerCase();let r="";for(const c of e)for(const h in c.options){if(t===h)return"Did you mean '".concat(c.id,".").concat(h,"'?");const p=h.toLowerCase();(n.startsWith(p)||p.startsWith(n))&&(r=r||"Did you mean '".concat(c.id,".").concat(h,"'?"))}return r}function mU(t,e,n){const c={...t.options||{}};return gU(c,n),c.log===null&&(c.log=new cU),TA(c,fC()),TA(c,e),c}function TA(t,e){for(const n in e)if(n in e){const r=e[n];mA(r)&&mA(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function gU(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function _b(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function yb(t){var e,n;z_(t,"null loader"),z_(_b(t),"invalid loader");let r;return Array.isArray(t)&&(r=t[1],t=t[0],t={...t,options:{...t.options,...r}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const pC=()=>{const t=hC();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function _U(t){const e=pC();t=Array.isArray(t)?t:[t];for(const n of t){const r=yb(n);e.find(c=>r===c)||e.unshift(r)}}function yU(){return pC()}const vU=new Ip({id:"loaders.gl"}),xU=/\.([^.]+)$/;async function bU(t,e=[],n,r){if(!mC(t))return null;let c=AA(t,e,{...n,nothrow:!0},r);if(c)return c;if(qh(t)&&(t=await t.slice(0,10).arrayBuffer(),c=AA(t,e,n,r)),!c&&!(n!=null&&n.nothrow))throw new Error(gC(t));return c}function AA(t,e=[],n,r){if(!mC(t))return null;if(e&&!Array.isArray(e))return yb(e);let c=[];e&&(c=c.concat(e)),n!=null&&n.ignoreRegisteredLoaders||c.push(...yU()),EU(c);const h=wU(t,c,n,r);if(!h&&!(n!=null&&n.nothrow))throw new Error(gC(t));return h}function wU(t,e,n,r){const{url:c,type:h}=Ay(t),p=c||r?.url;let s=null,v="";if(n!=null&&n.mimeType&&(s=Sv(e,n?.mimeType),v="match forced by supplied MIME type ".concat(n?.mimeType)),s=s||TU(e,p),v=v||(s?"matched url ".concat(p):""),s=s||Sv(e,h),v=v||(s?"matched MIME type ".concat(h):""),s=s||SU(e,t),v=v||(s?"matched initial data ".concat(_C(t)):""),s=s||Sv(e,n?.fallbackMimeType),v=v||(s?"matched fallback MIME type ".concat(h):""),v){var E;vU.log(1,"selectLoader selected ".concat((E=s)===null||E===void 0?void 0:E.name,": ").concat(v,"."))}return s}function mC(t){return!(t instanceof Response&&t.status===204)}function gC(t){const{url:e,type:n}=Ay(t);let r="No valid loader found (";r+=e?"".concat(zN(e),", "):"no url provided, ",r+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const c=t?_C(t):"";return r+=c?' first bytes: "'.concat(c,'"'):"first bytes: not available",r+=")",r}function EU(t){for(const e of t)yb(e)}function TU(t,e){const n=e&&xU.exec(e),r=n&&n[1];return r?AU(t,r):null}function AU(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Sv(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function SU(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(MU(e,n))return n}else if(ArrayBuffer.isView(e)){if(SA(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&SA(e,0,n))return n;return null}function MU(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function SA(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(c=>PU(t,e,n,c))}function PU(t,e,n,r){if(r instanceof ArrayBuffer)return LN(r,t,r.byteLength);switch(typeof r){case"function":return r(t,n);case"string":const c=Vx(t,e,r.length);return r===c;default:return!1}}function _C(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Vx(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Vx(t,0,e):""}function Vx(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let c="";for(let h=0;h<n;h++)c+=String.fromCharCode(r.getUint8(e+h));return c}const IU=256*1024;function*CU(t,e){const n=e?.chunkSize||IU;let r=0;const c=new TextEncoder;for(;r<t.length;){const h=Math.min(t.length-r,n),p=t.slice(r,r+h);r+=h,yield c.encode(p)}}const LU=256*1024;function*kU(t,e={}){const{chunkSize:n=LU}=e;let r=0;for(;r<t.byteLength;){const c=Math.min(t.byteLength-r,n),h=new ArrayBuffer(c),p=new Uint8Array(t,r,c);new Uint8Array(h).set(p),r+=c,yield h}}const RU=1024*1024;async function*OU(t,e){const n=e?.chunkSize||RU;let r=0;for(;r<t.size;){const c=r+n,h=await t.slice(r,c).arrayBuffer();r=c,yield h}}function MA(t,e){return mb?DU(t,e):zU(t)}async function*DU(t,e){const n=t.getReader();let r;try{for(;;){const c=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:h,value:p}=await c;if(h)return;yield iC(p)}}catch{n.releaseLock()}}async function*zU(t,e){for await(const n of t)yield iC(n)}function BU(t,e){if(typeof t=="string")return CU(t,e);if(t instanceof ArrayBuffer)return kU(t,e);if(qh(t))return OU(t,e);if(rC(t))return MA(t,e);if(Wh(t))return MA(t.body,e);throw new Error("makeIterator")}const yC="Cannot convert supplied data type";function FU(t,e,n){if(e.text&&typeof t=="string")return t;if(UN(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const c=t.byteLength||t.length;return(t.byteOffset!==0||c!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+c)),r}throw new Error(yC)}async function NU(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return FU(t,e);if(qh(t)&&(t=await sC(t)),Wh(t)){const c=t;return await ZN(c),e.binary?await c.arrayBuffer():await c.text()}if(rC(t)&&(t=BU(t,n)),FN(t)||NN(t))return RN(t);throw new Error(yC)}function UU(t,e,n=null){if(n)return n;const r={fetch:dC(e,t),...t};return Array.isArray(r.loaders)||(r.loaders=null),r}function VU(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:null}async function vb(t,e,n,r){Oa(!r||typeof r=="object"),e&&!Array.isArray(e)&&!_b(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:c}=Ay(t),p=VU(e,r),s=await bU(t,p,n);return s?(n=fU(n,s,p,c),r=UU({url:c,parse:vb,loaders:p},n,r),await jU(s,t,n,r)):null}async function jU(t,e,n,r){if(SN(t),Wh(e)){const c=e,{ok:h,redirected:p,status:s,statusText:v,type:E,url:M}=c,I=Object.fromEntries(c.headers.entries());r.response={headers:I,ok:h,redirected:p,status:s,statusText:v,type:E,url:M}}if(e=await NU(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,r,t);if(MN(t,n))return await PN(t,e,n,r,vb);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,r,t);if(t.parse)return await t.parse(e,n,r,t);throw Oa(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function jx(t,e,n,r){!Array.isArray(e)&&!_b(e)&&(n=e,e=void 0);const c=dC(n);let h=t;return typeof t=="string"&&(h=await c(t)),qh(t)&&(h=await c(t)),await vb(h,e,n)}const GU="3.2.12",{_parseImageNode:$U}=globalThis,Gx=typeof Image<"u",$x=typeof ImageBitmap<"u",HU=Boolean($U),Hx=mb?!0:HU;function WU(t){switch(t){case"auto":return $x||Gx||Hx;case"imagebitmap":return $x;case"image":return Gx;case"data":return Hx;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function qU(){if($x)return"imagebitmap";if(Gx)return"image";if(Hx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function ZU(t){const e=YU(t);if(!e)throw new Error("Not an image");return e}function XU(t){switch(ZU(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function YU(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const KU=/^data:image\/svg\+xml/,JU=/\.svg((\?|#).*)?$/;function xb(t){return t&&(KU.test(t)||JU.test(t))}function QU(t,e){if(xb(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(h){throw new Error(h.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return vC(t,e)}function vC(t,e){if(xb(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function xC(t,e,n){const r=QU(t,n),c=self.URL||self.webkitURL,h=typeof r!="string"&&c.createObjectURL(r);try{return await eV(h||r,e)}finally{h&&c.revokeObjectURL(h)}}async function eV(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,c)=>{try{n.onload=()=>r(n),n.onerror=h=>c(new Error("Could not load image ".concat(t,": ").concat(h)))}catch(h){c(h)}})}const tV={};let PA=!0;async function nV(t,e,n){let r;xb(n)?r=await xC(t,e,n):r=vC(t,n);const c=e&&e.imagebitmap;return await iV(r,c)}async function iV(t,e=null){if((rV(e)||!PA)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),PA=!1}return await createImageBitmap(t)}function rV(t){for(const e in t||tV)return!1;return!0}const ra=!1,Gd=!0;function bC(t){const e=Cp(t);return sV(e)||lV(e)||oV(e)||aV(e)}function sV(t){const e=Cp(t);return e.byteLength>=24&&e.getUint32(0,ra)===2303741511?{mimeType:"image/png",width:e.getUint32(16,ra),height:e.getUint32(20,ra)}:null}function oV(t){const e=Cp(t);return e.byteLength>=10&&e.getUint32(0,ra)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Gd),height:e.getUint16(8,Gd)}:null}function aV(t){const e=Cp(t);return e.byteLength>=14&&e.getUint16(0,ra)===16973&&e.getUint32(2,Gd)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Gd),height:e.getUint32(22,Gd)}:null}function lV(t){const e=Cp(t);if(!(e.byteLength>=3&&e.getUint16(0,ra)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:c}=cV();let h=2;for(;h+9<e.byteLength;){const p=e.getUint16(h,ra);if(c.has(p))return{mimeType:"image/jpeg",height:e.getUint16(h+5,ra),width:e.getUint16(h+7,ra)};if(!r.has(p))return null;h+=2,h+=e.getUint16(h,ra)}return null}function cV(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Cp(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function uV(t,e){const{mimeType:n}=bC(t)||{},r=globalThis._parseImageNode;return z_(r),await r(t,n)}async function hV(t,e,n){e=e||{};const c=(e.image||{}).type||"auto",{url:h}=n||{},p=fV(c);let s;switch(p){case"imagebitmap":s=await nV(t,e,h);break;case"image":s=await xC(t,e,h);break;case"data":s=await uV(t);break;default:z_(!1)}return c==="data"&&(s=XU(s)),s}function fV(t){switch(t){case"auto":case"data":return qU();default:return WU(t),t}}const dV=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],pV=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],mV={image:{type:"auto",decode:!0}},gV={id:"image",module:"images",name:"Images",version:GU,mimeTypes:pV,extensions:dV,parse:hV,tests:[t=>Boolean(bC(new DataView(t)))],options:mV},Vi=new Ip({id:"deck"});let Wx={};function _V(t){Wx=t}function ds(t,e,n,r){Vi.level>0&&Wx[t]&&Wx[t].call(null,e,n,r)}function yV(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const vV={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:yV,parseTextSync:JSON.parse},$d="8.8.23",a_=globalThis.deck&&globalThis.deck.VERSION;if(a_&&a_!==$d)throw new Error("deck.gl - multiple versions detected: ".concat(a_," vs ").concat($d));a_||(Vi.log(1,"deck.gl ".concat($d))(),globalThis.deck={...globalThis.deck,VERSION:$d,version:$d,log:Vi,_registerLoggers:_V},_U([vV,[gV,{imagebitmap:{premultiplyAlpha:"none"}}]]));const xV=globalThis.deck,An=new Ip({id:"luma.gl"});function ps(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const bV="Invalid WebGLRenderingContext",wV="Requires WebGL2";function Sy(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function ui(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function EV(t){return ui(t)?t:null}function My(t){return ps(Sy(t),bV),t}function ms(t){return ps(ui(t),wV),t}const Md={};function TV(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function AV(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function SV(t,e){Md[t]=!0,e!==void 0&&TV(e)}function MV(t){const e=t.getError;t.getError=function(){let r;do r=e.apply(t),r!==0&&(Md[r]=!0);while(r!==0);for(r in Md)if(Md[r])return delete Md[r],parseInt(r,10);return 0}}const Lp=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const c=new t.VertexAttrib(n);this.attribs[r]=c}this.maxAttrib=0};Lp.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Lp.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Jc=function(e){const n=this;this.gl=e,MV(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(h){return h===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(h){const p=n.currentVertexArrayObject;p.maxAttrib=Math.max(p.maxAttrib,h);const s=p.attribs[h];return s.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(h){const p=n.currentVertexArrayObject;p.maxAttrib=Math.max(p.maxAttrib,h);const s=p.attribs[h];return s.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(h,p){switch(h){case 34962:n.currentArrayBuffer=p;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=p;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(h,p){const v=n.currentVertexArrayObject.attribs[h];switch(p){case 34975:return v.buffer;case 34338:return v.enabled;case 34339:return v.size;case 34340:return v.stride;case 34341:return v.type;case 34922:return v.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(h,p,s,v,E,M){const I=n.currentVertexArrayObject;I.maxAttrib=Math.max(I.maxAttrib,h);const R=I.attribs[h];return R.buffer=n.currentArrayBuffer,R.size=p,R.type=s,R.normalized=v,R.stride=E,R.offset=M,R.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{AV("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Jc.prototype.VERTEX_ARRAY_BINDING_OES=34229;Jc.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new Lp(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Jc.prototype.createVertexArrayOES=function(){const e=new Lp(this);return this.vertexArrayObjects.push(e),e};Jc.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Jc.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Lp&&e.hasBeenBound&&e.ext===this)};Jc.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){SV(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,c=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const h=this.currentVertexArrayObject;if(c===h)return;(!c||h.elementArrayBuffer!==c.elementArrayBuffer)&&r.bindBuffer.call(n,34963,h.elementArrayBuffer);let p=this.currentArrayBuffer;const s=Math.max(c?c.maxAttrib:0,h.maxAttrib);for(let v=0;v<=s;v++){const E=h.attribs[v],M=c?c.attribs[v]:null;if((!c||E.enabled!==M.enabled)&&(E.enabled?r.enableVertexAttribArray.call(n,v):r.disableVertexAttribArray.call(n,v)),E.enabled){let I=!1;(!c||E.buffer!==M.buffer)&&(p!==E.buffer&&(r.bindBuffer.call(n,34962,E.buffer),p=E.buffer),I=!0),(I||E.cached!==M.cached)&&r.vertexAttribPointer.call(n,v,E.size,E.type,E.normalized,E.stride,E.offset)}}this.currentArrayBuffer!==p&&r.bindBuffer.call(n,34962,this.currentArrayBuffer)};function PV(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const c=e.call(this)||[];return c.indexOf("OES_vertex_array_object")<0&&c.push("OES_vertex_array_object"),c};const n=t.getExtension;t.getExtension=function(c){const h=n.call(this,c);return h||(c!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Jc(this)),this.__OESVertexArrayObject))}}const IA="OES_element_index",CA="WEBGL_draw_buffers",IV="EXT_disjoint_timer_query",CV="EXT_disjoint_timer_query_webgl2",LV="EXT_texture_filter_anisotropic",LA="WEBGL_debug_renderer_info",kV=35723,RV=4352,OV=36795,DV=34047,zV=37445,BV=37446,Hi=t=>ui(t)?void 0:0,FV={[3074]:t=>ui(t)?void 0:36064,[kV]:t=>ui(t)?void 0:RV,[35977]:Hi,[32937]:Hi,[OV]:(t,e)=>{const n=ui(t)?t.getExtension(CV):t.getExtension(IV);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[zV]:(t,e)=>{const n=t.getExtension(LA);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[BV]:(t,e)=>{const n=t.getExtension(LA);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[DV]:(t,e)=>{const n=t.luma.extensions[LV];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:Hi,[35071]:Hi,[37447]:Hi,[36063]:(t,e)=>{if(!ui(t)){const n=t.getExtension(CA);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:Hi,[35374]:Hi,[35377]:Hi,[34852]:t=>{if(!ui(t)){const e=t.getExtension(CA);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(IA)?2147483647:65535,[33001]:t=>t.getExtension(IA)?16777216:65535,[33e3]:t=>16777216,[37157]:Hi,[35373]:Hi,[35657]:Hi,[36183]:Hi,[37137]:Hi,[34045]:Hi,[35978]:Hi,[35979]:Hi,[35968]:Hi,[35376]:Hi,[35375]:Hi,[35659]:Hi,[37154]:Hi,[35371]:Hi,[35658]:Hi,[35076]:Hi,[35077]:Hi,[35380]:Hi};function NV(t,e,n){const r=FV[n],c=typeof r=="function"?r(t,e,n):r;return c!==void 0?c:e(n)}const UV="OES_vertex_array_object",wC="ANGLE_instanced_arrays",VV="WEBGL_draw_buffers",jV="EXT_disjoint_timer_query",GV="EXT_texture_filter_anisotropic",$V="VertexArray requires WebGL2 or OES_vertex_array_object extension";function HV(t,e){return{webgl2:ui(t),ext:t.getExtension(e)}}const EC={[UV]:{meta:{suffix:"OES"},createVertexArray:()=>{ps(!1,$V)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[wC]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){ps(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[VV]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{ps(!1)}},[jV]:{meta:{suffix:"EXT"},createQuery:()=>{ps(!1)},deleteQuery:()=>{ps(!1)},beginQuery:()=>{ps(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},Mv={readBuffer:(t,e,n)=>{ui(t)&&e(n)},getVertexAttrib:(t,e,n,r)=>{const{webgl2:c,ext:h}=HV(t,wC);let p;switch(r){case 35069:p=c?void 0:!1;break;case 35070:p=!c&&!h?0:void 0;break}return p!==void 0?p:e(n,r)},getProgramParameter:(t,e,n,r)=>{if(!ui(t))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,r)},getInternalformatParameter:(t,e,n,r,c)=>{if(!ui(t))switch(c){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,r,c)},getTexParameter(t,e,n,r){switch(r){case 34046:const{extensions:c}=t.luma,h=c[GV];r=h&&h.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,r)},getParameter:NV,hint(t,e,n,r){return e(n,r)}};function WV(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(PV(t),qV(t),XV(t,EC),ZV(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=WV;function qV(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function ZV(t,e){let{target:n,target2:r}=e;Object.keys(Mv).forEach(c=>{if(typeof Mv[c]=="function"){const h=t[c]?t[c].bind(t):()=>{},p=Mv[c].bind(null,t,h);n[c]=p,r[c]=p}})}function XV(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&YV(t,{extension:n,target:t.luma,target2:t})}function YV(t,e){let{extension:n,target:r,target2:c}=e;const h=EC[n];ps(h);const{meta:p={}}=h,{suffix:s=""}=p,v=t.getExtension(n);for(const E of Object.keys(h)){const M="".concat(E).concat(s);let I=null;E==="meta"||typeof t[E]=="function"||(v&&typeof v[M]=="function"?I=function(){return v[M](...arguments)}:typeof h[E]=="function"&&(I=h[E].bind(r))),I&&(r[E]=I,c[E]=I)}}const bb={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},_l=(t,e,n)=>e?t.enable(n):t.disable(n),kA=(t,e,n)=>t.hint(n,e),Us=(t,e,n)=>t.pixelStorei(n,e),KV=(t,e)=>{const n=ui(t)?36009:36160;return t.bindFramebuffer(n,e)},JV=(t,e)=>t.bindFramebuffer(36008,e);function vd(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const QV={[3042]:_l,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:_l,[2885]:(t,e)=>t.cullFace(e),[2929]:_l,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:_l,[35723]:kA,[36006]:KV,[2886]:(t,e)=>t.frontFace(e),[33170]:kA,[2849]:(t,e)=>t.lineWidth(e),[32823]:_l,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:_l,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:_l,[3088]:(t,e)=>t.scissor(...e),[2960]:_l,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:Us,[3317]:Us,[37440]:Us,[37441]:Us,[37443]:Us,[3330]:Us,[3332]:Us,[3331]:Us,[36010]:JV,[3314]:Us,[32878]:Us,[3316]:Us,[3315]:Us,[32877]:Us,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=vd(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=vd(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=vd(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=vd(e)&&e.length===3?[...e,...e]:e;const[n,r,c,h,p,s]=e;t.stencilFuncSeparate(1028,n,r,c),t.stencilFuncSeparate(1029,h,p,s)},stencilOp:(t,e)=>{e=vd(e)&&e.length===3?[...e,...e]:e;const[n,r,c,h,p,s]=e;t.stencilOpSeparate(1028,n,r,c),t.stencilOpSeparate(1029,h,p,s)},viewport:(t,e)=>t.viewport(...e)};function mr(t,e,n){return e[t]!==void 0?e[t]:n[t]}const ej={blendEquation:(t,e,n)=>t.blendEquationSeparate(mr(32777,e,n),mr(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(mr(32969,e,n),mr(32968,e,n),mr(32971,e,n),mr(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(mr(32824,e,n),mr(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(mr(32938,e,n),mr(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,mr(2962,e,n),mr(2967,e,n),mr(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,mr(34816,e,n),mr(36003,e,n),mr(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,mr(2964,e,n),mr(2965,e,n),mr(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,mr(34817,e,n),mr(34818,e,n),mr(34819,e,n))},RA={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,r,c)=>t({[32773]:new Float32Array([e,n,r,c])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,r,c)=>t({[32969]:e,[32968]:n,[32971]:r,[32970]:c}),clearColor:(t,e,n,r,c)=>t({[3106]:new Float32Array([e,n,r,c])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,r,c)=>t({[3107]:[e,n,r,c]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,r,c)=>t({[3088]:new Int32Array([e,n,r,c])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({[2962]:e,[2967]:n,[2963]:r,[34816]:e,[36003]:n,[36004]:r}),stencilFuncSeparate:(t,e,n,r,c)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:c}),stencilOp:(t,e,n,r)=>t({[2964]:e,[2965]:n,[2966]:r,[34817]:e,[34818]:n,[34819]:r}),stencilOpSeparate:(t,e,n,r,c)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:c}),viewport:(t,e,n,r,c)=>t({[2978]:[e,n,r,c]})},Qo=(t,e)=>t.isEnabled(e),OA={[3042]:Qo,[2884]:Qo,[2929]:Qo,[3024]:Qo,[32823]:Qo,[32926]:Qo,[32928]:Qo,[3089]:Qo,[2960]:Qo,[35977]:Qo};function TC(t){for(const e in t)return!1;return!0}function tj(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let c=0;c<t.length;++c)if(t[c]!==e[c])return!1;return!0}return!1}function DA(t,e){const n=t[e].bind(t);t[e]=function(){const c=arguments.length<=0?void 0:arguments[0];return c in t.state.cache?t.state.enable?t.state.cache[c]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function nj(t,e,n){const r=t[e].bind(t);t[e]=function(){for(var h=arguments.length,p=new Array(h),s=0;s<h;s++)p[s]=arguments[s];const{valueChanged:v,oldValue:E}=n(t.state._updateCache,...p);return v&&r(...p),E},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function ij(t){const e=t.useProgram.bind(t);t.useProgram=function(r){t.state.program!==r&&(e(r),t.state.program=r)}}class rj{constructor(e){let{copyState:n=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?oj(e):Object.assign({},bb),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){ps(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Da(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const c=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const h in e){ps(h!==void 0);const p=e[h],s=this.cache[h];tj(p,s)||(n=!0,r=s,c&&!(h in c)&&(c[h]=s),this.cache[h]=p)}return{valueChanged:n,oldValue:r}}}function AC(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:r}=e;if(ps(r!==void 0),!t.state){const{polyfillContext:c}=globalThis;c&&c(t),t.state=new rj(t,{copyState:r}),ij(t);for(const h in RA){const p=RA[h];nj(t,h,p)}DA(t,"getParameter"),DA(t,"isEnabled")}return t.state.enable=n,t}function sj(t){t.state||AC(t,{copyState:!1}),t.state.push()}function zA(t){ps(t.state),t.state.pop()}function Da(t,e){if(ps(Sy(t),"setParameters requires a WebGL context"),TC(e))return;const n={};for(const c in e){const h=Number(c),p=QV[c];p&&(typeof p=="string"?n[p]=!0:p(t,e[c],h))}const r=t.state&&t.state.cache;if(r)for(const c in n){const h=ej[c];h(t,e,r)}}function oj(t,e){if(e=e||bb,typeof e=="number"){const c=e,h=OA[c];return h?h(t,c):t.getParameter(c)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const c of n){const h=OA[c];r[c]=h?h(t,Number(c)):t.getParameter(Number(c))}return r}function aj(t){Da(t,bb)}function oo(t,e,n){if(TC(e))return n(t);const{nocatch:r=!0}=e;sj(t),Da(t,e);let c;if(r)c=n(t),zA(t);else try{c=n(t)}finally{zA(t)}return c}function Lh(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function Pv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=Lh(t),c=t.drawingBufferWidth,h=t.drawingBufferHeight;return cj(e,r,c,h,n)}function lj(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function cj(t,e,n,r,c){const h=BA(t[0],e,n);let p=FA(t[1],e,r,c),s=BA(t[0]+1,e,n);const v=s===n-1?s:s-1;s=FA(t[1]+1,e,r,c);let E;return c?(s=s===0?s:s+1,E=p,p=s):E=s===r-1?s:s-1,{x:h,y:p,width:Math.max(v-h+1,1),height:Math.max(E-p+1,1)}}function BA(t,e,n){return Math.min(Math.round(t*e),n-1)}function FA(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const wb=Na(),uj=wb&&typeof document<"u",SC={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function MC(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ps(wb,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},SC,t);const{width:e,height:n}=t;function r(s){if(t.throwOnError)throw new Error(s);return console.error(s),null}t.onError=r;let c;const{canvas:h}=t,p=pj({canvas:h,width:e,height:n,onError:r});return c=dj(p,t),c?(c=Eb(c,t),mj(c),c):null}function Eb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||gj(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},SC,e);const{manageState:n,debug:r}=e;return n&&AC(t,{copyState:!1,log:function(){for(var c=arguments.length,h=new Array(c),p=0;p<c;p++)h[p]=arguments[p];return An.log(1,...h)()}}),wb&&r&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),An.level=Math.max(An.level,1)):An.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function hj(t){const e=t.getParameter(7936),n=t.getParameter(7937),r=t.getExtension("WEBGL_debug_renderer_info"),c=r&&t.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),h=r&&t.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:c||e,renderer:h||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function fj(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const r=lj(e.useDevicePixels);_j(t,r,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function dj(t,e){const{onError:n}=e;let r=null;const c=v=>r=v.statusMessage||r;t.addEventListener("webglcontextcreationerror",c,!1);const{webgl1:h=!0,webgl2:p=!0}=e;let s=null;return p&&(s=s||t.getContext("webgl2",e),s=s||t.getContext("experimental-webgl2",e)),h&&(s=s||t.getContext("webgl",e),s=s||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",c,!1),s?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),s):n("Failed to create ".concat(p&&!h?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function pj(t){let{canvas:e,width:n=800,height:r=600,onError:c}=t,h;return typeof e=="string"?(uj&&document.readyState==="complete"||c("createGLContext called on canvas '".concat(e,"' before page was loaded")),h=document.getElementById(e)):e?h=e:(h=document.createElement("canvas"),h.id="lumagl-canvas",h.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",h.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(h,document.body.firstChild)),h}function mj(t){const e=ui(t)?"WebGL2":"WebGL1",n=hj(t),r=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",c=t.debug?" debug":"";An.info(1,"".concat(e).concat(c," context ").concat(r))()}function gj(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function _j(t,e,n){let r="width"in n?n.width:t.canvas.clientWidth,c="height"in n?n.height:t.canvas.clientHeight;(!r||!c)&&(An.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=t.canvas.width||1,c=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const h=t.luma.canvasSizeInfo;if(h.clientWidth!==r||h.clientHeight!==c||h.devicePixelRatio!==e){let p=e;const s=Math.floor(r*p),v=Math.floor(c*p);t.canvas.width=s,t.canvas.height=v,(t.drawingBufferWidth!==s||t.drawingBufferHeight!==v)&&(An.warn("Device pixel ratio clamped")(),p=Math.min(t.drawingBufferWidth/r,t.drawingBufferHeight/c),t.canvas.width=Math.floor(r*p),t.canvas.height=Math.floor(c*p)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:r,clientHeight:c,devicePixelRatio:e})}}const Hd="8.5.18",yj="set luma.log.level=1 (or higher) to trace rendering";class vj{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new gb({id:e})),this.stats.get(e)}}const Nc=new vj;if(globalThis.luma&&globalThis.luma.VERSION!==Hd)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Hd));globalThis.luma||(Na()&&An.log(1,"luma.gl ".concat(Hd," - ").concat(yj))(),globalThis.luma=globalThis.luma||{VERSION:Hd,version:Hd,log:An,stats:Nc,globals:{modules:{},nodeIO:{}}});function xj(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function bj(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function on(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function Iv(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const r=t[e];return on(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function Rl(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const Cv={};function zl(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Cv[t]=Cv[t]||1;const e=Cv[t]++;return"".concat(t,"-").concat(e)}function NA(t){return on(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function kh(t){let e=!0;for(const n in t){e=!1;break}return e}function PC(t,e,n,r){const c="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),h=Object.getPrototypeOf(t);r.forEach(p=>{h.methodName||(h[p]=()=>{throw An.removed("Calling removed method ".concat(e,".").concat(p,": "),c)(),new Error(p)})})}const Qu="Resource subclass must define virtual methods";class Ua{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};My(e);const{id:r,userData:c={}}=n;this.gl=e,this.gl2=e,this.id=r||zl(this[Symbol.toStringTag]),this.userData=c,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Iv(this.gl,e),on(e);const c=(this.constructor.PARAMETERS||{})[e];if(c){const h=ui(this.gl);if(!((!("webgl2"in c)||h)&&(!("extension"in c)||this.gl.getExtension(c.extension)))){const s=c.webgl1,v="webgl2"in c?c.webgl2:c.webgl1;return h?v:s}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:r}=e,c=this.constructor.PARAMETERS||{},h=ui(this.gl),p={},s=n||Object.keys(c);for(const v of s){const E=c[v];if(E&&(!("webgl2"in E)||h)&&(!("extension"in E)||this.gl.getExtension(E.extension))){const I=r?Rl(this.gl,v):v;p[I]=this.getParameter(v,e),r&&E.type==="GLenum"&&(p[I]=Rl(this.gl,p[I]))}}return p}setParameter(e,n){e=Iv(this.gl,e),on(e);const c=(this.constructor.PARAMETERS||{})[e];if(c){const h=ui(this.gl);if(!((!("webgl2"in c)||h)&&(!("extension"in c)||this.gl.getExtension(c.extension))))throw new Error("Parameter not available on this platform");c.type==="GLenum"&&(n=Iv(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,r){return PC(this,e,n,r)}initialize(e){}_createHandle(){throw new Error(Qu)}_deleteHandle(){throw new Error(Qu)}_bindHandle(e){throw new Error(Qu)}_getOptsFromHandle(){throw new Error(Qu)}_getParameter(e,n){throw new Error(Qu)}_setParameter(e,n){throw new Error(Qu)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Nc.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Nc.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const c=Nc.get("Memory Usage".concat(r));c.get("GPU Memory").addCount(e),c.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=Nc.get("Memory Usage".concat(n));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}}const wj="Failed to deduce GL constant from typed array";function qx(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(wj)}}function cp(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Ej(t){let{data:e,width:n,height:r,bytesPerPixel:c=4,temp:h}=t;const p=n*c;h=h||new Uint8Array(p);for(let s=0;s<r/2;++s){const v=s*p,E=(r-s-1)*p;h.set(e.subarray(v,v+p)),e.copyWithin(v,E,E+p),e.set(h,E)}}function Tj(t){let{data:e,width:n,height:r}=t;const c=Math.round(n/2),h=Math.round(r/2),p=new Uint8Array(c*h*4);for(let s=0;s<h;s++)for(let v=0;v<c;v++)for(let E=0;E<4;E++)p[(s*c+v)*4+E]=e[(s*2*n+v*2)*4+E];return{data:p,width:c,height:h}}function Zx(t,e,n){const{removedProps:r={},deprecatedProps:c={},replacedProps:h={}}=n;for(const s in r)if(s in e){const E=r[s]?"".concat(t,".").concat(r[s]):"N/A";An.removed("".concat(t,".").concat(s),E)()}for(const s in c)if(s in e){const v=c[s];An.deprecated("".concat(t,".").concat(s),"".concat(t,".").concat(v))()}let p=null;for(const s in h)if(s in e){const v=h[s];An.deprecated("".concat(t,".").concat(s),"".concat(t,".").concat(v))(),p=p||Object.assign({},e),p[v]=e[s],delete p[s]}return p||e}const Aj={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},Sj={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Ws{static getBytesPerElement(e){return cp(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return on(e.size),cp(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new Ws(Aj,...n)}constructor(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(c=>this._assign(c)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Ws.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Ws.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Zx("Accessor",e,Sj),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const UA=10,IC={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Mj={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:IC},Pj={removedProps:IC};class Ui extends Ua{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Ws.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Ws.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Zx("Buffer",e,Mj),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Zx("Buffer",e,Pj),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Ws(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:r=0,srcOffset:c=0}=e,h=e.byteLength||e.length;on(n);const p=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(p,this.handle),c!==0||h!==void 0?(ms(this.gl),this.gl.bufferSubData(this.target,r,n,c,h)):this.gl.bufferSubData(p,r,n),this.gl.bindBuffer(p,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:r=0,writeOffset:c=0,size:h}=e;const{gl:p}=this;return ms(p),p.bindBuffer(36662,n.handle),p.bindBuffer(36663,this.handle),p.copyBufferSubData(36662,36663,r,c,h),p.bindBuffer(36662,null),p.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:r=0,length:c=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ms(this.gl);const h=cp(this.accessor.type||5126,{clamped:!1}),p=this._getAvailableElementCount(n),s=r;let v,E;e?(E=e.length,v=E-s):(v=Math.min(p,c||p),E=s+v);const M=Math.min(p,v);return c=c||M,on(c<=M),e=e||new h(E),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,r,c),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:r=0,size:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?c!==void 0?this.gl.bindBufferRange(e,n,this.handle,r,c):(on(r===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(UA,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;on(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const c=this._getTarget();this.gl.bindBuffer(c,this.handle),this.gl.bufferData(c,r,this.usage),this.gl.bufferSubData(c,n,e),this.gl.bindBuffer(c,null),this.debugData=e.slice(0,UA),this.bytesUsed=r,this._trackAllocatedMemory(r);const h=qx(e);return on(h),this.setAccessor(new Ws(this.accessor,{type:h})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;on(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const c=this._getTarget();return this.gl.bindBuffer(c,this.handle),this.gl.bufferData(c,r,n),this.gl.bindBuffer(c,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=cp(this.accessor.type||5126,{clamped:!1}),r=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new Ws(this.accessor,{type:qx(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return An.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return An.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return An.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return An.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Ws(this.accessor,e),this}}const Tb={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},CC={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},LC={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function Ij(t,e){const n=Tb[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const r=ui(t)&&n.gl2||n.gl1;return typeof r=="string"?t.getExtension(r):r}function Cj(t,e){const n=Tb[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const Lj=[9729,9728],VA=globalThis.WebGLBuffer||function(){};class Rh extends Ua{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:c}=n;let h=!0;return r&&(h=h&&Ij(e,r),h=h&&(!c||Cj(e,r))),h}constructor(e,n){const{id:r=zl("texture"),handle:c,target:h}=n;super(e,{id:r,handle:c}),this.target=h,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(we=>this.initialize(Object.assign({},e,{pixels:we,data:we}))),this;const r=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(r&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:c=null,format:h=6408,border:p=0,recreate:s=!1,parameters:v={},pixelStore:E={},textureUnit:M=void 0}=e;n||(n=c);let{width:I,height:R,dataFormat:N,type:$,compressed:Z=!1,mipmaps:ne=!0}=e;const{depth:me=0}=e;return{width:I,height:R,compressed:Z,dataFormat:N,type:$}=this._deduceParameters({format:h,type:$,dataFormat:N,compressed:Z,data:n,width:I,height:R}),this.width=I,this.height=R,this.depth=me,this.format=h,this.type=$,this.dataFormat=N,this.border=p,this.textureUnit=M,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),ne&&this._isNPOT()&&(An.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),ne=!1,this._updateForNPOT(v)),this.mipmaps=ne,this.setImageData({data:n,width:I,height:R,depth:me,format:h,type:$,dataFormat:N,border:p,mipmaps:ne,parameters:E,compressed:Z}),ne&&this.generateMipmap(),this.setParameters(v),s&&(this.data=n),r&&(this._video={video:n,parameters:v,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:r,mipmaps:c=!1}=e;return r!==this.width||n!==this.height?this.initialize({width:r,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:c}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(An.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),oo(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:r=null,level:c=0,format:h=this.format,border:p=this.border,offset:s=0,parameters:v={}}=e;let{data:E=null,type:M=this.type,width:I=this.width,height:R=this.height,dataFormat:N=this.dataFormat,compressed:$=!1}=e;E||(E=r),{type:M,dataFormat:N,compressed:$,width:I,height:R}=this._deduceParameters({format:h,type:M,dataFormat:N,compressed:$,data:E,width:I,height:R});const{gl:Z}=this;Z.bindTexture(this.target,this.handle);let ne=null;({data:E,dataType:ne}=this._getDataType({data:E,compressed:$}));let me,we=0;if(oo(this.gl,v,()=>{switch(ne){case"null":Z.texImage2D(n,c,h,I,R,p,N,M,E);break;case"typed-array":Z.texImage2D(n,c,h,I,R,p,N,M,E,s);break;case"buffer":me=ms(Z),me.bindBuffer(35052,E.handle||E),me.texImage2D(n,c,h,I,R,p,N,M,s),me.bindBuffer(35052,null);break;case"browser-object":ui(Z)?Z.texImage2D(n,c,h,I,R,p,N,M,E):Z.texImage2D(n,c,h,N,M,E);break;case"compressed":for(const[he,Pe]of E.entries())Z.compressedTexImage2D(n,he,Pe.format,Pe.width,Pe.height,p,Pe.data),we+=Pe.levelSize;break;default:on(!1,"Unknown image data type")}}),ne==="compressed")this._trackAllocatedMemory(we,"Texture");else if(E&&E.byteLength)this._trackAllocatedMemory(E.byteLength,"Texture");else{const he=CC[this.dataFormat]||4,Pe=LC[this.type]||1;this._trackAllocatedMemory(this.width*this.height*he*Pe,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:r=null,data:c=null,x:h=0,y:p=0,width:s=this.width,height:v=this.height,level:E=0,format:M=this.format,type:I=this.type,dataFormat:R=this.dataFormat,compressed:N=!1,offset:$=0,border:Z=this.border,parameters:ne={}}=e;if({type:I,dataFormat:R,compressed:N,width:s,height:v}=this._deduceParameters({format:M,type:I,dataFormat:R,compressed:N,data:c,width:s,height:v}),on(this.depth===0,"texSubImage not supported for 3D textures"),c||(c=r),c&&c.data){const me=c;c=me.data,s=me.shape[0],v=me.shape[1]}c instanceof Ui&&(c=c.handle),this.gl.bindTexture(this.target,this.handle),oo(this.gl,ne,()=>{if(N)this.gl.compressedTexSubImage2D(n,E,h,p,s,v,M,c);else if(c===null)this.gl.texSubImage2D(n,E,h,p,s,v,R,I,null);else if(ArrayBuffer.isView(c))this.gl.texSubImage2D(n,E,h,p,s,v,R,I,c,$);else if(c instanceof VA){const me=ms(this.gl);me.bindBuffer(35052,c),me.texSubImage2D(n,E,h,p,s,v,R,I,$),me.bindBuffer(35052,null)}else ui(this.gl)?ms(this.gl).texSubImage2D(n,E,h,p,s,v,R,I,c):this.gl.texSubImage2D(n,E,h,p,R,I,c)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return An.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:r=!1}=e;return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof Ui?{data:n.handle,dataType:"buffer"}:n instanceof VA?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:r}=e;let{width:c,height:h,dataFormat:p,type:s,compressed:v}=e;const E=Tb[n];return p=p||E&&E.dataFormat,s=s||E&&E.types[0],v=v||E&&E.compressed,{width:c,height:h}=this._deduceImageSize(r,c,h),{dataFormat:p,type:s,compressed:v,width:c,height:h,format:n,data:r}}_deduceImageSize(e,n,r){let c;return typeof ImageData<"u"&&e instanceof ImageData?c={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?c={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?c={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?c={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?c={width:e.videoWidth,height:e.videoHeight}:e?c={width:n,height:r}:c={width:n>=0?n:1,height:r>=0?r:1},on(c,"Could not deduced texture size"),on(n===void 0||c.width===n,"Deduced texture width does not match supplied width"),on(r===void 0||c.height===r,"Deduced texture height does not match supplied height"),c}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:on(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return ui(this.gl)||!this.width||!this.height?!1:!NA(this.width)||!NA(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:Lj.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let kj="";function Rj(t,e){return on(typeof t=="string"),t=kj+t,new Promise((n,r)=>{try{const c=new Image;c.onload=()=>n(c),c.onerror=()=>r(new Error("Could not load image ".concat(t,"."))),c.crossOrigin=e&&e.crossOrigin||"anonymous",c.src=t}catch(c){r(c)}})}class Ys extends Rh{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Rh.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};My(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:Rj(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const Xx=[34069,34070,34071,34072,34073,34074];class kC extends Rh{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};My(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:n,data:r,x:c=0,y:h=0,mipmapLevel:p=0}=e;return this._subImage({target:n,data:r,x:c,y:h,mipmapLevel:p})}async setCubeMapImageData(e){let{width:n,height:r,pixels:c,data:h,border:p=0,format:s=6408,type:v=5121}=e;const{gl:E}=this,M=c||h,I=await Promise.all(Xx.map(R=>{const N=M[R];return Promise.all(Array.isArray(N)?N:[N])}));this.bind(),Xx.forEach((R,N)=>{I[N].length>1&&this.opts.mipmaps!==!1&&An.warn("".concat(this.id," has mipmap and multiple LODs."))(),I[N].forEach(($,Z)=>{n&&r?E.texImage2D(R,Z,s,n,r,p,s,v,$):E.texImage2D(R,Z,s,s,v,$)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:r,height:c,pixels:h,data:p,border:s=0,format:v=6408,type:E=5121}=e,{gl:M}=this,I=h||p;return this.bind(),I instanceof Promise?I.then(R=>this.setImageDataForFace(Object.assign({},e,{face:n,data:R,pixels:R}))):this.width||this.height?M.texImage2D(n,0,v,r,c,s,v,E,I):M.texImage2D(n,0,v,v,E,I),this}}kC.FACES=Xx;class Oj extends Rh{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return ui(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ms(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:r=6408,width:c,height:h,depth:p=1,border:s=0,format:v,type:E=5121,offset:M=0,data:I,parameters:R={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),oo(this.gl,R,()=>{ArrayBuffer.isView(I)&&this.gl.texImage3D(this.target,n,r,c,h,p,s,v,E,I),I instanceof Ui&&(this.gl.bindBuffer(35052,I.handle),this.gl.texImage3D(this.target,n,r,c,h,p,s,v,E,M))}),I&&I.byteLength)this._trackAllocatedMemory(I.byteLength,"Texture");else{const N=CC[this.dataFormat]||4,$=LC[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*N*$,"Texture")}return this.loaded=!0,this}}const Mc="EXT_color_buffer_float",jA={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:Mc,bpp:2},[33327]:{gl2:Mc,bpp:4},[34842]:{gl2:Mc,bpp:8},[33326]:{gl2:Mc,bpp:4},[33328]:{gl2:Mc,bpp:8},[34836]:{gl2:Mc,bpp:16},[35898]:{gl2:Mc,bpp:4}};function Dj(t,e,n){const r=n[e];if(!r)return!1;const c=ui(t)&&r.gl2||r.gl1;return typeof c=="string"?t.getExtension(c):c}class ah extends Ua{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||Dj(e,n,jA)}static getSamplesForFormat(e,n){let{format:r}=n;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:r=1,height:c=1,samples:h=0}=e;return on(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),h!==0&&ui(this.gl)?this.gl.renderbufferStorageMultisample(36161,h,n,r,c):this.gl.renderbufferStorage(36161,n,r,c),this.format=n,this.width=r,this.height=c,this.samples=h,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*jA[this.format].bpp),this}resize(e){let{width:n,height:r}=e;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const zj=256,Bj=1024,Fj=16384,GA=6144,$A=6145,HA=6146,WA=34041,RC="clear: bad arguments";function Ab(t){let{framebuffer:e=null,color:n=null,depth:r=null,stencil:c=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const h={};e&&(h.framebuffer=e);let p=0;n&&(p|=Fj,n!==!0&&(h.clearColor=n)),r&&(p|=zj,r!==!0&&(h.clearDepth=r)),c&&(p|=Bj,r!==!0&&(h.clearStencil=r)),on(p!==0,RC),oo(t,h,()=>{t.clear(p)})}function Nj(t){let{framebuffer:e=null,buffer:n=GA,drawBuffer:r=0,value:c=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ms(t),oo(t,{framebuffer:e},()=>{switch(n){case GA:switch(c.constructor){case Int32Array:t.clearBufferiv(n,r,c);break;case Uint32Array:t.clearBufferuiv(n,r,c);break;case Float32Array:default:t.clearBufferfv(n,r,c)}break;case $A:t.clearBufferfv($A,0,[c]);break;case HA:t.clearBufferiv(HA,0,[c]);break;case WA:const[h,p]=c;t.clearBufferfi(WA,0,h,p);break;default:on(!1,RC)}})}function Uj(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return on(!1),0}}function Py(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:r=0,sourceFormat:c=6408}=e;let{sourceAttachment:h=36064,target:p=null,sourceWidth:s,sourceHeight:v,sourceType:E}=e;const{framebuffer:M,deleteFramebuffer:I}=Vj(t);on(M);const{gl:R,handle:N,attachments:$}=M;s=s||M.width,v=v||M.height,h===36064&&N===null&&(h=1028),on($[h]),E=E||$[h].type,p=jj(p,E,c,s,v),E=E||qx(p);const Z=R.bindFramebuffer(36160,N);return R.readPixels(n,r,s,v,c,E,p),R.bindFramebuffer(36160,Z||null),I&&M.delete(),p}function qA(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=Py(t,{sourceAttachment:e}),{width:c,height:h}=t;for(;h>n;)({data:r,width:c,height:h}=Tj({data:r,width:c,height:h}));Ej({data:r,width:c,height:h});const p=document.createElement("canvas");p.width=c,p.height=h;const s=p.getContext("2d"),v=s.createImageData(c,h);return v.data.set(r),s.putImageData(v,0,0),p.toDataURL()}function Vj(t){return t instanceof br?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Jj(t),deleteFramebuffer:!0}}function jj(t,e,n,r,c){if(t)return t;e=e||5121;const h=cp(e,{clamped:!1}),p=Uj(n);return new h(r*c*p)}const Ki={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function Gj(t){const e=new Ys(t,{format:6408,type:5126,dataFormat:6408}),n=new br(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),r=n.getStatus();return e.delete(),n.delete(),r===36053}const OC={[Ki.WEBGL2]:[!1,!0],[Ki.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Ki.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Ki.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Ki.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Ki.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Ki.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Ki.FLOAT_BLEND]:["EXT_float_blend"],[Ki.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Ki.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Ki.TEXTURE_FLOAT]:["OES_texture_float",!0],[Ki.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Ki.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Ki.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Ki.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Ki.COLOR_ATTACHMENT_RGBA32F]:[Gj,"EXT_color_buffer_float"],[Ki.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Ki.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Ki.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Ki.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Ki.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Ki.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},$j=2;function Hj(t,e){return Sb(t,e)}function Sb(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>DC(t,n))}function Wj(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in OC)t.luma.caps[e]===void 0&&(t.luma.caps[e]=DC(t,e));return t.luma.caps}function DC(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=qj(t,e)),t.luma.caps[e]||An.log($j,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function qj(t,e){const n=OC[e];on(n,e);let r;const c=ui(t)&&n[1]||n[0];if(typeof c=="function")r=c(t);else if(Array.isArray(c)){r=!0;for(const h of c)r=r&&Boolean(t.getExtension(h))}else typeof c=="string"?r=Boolean(t.getExtension(c)):typeof c=="boolean"?r=c:on(!1);return r}const ZA="Multiple render targets not supported";class br extends Ua{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:c}=n;let h=!0;return r&&(h=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),c&&(h=h&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),h}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new br(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=ms(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=ms(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:r=1,attachments:c=null,color:h=!0,depth:p=!0,stencil:s=!1,check:v=!0,readBuffer:E=void 0,drawBuffers:M=void 0}=e;if(on(n>=0&&r>=0,"Width and height need to be integers"),this.width=n,this.height=r,c)for(const I in c){const R=c[I];(Array.isArray(R)?R[0]:R).resize({width:n,height:r})}else c=this._createDefaultAttachments(h,p,s,n,r);this.update({clearAttachments:!0,attachments:c,readBuffer:E,drawBuffers:M}),c&&v&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:r,drawBuffers:c,clearAttachments:h=!1,resizeAttachments:p=!0}=e;this.attach(n,{clearAttachments:h,resizeAttachments:p});const{gl:s}=this,v=s.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),c&&this._setDrawBuffers(c),s.bindFramebuffer(36160,v||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:r}=e;if(this.handle===null)return on(n===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),n!==this.width&&r!==this.height&&An.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(r))();for(const c in this.attachments)this.attachments[c].resize({width:n,height:r});return this.width=n,this.height=r,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const c={};n&&Object.keys(this.attachments).forEach(p=>{c[p]=null}),Object.assign(c,e);const h=this.gl.bindFramebuffer(36160,this.handle);for(const p in c){on(p!==void 0,"Misspelled framebuffer binding point?");const s=Number(p),v=c[s];let E=v;if(!E)this._unattach(s);else if(E instanceof ah)this._attachRenderbuffer({attachment:s,renderbuffer:E});else if(Array.isArray(v)){const[M,I=0,R=0]=v;E=M,this._attachTexture({attachment:s,texture:M,layer:I,level:R})}else this._attachTexture({attachment:s,texture:E,layer:0,level:0});r&&E&&E.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,h||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(p=>!this.attachments[p]).forEach(p=>{delete this.attachments[p]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(Xj(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:r,stencil:c,drawBuffers:h=[]}=e,p=this.gl.bindFramebuffer(36160,this.handle);return(n||r||c)&&Ab(this.gl,{color:n,depth:r,stencil:c}),h.forEach((s,v)=>{Nj(this.gl,{drawBuffer:v,value:s})}),this.gl.bindFramebuffer(36160,p||null),this}readPixels(){return An.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return An.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return An.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return An.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return An.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return An.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:r=0,y:c=0,width:h,height:p}=e;const s=ms(this.gl),v=s.bindFramebuffer(36008,this.handle);return r===0&&c===0&&h===void 0&&p===void 0?s.invalidateFramebuffer(36008,n):s.invalidateFramebuffer(36008,n,r,c,h,p),s.bindFramebuffer(36008,v),this}getAttachmentParameter(e,n,r){let c=this._getAttachmentParameterFallback(n);return c===null&&(this.gl.bindFramebuffer(36160,this.handle),c=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),r&&c>1e3&&(c=Rl(this.gl,c)),c}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const c={};for(const h of r){const p=n?Rl(this.gl,h):h;c[p]=this.getAttachmentParameter(e,h,n)}return c}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),r={};for(const c of n){const h=Number(c),p=e?Rl(this.gl,h):h;r[p]=this.getAttachmentParameters(h,e)}return r}show(){return typeof window<"u"&&window.open(qA(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>An.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const r=qA(this,{targetMaxHeight:100});return An.image({logLevel:e,message:n,image:r},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,r,c,h){let p=null;return e&&(p=p||{},p[36064]=new Ys(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:c,height:h,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(p[36064])),n&&r?(p=p||{},p[33306]=new ah(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:c,height:111}),this.ownResources.push(p[33306])):n?(p=p||{},p[36096]=new ah(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:c,height:h}),this.ownResources.push(p[36096])):r&&on(!1),p}_unattach(e){const n=this.attachments[e];!n||(n instanceof ah?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:r}=e;const{gl:c}=this;c.framebufferRenderbuffer(36160,n,36161,r.handle),this.attachments[n]=r}_attachTexture(e){let{attachment:n=36064,texture:r,layer:c,level:h}=e;const{gl:p}=this;switch(p.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:ms(p).framebufferTextureLayer(36160,n,r.target,h,c);break;case 34067:const v=Zj(c);p.framebufferTexture2D(36160,n,v,r.handle,h);break;case 3553:p.framebufferTexture2D(36160,n,3553,r.handle,h);break;default:on(!1,"Illegal texture type")}p.bindTexture(r.target,null),this.attachments[n]=r}_setReadBuffer(e){const n=EV(this.gl);n?n.readBuffer(e):on(e===36064||e===1029,ZA),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,r=ms(n);if(r)r.drawBuffers(e);else{const c=n.getExtension("WEBGL_draw_buffers");c?c.drawBuffersWEBGL(e):on(e.length===1&&(e[0]===36064||e[0]===1029),ZA)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=Wj(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function Zj(t){return t<34069?t+34069:t}function Xj(t){return(br.STATUS||{})[t]||"Framebuffer error ".concat(t)}const Yj=[36049,36048,33296,33298,33299,33300,33301,33302,33303];br.ATTACHMENT_PARAMETERS=Yj;function Kj(t,e){on(t instanceof Ys||t instanceof kC||t instanceof Oj);const n=t.constructor,{gl:r,width:c,height:h,format:p,type:s,dataFormat:v,border:E,mipmaps:M}=t,I=Object.assign({width:c,height:h,format:p,type:s,dataFormat:v,border:E,mipmaps:M},e);return new n(r,I)}function Jj(t,e){const{gl:n,width:r,height:c,id:h}=t;return new br(n,Object.assign({},e,{id:"framebuffer-for-".concat(h),width:r,height:c,attachments:{[36064]:t}}))}function l_(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=t.match(n);return r?r[1]:e}const Qj=35632,e8=35633;function t8(t){switch(t){case Qj:return"fragment";case e8:return"vertex";default:return"unknown type"}}function n8(t,e,n,r){const c=t.split(/\r?\n/),h={},p={},s=r||l_(e)||"(unnamed)",v="".concat(t8(n)," shader ").concat(s);for(let M=0;M<c.length;M++){const I=c[M];if(I.length<=1)continue;const R=I.split(":"),N=R[0],$=parseInt(R[2],10);if(isNaN($))throw new Error("GLSL compilation error in ".concat(v,": ").concat(t));N!=="WARNING"?h[$]=I:p[$]=I}const E=i8(e);return{shaderName:v,errors:XA(h,E),warnings:XA(p,E)}}function XA(t,e){let n="";for(let r=0;r<e.length;r++){const c=e[r];if(!(!t[r+3]&&!t[r+2]&&!t[r+1])&&(n+="".concat(c,`
`),t[r+1])){const h=t[r+1],p=h.split(":",3),s=p[0],v=parseInt(p[1],10)||0,E=h.substring(p.join(":").length+1).trim();n+=zC("^^^ ".concat(s,": ").concat(E,`

`),v)}}return n}function i8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=t.split(/\r?\n/),c=String(r.length+e-1).length;return r.map((h,p)=>{const s=String(p+e),v=s.length;return zC(s,c-v)+n+h})}function zC(t,e){let n="";for(let r=0;r<e;++r)n+=" ";return"".concat(n).concat(t)}function BC(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const r8="Shader: GLSL source code must be a JavaScript string";class up extends Ua{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return on(!1),"unknown"}}constructor(e,n){My(e),on(typeof n.source=="string",r8);const r=l_(n.source,null)||n.id||zl("unnamed ".concat(up.getTypeName(n.shaderType)));super(e,{id:r}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const r=l_(n,null);r&&(this.id=zl(r)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(up.getTypeName(this.shaderType),":").concat(this.id)}getName(){return l_(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:c,errors:h,warnings:p}=n8(r,this.source,this.shaderType,this.id);throw An.error("GLSL compilation errors in ".concat(c,`
`).concat(h))(),An.warn("GLSL compilation warnings in ".concat(c,`
`).concat(p))(),new Error("GLSL compilation errors in ".concat(c))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Lv extends up{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class kv extends up{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const s8={[5126]:Yi.bind(null,"uniform1fv",Vs,1,as),[35664]:Yi.bind(null,"uniform2fv",Vs,2,as),[35665]:Yi.bind(null,"uniform3fv",Vs,3,as),[35666]:Yi.bind(null,"uniform4fv",Vs,4,as),[5124]:Yi.bind(null,"uniform1iv",yl,1,as),[35667]:Yi.bind(null,"uniform2iv",yl,2,as),[35668]:Yi.bind(null,"uniform3iv",yl,3,as),[35669]:Yi.bind(null,"uniform4iv",yl,4,as),[35670]:Yi.bind(null,"uniform1iv",yl,1,as),[35671]:Yi.bind(null,"uniform2iv",yl,2,as),[35672]:Yi.bind(null,"uniform3iv",yl,3,as),[35673]:Yi.bind(null,"uniform4iv",yl,4,as),[35674]:Yi.bind(null,"uniformMatrix2fv",Vs,4,Ia),[35675]:Yi.bind(null,"uniformMatrix3fv",Vs,9,Ia),[35676]:Yi.bind(null,"uniformMatrix4fv",Vs,16,Ia),[35678]:Yr,[35680]:Yr,[5125]:Yi.bind(null,"uniform1uiv",Lg,1,as),[36294]:Yi.bind(null,"uniform2uiv",Lg,2,as),[36295]:Yi.bind(null,"uniform3uiv",Lg,3,as),[36296]:Yi.bind(null,"uniform4uiv",Lg,4,as),[35685]:Yi.bind(null,"uniformMatrix2x3fv",Vs,6,Ia),[35686]:Yi.bind(null,"uniformMatrix2x4fv",Vs,8,Ia),[35687]:Yi.bind(null,"uniformMatrix3x2fv",Vs,6,Ia),[35688]:Yi.bind(null,"uniformMatrix3x4fv",Vs,12,Ia),[35689]:Yi.bind(null,"uniformMatrix4x2fv",Vs,8,Ia),[35690]:Yi.bind(null,"uniformMatrix4x3fv",Vs,12,Ia),[35678]:Yr,[35680]:Yr,[35679]:Yr,[35682]:Yr,[36289]:Yr,[36292]:Yr,[36293]:Yr,[36298]:Yr,[36299]:Yr,[36300]:Yr,[36303]:Yr,[36306]:Yr,[36307]:Yr,[36308]:Yr,[36311]:Yr},o8={},a8={},l8={},YA=[0];function Mb(t,e,n,r){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(YA[0]=t,t=YA);const c=t.length;if(c%e&&An.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let h=r[c];h||(h=new n(c),r[c]=h);for(let p=0;p<c;p++)h[p]=t[p];return h}function Vs(t,e){return Mb(t,e,Float32Array,o8)}function yl(t,e){return Mb(t,e,Int32Array,a8)}function Lg(t,e){return Mb(t,e,Uint32Array,l8)}function KA(t,e,n){const r=s8[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,t,e)}function c8(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:Boolean(n[2])}}function u8(t,e,n){for(const r in t){const c=t[r];if((!n||Boolean(n[r]))&&!h8(c))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),c),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function h8(t){return Array.isArray(t)||ArrayBuffer.isView(t)?d8(t):isFinite(t)||t===!0||t===!1||t instanceof Rh||t instanceof ah?!0:t instanceof br?Boolean(t.texture):!1}function f8(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const r=t[e];for(let c=0,h=n.length;c<h;++c)r[c]=n[c]}else t[e]=n.slice();else t[e]=n}function d8(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Yr(){let t=null;return(e,n,r)=>{const c=t!==r;return c&&(e.uniform1i(n,r),t=r),c}}function Yi(t,e,n,r){let c=null,h=null;return(p,s,v)=>{const E=e(v,n),M=E.length;let I=!1;if(c===null)c=new Float32Array(M),h=M,I=!0;else{on(h===M,"Uniform length cannot change.");for(let R=0;R<M;++R)if(E[R]!==c[R]){I=!0;break}}return I&&(r(p,t,s,E),c.set(E)),I}}function as(t,e,n,r){t[e](n,r)}function Ia(t,e,n,r){t[e](n,!1,r)}const p8=5120,m8=5121,g8=5122,_8=5123,JA=0,kg=1,y8=2,v8=3,Rg=4,x8=5,b8=6,Lr=5126,w8=35664,E8=35665,T8=35666,xd=5124,A8=35667,S8=35668,M8=35669,bd=5125,P8=36294,I8=36295,C8=36296,L8=35670,k8=35671,R8=35672,O8=35673,D8=35674,z8=35675,B8=35676,F8=35685,N8=35686,U8=35687,V8=35688,j8=35689,G8=35690,Yx={[Lr]:[Lr,1,"float"],[w8]:[Lr,2,"vec2"],[E8]:[Lr,3,"vec3"],[T8]:[Lr,4,"vec4"],[xd]:[xd,1,"int"],[A8]:[xd,2,"ivec2"],[S8]:[xd,3,"ivec3"],[M8]:[xd,4,"ivec4"],[bd]:[bd,1,"uint"],[P8]:[bd,2,"uvec2"],[I8]:[bd,3,"uvec3"],[C8]:[bd,4,"uvec4"],[L8]:[Lr,1,"bool"],[k8]:[Lr,2,"bvec2"],[R8]:[Lr,3,"bvec3"],[O8]:[Lr,4,"bvec4"],[D8]:[Lr,8,"mat2"],[F8]:[Lr,8,"mat2x3"],[N8]:[Lr,8,"mat2x4"],[z8]:[Lr,12,"mat3"],[U8]:[Lr,12,"mat3x2"],[V8]:[Lr,12,"mat3x4"],[B8]:[Lr,16,"mat4"],[j8]:[Lr,16,"mat4x2"],[G8]:[Lr,16,"mat4x3"]};function $8(t){switch(t){case JA:return JA;case kg:return kg;case v8:return kg;case y8:return kg;case Rg:return Rg;case x8:return Rg;case b8:return Rg;default:return on(!1),0}}function QA(t){const e=Yx[t];if(!e)return null;const[n,r]=e;return{type:n,components:r}}function FC(t,e){switch(t){case p8:case m8:case g8:case _8:t=Lr;break}for(const n in Yx){const[r,c,h]=Yx[n];if(r===t&&c===e)return{glType:n,name:h}}return null}class H8{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,r=n.getProgramParameter(e.handle,35721);for(let c=0;c<r;c++){const{name:h,type:p,size:s}=n.getActiveAttrib(e.handle,c),v=n.getAttribLocation(e.handle,h);v>=0&&this._addAttribute(v,h,p,s)}this.attributeInfos.sort((c,h)=>c.location-h.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!ui(n))return;const r=n.getProgramParameter(e.handle,35971);for(let c=0;c<r;c++){const{name:h,type:p,size:s}=n.getTransformFeedbackVarying(e.handle,c);this._addVarying(c,h,p,s)}this.varyingInfos.sort((c,h)=>c.location-h.location)}_addAttribute(e,n,r,c){const{type:h,components:p}=QA(r),s={type:h,size:c*p};this._inferProperties(e,n,s);const v={location:e,name:n,accessor:new Ws(s)};this.attributeInfos.push(v),this.attributeInfosByLocation[e]=v,this.attributeInfosByName[v.name]=v}_inferProperties(e,n,r){/instance/i.test(n)&&(r.divisor=1)}_addVarying(e,n,r,c){const{type:h,components:p}=QA(r),s=new Ws({type:h,size:c*p}),v={location:e,name:n,accessor:s};this.varyingInfos.push(v),this.varyingInfosByName[v.name]=v}}const eS=4,W8=35981,q8=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class NC extends Ua{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",q8),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:r,fs:c,varyings:h,bufferMode:p=W8}=e;return this.hash=n||"",this.vs=typeof r=="string"?new Lv(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof c=="string"?new kv(this.gl,{id:"".concat(e.id,"-fs"),source:c}):c,on(this.vs instanceof Lv),on(this.fs instanceof kv),this.uniforms={},this._textureUniforms={},h&&h.length>0&&(ms(this.gl),this.varyings=h,this.gl2.transformFeedbackVaryings(this.handle,h,p)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new H8(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:r=4,vertexCount:c,offset:h=0,start:p,end:s,isIndexed:v=!1,indexType:E=5123,instanceCount:M=0,isInstanced:I=M>0,vertexArray:R=null,transformFeedback:N,framebuffer:$,parameters:Z={},uniforms:ne,samplers:me}=e;if((ne||me)&&(An.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(ne||{})),An.priority>=n){const we=$?$.id:"default",he="mode=".concat(Rl(this.gl,r)," verts=").concat(c," ")+"instances=".concat(M," indexType=").concat(Rl(this.gl,E)," ")+"isInstanced=".concat(I," isIndexed=").concat(v," ")+"Framebuffer=".concat(we);An.log(n,he)()}return on(R),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||c===0||I&&M===0?!1:(R.bindForDraw(c,M,()=>{if($!==void 0&&(Z=Object.assign({},Z,{framebuffer:$})),N){const we=$8(r);N.begin(we)}this._bindTextures(),oo(this.gl,Z,()=>{v&&I?this.gl2.drawElementsInstanced(r,c,E,h,M):v&&ui(this.gl)&&!isNaN(p)&&!isNaN(s)?this.gl2.drawRangeElements(r,p,s,c,E,h):v?this.gl.drawElements(r,c,E,h):I?this.gl2.drawArraysInstanced(r,h,c,M):this.gl.drawArrays(r,h,c)}),N&&N.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};An.priority>=2&&u8(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const r=e[n],c=this._uniformSetters[n];if(c){let h=r,p=!1;if(h instanceof br&&(h=h.texture),h instanceof Rh)if(p=this.uniforms[n]!==r,p){c.textureIndex===void 0&&(c.textureIndex=this._textureIndexCounter++);const s=h,{textureIndex:v}=c;s.bind(v),h=v,this._textureUniforms[n]=s}else h=c.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(c(h)||p)&&f8(this.uniforms,n,r)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const r=this._textureUniforms[n];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),r={};for(const c of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new Lv({handle:c});break;case 35632:r.fs=new kv({handle:c});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=zl(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),An.time(eS,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),An.timeEnd(eS,"linkProgram for ".concat(this._getName()))(),e.debug||An.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const r=this.gl.getActiveUniform(this.handle,n),{name:c}=c8(r.name);let h=e.getUniformLocation(this.handle,c);if(this._uniformSetters[c]=KA(e,h,r),r.size>1)for(let p=0;p<r.size;p++)h=e.getUniformLocation(this.handle,"".concat(c,"[").concat(p,"]")),this._uniformSetters["".concat(c,"[").concat(p,"]")]=KA(e,h,r)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const Z8=34918,X8=34919,Y8=35007,K8=36795,J8=35976,Q8=35887,eG=36202;class N_ extends Ua{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=ui(e),c=Sb(e,Ki.TIMER_QUERY);let h=r||c;for(const p of n)switch(p){case"queries":h=h&&r;break;case"timers":h=h&&c;break;default:on(!1)}return h}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(Y8)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?eG:Q8)}beginTransformFeedbackQuery(){return this.begin(J8)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,X8);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(K8)}getResult(){return this.gl2.getQueryParameter(this.handle,Z8)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((r,c)=>{const h=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):n++>e?(c("Timed out"),this._pollingPromise=null):requestAnimationFrame(h)};requestAnimationFrame(h)}),this._pollingPromise}_createHandle(){return N_.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class UC extends Ua{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return ui(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ms(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,kh(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const r=this._getVaryingIndex(e),{buffer:c,byteSize:h,byteOffset:p}=this._getBufferParams(n);return r<0?(this.unused[e]=c,An.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=n,this.bindOnUse||this._bindBuffer(r,c,p,h),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,r,c;return e instanceof Ui?c=e:(c=e.buffer,r=e.byteSize,n=e.byteOffset),(n!==void 0||r!==void 0)&&(n=n||0,r=r||c.byteLength-n),{buffer:c,byteOffset:n,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:r,byteOffset:c}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,c,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c=arguments.length>3?arguments[3]:void 0;const h=n&&n.handle;return!h||c===void 0?this.gl.bindBufferBase(35982,e,h):this.gl.bindBufferRange(35982,e,h,r,c),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let Og=null;function tG(t){return(!Og||Og.byteLength<t)&&(Og=new ArrayBuffer(t)),Og}function nG(t,e){const n=tG(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function iG(t){let{target:e,source:n,start:r=0,count:c=1}=t;const h=n.length,p=c*h;let s=0;for(let v=r;s<h;s++)e[v++]=n[s];for(;s<p;)s<p-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+p-s),s=p);return e}const rG="elements must be GL.ELEMENT_ARRAY_BUFFER";class Gs extends Ua{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?ui(e)||lC()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Gs(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Gs.MAX_ATTRIBUTES=Gs.MAX_ATTRIBUTES||e.getParameter(34921),Gs.MAX_ATTRIBUTES}static setConstant(e,n,r){switch(r.constructor){case Float32Array:Gs._setConstantFloatArray(e,n,r);break;case Int32Array:Gs._setConstantIntArray(e,n,r);break;case Uint32Array:Gs._setConstantUintArray(e,n,r);break;default:on(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Gs.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return on(!e||e.target===34963,rG),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,r){if(n.target===34963)return this.setElementBuffer(n,r);const{size:c,type:h,stride:p,offset:s,normalized:v,integer:E,divisor:M}=r,{gl:I,gl2:R}=this;return e=Number(e),this.bind(()=>{I.bindBuffer(34962,n.handle),E?(on(ui(I)),R.vertexAttribIPointer(e,c,h,p,s)):I.vertexAttribPointer(e,c,h,v,p,s),I.enableVertexAttribArray(e),R.vertexAttribDivisor(e,M||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!Gs.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const r=this._normalizeConstantArrayValue(n),c=r.byteLength*e,h=r.length*e;let p=!this.buffer;if(this.buffer=this.buffer||new Ui(this.gl,c),p=p||this.buffer.reallocate(c),p=p||!this._compareConstantArrayValues(r,this.bufferValue),p){const s=nG(n.constructor,h);iG({target:s,source:r,start:0,count:h}),this.buffer.subData(s),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==n[r])return!1;return!0}static _setConstantFloatArray(e,n,r){switch(r.length){case 1:e.vertexAttrib1fv(n,r);break;case 2:e.vertexAttrib2fv(n,r);break;case 3:e.vertexAttrib3fv(n,r);break;case 4:e.vertexAttrib4fv(n,r);break;default:on(!1)}}static _setConstantIntArray(e,n,r){switch(on(ui(e)),r.length){case 1:e.vertexAttribI1iv(n,r);break;case 2:e.vertexAttribI2iv(n,r);break;case 3:e.vertexAttribI3iv(n,r);break;case 4:e.vertexAttribI4iv(n,r);break;default:on(!1)}}static _setConstantUintArray(e,n,r){switch(on(ui(e)),r.length){case 1:e.vertexAttribI1uiv(n,r);break;case 2:e.vertexAttribI2uiv(n,r);break;case 3:e.vertexAttribI3uiv(n,r);break;case 4:e.vertexAttribI4uiv(n,r);break;default:on(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:r}=n;return on(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const sG="VertexArray: attributes must be Buffers or constants (i.e. typed array)",oG=/^(.+)__LOCATION_([0-9]+)$/,aG=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class lG{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Gs(e),PC(this,"VertexArray","v6.0",aG),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const r=e[n];this._setAttribute(n,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,r);const{location:c,accessor:h}=this._resolveLocationAndAccessor(e,n,n.accessor,r);return c>=0&&(this.values[c]=n,this.accessors[c]=h,this.clearDrawParams(),this.vertexArrayObject.setBuffer(c,n,h)),this}setConstant(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:c,accessor:h}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},r));return c>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[c]=n,this.accessors[c]=h,this.clearDrawParams(),this.vertexArrayObject.enable(c,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Ui(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof Ui&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof Ui&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,r){let c;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),c=r()}),c}_resolveLocationAndAccessor(e,n,r,c){const h={location:-1,accessor:null},{location:p,name:s}=this._getAttributeIndex(e);if(!Number.isFinite(p)||p<0)return this.unused[e]=n,An.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),h;const v=this._getAttributeInfo(s||p);if(!v)return h;const E=this.accessors[p]||{},M=Ws.resolve(v.accessor,E,r,c),{size:I,type:R}=M;return on(Number.isFinite(I)&&Number.isFinite(R)),{location:p,accessor:M}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const r=oG.exec(e),c=r?r[1]:e,h=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(c)+h,name:c}:{location:-1}}_setAttribute(e,n){if(n instanceof Ui)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof Ui){const r=n[0],c=n[1];this.setBuffer(e,r,c)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const r=n;this.setConstant(e,r)}else if(n.buffer instanceof Ui){const r=n;this.setBuffer(e,r.buffer,r)}else throw new Error(sG)}_setConstantAttributes(e,n){const r=Math.max(e|0,n|0);let c=this.values[0];ArrayBuffer.isView(c)&&this._setConstantAttributeZero(c,r);for(let h=1;h<this.vertexArrayObject.MAX_ATTRIBUTES;h++)c=this.values[h],ArrayBuffer.isView(c)&&this._setConstantAttribute(h,c)}_setConstantAttributeZero(e,n){if(Gs.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,n){Gs.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const r=this.values[n],c=this.accessors[n];if(!r)return;const{divisor:h}=c,p=h>0;if(e.isInstanced=e.isInstanced||p,r instanceof Ui){const s=r;if(p){const v=s.getVertexCount(c);e.instanceCount=Math.min(e.instanceCount,v)}else{const v=s.getVertexCount(c);e.vertexCount=Math.min(e.vertexCount,v)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return An.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function cG(t,e){const{maxElts:n=16,size:r=1}=e;let c="[";for(let p=0;p<t.length&&p<n;++p)p>0&&(c+=",".concat(p%r===0?" ":"")),c+=hp(t[p],e);const h=t.length>n?"...":"]";return"".concat(c).concat(h)}function hp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:r=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return cG(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return r?"0":"0.";if(r||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const c=t.toPrecision(2);return c.indexOf(".0")===c.length-2?c.slice(0,-1):c}function tS(t){let{header:e="Uniforms",program:n,uniforms:r,undefinedOnly:c=!1}=t;on(n);const h=".*_.*",p=".*Matrix",s=n._uniformSetters,v={},E=Object.keys(s).sort();let M=0;for(const N of E)!N.match(h)&&!N.match(p)&&Rv({table:v,header:e,uniforms:r,uniformName:N,undefinedOnly:c})&&M++;for(const N of E)N.match(p)&&Rv({table:v,header:e,uniforms:r,uniformName:N,undefinedOnly:c})&&M++;for(const N of E)v[N]||Rv({table:v,header:e,uniforms:r,uniformName:N,undefinedOnly:c})&&M++;let I=0;const R={};if(!c)for(const N in r){const $=r[N];v[N]||(I++,R[N]={Type:"NOT USED: ".concat($),[e]:hp($)})}return{table:v,count:M,unusedTable:R,unusedCount:I}}function Rv(t){let{table:e,header:n,uniforms:r,uniformName:c,undefinedOnly:h}=t;const p=r[c],s=uG(p);return!h||!s?(e[c]={[n]:s?hp(p):"N/A","Uniform Type":s?p:"NOT PROVIDED"},!0):!1}function uG(t){return t!=null}function hG(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=nS(e,e.elements,null,n));const c=e.values;for(const h in c){const p=e._getAttributeInfo(h);if(p){let s="".concat(h,": ").concat(p.name);const v=e.accessors[p.location];v&&(s="".concat(h,": ").concat(fG(p.name,v))),r[s]=nS(e,c[h],v,n)}}return r}function nS(t,e,n,r){const{gl:c}=t;if(!e)return{[r]:"null","Format ":"N/A"};let h="NOT PROVIDED",p=1,s=0,v=0,E,M,I;if(n&&(h=n.type,p=n.size,h=String(h).replace("Array",""),E=h.indexOf("nt")!==-1),e instanceof Ui){const R=e,{data:N,changed:$}=R.getDebugData();M=$?"*":"",I=N,v=R.byteLength,s=v/N.BYTES_PER_ELEMENT/p;let Z;if(n){const ne=n.divisor>0;Z="".concat(ne?"I ":"P "," ").concat(s," (x").concat(p,"=").concat(v," bytes ").concat(Rl(c,h),")")}else E=!0,Z="".concat(v," bytes");return{[r]:"".concat(M).concat(hp(I,{size:p,isInteger:E})),"Format ":Z}}return I=e,p=e.length,h=String(e.constructor.name).replace("Array",""),E=h.indexOf("nt")!==-1,{[r]:"".concat(hp(I,{size:p,isInteger:E})," (constant)"),"Format ":"".concat(p,"x").concat(h," (constant)")}}function fG(t,e){const{type:n,size:r}=e,c=FC(n,r);return c?"".concat(t," (").concat(c.name,")"):t}function dG(t){const e={},n="Accessors for ".concat(t.id);for(const r of t.attributeInfos)if(r){const c=iS(r);e["in ".concat(c)]={[n]:JSON.stringify(r.accessor)}}for(const r of t.varyingInfos)if(r){const c=iS(r);e["out ".concat(c)]={[n]:JSON.stringify(r.accessor)}}return e}function iS(t){const{type:e,size:n}=t.accessor,r=FC(e,n);return r?"".concat(r.name," ").concat(t.name):t.name}const rS=Na()&&typeof document<"u";let pG=0;class mG{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=ne=>MC(ne),onAddHTML:r=null,onInitialize:c=()=>{},onRender:h=()=>{},onFinalize:p=()=>{},onError:s,gl:v=null,glOptions:E={},debug:M=!1,createFramebuffer:I=!1,autoResizeViewport:R=!0,autoResizeDrawingBuffer:N=!0,stats:$=Nc.get("animation-loop-".concat(pG++))}=e;let{useDevicePixels:Z=!0}=e;"useDevicePixelRatio"in e&&(An.deprecated("useDevicePixelRatio","useDevicePixels")(),Z=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:r,onInitialize:c,onRender:h,onFinalize:p,onError:s,gl:v,glOptions:E,debug:M,createFramebuffer:I},this.gl=v,this.needsRedraw=null,this.timeline=null,this.stats=$,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:R,autoResizeDrawingBuffer:N,useDevicePixels:Z}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return on(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=N_.isSupported(this.gl,["timers"])?new N_(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):n}setViewParameters(){return An.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{!this._running||(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=rS?new Promise((e,n)=>{if(rS&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):bj(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):xj(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Eb(this.props.gl,e):this.onCreateContext(e),!Sy(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");aj(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let r=1;const{canvas:c}=this.gl;return c&&c.clientHeight?r=c.clientWidth/c.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&fj(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new br(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const kp="vs",Pb="fs";function Zs(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Ov={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function gG(t){const e={};for(const n in t){const r=t[n],c=_G(r);e[n]=c}return e}function _G(t){let e=sS(t);return e==="object"?t?"type"in t?Object.assign({},t,Ov[t.type]):"value"in t?(e=sS(t.value),Object.assign({type:e},t,Ov[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},Ov[e])}function sS(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const yG="vs",vG="fs";class oS{constructor(e){let{name:n,vs:r,fs:c,dependencies:h=[],uniforms:p,getUniforms:s,deprecations:v=[],defines:E={},inject:M={},vertexShader:I,fragmentShader:R}=e;Zs(typeof n=="string"),this.name=n,this.vs=r||I,this.fs=c||R,this.getModuleUniforms=s,this.dependencies=h,this.deprecations=this._parseDeprecationDefinitions(v),this.defines=E,this.injections=xG(M),p&&(this.uniforms=gG(p))}getModuleSource(e){let n;switch(e){case yG:n=this.vs||"";break;case vG:n=this.fs||"";break;default:Zs(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},r=this.uniforms;for(const c in r){const h=r[c];c in e&&!h.private?(h.validate&&Zs(h.validate(e[c],h),"".concat(this.name,": invalid ").concat(c)),n[c]=e[c]):n[c]=h.value}return n}}function xG(t){const e={vs:{},fs:{}};for(const n in t){let r=t[n];const c=n.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[c][n]=r}return e}function bG(t){return wG(jC(t))}function wG(t){const e={},n={};return VC({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,c)=>n[c]-n[r]).map(r=>e[r])}function VC(t){let{modules:e,level:n,moduleMap:r,moduleDepth:c}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const h of e)r[h.name]=h,(c[h.name]===void 0||c[h.name]<n)&&(c[h.name]=n);for(const h of e)h.dependencies&&VC({modules:h.dependencies,level:n+1,moduleMap:r,moduleDepth:c})}function jC(t,e){return t.map(n=>(n instanceof oS||(Zs(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),Zs(n.name,"shader module has no name"),n=new oS(n),n.dependencies=jC(n.dependencies)),n))}function EG(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",r=n.indexOf("MSIE ")!==-1,c=n.indexOf("Trident/")!==-1;return r||c}const TG=7936,AG=7937,SG=7938,MG=35724,Ib={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Lc={};Object.keys(Ib).forEach(t=>{Lc[t]=t});function PG(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function IG(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||TG),r=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||AG);return{gpuVendor:CG(n,r),vendor:n,renderer:r,version:t.getParameter(SG),shadingLanguageVersion:t.getParameter(MG)}}function CG(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const Dv={};function aS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Ib[e];if(Zs(r,e),!EG(n))return!0;if(e in Dv)return Dv[e];const c=r[0],h=n.behavior||"enable",p="#extension GL_".concat(c," : ").concat(h,`
void main(void) {}`),s=t.createShader(35633);t.shaderSource(s,p),t.compileShader(s);const v=t.getShaderParameter(s,35713);return t.deleteShader(s),Dv[e]=v,v}function LG(t,e){const n=Ib[e];Zs(n,e);const r=PG(t)&&n[1]||n[0],c=typeof r=="string"?Boolean(t.getExtension(r)):r;return Zs(c===!1||c===!0),c}function Dg(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>LG(t,n))}function kG(t){switch(IG(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function RG(t,e,n){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Dg(t,Lc.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Dg(t,Lc.GLSL_DERIVATIVES)&&aS(t,Lc.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Dg(t,Lc.GLSL_FRAG_DATA)&&aS(t,Lc.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Dg(t,Lc.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const OG=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,DG=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,zG={[kp]:OG,[Pb]:DG},c_="__LUMA_INJECT_DECLARATIONS__",lS=/void\s+main\s*\([^)]*\)\s*\{\n?/,cS=/}\n?[^{}]*$/,zv=[];function uS(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const c=e===kp;for(const h in n){const p=n[h];p.sort((v,E)=>v.order-E.order),zv.length=p.length;for(let v=0,E=p.length;v<E;++v)zv[v]=p[v].injection;const s="".concat(zv.join(`
`),`
`);switch(h){case"vs:#decl":c&&(t=t.replace(c_,s));break;case"vs:#main-start":c&&(t=t.replace(lS,v=>v+s));break;case"vs:#main-end":c&&(t=t.replace(cS,v=>s+v));break;case"fs:#decl":c||(t=t.replace(c_,s));break;case"fs:#main-start":c||(t=t.replace(lS,v=>v+s));break;case"fs:#main-end":c||(t=t.replace(cS,v=>s+v));break;default:t=t.replace(h,v=>v+s)}}return t=t.replace(c_,""),r&&(t=t.replace(/\}\s*$/,h=>h+zG[e])),t}function Kx(t){const e={};return Zs(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const r in n)e[r]=e[r]?"".concat(e[r],`
`).concat(n[r]):n[r]}),e}function Oh(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const GC=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],BG=[...GC,[Oh("attribute"),"in $1"],[Oh("varying"),"out $1"]],FG=[...GC,[Oh("varying"),"in $1"]],$C=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],NG=[...$C,[Oh("in"),"attribute $1"],[Oh("out"),"varying $1"]],UG=[...$C,[Oh("in"),"varying $1"]],Jx="gl_FragColor",Qx=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,VG=/void\s+main\s*\([^)]*\)\s*\{\n?/;function jG(t,e,n){switch(e){case 300:return n?U_(t,BG):GG(t);case 100:return n?U_(t,NG):$G(t);default:throw new Error("unknown GLSL version ".concat(e))}}function U_(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function GG(t){t=U_(t,FG);const e=t.match(Qx);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(Jx,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(VG,r=>"out vec4 ".concat(n,`;
`).concat(r)).replace(new RegExp("\\b".concat(Jx,"\\b"),"g"),n)}return t}function $G(t){t=U_(t,UG);const e=t.match(Qx);if(e){const n=e[1];t=t.replace(Qx,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),Jx)}return t}const HG=`

`.concat(c_,`

`),HC={[kp]:"vertex",[Pb]:"fragment"},WG=`precision highp float;

`;function qG(t,e){const{vs:n,fs:r}=e,c=bG(e.modules||[]);return{gl:t,vs:hS(t,Object.assign({},e,{source:n,type:kp,modules:c})),fs:hS(t,Object.assign({},e,{source:r,type:Pb,modules:c})),getUniforms:ZG(c)}}function hS(t,e){let{id:n,source:r,type:c,modules:h,defines:p={},hookFunctions:s=[],inject:v={},transpileToGLSL100:E=!1,prologue:M=!0,log:I}=e;Zs(typeof r=="string","shader source must be a string");const R=c===kp,N=r.split(`
`);let $=100,Z="",ne=r;N[0].indexOf("#version ")===0?($=300,Z=N[0],ne=N.slice(1).join(`
`)):Z="#version ".concat($);const me={};h.forEach(Tt=>{Object.assign(me,Tt.getDefines())}),Object.assign(me,p);let we=M?"".concat(Z,`
`).concat(YG({id:n,source:r,type:c}),`
`).concat(XG({type:c}),`
`).concat(kG(t),`
`).concat(RG(t),`
`).concat(KG(me),`
`).concat(R?"":WG,`
`):"".concat(Z,`
`);const he=QG(s),Pe={},ge={},nt={};for(const Tt in v){const Rt=typeof v[Tt]=="string"?{injection:v[Tt],order:0}:v[Tt],ke=Tt.match(/^(v|f)s:(#)?([\w-]+)$/);if(ke){const It=ke[2],xt=ke[3];It?xt==="decl"?ge[Tt]=[Rt]:nt[Tt]=[Rt]:Pe[Tt]=[Rt]}else nt[Tt]=[Rt]}for(const Tt of h){I&&Tt.checkDeprecations(ne,I);const Rt=Tt.getModuleSource(c,$);we+=Rt;const ke=Tt.injections[c];for(const It in ke){const xt=It.match(/^(v|f)s:#([\w-]+)$/);if(xt){const an=xt[2]==="decl"?ge:nt;an[It]=an[It]||[],an[It].push(ke[It])}else Pe[It]=Pe[It]||[],Pe[It].push(ke[It])}}return we+=HG,we=uS(we,c,ge),we+=JG(he[c],Pe),we+=ne,we=uS(we,c,nt),we=jG(we,E?100:$,R),we}function ZG(t){return function(n){const r={};for(const c of t){const h=c.getUniforms(n,r);Object.assign(r,h)}return r}}function XG(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(HC[e].toUpperCase(),`
`)}function YG(t){let{id:e,source:n,type:r}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(HC[r],`

`):""}function KG(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const r in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const c=t[r];(c||Number.isFinite(c))&&(n+="#define ".concat(r.toUpperCase()," ").concat(t[r],`
`))}return e===0&&(n+=`
`),n}function JG(t,e){let n="";for(const r in t){const c=t[r];if(n+="void ".concat(c.signature,` {
`),c.header&&(n+="  ".concat(c.header)),e[r]){const h=e[r];h.sort((p,s)=>p.order-s.order);for(const p of h)n+="  ".concat(p.injection,`
`)}c.footer&&(n+="  ".concat(c.footer)),n+=`}
`}return n}function QG(t){const e={vs:{},fs:{}};return t.forEach(n=>{let r;typeof n!="string"?(r=n,n=r.hook):r={},n=n.trim();const[c,h]=n.split(":"),p=n.replace(/\(.+/,"");e[c][p]=Object.assign(r,{signature:h})}),e}const e7="void main() {gl_FragColor = vec4(0);}",WC=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,t7=`#version 300 es
`.concat(WC);function qC(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[r,c,h]=n;if(!e.includes(r)||!c||!h)return null;const p=h.split(";")[0];return{qualifier:r,type:c,name:p}}function ZC(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:r,output:c}=t;if(!n)return e===300?t7:e>300?"#version ".concat(e,`
`).concat(WC):e7;const h=r7(n,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(n,`;
out vec4 `).concat(c,`;
void main() {
  `).concat(c," = ").concat(h,`;
}`):"varying ".concat(r," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(h,`;
}`)}function n7(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Zs(!1),null}}function i7(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Zs(!1),null}}function r7(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Zs(!1),null}}const s7=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,o7={name:"fp32",vs:s7,fs:null};function fS(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const qs={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function a7(t,{precision:e=qs.precision}={}){return t=l7(t),"".concat(parseFloat(t.toPrecision(e)))}function Dh(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Jr(t,e,n){return u7(t,r=>Math.max(e,Math.min(n,r)))}function V_(t,e,n){return Dh(t)?t.map((r,c)=>V_(r,e[c],n)):n*e+(1-n)*t}function zh(t,e,n){const r=qs.EPSILON;n&&(qs.EPSILON=n);try{if(t===e)return!0;if(Dh(t)&&Dh(e)){if(t.length!==e.length)return!1;for(let c=0;c<t.length;++c)if(!zh(t[c],e[c]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=qs.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{qs.EPSILON=r}}function l7(t){return Math.round(t/qs.EPSILON)*qs.EPSILON}function c7(t){return t.clone?t.clone():new Array(t.length)}function u7(t,e,n){if(Dh(t)){const r=t;n=n||c7(r);for(let c=0;c<n.length&&c<r.length;++c)n[c]=e(t[c],c,n);return n}return e(t)}function h7(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class XC extends h7(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Dh(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(qs)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+a7(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!zh(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let c=0;c<this.ELEMENTS;++c){const h=e[c];this[c]=h+r*(n[c]-h)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(qs.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function f7(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function $s(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Bv(t,e,n=""){if(qs.debug&&!f7(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class d7 extends XC{get x(){return this[0]}set x(e){this[0]=$s(e)}get y(){return this[1]}set y(e){this[1]=$s(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const c=this[r]-e[r];n+=c*c}return $s(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return $s(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return fS(e>=0&&e<this.ELEMENTS,"index is out of range"),$s(this[e])}setComponent(e,n){return fS(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var u_=1e-6,Bh=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function p7(){var t=new Bh(2);return Bh!=Float32Array&&(t[0]=0,t[1]=0),t}function j_(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function YC(t,e){return t[0]=-e[0],t[1]=-e[1],t}function KC(t,e,n,r){var c=e[0],h=e[1];return t[0]=c+r*(n[0]-c),t[1]=h+r*(n[1]-h),t}function m7(t,e,n){var r=e[0],c=e[1];return t[0]=n[0]*r+n[4]*c+n[12],t[1]=n[1]*r+n[5]*c+n[13],t}(function(){var t=p7();return function(e,n,r,c,h,p){var s,v;for(n||(n=2),r||(r=0),c?v=Math.min(c*n+r,e.length):v=e.length,s=r;s<v;s+=n)t[0]=e[s],t[1]=e[s+1],h(t,t,p),e[s]=t[0],e[s+1]=t[1];return e}})();function g7(t,e,n){const r=e[0],c=e[1],h=n[3]*r+n[7]*c||1;return t[0]=(n[0]*r+n[4]*c)/h,t[1]=(n[1]*r+n[5]*c)/h,t}function JC(t,e,n){const r=e[0],c=e[1],h=e[2],p=n[3]*r+n[7]*c+n[11]*h||1;return t[0]=(n[0]*r+n[4]*c+n[8]*h)/p,t[1]=(n[1]*r+n[5]*c+n[9]*h)/p,t[2]=(n[2]*r+n[6]*c+n[10]*h)/p,t}function _7(t,e,n){const r=e[0],c=e[1];return t[0]=n[0]*r+n[2]*c,t[1]=n[1]*r+n[3]*c,t[2]=e[2],t}function y7(){var t=new Bh(3);return Bh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function v7(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function x7(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function b7(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function w7(t,e,n){var r=e[0],c=e[1],h=e[2],p=n[0],s=n[1],v=n[2];return t[0]=c*v-h*s,t[1]=h*p-r*v,t[2]=r*s-c*p,t}function QC(t,e,n){var r=e[0],c=e[1],h=e[2],p=n[3]*r+n[7]*c+n[11]*h+n[15];return p=p||1,t[0]=(n[0]*r+n[4]*c+n[8]*h+n[12])/p,t[1]=(n[1]*r+n[5]*c+n[9]*h+n[13])/p,t[2]=(n[2]*r+n[6]*c+n[10]*h+n[14])/p,t}function E7(t,e,n){var r=e[0],c=e[1],h=e[2];return t[0]=r*n[0]+c*n[3]+h*n[6],t[1]=r*n[1]+c*n[4]+h*n[7],t[2]=r*n[2]+c*n[5]+h*n[8],t}function T7(t,e,n){var r=n[0],c=n[1],h=n[2],p=n[3],s=e[0],v=e[1],E=e[2],M=c*E-h*v,I=h*s-r*E,R=r*v-c*s,N=c*R-h*I,$=h*M-r*R,Z=r*I-c*M,ne=p*2;return M*=ne,I*=ne,R*=ne,N*=2,$*=2,Z*=2,t[0]=s+M+N,t[1]=v+I+$,t[2]=E+R+Z,t}function A7(t,e,n,r){var c=[],h=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],h[0]=c[0],h[1]=c[1]*Math.cos(r)-c[2]*Math.sin(r),h[2]=c[1]*Math.sin(r)+c[2]*Math.cos(r),t[0]=h[0]+n[0],t[1]=h[1]+n[1],t[2]=h[2]+n[2],t}function S7(t,e,n,r){var c=[],h=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],h[0]=c[2]*Math.sin(r)+c[0]*Math.cos(r),h[1]=c[1],h[2]=c[2]*Math.cos(r)-c[0]*Math.sin(r),t[0]=h[0]+n[0],t[1]=h[1]+n[1],t[2]=h[2]+n[2],t}function M7(t,e,n,r){var c=[],h=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],h[0]=c[0]*Math.cos(r)-c[1]*Math.sin(r),h[1]=c[0]*Math.sin(r)+c[1]*Math.cos(r),h[2]=c[2],t[0]=h[0]+n[0],t[1]=h[1]+n[1],t[2]=h[2]+n[2],t}function P7(t,e){var n=t[0],r=t[1],c=t[2],h=e[0],p=e[1],s=e[2],v=Math.sqrt(n*n+r*r+c*c),E=Math.sqrt(h*h+p*p+s*s),M=v*E,I=M&&b7(t,e)/M;return Math.acos(Math.min(Math.max(I,-1),1))}var I7=v7;(function(){var t=y7();return function(e,n,r,c,h,p){var s,v;for(n||(n=3),r||(r=0),c?v=Math.min(c*n+r,e.length):v=e.length,s=r;s<v;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],h(t,t,p),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();const Fv=[0,0,0];let zg;class fa extends d7{static get ZERO(){return zg||(zg=new fa(0,0,0),Object.freeze(zg)),zg}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Dh(e)?this.copy(e):(qs.debug&&($s(e),$s(n),$s(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return qs.debug&&($s(e.x),$s(e.y),$s(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=$s(e)}angle(e){return P7(this,e)}cross(e){return w7(this,this,e),this.check()}rotateX({radians:e,origin:n=Fv}){return A7(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Fv}){return S7(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Fv}){return M7(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return QC(this,this,e),this.check()}transformAsVector(e){return JC(this,this,e),this.check()}transformByMatrix3(e){return E7(this,this,e),this.check()}transformByMatrix2(e){return _7(this,this,e),this.check()}transformByQuaternion(e){return T7(this,this,e),this.check()}}class C7 extends XC{toString(){let e="[";if(qs.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=$s(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let c=0;c<this.RANK;++c)n[c]=this[r+c];return n}setColumn(e,n){const r=e*this.RANK;for(let c=0;c<this.RANK;++c)this[r+c]=n[c];return this}}function L7(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function k7(t,e){if(t===e){var n=e[1],r=e[2],c=e[3],h=e[6],p=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=h,t[11]=e[14],t[12]=c,t[13]=p,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function e1(t,e){var n=e[0],r=e[1],c=e[2],h=e[3],p=e[4],s=e[5],v=e[6],E=e[7],M=e[8],I=e[9],R=e[10],N=e[11],$=e[12],Z=e[13],ne=e[14],me=e[15],we=n*s-r*p,he=n*v-c*p,Pe=n*E-h*p,ge=r*v-c*s,nt=r*E-h*s,Tt=c*E-h*v,Rt=M*Z-I*$,ke=M*ne-R*$,It=M*me-N*$,xt=I*ne-R*Z,gn=I*me-N*Z,an=R*me-N*ne,ln=we*an-he*gn+Pe*xt+ge*It-nt*ke+Tt*Rt;return ln?(ln=1/ln,t[0]=(s*an-v*gn+E*xt)*ln,t[1]=(c*gn-r*an-h*xt)*ln,t[2]=(Z*Tt-ne*nt+me*ge)*ln,t[3]=(R*nt-I*Tt-N*ge)*ln,t[4]=(v*It-p*an-E*ke)*ln,t[5]=(n*an-c*It+h*ke)*ln,t[6]=(ne*Pe-$*Tt-me*he)*ln,t[7]=(M*Tt-R*Pe+N*he)*ln,t[8]=(p*gn-s*It+E*Rt)*ln,t[9]=(r*It-n*gn-h*Rt)*ln,t[10]=($*nt-Z*Pe+me*we)*ln,t[11]=(I*Pe-M*nt-N*we)*ln,t[12]=(s*ke-p*xt-v*Rt)*ln,t[13]=(n*xt-r*ke+c*Rt)*ln,t[14]=(Z*he-$*ge-ne*we)*ln,t[15]=(M*ge-I*he+R*we)*ln,t):null}function R7(t){var e=t[0],n=t[1],r=t[2],c=t[3],h=t[4],p=t[5],s=t[6],v=t[7],E=t[8],M=t[9],I=t[10],R=t[11],N=t[12],$=t[13],Z=t[14],ne=t[15],me=e*p-n*h,we=e*s-r*h,he=e*v-c*h,Pe=n*s-r*p,ge=n*v-c*p,nt=r*v-c*s,Tt=E*$-M*N,Rt=E*Z-I*N,ke=E*ne-R*N,It=M*Z-I*$,xt=M*ne-R*$,gn=I*ne-R*Z;return me*gn-we*xt+he*It+Pe*ke-ge*Rt+nt*Tt}function Hc(t,e,n){var r=e[0],c=e[1],h=e[2],p=e[3],s=e[4],v=e[5],E=e[6],M=e[7],I=e[8],R=e[9],N=e[10],$=e[11],Z=e[12],ne=e[13],me=e[14],we=e[15],he=n[0],Pe=n[1],ge=n[2],nt=n[3];return t[0]=he*r+Pe*s+ge*I+nt*Z,t[1]=he*c+Pe*v+ge*R+nt*ne,t[2]=he*h+Pe*E+ge*N+nt*me,t[3]=he*p+Pe*M+ge*$+nt*we,he=n[4],Pe=n[5],ge=n[6],nt=n[7],t[4]=he*r+Pe*s+ge*I+nt*Z,t[5]=he*c+Pe*v+ge*R+nt*ne,t[6]=he*h+Pe*E+ge*N+nt*me,t[7]=he*p+Pe*M+ge*$+nt*we,he=n[8],Pe=n[9],ge=n[10],nt=n[11],t[8]=he*r+Pe*s+ge*I+nt*Z,t[9]=he*c+Pe*v+ge*R+nt*ne,t[10]=he*h+Pe*E+ge*N+nt*me,t[11]=he*p+Pe*M+ge*$+nt*we,he=n[12],Pe=n[13],ge=n[14],nt=n[15],t[12]=he*r+Pe*s+ge*I+nt*Z,t[13]=he*c+Pe*v+ge*R+nt*ne,t[14]=he*h+Pe*E+ge*N+nt*me,t[15]=he*p+Pe*M+ge*$+nt*we,t}function G_(t,e,n){var r=n[0],c=n[1],h=n[2],p,s,v,E,M,I,R,N,$,Z,ne,me;return e===t?(t[12]=e[0]*r+e[4]*c+e[8]*h+e[12],t[13]=e[1]*r+e[5]*c+e[9]*h+e[13],t[14]=e[2]*r+e[6]*c+e[10]*h+e[14],t[15]=e[3]*r+e[7]*c+e[11]*h+e[15]):(p=e[0],s=e[1],v=e[2],E=e[3],M=e[4],I=e[5],R=e[6],N=e[7],$=e[8],Z=e[9],ne=e[10],me=e[11],t[0]=p,t[1]=s,t[2]=v,t[3]=E,t[4]=M,t[5]=I,t[6]=R,t[7]=N,t[8]=$,t[9]=Z,t[10]=ne,t[11]=me,t[12]=p*r+M*c+$*h+e[12],t[13]=s*r+I*c+Z*h+e[13],t[14]=v*r+R*c+ne*h+e[14],t[15]=E*r+N*c+me*h+e[15]),t}function Cb(t,e,n){var r=n[0],c=n[1],h=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*h,t[9]=e[9]*h,t[10]=e[10]*h,t[11]=e[11]*h,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function O7(t,e,n,r){var c=r[0],h=r[1],p=r[2],s=Math.hypot(c,h,p),v,E,M,I,R,N,$,Z,ne,me,we,he,Pe,ge,nt,Tt,Rt,ke,It,xt,gn,an,ln,$t;return s<u_?null:(s=1/s,c*=s,h*=s,p*=s,v=Math.sin(n),E=Math.cos(n),M=1-E,I=e[0],R=e[1],N=e[2],$=e[3],Z=e[4],ne=e[5],me=e[6],we=e[7],he=e[8],Pe=e[9],ge=e[10],nt=e[11],Tt=c*c*M+E,Rt=h*c*M+p*v,ke=p*c*M-h*v,It=c*h*M-p*v,xt=h*h*M+E,gn=p*h*M+c*v,an=c*p*M+h*v,ln=h*p*M-c*v,$t=p*p*M+E,t[0]=I*Tt+Z*Rt+he*ke,t[1]=R*Tt+ne*Rt+Pe*ke,t[2]=N*Tt+me*Rt+ge*ke,t[3]=$*Tt+we*Rt+nt*ke,t[4]=I*It+Z*xt+he*gn,t[5]=R*It+ne*xt+Pe*gn,t[6]=N*It+me*xt+ge*gn,t[7]=$*It+we*xt+nt*gn,t[8]=I*an+Z*ln+he*$t,t[9]=R*an+ne*ln+Pe*$t,t[10]=N*an+me*ln+ge*$t,t[11]=$*an+we*ln+nt*$t,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function eL(t,e,n){var r=Math.sin(n),c=Math.cos(n),h=e[4],p=e[5],s=e[6],v=e[7],E=e[8],M=e[9],I=e[10],R=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=h*c+E*r,t[5]=p*c+M*r,t[6]=s*c+I*r,t[7]=v*c+R*r,t[8]=E*c-h*r,t[9]=M*c-p*r,t[10]=I*c-s*r,t[11]=R*c-v*r,t}function D7(t,e,n){var r=Math.sin(n),c=Math.cos(n),h=e[0],p=e[1],s=e[2],v=e[3],E=e[8],M=e[9],I=e[10],R=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*c-E*r,t[1]=p*c-M*r,t[2]=s*c-I*r,t[3]=v*c-R*r,t[8]=h*r+E*c,t[9]=p*r+M*c,t[10]=s*r+I*c,t[11]=v*r+R*c,t}function tL(t,e,n){var r=Math.sin(n),c=Math.cos(n),h=e[0],p=e[1],s=e[2],v=e[3],E=e[4],M=e[5],I=e[6],R=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*c+E*r,t[1]=p*c+M*r,t[2]=s*c+I*r,t[3]=v*c+R*r,t[4]=E*c-h*r,t[5]=M*c-p*r,t[6]=I*c-s*r,t[7]=R*c-v*r,t}function z7(t,e){var n=e[0],r=e[1],c=e[2],h=e[3],p=n+n,s=r+r,v=c+c,E=n*p,M=r*p,I=r*s,R=c*p,N=c*s,$=c*v,Z=h*p,ne=h*s,me=h*v;return t[0]=1-I-$,t[1]=M+me,t[2]=R-ne,t[3]=0,t[4]=M-me,t[5]=1-E-$,t[6]=N+Z,t[7]=0,t[8]=R+ne,t[9]=N-Z,t[10]=1-E-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function B7(t,e,n,r,c,h,p){var s=1/(n-e),v=1/(c-r),E=1/(h-p);return t[0]=h*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h*2*v,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(c+r)*v,t[10]=(p+h)*E,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*h*2*E,t[15]=0,t}function F7(t,e,n,r,c){var h=1/Math.tan(e/2),p;return t[0]=h/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(p=1/(r-c),t[10]=(c+r)*p,t[14]=2*c*r*p):(t[10]=-1,t[14]=-2*r),t}var N7=F7;function U7(t,e,n,r,c,h,p){var s=1/(e-n),v=1/(r-c),E=1/(h-p);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*E,t[11]=0,t[12]=(e+n)*s,t[13]=(c+r)*v,t[14]=(p+h)*E,t[15]=1,t}var V7=U7;function j7(t,e,n,r){var c,h,p,s,v,E,M,I,R,N,$=e[0],Z=e[1],ne=e[2],me=r[0],we=r[1],he=r[2],Pe=n[0],ge=n[1],nt=n[2];return Math.abs($-Pe)<u_&&Math.abs(Z-ge)<u_&&Math.abs(ne-nt)<u_?L7(t):(M=$-Pe,I=Z-ge,R=ne-nt,N=1/Math.hypot(M,I,R),M*=N,I*=N,R*=N,c=we*R-he*I,h=he*M-me*R,p=me*I-we*M,N=Math.hypot(c,h,p),N?(N=1/N,c*=N,h*=N,p*=N):(c=0,h=0,p=0),s=I*p-R*h,v=R*c-M*p,E=M*h-I*c,N=Math.hypot(s,v,E),N?(N=1/N,s*=N,v*=N,E*=N):(s=0,v=0,E=0),t[0]=c,t[1]=s,t[2]=M,t[3]=0,t[4]=h,t[5]=v,t[6]=I,t[7]=0,t[8]=p,t[9]=E,t[10]=R,t[11]=0,t[12]=-(c*$+h*Z+p*ne),t[13]=-(s*$+v*Z+E*ne),t[14]=-(M*$+I*Z+R*ne),t[15]=1,t)}function G7(){var t=new Bh(4);return Bh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function $7(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Rp(t,e,n){var r=e[0],c=e[1],h=e[2],p=e[3];return t[0]=n[0]*r+n[4]*c+n[8]*h+n[12]*p,t[1]=n[1]*r+n[5]*c+n[9]*h+n[13]*p,t[2]=n[2]*r+n[6]*c+n[10]*h+n[14]*p,t[3]=n[3]*r+n[7]*c+n[11]*h+n[15]*p,t}(function(){var t=G7();return function(e,n,r,c,h,p){var s,v;for(n||(n=4),r||(r=0),c?v=Math.min(c*n+r,e.length):v=e.length,s=r;s<v;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],h(t,t,p),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();var t1;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(t1||(t1={}));const H7=45*Math.PI/180,W7=1,Nv=.1,Uv=500,q7=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class co extends C7{static get IDENTITY(){return X7()}static get ZERO(){return Z7()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return t1}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,c,h,p,s,v,E,M,I,R,N,$,Z,ne){return this[0]=e,this[1]=n,this[2]=r,this[3]=c,this[4]=h,this[5]=p,this[6]=s,this[7]=v,this[8]=E,this[9]=M,this[10]=I,this[11]=R,this[12]=N,this[13]=$,this[14]=Z,this[15]=ne,this.check()}setRowMajor(e,n,r,c,h,p,s,v,E,M,I,R,N,$,Z,ne){return this[0]=e,this[1]=h,this[2]=E,this[3]=N,this[4]=n,this[5]=p,this[6]=M,this[7]=$,this[8]=r,this[9]=s,this[10]=I,this[11]=Z,this[12]=c,this[13]=v,this[14]=R,this[15]=ne,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(q7)}fromObject(e){return this.check()}fromQuaternion(e){return z7(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:c,top:h,near:p=Nv,far:s=Uv}=e;return s===1/0?Y7(this,n,r,c,h,p):B7(this,n,r,c,h,p,s),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:c=[0,1,0]}=e;return j7(this,n,r,c),this.check()}ortho(e){const{left:n,right:r,bottom:c,top:h,near:p=Nv,far:s=Uv}=e;return V7(this,n,r,c,h,p,s),this.check()}orthographic(e){const{fovy:n=H7,aspect:r=W7,focalDistance:c=1,near:h=Nv,far:p=Uv}=e;dS(n);const s=n/2,v=c*Math.tan(s),E=v*r;return this.ortho({left:-E,right:E,bottom:-v,top:v,near:h,far:p})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:c=.1,far:h=500}=e;return dS(n),N7(this,n,r,c,h),this.check()}determinant(){return R7(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),c=1/r[0],h=1/r[1],p=1/r[2];return e[0]=this[0]*c,e[1]=this[1]*h,e[2]=this[2]*p,e[3]=0,e[4]=this[4]*c,e[5]=this[5]*h,e[6]=this[6]*p,e[7]=0,e[8]=this[8]*c,e[9]=this[9]*h,e[10]=this[10]*p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),c=1/r[0],h=1/r[1],p=1/r[2];return e[0]=this[0]*c,e[1]=this[1]*h,e[2]=this[2]*p,e[3]=this[4]*c,e[4]=this[5]*h,e[5]=this[6]*p,e[6]=this[8]*c,e[7]=this[9]*h,e[8]=this[10]*p,e}transpose(){return k7(this,this),this.check()}invert(){return e1(this,this),this.check()}multiplyLeft(e){return Hc(this,e,this),this.check()}multiplyRight(e){return Hc(this,this,e),this.check()}rotateX(e){return eL(this,this,e),this.check()}rotateY(e){return D7(this,this,e),this.check()}rotateZ(e){return tL(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return O7(this,this,e,n),this.check()}scale(e){return Cb(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return G_(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Rp(n||[-0,-0,-0,-0],e,this),Bv(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let c;switch(r){case 2:c=m7(n||[-0,-0],e,this);break;case 3:c=QC(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Bv(c,e.length),c}transformAsVector(e,n){let r;switch(e.length){case 2:r=g7(n||[-0,-0],e,this);break;case 3:r=JC(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Bv(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let Bg,Fg;function Z7(){return Bg||(Bg=new co([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Bg)),Bg}function X7(){return Fg||(Fg=new co,Object.freeze(Fg)),Fg}function dS(t){if(t>Math.PI*2)throw Error("expected radians")}function Y7(t,e,n,r,c,h){const p=2*h/(n-e),s=2*h/(c-r),v=(n+e)/(n-e),E=(c+r)/(c-r),M=-1,I=-1,R=-2*h;return t[0]=p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=v,t[9]=E,t[10]=M,t[11]=I,t[12]=0,t[13]=0,t[14]=R,t[15]=0,t}const pS=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,K7={lightSources:{}};function Vv(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function J7(t){let{ambientLight:e,pointLights:n=[],directionalLights:r=[]}=t;const c={};return e?c["lighting_uAmbientLight.color"]=Vv(e):c["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((h,p)=>{c["lighting_uPointLight[".concat(p,"].color")]=Vv(h),c["lighting_uPointLight[".concat(p,"].position")]=h.position,c["lighting_uPointLight[".concat(p,"].attenuation")]=h.attenuation||[1,0,0]}),c.lighting_uPointLightCount=n.length,r.forEach((h,p)=>{c["lighting_uDirectionalLight[".concat(p,"].color")]=Vv(h),c["lighting_uDirectionalLight[".concat(p,"].direction")]=h.direction}),c.lighting_uDirectionalLightCount=r.length,c}function nL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:K7;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:r}=t.lightSources||{};return e||n&&n.length>0||r&&r.length>0?Object.assign({},J7({ambientLight:e,pointLights:n,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return nL({lightSources:e})}return{}}const Q7={name:"lights",vs:pS,fs:pS,getUniforms:nL,defines:{MAX_LIGHTS:3}},e9=new Uint8Array([0,255,255,255]),t9={pickingSelectedColor:null,pickingHighlightColor:e9,pickingActive:!1,pickingAttribute:!1};function n9(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t9;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}const i9=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,r9=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,s9={name:"picking",vs:i9,fs:r9,getUniforms:n9},o9=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,a9={};function l9(t){const{ambient:e=.35,diffuse:n=.6,shininess:r=32,specularColor:c=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:c.map(h=>h/255)}}function c9(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:a9;if(!("material"in t))return{};const{material:e}=t;return e?l9(e):{lighting_uEnabled:!1}}const u9={name:"gouraud-lighting",dependencies:[Q7],vs:o9,defines:{LIGHTING_VERTEX:1},getUniforms:c9},h9=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,f9={name:"transform",vs:h9,fs:null};class Op{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Op(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:r="",defines:c={},inject:h={},varyings:p=[],bufferMode:s=35981,transpileToGLSL100:v=!1}=e,E=this._getModuleList(e.modules),M=this._getHash(n),I=this._getHash(r),R=E.map(he=>this._getHash(he.name)).sort(),N=p.map(he=>this._getHash(he)),$=Object.keys(c).sort(),Z=Object.keys(h).sort(),ne=[],me=[];for(const he of $)ne.push(this._getHash(he)),ne.push(this._getHash(c[he]));for(const he of Z)me.push(this._getHash(he)),me.push(this._getHash(h[he]));const we="".concat(M,"/").concat(I,"D").concat(ne.join("/"),"M").concat(R.join("/"),"I").concat(me.join("/"),"V").concat(N.join("/"),"H").concat(this.stateHash,"B").concat(s).concat(v?"T":"");if(!this._programCache[we]){const he=qG(this.gl,{vs:n,fs:r,modules:E,inject:h,defines:c,hookFunctions:this._hookFunctions,transpileToGLSL100:v});this._programCache[we]=new NC(this.gl,{hash:we,vs:he.vs,fs:he.fs,varyings:p,bufferMode:s}),this._getUniforms[we]=he.getUniforms||(Pe=>{}),this._useCounts[we]=0}return this._useCounts[we]++,this._programCache[we]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),r={};let c=0;for(let h=0,p=this._defaultModules.length;h<p;++h){const s=this._defaultModules[h],v=s.name;n[c++]=s,r[v]=!0}for(let h=0,p=e.length;h<p;++h){const s=e[h],v=s.name;r[v]||(n[c++]=s,r[v]=!0)}return n.length=c,n}}const d9={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function p9(t,e,n){const r={};let c=e.indices;for(const h in e.attributes){const p=e.attributes[h],s=m9(h,n);if(h==="indices")c=p;else if(p.constant)r[s]=p.value;else{const v=p.value,E={...p};delete E.value,r[s]=[new Ui(t,v),E],g9(h,E)}}if(c){const h=c.value||c;on(h instanceof Uint16Array||h instanceof Uint32Array,'attribute array for "indices" must be of integer type');const p={size:1,isIndexed:c.isIndexed===void 0?!0:c.isIndexed};r.indices=[new Ui(t,{data:h,target:34963}),p]}return r}function m9(t,e){const{attributeMap:n=d9}=e||{};return n&&n[t]||t}function g9(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}on(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const eh=2,_9=1e4,y9="Model needs drawMode and vertexCount",mS=()=>{},v9={};class $_{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=zl("model")}=n;on(Sy(e)),this.id=r,this.gl=e,this.id=n.id||zl("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||Op.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:r,fs:c,modules:h,defines:p,inject:s,varyings:v,bufferMode:E,transpileToGLSL100:M}=e;this.programProps={program:n,vs:r,fs:c,modules:h,defines:p,inject:s,varyings:v,bufferMode:E,transpileToGLSL100:M},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},on(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),y9)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:r,fs:c,modules:h,defines:p,inject:s,varyings:v,bufferMode:E,transpileToGLSL100:M}=e;this.programProps={program:n,vs:r,fs:c,modules:h,defines:p,inject:s,varyings:v,bufferMode:E,transpileToGLSL100:M},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return on(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return on(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=p9(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(kh(e))return this;const n={};for(const r in e){const c=e[r];n[r]=c.getValue?c.getValue():c}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return Ab(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:r,uniforms:c={},attributes:h={},transformFeedback:p=this.transformFeedback,parameters:s={},vertexArray:v=this.vertexArray}=e;this.setAttributes(h),this.updateModuleSettings(n),this.setUniforms(c);let E;An.priority>=eh&&(E=this._logDrawCallStart(eh));const M=this.vertexArray.getDrawParams(),{isIndexed:I=M.isIndexed,indexType:R=M.indexType,indexOffset:N=M.indexOffset,vertexArrayInstanced:$=M.isInstanced}=this.props;$&&!this.isInstanced&&An.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:Z,instanceCount:ne}=this,{onBeforeRender:me=mS,onAfterRender:we=mS}=this.props;me(),this.program.setUniforms(this.uniforms);const he=this.program.draw(Object.assign(v9,e,{logPriority:E,uniforms:null,framebuffer:r,parameters:s,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:v,transformFeedback:p,isIndexed:I,indexType:R,isInstanced:Z,instanceCount:ne,offset:I?N:0}));return we(),An.priority>=eh&&this._logDrawCallEnd(E,v,r),he}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:r,unbindModels:c=[]}=e;let{parameters:h}=e;r&&this._setFeedbackBuffers(r),n&&(h=Object.assign({},h,{[35977]:n})),c.forEach(p=>p.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:h}))}finally{c.forEach(p=>p.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return An.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:r,fs:c,modules:h,inject:p,defines:s,varyings:v,bufferMode:E,transpileToGLSL100:M}=this.programProps;n=this.programManager.get({vs:r,fs:c,modules:h,inject:p,defines:s,varyings:v,bufferMode:E,transpileToGLSL100:M}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}on(n instanceof NC,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new lG(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof Ui&&n.delete()}}_setAnimationProps(e){this.animated&&on(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(kh(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new UC(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:_9;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),An.group(eh,">>> DRAWING MODEL ".concat(this.id),{collapsed:An.level<=2})(),e}_logDrawCallEnd(e,n,r,c){if(e===void 0)return;const h=hG({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:p,unusedTable:s,unusedCount:v}=tS({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:E,count:M}=tS({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});M>0&&An.log("MISSING UNIFORMS",Object.keys(E))(),v>0&&An.log("UNUSED UNIFORMS",Object.keys(s))();const I=dG(this.vertexArray.configuration);An.table(e,h)(),An.table(e,p)(),An.table(e+1,I)(),c&&c.log({logLevel:eh,message:"Rendered to ".concat(c.id)}),An.groupEnd(eh)()}}class x9{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:c}=n;return{attributes:Object.assign({},r,e.attributes),transformFeedback:c}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],r=e?n[e]:null;return r?r instanceof Ui?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,r=this.getBuffer(n);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&on(ui(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const c in this.feedbackMap){const h=this.feedbackMap[c];c in n&&(r[h]=c)}Object.assign(r,e.feedbackBuffers);for(const c in r){const h=r[c];if(typeof h=="string"){const p=n[h],{byteLength:s,usage:v,accessor:E}=p;r[c]=this._createNewBuffer(c,{byteLength:s,usage:v,accessor:E})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:r})}_setupTransformFeedback(e,n){let{model:r}=n;const{program:c}=r;e.transformFeedback=new UC(this.gl,{program:c,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),c=this._getNextIndex();this.bindings[c]=this._updateBinding(this.bindings[c],{sourceBuffers:n,feedbackBuffers:r})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const c in this.feedbackMap){const h=this.feedbackMap[c];n[c]=e.feedbackBuffers[h],r[h]=e.sourceBuffers[c],on(r[h]instanceof Ui)}return{sourceBuffers:n,feedbackBuffers:r}}_createNewBuffer(e,n){const r=new Ui(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const b9="transform_uSampler_",H_="transform_uSize_",gS="transform_position";function w9(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:r,targetTexture:c}=t,p=Object.keys(n).length,s=null;const v={};let E=e,M={};if(p>0||r){const I=E.split(`
`),R=I.slice();if(I.forEach((N,$,Z)=>{if(p>0){const ne=M9(N,n);if(ne){const{updatedLine:me,inject:we}=ne;R[$]=me,M=Kx([M,we]),Object.assign(v,ne.samplerTextureMap),p--}}r&&!s&&(s=S9(N,r))}),r){on(c);const N="".concat(H_).concat(r),$="uniform vec2 ".concat(N,`;
`),Z="     vec2 ".concat(gS," = transform_getPos(").concat(N,`);
     gl_Position = vec4(`).concat(gS,`, 0, 1.);
`);M=Kx([M,{"vs:#decl":$,"vs:#main-start":Z}])}E=R.join(`
`)}return{vs:E,targetTextureType:s,inject:M,samplerTextureMap:v}}function E9(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:r}=t;const c={};let h,p;n&&({width:h,height:p}=r,c["".concat(H_).concat(n)]=[h,p]);for(const s in e)({width:h,height:p}=e[s]),c["".concat(H_).concat(s)]=[h,p];return c}function T9(t){return qC(t,["attribute","in"])}function A9(t){const e="".concat(b9).concat(t),n="".concat(H_).concat(t),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:r}}function S9(t,e){const n=qC(t,["varying","out"]);return n&&n.name===e?n.type:null}function M9(t,e){const n={},r=T9(t);if(!r)return null;const{type:c,name:h}=r;if(h&&e[h]){const p="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:s,sizeName:v,uniformDeclerations:E}=A9(h),M=n7(c),I="  ".concat(c," ").concat(h," = transform_getInput(").concat(s,", ").concat(v,").").concat(M,`;
`);return n[s]=h,{updatedLine:p,inject:{"vs:#decl":E,"vs:#main-start":I},samplerTextureMap:n}}return null}const P9={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},I9="transform_output";class C9{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:r,framebuffer:c,targetTexture:h}=this.bindings[this.currentIndex],p=Object.assign({},n,e.attributes),s=Object.assign({},e.uniforms),v=Object.assign({},e.parameters);let E=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){p.transform_elementID=this.elementIDBuffer;for(const I in this.samplerTextureMap){const R=this.samplerTextureMap[I];s[I]=r[R]}this._setSourceTextureParameters();const M=E9({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:h});Object.assign(s,M)}return this.hasTargetTexture&&(E=!1,v.viewport=[0,0,c.width,c.height]),{attributes:p,framebuffer:c,uniforms:s,discard:E,parameters:v}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],r=Py(n);if(!e)return r;const c=r.constructor,h=i7(this.targetTextureType),p=new c(r.length*h/4);let s=0;for(let v=0;v<r.length;v+=4)for(let E=0;E<h;E++)p[s++]=r[v+E];return p}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:r}=e;if(r instanceof Ys)return r;const c=n[r];return c?(this._targetRefTexName=r,this._createNewTexture(c)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:r={},_targetTexture:c}=e,h=this._createTargetTexture({sourceTextures:r,textureOrReference:c});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:r,targetTexture:h}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((r,c,h)=>{h[c]=c}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new Ui(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),c=this._getNextIndex();this.bindings[c]=this._updateBinding(this.bindings[c],{sourceTextures:n,targetTexture:r})}}_updateBinding(e,n){const{sourceBuffers:r,sourceTextures:c,targetTexture:h}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,c),Object.assign(e.sourceBuffers,r),h){e.targetTexture=h;const{width:p,height:s}=h,{framebuffer:v}=e;v?(v.update({attachments:{[36064]:h},resizeAttachments:!1}),v.resize({width:p,height:s})):e.framebuffer=new br(this.gl,{id:"transform-framebuffer",width:p,height:s,attachments:{[36064]:h}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const r in n)n[r].setParameters(P9)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:r}}_createNewTexture(e){const n=Kj(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:r}=this.bindings[this.currentIndex],{vs:c,uniforms:h,targetTextureType:p,inject:s,samplerTextureMap:v}=w9({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),E=Kx([e.inject||{},s]);this.targetTextureType=p,this.samplerTextureMap=v;const M=e._fs||ZC({version:BC(c),input:this.targetTextureVarying,inputType:p,output:I9}),I=this.hasSourceTextures||this.targetTextureVarying?[f9].concat(e.modules||[]):e.modules;return{vs:c,fs:M,modules:I,uniforms:h,inject:E}}}class Lb{static isSupported(e){return ui(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:r}=this;e&&e.delete(),n&&n.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,r=this._updateDrawOptions(e);n&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)e=e||r.swap();on(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n){const c=r.getData(e);if(c)return c}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new $_(n,Object.assign({},e,{fs:e.fs||ZC({version:BC(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const c of r)n=c.updateModelProps(n);return n}_buildResourceTransforms(e,n){L9(n)&&(this.bufferTransform=new x9(e,n)),k9(n)&&(this.textureTransform=new C9(e,n)),on(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const c of r)n=Object.assign(n,c.getDrawOptions(n));return n}}function L9(t){return!!(!kh(t.feedbackBuffers)||!kh(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function k9(t){return!!(!kh(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const _S={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class iL{static get DRAW_MODE(){return _S}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=zl("geometry"),drawMode:r=_S.TRIANGLES,attributes:c={},indices:h=null,vertexCount:p=null}=e;this.id=n,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(c,h),this.vertexCount=p||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const r in e){let c=e[r];c=ArrayBuffer.isView(c)?{value:c}:c,on(ArrayBuffer.isView(c.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!c.size&&(c.size=3),r==="indices"?(on(!this.indices),this.indices=c):this.attributes[r]=c}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const c in e){const h=e[c],{value:p,size:s,constant:v}=h;!v&&p&&s>=1&&(r=Math.min(r,p.length/s))}return on(Number.isFinite(r)),r}}let R9=1,O9=1;class rL{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:c=1,repeat:h=1}=e,p=R9++,s={time:0,delay:n,duration:r,rate:c,repeat:h};return this._setChannelTime(s,this.time),this.channels.set(p,s),p}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const c of n)this._setChannelTime(c,this.time);const r=this.animations.values();for(const c of r){const{animation:h,channel:p}=c;h.setTime(this.getTime(p))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=O9++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,c=e.duration*e.repeat;r>=c?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const sL="#define SMOOTH_EDGE_RADIUS 0.5",D9=`
`.concat(sL,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),z9=`
`.concat(sL,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),B9={name:"geometry",vs:D9,fs:z9},Ti={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ti,"IDENTITY",{get:()=>(Vi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const sa={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},n1={common:0,meters:1,pixels:2},yS={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Dp={DRAW:"draw",MASK:"mask"},F9=Object.keys(Ti).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Ti[t],";")).join(""),N9=Object.keys(sa).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(sa[t],";")).join(""),U9=Object.keys(n1).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(n1[t],";")).join(""),V9="".concat(F9,`
`).concat(N9,`
`).concat(U9,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0; // meters
const float GLOBE_RADIUS = 256.0;

// returns an adjustment factor for uCommonUnitsPerMeter
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear
    // Adjust by 1 / cos(latitude)
    // If geometry.position (vertex in common space) is populated, use it
    // Otherwise use geometry.worldPosition (anchor in world space)
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }

    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)
    // Taylor series of 1 / cos(latitude)
    // Max error < 0.003
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}

//
// Scaling offsets - scales meters to "world distance"
// Note the scalar version of project_size is for scaling the z component only
//
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}

// Get rotation matrix that aligns the z axis with the given up vector
// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  // Tangent on XY plane
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}

//
// Projecting normal - transform deltas from current coordinate system to
// normals in the worldspace
//
vec3 project_normal(vec3 vector) {
  // Apply model matrix
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

//
// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]
//
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

//
// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)
//
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;

  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        // Too far from the projection center for offset mode to be accurate
        // Only use high parts
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.
    position_world.xyz -= project_uCoordinateOrigin;
  }

  // Translation is already added to the high parts
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}

//
// Projects from common space coordinates to clip space.
// Uses project_uViewProjectionMatrix
//
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}

// Returns a clip space offset that corresponds to a given number of screen pixels
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  // UNIT_PIXELS
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function j9(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Iy(t){let e={},n;return r=>{for(const c in r)if(!j9(r[c],e[c])){n=t(r),e=r;break}return n}}const vS=[0,0,0,0],G9=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],oL=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$9=[0,0,0],aL=[0,0,0],H9=Iy(Z9);function lL(t,e,n=aL){n.length<3&&(n=[n[0],n[1],0]);let r=n,c,h=!0;switch(e===Ti.LNGLAT_OFFSETS||e===Ti.METER_OFFSETS?c=n:c=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case sa.WEB_MERCATOR:(e===Ti.LNGLAT||e===Ti.CARTESIAN)&&(c=[0,0,0],h=!1);break;case sa.WEB_MERCATOR_AUTO_OFFSET:e===Ti.LNGLAT?r=c:e===Ti.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],c=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case sa.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case sa.GLOBE:h=!1,c=null;break;default:h=!1}return{geospatialOrigin:c,shaderCoordinateOrigin:r,offsetMode:h}}function W9(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:c}=t;let{viewMatrix:h,viewProjectionMatrix:p}=t,s=vS,v=vS,E=t.cameraPosition;const{geospatialOrigin:M,shaderCoordinateOrigin:I,offsetMode:R}=lL(t,e,n);return R&&(v=t.projectPosition(M||I),E=[E[0]-v[0],E[1]-v[1],E[2]-v[2]],v[3]=1,s=Rp([],v,p),h=r||h,p=Hc([],c,h),p=Hc([],p,G9)),{viewMatrix:h,viewProjectionMatrix:p,projectionCenter:s,originCommon:v,cameraPosCommon:E,shaderCoordinateOrigin:I,geospatialOrigin:M}}function q9({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=Ti.DEFAULT,coordinateOrigin:c=aL,autoWrapLongitude:h=!1}){r===Ti.DEFAULT&&(r=t.isGeospatial?Ti.LNGLAT:Ti.CARTESIAN);const p=H9({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:c});return p.project_uWrapLongitude=h,p.project_uModelMatrix=n||oL,p}function Z9({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:c,viewProjectionMatrix:h,originCommon:p,cameraPosCommon:s,shaderCoordinateOrigin:v,geospatialOrigin:E}=W9(t,n,r),M=t.getDistanceScales(),I=[t.width*e,t.height*e],R=Rp([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,N={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:v,project_uCommonOrigin:p.slice(0,3),project_uCenter:c,project_uPseudoMeters:Boolean(t._pseudoMeters),project_uViewportSize:I,project_uDevicePixelRatio:e,project_uFocalDistance:R,project_uCommonUnitsPerMeter:M.unitsPerMeter,project_uCommonUnitsPerWorldUnit:M.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:$9,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:h,project_uModelMatrix:oL,project_uCameraPosition:s};if(E){const $=t.getDistanceScales(E);switch(n){case Ti.METER_OFFSETS:N.project_uCommonUnitsPerWorldUnit=$.unitsPerMeter,N.project_uCommonUnitsPerWorldUnit2=$.unitsPerMeter2;break;case Ti.LNGLAT:case Ti.LNGLAT_OFFSETS:t._pseudoMeters||(N.project_uCommonUnitsPerMeter=$.unitsPerMeter),N.project_uCommonUnitsPerWorldUnit=$.unitsPerDegree,N.project_uCommonUnitsPerWorldUnit2=$.unitsPerDegree2;break;case Ti.CARTESIAN:N.project_uCommonUnitsPerWorldUnit=[1,1,$.unitsPerMeter[2]],N.project_uCommonUnitsPerWorldUnit2=[0,0,$.unitsPerMeter2[2]];break}}return N}const X9={};function Y9(t=X9){return"viewport"in t?q9(t):{}}const kb={name:"project",dependencies:[o7,B9],vs:V9,getUniforms:Y9},K9=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,cL={name:"project32",dependencies:[kb],vs:K9};function J9(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function gh(t,e){const n=Rp([],e,t);return $7(n,n,1/n[3]),n}function xS(t,e){const n=t%e;return n<0?e+n:n}function i1(t,e,n){return t<e?e:t>n?n:t}function Q9(t){return Math.log(t)*Math.LOG2E}const Rb=Math.log2||Q9;function za(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Mo=Math.PI,uL=Mo/4,ko=Mo/180,r1=180/Mo,fp=512,s1=4003e4,Ng=85.051129,e$=1.5;function t$(t){return Rb(t)}function W_(t){const[e,n]=t;za(Number.isFinite(e)),za(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*ko,c=n*ko,h=fp*(r+Mo)/(2*Mo),p=fp*(Mo+Math.log(Math.tan(uL+c*.5)))/(2*Mo);return[h,p]}function Fh(t){const[e,n]=t,r=e/fp*(2*Mo)-Mo,c=2*(Math.atan(Math.exp(n/fp*(2*Mo)-Mo))-uL);return[r*r1,c*r1]}function n$(t){const{latitude:e}=t;za(Number.isFinite(e));const n=Math.cos(e*ko);return t$(s1*n)-9}function o1(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;za(Number.isFinite(e)&&Number.isFinite(n));const c=fp,h=Math.cos(e*ko),p=c/360,s=p/h,v=c/s1/h,E={unitsPerMeter:[v,v,v],metersPerUnit:[1/v,1/v,1/v],unitsPerDegree:[p,s,v],degreesPerUnit:[1/p,1/s,1/v]};if(r){const M=ko*Math.tan(e*ko)/h,I=p*M/2,R=c/s1*M,N=R/s*v;E.unitsPerDegree2=[0,I,R],E.unitsPerMeter2=[N,0,N]}return E}function hL(t,e){const[n,r,c]=t,[h,p,s]=e,{unitsPerMeter:v,unitsPerMeter2:E}=o1({longitude:n,latitude:r,highPrecision:!0}),M=W_(t);M[0]+=h*(v[0]+E[0]*p),M[1]+=p*(v[1]+E[1]*p);const I=Fh(M),R=(c||0)+(s||0);return Number.isFinite(c)||Number.isFinite(s)?[I[0],I[1],R]:I}function i$(t){const{height:e,pitch:n,bearing:r,altitude:c,scale:h,center:p}=t,s=J9();G_(s,s,[0,0,-c]),eL(s,s,-n*ko),tL(s,s,r*ko);const v=h/e;return Cb(s,s,[v,v,v]),p&&G_(s,s,x7([],p)),s}function r$(t){const{width:e,height:n,altitude:r,pitch:c=0,offset:h,center:p,scale:s,nearZMultiplier:v=1,farZMultiplier:E=1}=t;let{fovy:M=q_(e$)}=t;r!==void 0&&(M=q_(r));const I=M*ko,R=c*ko,N=fL(M);let $=N;p&&($+=p[2]*s/Math.cos(R)/n);const Z=I*(.5+(h?h[1]:0)/n),ne=Math.sin(Z)*$/Math.sin(i1(Math.PI/2-R-Z,.01,Math.PI-.01)),me=Math.sin(R)*ne+$,we=$*10,he=Math.min(me*E,we);return{fov:I,aspect:e/n,focalDistance:N,near:v,far:he}}function q_(t){return 2*Math.atan(.5/t)*r1}function fL(t){return .5/Math.tan(.5*t*ko)}function dL(t,e){const[n,r,c=0]=t;return za(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(c)),gh(e,[n,r,c,1])}function Cy(t,e,n=0){const[r,c,h]=t;if(za(Number.isFinite(r)&&Number.isFinite(c),"invalid pixel coordinate"),Number.isFinite(h))return gh(e,[r,c,h,1]);const p=gh(e,[r,c,0,1]),s=gh(e,[r,c,1,1]),v=p[2],E=s[2],M=v===E?0:((n||0)-v)/(E-v);return KC([],p,s,M)}function pL(t){const{width:e,height:n,bounds:r,minExtent:c=0,maxZoom:h=24,offset:p=[0,0]}=t,[[s,v],[E,M]]=r,I=s$(t.padding),R=W_([s,i1(M,-Ng,Ng)]),N=W_([E,i1(v,-Ng,Ng)]),$=[Math.max(Math.abs(N[0]-R[0]),c),Math.max(Math.abs(N[1]-R[1]),c)],Z=[e-I.left-I.right-Math.abs(p[0])*2,n-I.top-I.bottom-Math.abs(p[1])*2];za(Z[0]>0&&Z[1]>0);const ne=Z[0]/$[0],me=Z[1]/$[1],we=(I.right-I.left)/2/ne,he=(I.top-I.bottom)/2/me,Pe=[(N[0]+R[0])/2+we,(N[1]+R[1])/2+he],ge=Fh(Pe),nt=Math.min(h,Rb(Math.abs(Math.min(ne,me))));return za(Number.isFinite(nt)),{longitude:ge[0],latitude:ge[1],zoom:nt}}function s$(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(za(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const bS=Math.PI/180;function o$(t,e=0){const{width:n,height:r,unproject:c}=t,h={targetZ:e},p=c([0,r],h),s=c([n,r],h);let v,E;const M=t.fovy?.5*t.fovy*bS:Math.atan(.5/t.altitude),I=(90-t.pitch)*bS;return M>I-.01?(v=wS(t,0,e),E=wS(t,n,e)):(v=c([0,0],h),E=c([n,0],h)),[p,s,E,v]}function wS(t,e,n){const{pixelUnprojectionMatrix:r}=t,c=gh(r,[e,0,1,1]),h=gh(r,[e,t.height,1,1]),s=(n*t.distanceScales.unitsPerMeter[2]-c[2])/(h[2]-c[2]),v=KC([],c,h,s),E=Fh(v);return E.push(n),E}const ES=512;function a$(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:c,latitude:h,zoom:p,bearing:s=0}=t;(c<-180||c>180)&&(c=xS(c+180,360)-180),(s<-180||s>180)&&(s=xS(s+180,360)-180);const v=Rb(n/ES);if(p<=v)p=v,h=0;else{const E=n/2/Math.pow(2,p),M=Fh([0,E])[1];if(h<M)h=M;else{const I=Fh([0,ES-E])[1];h>I&&(h=I)}}return{width:e,height:n,longitude:c,latitude:h,zoom:p,pitch:r,bearing:s}}const l$=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,c$=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,u$=Iy(m$),h$=Iy(g$),f$=[0,0,0,1],d$=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function p$(t,e){const[n,r,c]=t,h=Cy([n,r,c],e);return Number.isFinite(c)?h:[h[0],h[1],0]}function m$({viewport:t,center:e}){return new co(t.viewProjectionMatrix).invert().transform(e)}function g$({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,c=t.isGeospatial?void 0:1,h=[[0,0,c],[t.width,0,c],[0,t.height,c],[t.width,t.height,c],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(p=>p$(p,r));for(const p of e){const s=p.clone().translate(new fa(t.center).negate()),v=h.map(M=>s.transform(M)),E=new co().ortho({left:Math.min(...v.map(M=>M[0])),right:Math.max(...v.map(M=>M[0])),bottom:Math.min(...v.map(M=>M[1])),top:Math.max(...v.map(M=>M[1])),near:Math.min(...v.map(M=>-M[2])),far:Math.max(...v.map(M=>-M[2]))});n.push(E.multiplyRight(p))}return n}function _$(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||f$,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},c=u$({viewport:t.viewport,center:e.project_uCenter}),h=[],p=h$({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let s=0;s<t.shadowMatrices.length;s++){const v=p[s],E=v.clone().translate(new fa(t.viewport.center).negate());e.project_uCoordinateSystem===Ti.LNGLAT&&e.project_uProjectionMode===sa.WEB_MERCATOR?(p[s]=E,h[s]=c):(p[s]=v.clone().multiplyRight(d$),h[s]=E.transform(c))}for(let s=0;s<p.length;s++)r["shadow_uViewProjectionMatrices[".concat(s,"]")]=p[s],r["shadow_uProjectCenters[".concat(s,"]")]=h[s],t.shadowMaps&&t.shadowMaps.length>0?r["shadow_uShadowMap".concat(s)]=t.shadowMaps[s]:r["shadow_uShadowMap".concat(s)]=t.dummyShadowMap;return r}const jv={name:"shadow",dependencies:[kb],vs:l$,fs:c$,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?_$(t,e):{}},mL={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...s9},y$=[kb],v$=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function x$(t){const e=Op.getDefaultProgramManager(t);for(const n of y$)e.addDefaultModule(n);for(const n of v$)e.addShaderHook(n);return e}const b$=[255,255,255],w$=1;let E$=0;class T${constructor(e={}){Y(this,"id",void 0),Y(this,"color",void 0),Y(this,"intensity",void 0),Y(this,"type","ambient");const{color:n=b$}=e,{intensity:r=w$}=e;this.id=e.id||"ambient-".concat(E$++),this.color=n,this.intensity=r}}const A$=[255,255,255],S$=1,M$=[0,0,-1];let P$=0;class TS{constructor(e={}){Y(this,"id",void 0),Y(this,"color",void 0),Y(this,"intensity",void 0),Y(this,"type","directional"),Y(this,"direction",void 0),Y(this,"shadow",void 0);const{color:n=A$}=e,{intensity:r=S$}=e,{direction:c=M$}=e,{_shadow:h=!1}=e;this.id=e.id||"directional-".concat(P$++),this.color=n,this.intensity=r,this.type="directional",this.direction=new fa(c).normalize().toArray(),this.shadow=h}getProjectedLight(e){return this}}class I${constructor(e,n={id:"pass"}){Y(this,"id",void 0),Y(this,"gl",void 0),Y(this,"props",void 0);const{id:r}=n;this.id=r,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Ly extends I${constructor(...e){super(...e),Y(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return Da(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:r,viewports:c,views:h,onViewportActive:p,clearStack:s=!0,clearCanvas:v=!0}=e;e.pass=e.pass||"unknown";const E=this.gl;v&&L$(E),s&&(this._lastRenderIndex=-1);const M=[];for(const I of c){const R=h&&h[I.id];p(I);const N=this._getDrawLayerParams(I,e),$=I.subViewports||[I];for(const Z of $){const ne=this._drawLayersInViewport(E,{target:n,moduleParameters:r,viewport:Z,view:R,pass:e.pass,layers:e.layers},N);M.push(ne)}}return M}_getDrawLayerParams(e,{layers:n,pass:r,layerFilter:c,cullRect:h,effects:p,moduleParameters:s}){const v=[],E=gL(this._lastRenderIndex+1),M={layer:n[0],viewport:e,isPicking:r.startsWith("picking"),renderPass:r,cullRect:h},I={};for(let R=0;R<n.length;R++){const N=n[R],$=this._shouldDrawLayer(N,M,c,I),Z={shouldDrawLayer:$};$&&(Z.layerRenderIndex=E(N,$),Z.moduleParameters=this._getModuleParameters(N,p,r,s),Z.layerParameters=this.getLayerParameters(N,R,e)),v[R]=Z}return v}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:c,target:h,viewport:p,view:s},v){const E=C$(e,{moduleParameters:r,target:h,viewport:p});if(s&&s.props.clear){const I=s.props.clear===!0?{color:!0,depth:!0}:s.props.clear;oo(e,{scissorTest:!0,scissor:E},()=>Ab(e,I))}const M={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Da(e,{viewport:E});for(let I=0;I<n.length;I++){const R=n[I],{shouldDrawLayer:N,layerRenderIndex:$,moduleParameters:Z,layerParameters:ne}=v[I];if(N&&R.props.pickable&&M.pickableCount++,R.isComposite)M.compositeCount++;else if(N){M.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,$),Z.viewport=p;try{R._drawLayer({moduleParameters:Z,uniforms:{layerIndex:$},parameters:ne})}catch(me){R.raiseError(me,"drawing ".concat(R," to ").concat(c))}}}return M}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,c){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let p=e.parent;for(;p;){if(!p.props.visible||!p.filterSubLayer(n))return!1;n.layer=p,p=p.parent}if(r){const s=n.layer.id;if(s in c||(c[s]=r(n)),!c[s])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,c){var h;const p=Object.assign(Object.create(((h=e.internalState)===null||h===void 0?void 0:h.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Lh(this.gl)});if(n)for(const v of n){var s;Object.assign(p,(s=v.getModuleParameters)===null||s===void 0?void 0:s.call(v,e))}return Object.assign(p,this.getModuleParameters(e,n),c)}}function gL(t=0,e={}){const n={},r=(c,h)=>{const p=c.props._offset,s=c.id,v=c.parent&&c.parent.id;let E;if(v&&!(v in e)&&r(c.parent,!1),v in n){const M=n[v]=n[v]||gL(e[v],e);E=M(c,h),n[s]=M}else Number.isFinite(p)?(E=p+(e[v]||0),n[s]=null):E=t;return h&&E>=t&&(t=E+1),e[s]=E,E};return r}function C$(t,{moduleParameters:e,target:n,viewport:r}){const c=n&&n.id!=="default-framebuffer",h=e&&e.devicePixelRatio||Lh(t),p=c?n.height:t.drawingBufferHeight,s=r;return[s.x*h,p-(s.y+s.height)*h,s.width*h,s.height*h]}function L$(t){const e=t.drawingBufferWidth,n=t.drawingBufferHeight;Da(t,{viewport:[0,0,e,n]}),t.clear(16640)}class k$ extends Ly{constructor(e,n){super(e,n),Y(this,"shadowMap",void 0),Y(this,"depthBuffer",void 0),Y(this,"fbo",void 0),this.shadowMap=new Ys(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new ah(e,{format:33189,width:1,height:1}),this.fbo=new br(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;oo(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],c=Lh(this.gl),h=r.width*c,p=r.height*c;(h!==n.width||p!==n.height)&&n.resize({width:h,height:p}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const R$={color:[255,255,255],intensity:1},AS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],O$=[0,0,0,200/255];class _L{constructor(e={}){Y(this,"id","lighting-effect"),Y(this,"props",null),Y(this,"shadowColor",O$),Y(this,"shadow",void 0),Y(this,"ambientLight",null),Y(this,"directionalLights",[]),Y(this,"pointLights",[]),Y(this,"shadowPasses",[]),Y(this,"shadowMaps",[]),Y(this,"dummyShadowMap",null),Y(this,"programManager",void 0),Y(this,"shadowMatrices",void 0);for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow)}preRender(e,{layers:n,layerFilter:r,viewports:c,onViewportActive:h,views:p}){if(!!this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Op.getDefaultProgramManager(e),jv&&this.programManager.addDefaultModule(jv)),this.dummyShadowMap||(this.dummyShadowMap=new Ys(e,{width:1,height:1}));for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:n,layerFilter:r,viewports:c,onViewportActive:h,views:p,moduleParameters:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(jv),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new co().lookAt({eye:new fa(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new k$(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new T$(R$),this.directionalLights.push(new TS(AS[0]),new TS(AS[1])))}}class D${constructor(e={}){Y(this,"_pool",[]),Y(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:c,padding:h=0,copy:p=!1,initialize:s=!1,maxCount:v}){const E=c||e&&e.constructor||Float32Array,M=n*r+h;if(ArrayBuffer.isView(e)){if(M<=e.length)return e;if(M*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new E(e.buffer,0,M)}let I=1/0;v&&(I=v*r+h);const R=this._allocate(E,M,s,I);return e&&p?R.set(e):s||R.fill(0,0,4),this._release(e),R}release(e){this._release(e)}_allocate(e,n,r,c){let h=Math.max(Math.ceil(n*this.opts.overAlloc),1);h>c&&(h=c);const p=this._pool,s=e.BYTES_PER_ELEMENT*h,v=p.findIndex(E=>E.byteLength>=s);if(v>=0){const E=new e(p.splice(v,1)[0],0,h);return r&&E.fill(0),E}return new e(h)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:c}=r,h=n.findIndex(p=>p.byteLength>=c);h<0?n.push(r):(h>0||n.length<this.opts.poolSize)&&n.splice(h,0,r),n.length>this.opts.poolSize&&n.shift()}}const Nh=new D$;function Pd(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function z$(t,e){const n=t%e;return n<0?e+n:n}function B$(t){return[t[12],t[13],t[14]]}function F$(t){return{left:th(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:th(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:th(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:th(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:th(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:th(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const SS=new fa;function th(t,e,n,r){SS.set(t,e,n);const c=SS.len();return{distance:r/c,normal:new fa(-t/c,-e/c,-n/c)}}function N$(t){return t-Math.fround(t)}let wd;function Gv(t,e){const{size:n=1,startIndex:r=0}=e,c=e.endIndex!==void 0?e.endIndex:t.length,h=(c-r)/n;wd=Nh.allocate(wd,h,{type:Float32Array,size:n*2});let p=r,s=0;for(;p<c;){for(let v=0;v<n;v++){const E=t[p++];wd[s+v]=E,wd[s+v+n]=N$(E)}s+=n*2}return wd.subarray(0,h*n*2)}const U$=Math.PI/180,V$=Pd(),MS=[0,0,0],j$={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function G$({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:c,padding:h,near:p,far:s}){const v=t/e,E=n?new co().orthographic({fovy:r,aspect:v,focalDistance:c,near:p,far:s}):new co().perspective({fovy:r,aspect:v,near:p,far:s});if(h){const{left:M=0,right:I=0,top:R=0,bottom:N=0}=h,$=Jr((M+t-I)/2,0,t)-t/2,Z=Jr((R+e-N)/2,0,e)-e/2;E[8]-=$*2/t,E[9]+=Z*2/e}return E}class Qc{constructor(e={}){Y(this,"id",void 0),Y(this,"x",void 0),Y(this,"y",void 0),Y(this,"width",void 0),Y(this,"height",void 0),Y(this,"padding",void 0),Y(this,"isGeospatial",void 0),Y(this,"zoom",void 0),Y(this,"focalDistance",void 0),Y(this,"position",void 0),Y(this,"modelMatrix",void 0),Y(this,"distanceScales",void 0),Y(this,"scale",void 0),Y(this,"center",void 0),Y(this,"cameraPosition",void 0),Y(this,"projectionMatrix",void 0),Y(this,"viewMatrix",void 0),Y(this,"viewMatrixUncentered",void 0),Y(this,"viewMatrixInverse",void 0),Y(this,"viewProjectionMatrix",void 0),Y(this,"pixelProjectionMatrix",void 0),Y(this,"pixelUnprojectionMatrix",void 0),Y(this,"resolution",void 0),Y(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||j$,this.focalDistance=e.focalDistance||1,this.position=e.position||MS,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?sa.WEB_MERCATOR:sa.WEB_MERCATOR_AUTO_OFFSET:sa.IDENTITY}equals(e){return e instanceof Qc?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&zh(e.projectionMatrix,this.projectionMatrix)&&zh(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),c=dL(r,this.pixelProjectionMatrix),[h,p]=c,s=n?p:this.height-p;return e.length===2?[h,s]:[h,s,c[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[c,h,p]=e,s=n?h:this.height-h,v=r&&r*this.distanceScales.unitsPerMeter[2],E=Cy([c,s,p],this.pixelUnprojectionMatrix,v),[M,I,R]=this.unprojectPosition(E);return Number.isFinite(p)?[M,I,R]:Number.isFinite(r)?[M,I,r]:[M,I]}projectPosition(e){const[n,r]=this.projectFlat(e),c=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,c]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),c=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,c]}projectFlat(e){if(this.isGeospatial){const n=W_(e);return n[1]=Jr(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Fh(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),c=this.unproject([this.width,0],n),h=this.unproject([0,this.height],n),p=this.unproject([this.width,this.height],n);return[Math.min(r[0],c[0],h[0],p[0]),Math.min(r[1],c[1],h[1],p[1]),Math.max(r[0],c[0],h[0],p[0]),Math.max(r[1],c[1],h[1],p[1])]}getDistanceScales(e){return e?o1({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:c=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+c}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,F$(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=n$({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||o1({latitude:r,longitude:n}));const c=Math.pow(2,this.zoom);this.scale=c;const{position:h,modelMatrix:p}=e;let s=MS;if(h&&(s=p?new co(p).transformAsVector(h,[]):h),this.isGeospatial){const v=this.projectPosition([n,r,0]);this.center=new fa(s).scale(this.distanceScales.unitsPerMeter).add(v)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:n=V$,projectionMatrix:r=null,orthographic:c=!1,fovyRadians:h,fovy:p=75,near:s=.1,far:v=1e3,padding:E=null,focalDistance:M=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new co().multiplyRight(n).translate(new fa(this.center).negate()),this.projectionMatrix=r||G$({width:this.width,height:this.height,orthographic:c,fovyRadians:h||p*U$,focalDistance:M,padding:E,near:s,far:v});const I=Pd();Hc(I,I,this.projectionMatrix),Hc(I,I,this.viewMatrix),this.viewProjectionMatrix=I,this.viewMatrixInverse=e1([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=B$(this.viewMatrixInverse);const R=Pd(),N=Pd();Cb(R,R,[this.width/2,-this.height/2,1]),G_(R,R,[1,-1,0]),Hc(N,R,this.viewProjectionMatrix),this.pixelProjectionMatrix=N,this.pixelUnprojectionMatrix=e1(Pd(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Vi.warn("Pixel project matrix not invertible")()}}Y(Qc,"displayName","Viewport");const $$=512,H$=4003e4,W$=Math.PI/180;function PS(t){const e=Math.cos(t*W$);return $$/H$/e}class Ba extends Qc{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:c=0,pitch:h=0,bearing:p=0,nearZMultiplier:s=.1,farZMultiplier:v=1.01,orthographic:E=!1,projectionMatrix:M,repeat:I=!1,worldOffset:R=0,legacyMeterSizes:N=!1}=e;let{width:$,height:Z,altitude:ne=1.5}=e;const me=Math.pow(2,c);$=$||1,Z=Z||1;let we,he=null;M?(ne=M[5]/2,we=q_(ne)):(e.fovy?(we=e.fovy,ne=fL(we)):we=q_(ne),he=r$({width:$,height:Z,pitch:h,fovy:we,nearZMultiplier:s,farZMultiplier:v}));let Pe=i$({height:Z,pitch:h,bearing:p,scale:me,altitude:ne});R&&(Pe=new co().translate([512*R,0,0]).multiplyLeft(Pe)),super({...e,width:$,height:Z,viewMatrix:Pe,longitude:r,latitude:n,zoom:c,...he,fovy:we,focalDistance:ne}),Y(this,"longitude",void 0),Y(this,"latitude",void 0),Y(this,"pitch",void 0),Y(this,"bearing",void 0),Y(this,"altitude",void 0),Y(this,"fovy",void 0),Y(this,"orthographic",void 0),Y(this,"_subViewports",void 0),Y(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=r,this.zoom=c,this.pitch=h,this.bearing=p,this.altitude=ne,this.fovy=we,this.orthographic=E,this._subViewports=I?[]:null,this._pseudoMeters=N,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let c=n;c<=r;c++){const h=c?new Ba({...this,worldOffset:c}):this;this._subViewports.push(h)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),c=(e[2]||0)*PS(e[1]);return[n,r,c]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),c=(e[2]||0)/PS(r);return[n,r,c]}addMetersToLngLat(e,n){return hL(e,n)}panByPosition(e,n){const r=Cy(n,this.pixelUnprojectionMatrix),c=this.projectFlat(e),h=j_([],c,YC([],r)),p=j_([],this.center,h),[s,v]=this.unprojectFlat(p);return{longitude:s,latitude:v}}getBounds(e={}){const n=o$(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:c}=this,{longitude:h,latitude:p,zoom:s}=pL({width:r,height:c,bounds:e,...n});return new Ba({width:r,height:c,longitude:h,latitude:p,zoom:s})}}Y(Ba,"displayName","WebMercatorViewport");function $v(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof Ba){const[c,h,p=0]=t,s=e.getDistanceScales([c,h]);r[2]=p*s.unitsPerMeter[2]}return r}function q$(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:c,fromCoordinateSystem:h,fromCoordinateOrigin:p}=t;return c===Ti.DEFAULT&&(c=e.isGeospatial?Ti.LNGLAT:Ti.CARTESIAN),h===void 0&&(h=c),p===void 0&&(p=r),{viewport:e,coordinateSystem:c,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:h,fromCoordinateOrigin:p}}function yL(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:c,offsetMode:h}){let[p,s,v=0]=t;switch(n&&([p,s,v]=Rp([],[p,s,v,1],n)),r){case Ti.LNGLAT:return $v([p,s,v],e,h);case Ti.LNGLAT_OFFSETS:return $v([p+c[0],s+c[1],v+(c[2]||0)],e,h);case Ti.METER_OFFSETS:return $v(hL(c,[p,s,v]),e,h);case Ti.CARTESIAN:default:return e.isGeospatial?[p+c[0],s+c[1],v+c[2]]:e.projectPosition([p,s,v])}}function Z$(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:c,modelMatrix:h,fromCoordinateSystem:p,fromCoordinateOrigin:s}=q$(e),{geospatialOrigin:v,shaderCoordinateOrigin:E,offsetMode:M}=lL(n,r,c),I=yL(t,{viewport:n,modelMatrix:h,coordinateSystem:p,coordinateOrigin:s,offsetMode:M});if(M){const R=n.projectPosition(v||E);I7(I,I,R)}return I}const sh={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Z_=Symbol.for("component"),_h=Symbol.for("asyncPropDefaults"),Xc=Symbol.for("asyncPropOriginal"),Il=Symbol.for("asyncPropResolved");function Ob(t,e=()=>!0){return Array.isArray(t)?vL(t,e,[]):e(t)?[t]:[]}function vL(t,e,n){let r=-1;for(;++r<t.length;){const c=t[r];Array.isArray(c)?vL(c,e,n):e(c)&&n.push(c)}return n}function X$({target:t,source:e,start:n=0,count:r=1}){const c=e.length,h=r*c;let p=0;for(let s=n;p<c;p++)t[s++]=e[p];for(;p<h;)p<h-p?(t.copyWithin(n+p,n,n+p),p*=2):(t.copyWithin(n+p,n,n+h-p),p=h);return t}class Y${constructor(e,n,r){Y(this,"id",void 0),Y(this,"context",void 0),Y(this,"isLoaded",void 0),Y(this,"persistent",void 0),Y(this,"_loadCount",0),Y(this,"_subscribers",new Set),Y(this,"_data",void 0),Y(this,"_loader",void 0),Y(this,"_error",void 0),Y(this,"_content",void 0),this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let c=e;typeof e=="string"&&(c=jx(e)),c instanceof Promise?(this.isLoaded=!1,this._loader=c.then(h=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=h)}).catch(h=>{this._loadCount===r&&(this.isLoaded=!0,this._error=h||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const h of this._subscribers)h.onChange(this.getData())}}class K${constructor({gl:e,protocol:n}){Y(this,"protocol",void 0),Y(this,"_context",void 0),Y(this,"_resources",void 0),Y(this,"_consumers",void 0),Y(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:c=!0}){let h=this._resources[e];h?h.setData(n,r):(h=new Y$(e,n,this._context),this._resources[e]=h),h.persistent=c}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const c=n[r],h=this._resources[c.resourceId];h&&h.unsubscribe(c)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:c="default"}){const{_resources:h,protocol:p}=this;e.startsWith(p)&&(e=e.replace(p,""),h[e]||this.add({resourceId:e,data:null,persistent:!1}));const s=h[e];if(this._track(r,c,s,n),s)return s.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,c){const h=this._consumers,p=h[e]=h[e]||{},s=p[n]||{},v=s.resourceId&&this._resources[s.resourceId];v&&(v.unsubscribe(s),this.prune()),r&&(p[n]=s,s.onChange=c,s.resourceId=r.id,r.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const J$="layerManager.setLayers",Q$="layerManager.activateViewport";class eH{constructor(e,{deck:n,stats:r,viewport:c,timeline:h}={}){Y(this,"layers",void 0),Y(this,"context",void 0),Y(this,"resourceManager",void 0),Y(this,"_lastRenderedLayers",[]),Y(this,"_needsRedraw",!1),Y(this,"_needsUpdate",!1),Y(this,"_nextLayers",null),Y(this,"_debug",!1),Y(this,"activateViewport",p=>{ds(Q$,this,p),p&&(this.context.viewport=p)}),this.layers=[],this.resourceManager=new K$({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&x$(e),stats:r||new gb({id:"deck.gl"}),viewport:c||new Qc({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:h||new rL,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const c=r.getNeedsRedraw(e);n=n||c}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){ds(J$,this,n,e),this._lastRenderedLayers=e;const r=Ob(e,Boolean);for(const c of r)c.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,r){r.raiseError(n,"".concat(e," of ").concat(r))}_updateLayers(e,n){const r={};for(const p of e)r[p.id]?Vi.warn("Multiple old layers with same id ".concat(p.id))():r[p.id]=p;const c=[];this._updateSublayersRecursively(n,r,c),this._finalizeOldLayers(r);let h=!1;for(const p of c)if(p.hasUniformTransition()){h="Uniform transition in ".concat(p);break}this._needsUpdate=h,this.layers=c}_updateSublayersRecursively(e,n,r){for(const c of e){c.context=this.context;const h=n[c.id];h===null&&Vi.warn("Multiple new layers with same id ".concat(c.id))(),n[c.id]=null;let p=null;try{this._debug&&h!==c&&c.validateProps(),h?(this._transferLayerState(h,c),this._updateLayer(c)):this._initializeLayer(c),r.push(c),p=c.isComposite?c.getSubLayers():null}catch(s){this._handleError("matching",s,c)}p&&this._updateSublayersRecursively(p,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=sh.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=sh.MATCHED,n!==e&&(e.lifecycle=sh.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=sh.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=sh.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Zh(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const n in t){const r=t[n],c=e[n];if(!(r===c||Array.isArray(r)&&Array.isArray(c)&&Zh(r,c)))return!1}return!0}class tH{constructor(e){Y(this,"width",void 0),Y(this,"height",void 0),Y(this,"views",void 0),Y(this,"viewState",void 0),Y(this,"controllers",void 0),Y(this,"timeline",void 0),Y(this,"_viewports",void 0),Y(this,"_viewportMap",void 0),Y(this,"_isUpdating",void 0),Y(this,"_needsRedraw",void 0),Y(this,"_needsUpdate",void 0),Y(this,"_eventManager",void 0),Y(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),c={x:e[0],y:e[1]};for(let h=r.length-1;h>=0;--h){const p=r[h];if(p.containsPixel(c)){const s=e.slice();return s[0]-=p.x,s[1]-=p.y,p.unproject(s,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Ob(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Zh(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Vi.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:h=>{var p;return(p=this.getView(e.id))===null||p===void 0?void 0:p.makeViewport({viewState:h,width:this.width,height:this.height})}})}_updateController(e,n,r,c){const h=e.controller;if(h){const p={...n,...h,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return c||(c=this._createController(e,p)),c&&c.setProps(p),c}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let c=e.length;c--;){const h=e[c],p=this.getViewState(h),s=h.makeViewport({viewState:p,width:this.width,height:this.height});let v=n[h.id];const E=Boolean(h.controller);E&&!v&&(r=!0),(r||!E)&&v&&(v.finalize(),v=null),this.controllers[h.id]=this._updateController(h,p,s,v),this._viewports.unshift(s)}for(const c in n){const h=n[c];h&&!this.controllers[c]&&h.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,c)=>!e[c].equals(n[c]))}}const nH=/([0-9]+\.?[0-9]*)(%|px)/;function vl(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=nH.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function xl(t,e){return t.relative?Math.round(t.position*e):t.position}function jr(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class xL{constructor(e){Y(this,"id",void 0),Y(this,"viewportInstance",void 0),Y(this,"_x",void 0),Y(this,"_y",void 0),Y(this,"_width",void 0),Y(this,"_height",void 0),Y(this,"_padding",void 0),Y(this,"props",void 0);const{id:n,x:r=0,y:c=0,width:h="100%",height:p="100%",padding:s=null,viewportInstance:v}=e||{};jr(!v||v instanceof Qc),this.viewportInstance=v,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=vl(r),this._y=vl(c),this._width=vl(h),this._height=vl(p),this._padding=s&&{left:vl(s.left||0),right:vl(s.right||0),top:vl(s.top||0),bottom:vl(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Zh(this.props,e.props)}makeViewport({width:e,height:n,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);const c=this.getDimensions({width:e,height:n});return new this.ViewportType({...r,...this.props,...c})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:xl(this._x,e),y:xl(this._y,n),width:xl(this._width,e),height:xl(this._height,n)};return this._padding&&(r.padding={left:xl(this._padding.left,e),top:xl(this._padding.top,n),right:xl(this._padding.right,e),bottom:xl(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class zp{constructor(e){Y(this,"_inProgress",void 0),Y(this,"_handle",void 0),Y(this,"_timeline",void 0),Y(this,"time",void 0),Y(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(n=(r=this.settings).onStart)===null||n===void 0||n.call(r,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:c}=this;this._handle=r.addChannel({delay:r.getTime(),duration:c.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const IS=()=>{},a1={BREAK:1,SNAP_TO_END:2,IGNORE:3},iH=t=>t,rH=a1.BREAK;class sH{constructor(e){Y(this,"getControllerState",void 0),Y(this,"props",void 0),Y(this,"propsInTransition",void 0),Y(this,"transition",void 0),Y(this,"onViewStateChange",void 0),Y(this,"onStateChange",void 0),Y(this,"_onTransitionUpdate",n=>{const{time:r,settings:{interpolator:c,startProps:h,endProps:p,duration:s,easing:v}}=n,E=v(r/s),M=c.interpolateProps(h,p,E);this.propsInTransition=this.getControllerState({...this.props,...M}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new zp(e.timeline),this.onViewStateChange=e.onViewStateChange||IS,this.onStateChange=e.onStateChange||IS}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let c=r;if(this.transition.inProgress){const{interruption:h,endProps:p}=this.transition.settings;c={...r,...h===a1.SNAP_TO_END?p:this.propsInTransition||r}}this._triggerTransition(c,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&Boolean(r)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===a1.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),c=this.getControllerState(n).shortestPathFrom(r),h=n.transitionInterpolator,p=h.getDuration?h.getDuration(e,n):n.transitionDuration;if(p===0)return;const s=h.initializeProps(e,c);this.propsInTransition={};const v={duration:p,easing:n.transitionEasing||iH,interpolator:h,interruption:n.transitionInterruption||rH,startProps:s.start,endProps:s.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(v),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(n)}}}class oH{constructor(e){Y(this,"_propsToCompare",void 0),Y(this,"_propsToExtract",void 0),Y(this,"_requiredProps",void 0);const{compare:n,extract:r,required:c}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=c}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!zh(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},c={};for(const h of this._propsToExtract)(h in e||h in n)&&(r[h]=e[h],c[h]=n[h]);return this._checkRequiredProps(r),this._checkRequiredProps(c),{start:r,end:c}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){!this._requiredProps||this._requiredProps.forEach(n=>{const r=e[n];jr(Number.isFinite(r)||Array.isArray(r),"".concat(n," is required for transition"))})}}const aH=["longitude","latitude","zoom","bearing","pitch"],lH=["longitude","latitude","zoom"];class Db extends oH{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:aH,required:lH},super(r.transitionProps),Y(this,"opts",void 0),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:c,around:h}=this.opts;if(c&&h){const p=c(e),s=c(n),v=p.unproject(h);r.start.around=h,Object.assign(r.end,{around:s.project(v),aroundPosition:v,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const c={};for(const h of this._propsToExtract)c[h]=V_(e[h]||0,n[h]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const h=this.opts.makeViewport({...n,...c});Object.assign(c,h.panByPosition(n.aroundPosition,V_(e.around,n.around,r)))}return c}}const bl={transitionDuration:0},cH=300,Ug=t=>1-(1-t)*(1-t),nh={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Pc={};class bL{constructor(e){Y(this,"props",void 0),Y(this,"state",{}),Y(this,"transitionManager",void 0),Y(this,"eventManager",void 0),Y(this,"onViewStateChange",void 0),Y(this,"onStateChange",void 0),Y(this,"makeViewport",void 0),Y(this,"_controllerState",void 0),Y(this,"_events",{}),Y(this,"_interactionState",{isDragging:!1}),Y(this,"_customEvents",[]),Y(this,"_eventStartBlocked",null),Y(this,"_panMove",!1),Y(this,"invertPan",!1),Y(this,"dragMode","rotate"),Y(this,"inertia",0),Y(this,"scrollZoom",!0),Y(this,"dragPan",!0),Y(this,"dragRotate",!0),Y(this,"doubleClickZoom",!0),Y(this,"touchZoom",!0),Y(this,"touchRotate",!1),Y(this,"keyboard",!0),this.transitionManager=new sH({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:c}=e;return[c.x-n,c.y-r]}isPointInBounds(e,n){const{width:r,height:c}=this.props;if(n&&n.handled)return!1;const h=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=c;return h&&n&&n.stopPropagation(),h}isFunctionKeyPressed(e){const{srcEvent:n}=e;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?cH:0;const{scrollZoom:r=!0,dragPan:c=!0,dragRotate:h=!0,doubleClickZoom:p=!0,touchZoom:s=!0,touchRotate:v=!1,keyboard:E=!0}=e,M=Boolean(this.onViewStateChange);this.toggleEvents(nh.WHEEL,M&&r),this.toggleEvents(nh.PAN,M&&(c||h)),this.toggleEvents(nh.PINCH,M&&(s||v)),this.toggleEvents(nh.TRIPLE_PAN,M&&v),this.toggleEvents(nh.DOUBLE_TAP,M&&p),this.toggleEvents(nh.KEYBOARD,M&&E),this.scrollZoom=r,this.dragPan=c,this.dragRotate=h,this.doubleClickZoom=p,this.touchZoom=s,this.touchRotate=v,this.keyboard=E}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const c={...e.getViewportProps(),...n},h=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),h){const p=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:c,interactionState:this._interactionState,oldViewState:p})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const c=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(c,bl,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,bl,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),c=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],h=this.controllerState.pan({pos:c}).panEnd();this.updateViewport(h,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Ug},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,bl,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),c=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],h=this.controllerState.rotate({pos:c}).rotateEnd();this.updateViewport(h,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Ug},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:r=.01,smooth:c=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:h}=e;let p=2/(1+Math.exp(-Math.abs(h*r)));h<0&&p!==0&&(p=1/p);const s=this.controllerState.zoom({pos:n,scale:p});return this.updateViewport(s,{...this._getTransitionProps({around:n}),transitionDuration:c?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,bl,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,bl,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),c=[r[0],r[1]+=e.velocityY*n/2],h=this.controllerState.rotate({pos:c});this.updateViewport(h,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Ug},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Pc._startPinchRotation=e.rotation,Pc._lastPinchEvent=e,this.updateViewport(r,bl,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,c=this.getCenter(e);n=n.zoom({pos:c,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:Pc._startPinchRotation-r})}return this.updateViewport(n,bl,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Pc._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=Pc;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const c=this.getCenter(e);let h=this.controllerState.rotateEnd();const p=Math.log2(e.scale),s=(p-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),v=Math.pow(2,p+s*n/2);h=h.zoom({pos:c,scale:v}).zoomEnd(),this.updateViewport(h,{...this._getTransitionProps({around:c}),transitionDuration:n,transitionEasing:Ug},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const c=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(c,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Pc._startPinchRotation=null,Pc._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),c=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(c,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:c,rotateSpeedX:h,rotateSpeedY:p}=this.keyboard===!0?{}:this.keyboard,{controllerState:s}=this;let v;const E={};switch(e.srcEvent.code){case"Minus":v=n?s.zoomOut(r).zoomOut(r):s.zoomOut(r),E.isZooming=!0;break;case"Equal":v=n?s.zoomIn(r).zoomIn(r):s.zoomIn(r),E.isZooming=!0;break;case"ArrowLeft":n?(v=s.rotateLeft(h),E.isRotating=!0):(v=s.moveLeft(c),E.isPanning=!0);break;case"ArrowRight":n?(v=s.rotateRight(h),E.isRotating=!0):(v=s.moveRight(c),E.isPanning=!0);break;case"ArrowUp":n?(v=s.rotateUp(p),E.isRotating=!0):(v=s.moveUp(c),E.isPanning=!0);break;case"ArrowDown":n?(v=s.rotateDown(p),E.isRotating=!0):(v=s.moveDown(c),E.isPanning=!0);break;default:return!1}return this.updateViewport(v,this._getTransitionProps(),E),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?bl:e?{...n,transitionInterpolator:new Db({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class wL{constructor(e,n){Y(this,"_viewportProps",void 0),Y(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const CS=5,uH=1.2;class hH extends wL{constructor(e){const{width:n,height:r,latitude:c,longitude:h,zoom:p,bearing:s=0,pitch:v=0,altitude:E=1.5,position:M=[0,0,0],maxZoom:I=20,minZoom:R=0,maxPitch:N=60,minPitch:$=0,startPanLngLat:Z,startZoomLngLat:ne,startRotatePos:me,startBearing:we,startPitch:he,startZoom:Pe,normalize:ge=!0}=e;jr(Number.isFinite(h)),jr(Number.isFinite(c)),jr(Number.isFinite(p)),super({width:n,height:r,latitude:c,longitude:h,zoom:p,bearing:s,pitch:v,altitude:E,maxZoom:I,minZoom:R,maxPitch:N,minPitch:$,normalize:ge,position:M},{startPanLngLat:Z,startZoomLngLat:ne,startRotatePos:me,startBearing:we,startPitch:he,startZoom:Pe}),Y(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const h=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(h)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:c,startBearing:h,startPitch:p}=this.getState();if(!c||h===void 0||p===void 0)return this;let s;return e?s=this._getNewRotation(e,c,p,h):s={bearing:h+n,pitch:p+r},this._getUpdatedState(s)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:c,startZoomLngLat:h}=this.getState();if(h||(c=this.getViewportProps().zoom,h=this._unproject(n)||this._unproject(e)),!h)return this;const{maxZoom:p,minZoom:s}=this.getViewportProps();let v=c+Math.log2(r);v=Jr(v,s,p);const E=this.makeViewport({...this.getViewportProps(),zoom:v});return this._getUpdatedState({zoom:v,...E.panByPosition(h,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:c,longitude:h}=r;return Math.abs(c-n.bearing)>180&&(r.bearing=c<0?c+360:c-360),Math.abs(h-n.longitude)>180&&(r.longitude=h<0?h+360:h-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:c}=e;e.zoom=Jr(c,r,n);const{maxPitch:h,minPitch:p,pitch:s}=e;e.pitch=Jr(s,p,h);const{normalize:v=!0}=e;return v&&Object.assign(e,a$(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,c){const h=e[0]-n[0],p=e[1]-n[1],s=e[1],v=n[1],{width:E,height:M}=this.getViewportProps(),I=h/E;let R=0;p>0?Math.abs(M-v)>CS&&(R=p/(v-M)*uH):p<0&&v>CS&&(R=1-s/v),R=Jr(R,-1,1);const{minPitch:N,maxPitch:$}=this.getViewportProps(),Z=c+180*I;let ne=r;return R>0?ne=r+R*($-r):R<0&&(ne=r-R*(N-r)),{pitch:ne,bearing:Z}}}class fH extends bL{constructor(...e){super(...e),Y(this,"ControllerState",hH),Y(this,"transition",{transitionDuration:300,transitionInterpolator:new Db({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),Y(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class zb extends xL{get ViewportType(){return Ba}get ControllerType(){return fH}}Y(zb,"displayName","MapView");class dH extends Ly{constructor(e,n){super(e,n),Y(this,"maskMap",void 0),Y(this,"fbo",void 0);const{mapSize:r=2048}=n;this.maskMap=new Ys(e,{width:r,height:r,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.fbo=new br(e,{id:"maskmap",width:r,height:r,attachments:{[36064]:this.maskMap}})}render(e){const n=this.gl,r=[!1,!1,!1,!1];return r[e.channel]=!0,oo(n,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:r,depthTest:!1},()=>super.render({...e,target:this.fbo,pass:"mask"}))}shouldDrawLayer(e){return e.props.operation===Dp.MASK}delete(){this.fbo.delete(),this.maskMap.delete()}}const pH=new co().lookAt({eye:[0,0,1]});function mH({width:t,height:e,near:n,far:r,padding:c}){let h=-t/2,p=t/2,s=-e/2,v=e/2;if(c){const{left:E=0,right:M=0,top:I=0,bottom:R=0}=c,N=Jr((E+t-M)/2,0,t)-t/2,$=Jr((I+e-R)/2,0,e)-e/2;h-=N,p-=N,s+=$,v+=$}return new co().ortho({left:h,right:p,bottom:s,top:v,near:n,far:r})}class gH extends Qc{constructor(e){const{width:n,height:r,near:c=.1,far:h=1e3,zoom:p=0,target:s=[0,0,0],padding:v=null,flipY:E=!0}=e,M=Array.isArray(p)?p[0]:p,I=Array.isArray(p)?p[1]:p,R=Math.min(M,I),N=Math.pow(2,R);let $;if(M!==I){const Z=Math.pow(2,M),ne=Math.pow(2,I);$={unitsPerMeter:[Z/N,ne/N,1],metersPerUnit:[N/Z,N/ne,1]}}super({...e,longitude:void 0,position:s,viewMatrix:pH.clone().scale([N,N*(E?-1:1),N]),projectionMatrix:mH({width:n||1,height:r||1,padding:v,near:c,far:h}),zoom:R,distanceScales:$})}projectFlat([e,n]){const{unitsPerMeter:r}=this.distanceScales;return[e*r[0],n*r[1]]}unprojectFlat([e,n]){const{metersPerUnit:r}=this.distanceScales;return[e*r[0],n*r[1]]}panByPosition(e,n){const r=Cy(n,this.pixelUnprojectionMatrix),c=this.projectFlat(e),h=j_([],c,YC([],r)),p=j_([],this.center,h);return{target:this.unprojectFlat(p)}}}class _H extends wL{constructor(e){const{width:n,height:r,rotationX:c=0,rotationOrbit:h=0,target:p=[0,0,0],zoom:s=0,minRotationX:v=-90,maxRotationX:E=90,minZoom:M=-1/0,maxZoom:I=1/0,startPanPosition:R,startRotatePos:N,startRotationX:$,startRotationOrbit:Z,startZoomPosition:ne,startZoom:me}=e;super({width:n,height:r,rotationX:c,rotationOrbit:h,target:p,zoom:s,minRotationX:v,maxRotationX:E,minZoom:M,maxZoom:I},{startPanPosition:R,startRotatePos:N,startRotationX:$,startRotationOrbit:Z,startZoomPosition:ne,startZoom:me}),Y(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const r=this.getState().startPanPosition||n;if(!r)return this;const h=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(h)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:c,startRotationX:h,startRotationOrbit:p}=this.getState(),{width:s,height:v}=this.getViewportProps();if(!c||h===void 0||p===void 0)return this;let E;if(e){let M=(e[0]-c[0])/s;const I=(e[1]-c[1])/v;(h<-90||h>90)&&(M*=-1),E={rotationX:h+I*180,rotationOrbit:p+M*180}}else E={rotationX:h+r,rotationOrbit:p+n};return this._getUpdatedState(E)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{rotationOrbit:c}=r;return Math.abs(c-n.rotationOrbit)>180&&(r.rotationOrbit=c<0?c+360:c-360),r}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:c,startZoomPosition:h}=this.getState();if(h||(c=this.getViewportProps().zoom,h=this._unproject(n)||this._unproject(e)),!h)return this;const p=this._calculateNewZoom({scale:r,startZoom:c}),s=this.makeViewport({...this.getViewportProps(),zoom:p});return this._getUpdatedState({zoom:p,...s.panByPosition(h,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:r,minZoom:c}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const h=n+Math.log2(e);return Jr(h,c,r)}_panFromCenter(e){const{width:n,height:r,target:c}=this.getViewportProps();return this.pan({startPosition:c,pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:c,maxRotationX:h,minRotationX:p,rotationOrbit:s}=e;return e.zoom=Array.isArray(c)?[Jr(c[0],r,n),Jr(c[1],r,n)]:Jr(c,r,n),e.rotationX=Jr(e.rotationX,p,h),(s<-180||s>180)&&(e.rotationOrbit=z$(s+180,360)-180),e}}class yH extends _H{constructor(e){super(e),Y(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:r,minZoom:c}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);let h=Math.log2(e);if(Array.isArray(n)){let[p,s]=n;switch(this.zoomAxis){case"X":p=Jr(p+h,c,r);break;case"Y":s=Jr(s+h,c,r);break;default:let v=Math.min(p+h,s+h);v<c&&(h+=c-v),v=Math.max(p+h,s+h),v>r&&(h+=r-v),p+=h,s+=h}return[p,s]}return Jr(n+h,c,r)}}class vH extends bL{constructor(...e){super(...e),Y(this,"ControllerState",yH),Y(this,"transition",{transitionDuration:300,transitionInterpolator:new Db(["target","zoom"])}),Y(this,"dragMode","pan")}_onPanRotate(){return!1}}class EL extends xL{get ViewportType(){return gH}get ControllerType(){return vH}}Y(EL,"displayName","OrthographicView");function xH({layers:t,viewport:e}){let n=null;for(const h of t){const p=h.getBounds();p&&(n?(n[0]=Math.min(n[0],p[0][0]),n[1]=Math.min(n[1],p[0][1]),n[2]=Math.max(n[2],p[1][0]),n[3]=Math.max(n[3],p[1][1])):n=[p[0][0],p[0][1],p[1][0],p[1][1]])}const r=e.getBounds();if(!n)return r;const c=wH(r);return n[2]-n[0]<c[2]-c[0]||n[3]-n[1]<c[3]-c[1]||(n[0]=Math.max(n[0],c[0]),n[1]=Math.max(n[1],c[1]),n[2]=Math.min(n[2],c[2]),n[3]=Math.min(n[3],c[3])),n}function bH({bounds:t,viewport:e,width:n,height:r}){if(t[2]<=t[0]||t[3]<=t[1])return null;const c=1;if(n-=c*2,r-=c*2,e instanceof Ba){const{longitude:s,latitude:v,zoom:E}=pL({width:n,height:r,bounds:[[t[0],t[1]],[t[2],t[3]]],maxZoom:20});return new Ba({longitude:s,latitude:v,zoom:E,x:c,y:c,width:n,height:r})}const h=[(t[0]+t[2])/2,(t[1]+t[3])/2,0],p=Math.min(20,n/(t[2]-t[0]),r/(t[3]-t[1]));return new EL({x:c,y:c}).makeViewport({width:n,height:r,viewState:{target:h,zoom:Math.log2(p)}})}function wH(t){const e={x:t[2]-t[0],y:t[3]-t[1]},n={x:t[0]+.5*e.x,y:t[1]+.5*e.y};return[n.x-e.x,n.y-e.y,n.x+e.x,n.y+e.y]}class EH{constructor(){Y(this,"id","mask-effect"),Y(this,"props",null),Y(this,"useInPicking",!0),Y(this,"dummyMaskMap",void 0),Y(this,"channels",[]),Y(this,"masks",null),Y(this,"maskPass",void 0),Y(this,"maskMap",void 0),Y(this,"lastViewport",void 0)}preRender(e,{layers:n,layerFilter:r,viewports:c,onViewportActive:h,views:p}){this.dummyMaskMap||(this.dummyMaskMap=new Ys(e,{width:1,height:1}));const s=n.filter(I=>I.props.visible&&I.props.operation===Dp.MASK);if(s.length===0){this.masks=null,this.channels.length=0;return}this.masks={},this.maskPass||(this.maskPass=new dH(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const v=this._sortMaskChannels(s),E=c[0],M=!this.lastViewport||!this.lastViewport.equals(E);for(const I in v)this._renderChannel(v[I],{layerFilter:r,onViewportActive:h,views:p,viewport:E,viewportChanged:M})}_renderChannel(e,{layerFilter:n,onViewportActive:r,views:c,viewport:h,viewportChanged:p}){const s=this.channels[e.index];if(!s)return;const v=e===s||s.layers.length!==e.layers.length||e.layerBounds.some((E,M)=>E!==s.layerBounds[M]);if(e.bounds=s.bounds,e.maskBounds=s.maskBounds,this.channels[e.index]=e,(v||p)&&(this.lastViewport=h,e.bounds=xH({layers:e.layers,viewport:h}),v||!zh(e.bounds,s.bounds))){const{maskPass:E,maskMap:M}=this,I=bH({bounds:e.bounds,viewport:h,width:M.width,height:M.height});e.maskBounds=I?I.getBounds():[0,0,1,1],E.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:n,viewports:I?[I]:[],onViewportActive:r,views:c,moduleParameters:{devicePixelRatio:1}})}this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem}}_sortMaskChannels(e){const n={};let r=0;for(const c of e){const{id:h}=c.root;let p=n[h];if(!p){if(++r>4){Vi.warn("Too many mask layers. The max supported is 4")();continue}p={id:h,index:this.channels.findIndex(s=>s?.id===h),layers:[],layerBounds:[],coordinateOrigin:c.root.props.coordinateOrigin,coordinateSystem:c.root.props.coordinateSystem},n[h]=p}p.layers.push(c),p.layerBounds.push(c.getBounds())}for(let c=0;c<4;c++){const h=this.channels[c];(!h||!(h.id in n))&&(this.channels[c]=null)}for(const c in n){const h=n[c];h.index<0&&(h.index=this.channels.findIndex(p=>!p),this.channels[h.index]=h)}return n}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const TH=new _L;class AH{constructor(){Y(this,"effects",void 0),Y(this,"_internalEffects",void 0),Y(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!Zh(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._internalEffects=e.slice(),this._internalEffects.push(new EH),e.some(n=>n instanceof _L)||this._internalEffects.push(TH)}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}}class SH extends Ly{shouldDrawLayer(e){return e.props.operation===Dp.DRAW}}const LS={blendFunc:[1,0,32771,0],blendEquation:32774};class TL extends Ly{constructor(...e){super(...e),Y(this,"pickZ",void 0),Y(this,"_colors",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:c,onViewportActive:h,pickingFBO:p,deviceRect:{x:s,y:v,width:E,height:M},cullRect:I,effects:R,pass:N="picking",pickZ:$}){const Z=this.gl;this.pickZ=$;const ne=$?null:{byLayer:new Map,byAlpha:[]};this._colors=ne;const me=oo(Z,{scissorTest:!0,scissor:[s,v,E,M],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...LS,blend:!$},()=>super.render({target:p,layers:e,layerFilter:n,views:r,viewports:c,onViewportActive:h,cullRect:I,effects:R?.filter(he=>he.useInPicking),pass:N}));return this._colors=null,{decodePickingColor:ne&&PH.bind(null,ne),stats:me}}shouldDrawLayer(e){return e.props.pickable&&e.props.operation===Dp.DRAW}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,r){const c={...e.props.parameters};return this._colors?(Object.assign(c,LS),c.blend=!0,c.blendColor=MH(this._colors,e,r)):c.blend=!1,c}}function MH(t,e,n){const{byLayer:r,byAlpha:c}=t;let h,p=r.get(e);return p?(p.viewports.push(n),h=p.a):(h=r.size+1,h<=255?(p={a:h,layer:e,viewports:[n]},r.set(e,p),c[h]=p):(Vi.warn("Too many pickable layers, only picking the first 255")(),h=0)),[0,0,0,h/255]}function PH(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const IH="deckRenderer.renderLayers";class CH{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new SH(e),this.pickLayersPass=new TL(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||br.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const r=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,c=n.render({...e,target:r});this._postRender(e.effects,e),this.renderCount++,ds(IH,this,c,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){let r=null;for(const c of e)c.preRender(this.gl,n),c.postRender&&(r=c);r&&this._resizeRenderBuffers(),this.lastPostProcessEffect=r}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new br(this.gl),new br(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:r}=this,c={inputBuffer:r[0],swapBuffer:r[1],target:null};for(const h of e)if(h.postRender){if(h===this.lastPostProcessEffect){c.target=n.target,h.postRender(this.gl,c);break}const p=h.postRender(this.gl,c);c.inputBuffer=p,c.swapBuffer=p===r[0]?r[1]:r[0]}}}const LH={pickedColor:null,pickedObjectIndex:-1};function kH({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:c,deviceRect:h}){const{x:p,y:s,width:v,height:E}=h;let M=c*c,I=-1,R=0;for(let N=0;N<E;N++){const $=N+s-r,Z=$*$;if(Z>M)R+=4*v;else for(let ne=0;ne<v;ne++){if(t[R+3]-1>=0){const we=ne+p-n,he=we*we+Z;he<=M&&(M=he,I=R)}R+=4}}if(I>=0){const N=t.slice(I,I+4),$=e(N);if($){const Z=Math.floor(I/4/v),ne=I/4-Z*v;return{...$,pickedColor:N,pickedX:p+ne,pickedY:s+Z}}Vi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return LH}function RH({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const h=t.slice(r,r+4),p=h.join(",");if(!n.has(p)){const s=e(h);s?n.set(p,{...s,color:h}):Vi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function AL({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:c,z:h}){let p=e[0];e.length>1&&(p=DH(t?.pickedViewports||e,{x:r,y:c}));let s;if(p){const v=[r-p.x,c-p.y];h!==void 0&&(v[2]=h),s=p.unproject(v)}return{color:null,layer:null,viewport:p,index:-1,picked:!1,x:r,y:c,pixel:[r,c],coordinate:s,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function OH(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:c}=t,{pickedColor:h,pickedLayer:p,pickedObjectIndex:s}=e,v=p?[p]:[];if(r==="hover"){const I=n.index,R=n.layerId,N=p?p.props.id:null;if(N!==R||s!==I){if(N!==R){const $=c.find(Z=>Z.props.id===R);$&&v.unshift($)}n.layerId=N,n.index=s,n.info=null}}const E=AL(t),M=new Map;return M.set(null,E),v.forEach(I=>{let R={...E};I===p&&(R.color=h,R.index=s,R.picked=!0),R=SL({layer:I,info:R,mode:r});const N=R.layer;I===p&&r==="hover"&&(n.info=R),M.set(N.id,R),r==="hover"&&N.updateAutoHighlight(R)}),M}function SL({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function DH(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class zH{constructor(e){Y(this,"gl",void 0),Y(this,"pickingFBO",void 0),Y(this,"depthFBO",void 0),Y(this,"pickLayersPass",void 0),Y(this,"layerFilter",void 0),Y(this,"lastPickedInfo",void 0),Y(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new TL(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:c},h=this.lastPickedInfo.info){const p=h&&h.layer&&h.layer.id,s=h&&h.viewport&&h.viewport.id,v=p?r.find(R=>R.id===p):null,E=s&&c.find(R=>R.id===s)||c[0],M=E&&E.unproject([e-E.x,n-E.y]);return{...h,...{x:e,y:n,viewport:E,coordinate:M,layer:v}}}_resizeBuffer(){var e,n;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new br(r),br.isSupported(r,{colorBufferFloat:!0}))){const c=new br(r);c.attach({[36064]:new Ys(r,{format:ui(r)?34836:6408,type:5126})}),this.depthFBO=c}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>r.isPickable()&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:c,y:h,radius:p=0,depth:s=1,mode:v="query",unproject3D:E,onViewportActive:M,effects:I}){const R=this._getPickable(e),N=Lh(this.gl);if(!R)return{result:[],emptyInfo:AL({viewports:r,x:c,y:h,pixelRatio:N})};this._resizeBuffer();const $=Pv(this.gl,[c,h],!0),Z=[$.x+Math.floor($.width/2),$.y+Math.floor($.height/2)],ne=Math.round(p*N),{width:me,height:we}=this.pickingFBO,he=this._getPickingRect({deviceX:Z[0],deviceY:Z[1],deviceRadius:ne,deviceWidth:me,deviceHeight:we}),Pe={x:c-p,y:h-p,width:p*2+1,height:p*2+1};let ge;const nt=[],Tt=new Set;for(let Rt=0;Rt<s;Rt++){let ke;if(he){const xt=this._drawAndSample({layers:R,views:n,viewports:r,onViewportActive:M,deviceRect:he,cullRect:Pe,effects:I,pass:"picking:".concat(v)});ke=kH({...xt,deviceX:Z[0],deviceY:Z[1],deviceRadius:ne,deviceRect:he})}else ke={pickedColor:null,pickedObjectIndex:-1};let It;ke.pickedLayer&&E&&this.depthFBO&&(It=this._drawAndSample({layers:[ke.pickedLayer],views:n,viewports:r,onViewportActive:M,deviceRect:{x:ke.pickedX,y:ke.pickedY,width:1,height:1},cullRect:Pe,effects:I,pass:"picking:".concat(v,":z")},!0).pickedColors[0]),ke.pickedLayer&&Rt+1<s&&(Tt.add(ke.pickedLayer),ke.pickedLayer.disablePickingIndex(ke.pickedObjectIndex)),ge=OH({pickInfo:ke,lastPickedInfo:this.lastPickedInfo,mode:v,layers:R,viewports:r,x:c,y:h,z:It,pixelRatio:N});for(const xt of ge.values())xt.layer&&nt.push(xt);if(!ke.pickedColor)break}for(const Rt of Tt)Rt.restorePickingColors();return{result:nt,emptyInfo:ge.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:c,y:h,width:p=1,height:s=1,mode:v="query",maxObjects:E=null,onViewportActive:M,effects:I}){const R=this._getPickable(e);if(!R)return[];this._resizeBuffer();const N=Lh(this.gl),$=Pv(this.gl,[c,h],!0),Z=$.x,ne=$.y+$.height,me=Pv(this.gl,[c+p,h+s],!0),we=me.x+me.width,he=me.y,Pe={x:Z,y:he,width:we-Z,height:ne-he},ge=this._drawAndSample({layers:R,views:n,viewports:r,onViewportActive:M,deviceRect:Pe,cullRect:{x:c,y:h,width:p,height:s},effects:I,pass:"picking:".concat(v)}),nt=RH(ge),Tt=new Map,Rt=Number.isFinite(E);for(let ke=0;ke<nt.length&&!(Rt&&E&&Tt.size>=E);ke++){const It=nt[ke];let xt={color:It.pickedColor,layer:null,index:It.pickedObjectIndex,picked:!0,x:c,y:h,pixelRatio:N};xt=SL({layer:It.pickedLayer,info:xt,mode:v}),Tt.has(xt.object)||Tt.set(xt.object,xt)}return Array.from(Tt.values())}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:c,deviceRect:h,cullRect:p,effects:s,pass:v},E=!1){const M=E?this.depthFBO:this.pickingFBO,{decodePickingColor:I}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:c,pickingFBO:M,deviceRect:h,cullRect:p,effects:s,pass:v,pickZ:E}),{x:R,y:N,width:$,height:Z}=h,ne=new(E?Float32Array:Uint8Array)($*Z*4);return Py(M,{sourceX:R,sourceY:N,sourceWidth:$,sourceHeight:Z,target:ne}),{pickedColors:ne,decodePickingColor:I}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:c,deviceHeight:h}){const p=Math.max(0,e-r),s=Math.max(0,n-r),v=Math.min(c,e+r+1)-p,E=Math.min(h,n+r+1)-s;return v<=0||E<=0?null:{x:p,y:s,width:v,height:E}}}const BH={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class FH{constructor(e){Y(this,"el",null),Y(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,BH),n.appendChild(this.el))}setTooltip(e,n,r){const c=this.el;if(!!c){if(typeof e=="string")c.innerText=e;else if(e)e.text&&(c.innerText=e.text),e.html&&(c.innerHTML=e.html),e.className&&(c.className=e.className),Object.assign(c.style,e.style);else{this.isVisible=!1,c.style.display="none";return}this.isVisible=!0,c.style.display="block",c.style.transform="translate(".concat(n,"px, ").concat(r,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var Xh={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,c){var h=["","webkit","Moz","MS","ms","o"],p=n.createElement("div"),s="function",v=Math.round,E=Math.abs,M=Date.now;function I(X,re,Ae){return setTimeout(he(X,Ae),re)}function R(X,re,Ae){return Array.isArray(X)?(N(X,Ae[re],Ae),!0):!1}function N(X,re,Ae){var Je;if(!!X)if(X.forEach)X.forEach(re,Ae);else if(X.length!==c)for(Je=0;Je<X.length;)re.call(Ae,X[Je],Je,X),Je++;else for(Je in X)X.hasOwnProperty(Je)&&re.call(Ae,X[Je],Je,X)}function $(X,re,Ae){var Je="DEPRECATED METHOD: "+re+`
`+Ae+` AT 
`;return function(){var Et=new Error("get-stack-trace"),qt=Et&&Et.stack?Et.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Rn=e.console&&(e.console.warn||e.console.log);return Rn&&Rn.call(e.console,Je,qt),X.apply(this,arguments)}}var Z;typeof Object.assign!="function"?Z=function(re){if(re===c||re===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ae=Object(re),Je=1;Je<arguments.length;Je++){var Et=arguments[Je];if(Et!==c&&Et!==null)for(var qt in Et)Et.hasOwnProperty(qt)&&(Ae[qt]=Et[qt])}return Ae}:Z=Object.assign;var ne=$(function(re,Ae,Je){for(var Et=Object.keys(Ae),qt=0;qt<Et.length;)(!Je||Je&&re[Et[qt]]===c)&&(re[Et[qt]]=Ae[Et[qt]]),qt++;return re},"extend","Use `assign`."),me=$(function(re,Ae){return ne(re,Ae,!0)},"merge","Use `assign`.");function we(X,re,Ae){var Je=re.prototype,Et;Et=X.prototype=Object.create(Je),Et.constructor=X,Et._super=Je,Ae&&Z(Et,Ae)}function he(X,re){return function(){return X.apply(re,arguments)}}function Pe(X,re){return typeof X==s?X.apply(re&&re[0]||c,re):X}function ge(X,re){return X===c?re:X}function nt(X,re,Ae){N(It(re),function(Je){X.addEventListener(Je,Ae,!1)})}function Tt(X,re,Ae){N(It(re),function(Je){X.removeEventListener(Je,Ae,!1)})}function Rt(X,re){for(;X;){if(X==re)return!0;X=X.parentNode}return!1}function ke(X,re){return X.indexOf(re)>-1}function It(X){return X.trim().split(/\s+/g)}function xt(X,re,Ae){if(X.indexOf&&!Ae)return X.indexOf(re);for(var Je=0;Je<X.length;){if(Ae&&X[Je][Ae]==re||!Ae&&X[Je]===re)return Je;Je++}return-1}function gn(X){return Array.prototype.slice.call(X,0)}function an(X,re,Ae){for(var Je=[],Et=[],qt=0;qt<X.length;){var Rn=re?X[qt][re]:X[qt];xt(Et,Rn)<0&&Je.push(X[qt]),Et[qt]=Rn,qt++}return Ae&&(re?Je=Je.sort(function(ye,Le){return ye[re]>Le[re]}):Je=Je.sort()),Je}function ln(X,re){for(var Ae,Je,Et=re[0].toUpperCase()+re.slice(1),qt=0;qt<h.length;){if(Ae=h[qt],Je=Ae?Ae+Et:re,Je in X)return Je;qt++}return c}var $t=1;function Mn(){return $t++}function yn(X){var re=X.ownerDocument||X;return re.defaultView||re.parentWindow||e}var vn=/mobile|tablet|ip(ad|hone|od)|android/i,Bn="ontouchstart"in e,Wn=ln(e,"PointerEvent")!==c,pi=Bn&&vn.test(navigator.userAgent),Kn="touch",Ii="pen",vi="mouse",lt="kinect",zt=25,yt=1,Ft=2,Jt=4,xn=8,wn=1,ue=2,Me=4,Ve=8,Qe=16,st=ue|Me,St=Ve|Qe,Dt=st|St,Pt=["x","y"],Mt=["clientX","clientY"];function ht(X,re){var Ae=this;this.manager=X,this.callback=re,this.element=X.element,this.target=X.options.inputTarget,this.domHandler=function(Je){Pe(X.options.enable,[X])&&Ae.handler(Je)},this.init()}ht.prototype={handler:function(){},init:function(){this.evEl&&nt(this.element,this.evEl,this.domHandler),this.evTarget&&nt(this.target,this.evTarget,this.domHandler),this.evWin&&nt(yn(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Tt(this.element,this.evEl,this.domHandler),this.evTarget&&Tt(this.target,this.evTarget,this.domHandler),this.evWin&&Tt(yn(this.element),this.evWin,this.domHandler)}};function Zt(X){var re,Ae=X.options.inputClass;return Ae?re=Ae:Wn?re=_s:pi?re=oe:Bn?re=de:re=hi,new re(X,jt)}function jt(X,re,Ae){var Je=Ae.pointers.length,Et=Ae.changedPointers.length,qt=re&yt&&Je-Et===0,Rn=re&(Jt|xn)&&Je-Et===0;Ae.isFirst=!!qt,Ae.isFinal=!!Rn,qt&&(X.session={}),Ae.eventType=re,tn(X,Ae),X.emit("hammer.input",Ae),X.recognize(Ae),X.session.prevInput=Ae}function tn(X,re){var Ae=X.session,Je=re.pointers,Et=Je.length;Ae.firstInput||(Ae.firstInput=J(re)),Et>1&&!Ae.firstMultiple?Ae.firstMultiple=J(re):Et===1&&(Ae.firstMultiple=!1);var qt=Ae.firstInput,Rn=Ae.firstMultiple,xi=Rn?Rn.center:qt.center,ye=re.center=G(Je);re.timeStamp=M(),re.deltaTime=re.timeStamp-qt.timeStamp,re.angle=sn(xi,ye),re.distance=ct(xi,ye),dn(Ae,re),re.offsetDirection=gt(re.deltaX,re.deltaY);var Le=Fe(re.deltaTime,re.deltaX,re.deltaY);re.overallVelocityX=Le.x,re.overallVelocityY=Le.y,re.overallVelocity=E(Le.x)>E(Le.y)?Le.x:Le.y,re.scale=Rn?$n(Rn.pointers,Je):1,re.rotation=Rn?fn(Rn.pointers,Je):0,re.maxPointers=Ae.prevInput?re.pointers.length>Ae.prevInput.maxPointers?re.pointers.length:Ae.prevInput.maxPointers:re.pointers.length,et(Ae,re);var ze=X.element;Rt(re.srcEvent.target,ze)&&(ze=re.srcEvent.target),re.target=ze}function dn(X,re){var Ae=re.center,Je=X.offsetDelta||{},Et=X.prevDelta||{},qt=X.prevInput||{};(re.eventType===yt||qt.eventType===Jt)&&(Et=X.prevDelta={x:qt.deltaX||0,y:qt.deltaY||0},Je=X.offsetDelta={x:Ae.x,y:Ae.y}),re.deltaX=Et.x+(Ae.x-Je.x),re.deltaY=Et.y+(Ae.y-Je.y)}function et(X,re){var Ae=X.lastInterval||re,Je=re.timeStamp-Ae.timeStamp,Et,qt,Rn,xi;if(re.eventType!=xn&&(Je>zt||Ae.velocity===c)){var ye=re.deltaX-Ae.deltaX,Le=re.deltaY-Ae.deltaY,ze=Fe(Je,ye,Le);qt=ze.x,Rn=ze.y,Et=E(ze.x)>E(ze.y)?ze.x:ze.y,xi=gt(ye,Le),X.lastInterval=re}else Et=Ae.velocity,qt=Ae.velocityX,Rn=Ae.velocityY,xi=Ae.direction;re.velocity=Et,re.velocityX=qt,re.velocityY=Rn,re.direction=xi}function J(X){for(var re=[],Ae=0;Ae<X.pointers.length;)re[Ae]={clientX:v(X.pointers[Ae].clientX),clientY:v(X.pointers[Ae].clientY)},Ae++;return{timeStamp:M(),pointers:re,center:G(re),deltaX:X.deltaX,deltaY:X.deltaY}}function G(X){var re=X.length;if(re===1)return{x:v(X[0].clientX),y:v(X[0].clientY)};for(var Ae=0,Je=0,Et=0;Et<re;)Ae+=X[Et].clientX,Je+=X[Et].clientY,Et++;return{x:v(Ae/re),y:v(Je/re)}}function Fe(X,re,Ae){return{x:re/X||0,y:Ae/X||0}}function gt(X,re){return X===re?wn:E(X)>=E(re)?X<0?ue:Me:re<0?Ve:Qe}function ct(X,re,Ae){Ae||(Ae=Pt);var Je=re[Ae[0]]-X[Ae[0]],Et=re[Ae[1]]-X[Ae[1]];return Math.sqrt(Je*Je+Et*Et)}function sn(X,re,Ae){Ae||(Ae=Pt);var Je=re[Ae[0]]-X[Ae[0]],Et=re[Ae[1]]-X[Ae[1]];return Math.atan2(Et,Je)*180/Math.PI}function fn(X,re){return sn(re[1],re[0],Mt)+sn(X[1],X[0],Mt)}function $n(X,re){return ct(re[0],re[1],Mt)/ct(X[0],X[1],Mt)}var nn={mousedown:yt,mousemove:Ft,mouseup:Jt},ei="mousedown",qi="mousemove mouseup";function hi(){this.evEl=ei,this.evWin=qi,this.pressed=!1,ht.apply(this,arguments)}we(hi,ht,{handler:function(re){var Ae=nn[re.type];Ae&yt&&re.button===0&&(this.pressed=!0),Ae&Ft&&re.which!==1&&(Ae=Jt),this.pressed&&(Ae&Jt&&(this.pressed=!1),this.callback(this.manager,Ae,{pointers:[re],changedPointers:[re],pointerType:vi,srcEvent:re}))}});var Hn={pointerdown:yt,pointermove:Ft,pointerup:Jt,pointercancel:xn,pointerout:xn},_r={2:Kn,3:Ii,4:vi,5:lt},ti="pointerdown",ji="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(ti="MSPointerDown",ji="MSPointerMove MSPointerUp MSPointerCancel");function _s(){this.evEl=ti,this.evWin=ji,ht.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}we(_s,ht,{handler:function(re){var Ae=this.store,Je=!1,Et=re.type.toLowerCase().replace("ms",""),qt=Hn[Et],Rn=_r[re.pointerType]||re.pointerType,xi=Rn==Kn,ye=xt(Ae,re.pointerId,"pointerId");qt&yt&&(re.button===0||xi)?ye<0&&(Ae.push(re),ye=Ae.length-1):qt&(Jt|xn)&&(Je=!0),!(ye<0)&&(Ae[ye]=re,this.callback(this.manager,qt,{pointers:Ae,changedPointers:[re],pointerType:Rn,srcEvent:re}),Je&&Ae.splice(ye,1))}});var kr={touchstart:yt,touchmove:Ft,touchend:Jt,touchcancel:xn},Hr="touchstart",ts="touchstart touchmove touchend touchcancel";function ir(){this.evTarget=Hr,this.evWin=ts,this.started=!1,ht.apply(this,arguments)}we(ir,ht,{handler:function(re){var Ae=kr[re.type];if(Ae===yt&&(this.started=!0),!!this.started){var Je=ys.call(this,re,Ae);Ae&(Jt|xn)&&Je[0].length-Je[1].length===0&&(this.started=!1),this.callback(this.manager,Ae,{pointers:Je[0],changedPointers:Je[1],pointerType:Kn,srcEvent:re})}}});function ys(X,re){var Ae=gn(X.touches),Je=gn(X.changedTouches);return re&(Jt|xn)&&(Ae=an(Ae.concat(Je),"identifier",!0)),[Ae,Je]}var Rr={touchstart:yt,touchmove:Ft,touchend:Jt,touchcancel:xn},Os="touchstart touchmove touchend touchcancel";function oe(){this.evTarget=Os,this.targetIds={},ht.apply(this,arguments)}we(oe,ht,{handler:function(re){var Ae=Rr[re.type],Je=U.call(this,re,Ae);!Je||this.callback(this.manager,Ae,{pointers:Je[0],changedPointers:Je[1],pointerType:Kn,srcEvent:re})}});function U(X,re){var Ae=gn(X.touches),Je=this.targetIds;if(re&(yt|Ft)&&Ae.length===1)return Je[Ae[0].identifier]=!0,[Ae,Ae];var Et,qt,Rn=gn(X.changedTouches),xi=[],ye=this.target;if(qt=Ae.filter(function(Le){return Rt(Le.target,ye)}),re===yt)for(Et=0;Et<qt.length;)Je[qt[Et].identifier]=!0,Et++;for(Et=0;Et<Rn.length;)Je[Rn[Et].identifier]&&xi.push(Rn[Et]),re&(Jt|xn)&&delete Je[Rn[Et].identifier],Et++;if(!!xi.length)return[an(qt.concat(xi),"identifier",!0),xi]}var H=2500,se=25;function de(){ht.apply(this,arguments);var X=he(this.handler,this);this.touch=new oe(this.manager,X),this.mouse=new hi(this.manager,X),this.primaryTouch=null,this.lastTouches=[]}we(de,ht,{handler:function(re,Ae,Je){var Et=Je.pointerType==Kn,qt=Je.pointerType==vi;if(!(qt&&Je.sourceCapabilities&&Je.sourceCapabilities.firesTouchEvents)){if(Et)Se.call(this,Ae,Je);else if(qt&&Oe.call(this,Je))return;this.callback(re,Ae,Je)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Se(X,re){X&yt?(this.primaryTouch=re.changedPointers[0].identifier,Re.call(this,re)):X&(Jt|xn)&&Re.call(this,re)}function Re(X){var re=X.changedPointers[0];if(re.identifier===this.primaryTouch){var Ae={x:re.clientX,y:re.clientY};this.lastTouches.push(Ae);var Je=this.lastTouches,Et=function(){var qt=Je.indexOf(Ae);qt>-1&&Je.splice(qt,1)};setTimeout(Et,H)}}function Oe(X){for(var re=X.srcEvent.clientX,Ae=X.srcEvent.clientY,Je=0;Je<this.lastTouches.length;Je++){var Et=this.lastTouches[Je],qt=Math.abs(re-Et.x),Rn=Math.abs(Ae-Et.y);if(qt<=se&&Rn<=se)return!0}return!1}var Ie=ln(p.style,"touchAction"),Ne=Ie!==c,at="compute",Ot="auto",dt="manipulation",Kt="none",Yt="pan-x",Wt="pan-y",cn=pn();function Pn(X,re){this.manager=X,this.set(re)}Pn.prototype={set:function(X){X==at&&(X=this.compute()),Ne&&this.manager.element.style&&cn[X]&&(this.manager.element.style[Ie]=X),this.actions=X.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var X=[];return N(this.manager.recognizers,function(re){Pe(re.options.enable,[re])&&(X=X.concat(re.getTouchAction()))}),Fn(X.join(" "))},preventDefaults:function(X){var re=X.srcEvent,Ae=X.offsetDirection;if(this.manager.session.prevented){re.preventDefault();return}var Je=this.actions,Et=ke(Je,Kt)&&!cn[Kt],qt=ke(Je,Wt)&&!cn[Wt],Rn=ke(Je,Yt)&&!cn[Yt];if(Et){var xi=X.pointers.length===1,ye=X.distance<2,Le=X.deltaTime<250;if(xi&&ye&&Le)return}if(!(Rn&&qt)&&(Et||qt&&Ae&st||Rn&&Ae&St))return this.preventSrc(re)},preventSrc:function(X){this.manager.session.prevented=!0,X.preventDefault()}};function Fn(X){if(ke(X,Kt))return Kt;var re=ke(X,Yt),Ae=ke(X,Wt);return re&&Ae?Kt:re||Ae?re?Yt:Wt:ke(X,dt)?dt:Ot}function pn(){if(!Ne)return!1;var X={},re=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ae){X[Ae]=re?e.CSS.supports("touch-action",Ae):!0}),X}var qn=1,Dn=2,Er=4,fr=8,Ze=fr,yr=16,ai=32;function dr(X){this.options=Z({},this.defaults,X||{}),this.id=Mn(),this.manager=null,this.options.enable=ge(this.options.enable,!0),this.state=qn,this.simultaneous={},this.requireFail=[]}dr.prototype={defaults:{},set:function(X){return Z(this.options,X),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(X){if(R(X,"recognizeWith",this))return this;var re=this.simultaneous;return X=qr(X,this),re[X.id]||(re[X.id]=X,X.recognizeWith(this)),this},dropRecognizeWith:function(X){return R(X,"dropRecognizeWith",this)?this:(X=qr(X,this),delete this.simultaneous[X.id],this)},requireFailure:function(X){if(R(X,"requireFailure",this))return this;var re=this.requireFail;return X=qr(X,this),xt(re,X)===-1&&(re.push(X),X.requireFailure(this)),this},dropRequireFailure:function(X){if(R(X,"dropRequireFailure",this))return this;X=qr(X,this);var re=xt(this.requireFail,X);return re>-1&&this.requireFail.splice(re,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(X){return!!this.simultaneous[X.id]},emit:function(X){var re=this,Ae=this.state;function Je(Et){re.manager.emit(Et,X)}Ae<fr&&Je(re.options.event+da(Ae)),Je(re.options.event),X.additionalEvent&&Je(X.additionalEvent),Ae>=fr&&Je(re.options.event+da(Ae))},tryEmit:function(X){if(this.canEmit())return this.emit(X);this.state=ai},canEmit:function(){for(var X=0;X<this.requireFail.length;){if(!(this.requireFail[X].state&(ai|qn)))return!1;X++}return!0},recognize:function(X){var re=Z({},X);if(!Pe(this.options.enable,[this,re])){this.reset(),this.state=ai;return}this.state&(Ze|yr|ai)&&(this.state=qn),this.state=this.process(re),this.state&(Dn|Er|fr|yr)&&this.tryEmit(re)},process:function(X){},getTouchAction:function(){},reset:function(){}};function da(X){return X&yr?"cancel":X&fr?"end":X&Er?"move":X&Dn?"start":""}function Wr(X){return X==Qe?"down":X==Ve?"up":X==ue?"left":X==Me?"right":""}function qr(X,re){var Ae=re.manager;return Ae?Ae.get(X):X}function Or(){dr.apply(this,arguments)}we(Or,dr,{defaults:{pointers:1},attrTest:function(X){var re=this.options.pointers;return re===0||X.pointers.length===re},process:function(X){var re=this.state,Ae=X.eventType,Je=re&(Dn|Er),Et=this.attrTest(X);return Je&&(Ae&xn||!Et)?re|yr:Je||Et?Ae&Jt?re|fr:re&Dn?re|Er:Dn:ai}});function Tr(){Or.apply(this,arguments),this.pX=null,this.pY=null}we(Tr,Or,{defaults:{event:"pan",threshold:10,pointers:1,direction:Dt},getTouchAction:function(){var X=this.options.direction,re=[];return X&st&&re.push(Wt),X&St&&re.push(Yt),re},directionTest:function(X){var re=this.options,Ae=!0,Je=X.distance,Et=X.direction,qt=X.deltaX,Rn=X.deltaY;return Et&re.direction||(re.direction&st?(Et=qt===0?wn:qt<0?ue:Me,Ae=qt!=this.pX,Je=Math.abs(X.deltaX)):(Et=Rn===0?wn:Rn<0?Ve:Qe,Ae=Rn!=this.pY,Je=Math.abs(X.deltaY))),X.direction=Et,Ae&&Je>re.threshold&&Et&re.direction},attrTest:function(X){return Or.prototype.attrTest.call(this,X)&&(this.state&Dn||!(this.state&Dn)&&this.directionTest(X))},emit:function(X){this.pX=X.deltaX,this.pY=X.deltaY;var re=Wr(X.direction);re&&(X.additionalEvent=this.options.event+re),this._super.emit.call(this,X)}});function ft(){Or.apply(this,arguments)}we(ft,Or,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Kt]},attrTest:function(X){return this._super.attrTest.call(this,X)&&(Math.abs(X.scale-1)>this.options.threshold||this.state&Dn)},emit:function(X){if(X.scale!==1){var re=X.scale<1?"in":"out";X.additionalEvent=this.options.event+re}this._super.emit.call(this,X)}});function Cn(){dr.apply(this,arguments),this._timer=null,this._input=null}we(Cn,dr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ot]},process:function(X){var re=this.options,Ae=X.pointers.length===re.pointers,Je=X.distance<re.threshold,Et=X.deltaTime>re.time;if(this._input=X,!Je||!Ae||X.eventType&(Jt|xn)&&!Et)this.reset();else if(X.eventType&yt)this.reset(),this._timer=I(function(){this.state=Ze,this.tryEmit()},re.time,this);else if(X.eventType&Jt)return Ze;return ai},reset:function(){clearTimeout(this._timer)},emit:function(X){this.state===Ze&&(X&&X.eventType&Jt?this.manager.emit(this.options.event+"up",X):(this._input.timeStamp=M(),this.manager.emit(this.options.event,this._input)))}});function Ln(){Or.apply(this,arguments)}we(Ln,Or,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Kt]},attrTest:function(X){return this._super.attrTest.call(this,X)&&(Math.abs(X.rotation)>this.options.threshold||this.state&Dn)}});function Ar(){Or.apply(this,arguments)}we(Ar,Or,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:st|St,pointers:1},getTouchAction:function(){return Tr.prototype.getTouchAction.call(this)},attrTest:function(X){var re=this.options.direction,Ae;return re&(st|St)?Ae=X.overallVelocity:re&st?Ae=X.overallVelocityX:re&St&&(Ae=X.overallVelocityY),this._super.attrTest.call(this,X)&&re&X.offsetDirection&&X.distance>this.options.threshold&&X.maxPointers==this.options.pointers&&E(Ae)>this.options.velocity&&X.eventType&Jt},emit:function(X){var re=Wr(X.offsetDirection);re&&this.manager.emit(this.options.event+re,X),this.manager.emit(this.options.event,X)}});function Zr(){dr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}we(Zr,dr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[dt]},process:function(X){var re=this.options,Ae=X.pointers.length===re.pointers,Je=X.distance<re.threshold,Et=X.deltaTime<re.time;if(this.reset(),X.eventType&yt&&this.count===0)return this.failTimeout();if(Je&&Et&&Ae){if(X.eventType!=Jt)return this.failTimeout();var qt=this.pTime?X.timeStamp-this.pTime<re.interval:!0,Rn=!this.pCenter||ct(this.pCenter,X.center)<re.posThreshold;this.pTime=X.timeStamp,this.pCenter=X.center,!Rn||!qt?this.count=1:this.count+=1,this._input=X;var xi=this.count%re.taps;if(xi===0)return this.hasRequireFailures()?(this._timer=I(function(){this.state=Ze,this.tryEmit()},re.interval,this),Dn):Ze}return ai},failTimeout:function(){return this._timer=I(function(){this.state=ai},this.options.interval,this),ai},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ze&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Sn(X,re){return re=re||{},re.recognizers=ge(re.recognizers,Sn.defaults.preset),new us(X,re)}Sn.VERSION="2.0.7",Sn.defaults={domEvents:!1,touchAction:at,enable:!0,inputTarget:null,inputClass:null,preset:[[Ln,{enable:!1}],[ft,{enable:!1},["rotate"]],[Ar,{direction:st}],[Tr,{direction:st},["swipe"]],[Zr],[Zr,{event:"doubletap",taps:2},["tap"]],[Cn]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ds=1,Sr=2;function us(X,re){this.options=Z({},Sn.defaults,re||{}),this.options.inputTarget=this.options.inputTarget||X,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=X,this.input=Zt(this),this.touchAction=new Pn(this,this.options.touchAction),rr(this,!0),N(this.options.recognizers,function(Ae){var Je=this.add(new Ae[0](Ae[1]));Ae[2]&&Je.recognizeWith(Ae[2]),Ae[3]&&Je.requireFailure(Ae[3])},this)}us.prototype={set:function(X){return Z(this.options,X),X.touchAction&&this.touchAction.update(),X.inputTarget&&(this.input.destroy(),this.input.target=X.inputTarget,this.input.init()),this},stop:function(X){this.session.stopped=X?Sr:Ds},recognize:function(X){var re=this.session;if(!re.stopped){this.touchAction.preventDefaults(X);var Ae,Je=this.recognizers,Et=re.curRecognizer;(!Et||Et&&Et.state&Ze)&&(Et=re.curRecognizer=null);for(var qt=0;qt<Je.length;)Ae=Je[qt],re.stopped!==Sr&&(!Et||Ae==Et||Ae.canRecognizeWith(Et))?Ae.recognize(X):Ae.reset(),!Et&&Ae.state&(Dn|Er|fr)&&(Et=re.curRecognizer=Ae),qt++}},get:function(X){if(X instanceof dr)return X;for(var re=this.recognizers,Ae=0;Ae<re.length;Ae++)if(re[Ae].options.event==X)return re[Ae];return null},add:function(X){if(R(X,"add",this))return this;var re=this.get(X.options.event);return re&&this.remove(re),this.recognizers.push(X),X.manager=this,this.touchAction.update(),X},remove:function(X){if(R(X,"remove",this))return this;if(X=this.get(X),X){var re=this.recognizers,Ae=xt(re,X);Ae!==-1&&(re.splice(Ae,1),this.touchAction.update())}return this},on:function(X,re){if(X!==c&&re!==c){var Ae=this.handlers;return N(It(X),function(Je){Ae[Je]=Ae[Je]||[],Ae[Je].push(re)}),this}},off:function(X,re){if(X!==c){var Ae=this.handlers;return N(It(X),function(Je){re?Ae[Je]&&Ae[Je].splice(xt(Ae[Je],re),1):delete Ae[Je]}),this}},emit:function(X,re){this.options.domEvents&&ii(X,re);var Ae=this.handlers[X]&&this.handlers[X].slice();if(!(!Ae||!Ae.length)){re.type=X,re.preventDefault=function(){re.srcEvent.preventDefault()};for(var Je=0;Je<Ae.length;)Ae[Je](re),Je++}},destroy:function(){this.element&&rr(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function rr(X,re){var Ae=X.element;if(!!Ae.style){var Je;N(X.options.cssProps,function(Et,qt){Je=ln(Ae.style,qt),re?(X.oldCssProps[Je]=Ae.style[Je],Ae.style[Je]=Et):Ae.style[Je]=X.oldCssProps[Je]||""}),re||(X.oldCssProps={})}}function ii(X,re){var Ae=n.createEvent("Event");Ae.initEvent(X,!0,!0),Ae.gesture=re,re.target.dispatchEvent(Ae)}Z(Sn,{INPUT_START:yt,INPUT_MOVE:Ft,INPUT_END:Jt,INPUT_CANCEL:xn,STATE_POSSIBLE:qn,STATE_BEGAN:Dn,STATE_CHANGED:Er,STATE_ENDED:fr,STATE_RECOGNIZED:Ze,STATE_CANCELLED:yr,STATE_FAILED:ai,DIRECTION_NONE:wn,DIRECTION_LEFT:ue,DIRECTION_RIGHT:Me,DIRECTION_UP:Ve,DIRECTION_DOWN:Qe,DIRECTION_HORIZONTAL:st,DIRECTION_VERTICAL:St,DIRECTION_ALL:Dt,Manager:us,Input:ht,TouchAction:Pn,TouchInput:oe,MouseInput:hi,PointerEventInput:_s,TouchMouseInput:de,SingleTouchInput:ir,Recognizer:dr,AttrRecognizer:Or,Tap:Zr,Pan:Tr,Swipe:Ar,Pinch:ft,Rotate:Ln,Press:Cn,on:nt,off:Tt,each:N,merge:me,extend:ne,assign:Z,inherit:we,bindFn:he,prefixed:ln});var Va=typeof e<"u"?e:typeof self<"u"?self:{};Va.Hammer=Sn,typeof c=="function"&&c.amd?c(function(){return Sn}):t.exports?t.exports=Sn:e[r]=Sn})(window,document,"Hammer")})(Xh);const NH=Xh.exports,ea=nO({__proto__:null,default:NH},[Xh.exports]),ML=1,PL=2,l1=4,UH={mousedown:ML,mousemove:PL,mouseup:l1};function VH(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function jH(t){const e=t.prototype.handler;t.prototype.handler=function(r){const c=this.store;r.button>0&&r.type==="pointerdown"&&(VH(c,h=>h.pointerId===r.pointerId)||c.push(r)),e.call(this,r)}}function GH(t){t.prototype.handler=function(n){let r=UH[n.type];r&ML&&n.button>=0&&(this.pressed=!0),r&PL&&n.which===0&&(r=l1),this.pressed&&(r&l1&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}jH(Xh.exports.PointerEventInput);GH(Xh.exports.MouseInput);const $H=Xh.exports.Manager;class ky{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const HH=ea?[[ea.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[ea.Rotate,{enable:!1}],[ea.Pinch,{enable:!1}],[ea.Swipe,{enable:!1}],[ea.Pan,{threshold:0,enable:!1}],[ea.Press,{enable:!1}],[ea.Tap,{event:"doubletap",taps:2,enable:!1}],[ea.Tap,{event:"anytap",enable:!1}],[ea.Tap,{enable:!1}]]:null,kS={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},WH={doubletap:["tap"]},qH={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Bb={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},ZH={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},RS={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},XH=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",lh=typeof window<"u"?window:global;let c1=!1;try{const t={get passive(){return c1=!0,!0}};lh.addEventListener("test",null,t),lh.removeEventListener("test",null)}catch{c1=!1}const YH=XH.indexOf("firefox")!==-1,{WHEEL_EVENTS:KH}=Bb,OS="wheel",DS=4.000244140625,JH=40,QH=.25;class eW extends ky{constructor(e,n,r){super(e,n,r),this.handleEvent=c=>{if(!this.options.enable)return;let h=c.deltaY;lh.WheelEvent&&(YH&&c.deltaMode===lh.WheelEvent.DOM_DELTA_PIXEL&&(h/=lh.devicePixelRatio),c.deltaMode===lh.WheelEvent.DOM_DELTA_LINE&&(h*=JH)),h!==0&&h%DS===0&&(h=Math.floor(h/DS)),c.shiftKey&&h&&(h=h*QH),this.callback({type:OS,center:{x:c.clientX,y:c.clientY},delta:-h,srcEvent:c,pointerType:"mouse",target:c.target})},this.events=(this.options.events||[]).concat(KH),this.events.forEach(c=>e.addEventListener(c,this.handleEvent,c1?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===OS&&(this.options.enable=n)}}const{MOUSE_EVENTS:tW}=Bb,zS="pointermove",BS="pointerover",FS="pointerout",NS="pointerenter",US="pointerleave";class nW extends ky{constructor(e,n,r){super(e,n,r),this.handleEvent=h=>{this.handleOverEvent(h),this.handleOutEvent(h),this.handleEnterEvent(h),this.handleLeaveEvent(h),this.handleMoveEvent(h)},this.pressed=!1;const{enable:c}=this.options;this.enableMoveEvent=c,this.enableLeaveEvent=c,this.enableEnterEvent=c,this.enableOutEvent=c,this.enableOverEvent=c,this.events=(this.options.events||[]).concat(tW),this.events.forEach(h=>e.addEventListener(h,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===zS&&(this.enableMoveEvent=n),e===BS&&(this.enableOverEvent=n),e===FS&&(this.enableOutEvent=n),e===NS&&(this.enableEnterEvent=n),e===US&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(BS,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(FS,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(NS,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(US,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(zS,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:iW}=Bb,VS="keydown",jS="keyup";class rW extends ky{constructor(e,n,r){super(e,n,r),this.handleEvent=c=>{const h=c.target||c.srcElement;h.tagName==="INPUT"&&h.type==="text"||h.tagName==="TEXTAREA"||(this.enableDownEvent&&c.type==="keydown"&&this.callback({type:VS,srcEvent:c,key:c.key,target:c.target}),this.enableUpEvent&&c.type==="keyup"&&this.callback({type:jS,srcEvent:c,key:c.key,target:c.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(iW),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(c=>e.addEventListener(c,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===VS&&(this.enableDownEvent=n),e===jS&&(this.enableUpEvent=n)}}const GS="contextmenu";class sW extends ky{constructor(e,n,r){super(e,n,r),this.handleEvent=c=>{!this.options.enable||this.callback({type:GS,center:{x:c.clientX,y:c.clientY},srcEvent:c,pointerType:"mouse",target:c.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===GS&&(this.options.enable=n)}}const u1=1,X_=2,h1=4,oW={pointerdown:u1,pointermove:X_,pointerup:h1,mousedown:u1,mousemove:X_,mouseup:h1},aW=1,lW=2,cW=3,uW=0,hW=1,fW=2,dW=1,pW=2,mW=4;function gW(t){const e=oW[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r,which:c}=t.srcEvent;let h=!1,p=!1,s=!1;return e===h1||e===X_&&!Number.isFinite(n)?(h=c===aW,p=c===lW,s=c===cW):e===X_?(h=Boolean(n&dW),p=Boolean(n&mW),s=Boolean(n&pW)):e===u1&&(h=r===uW,p=r===hW,s=r===fW),{leftButton:h,middleButton:p,rightButton:s}}function _W(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),c=r.width/e.offsetWidth||1,h=r.height/e.offsetHeight||1,p={x:(n.x-r.left-e.clientLeft)/c,y:(n.y-r.top-e.clientTop)/h};return{center:n,offsetCenter:p}}const Hv={srcElement:"root",priority:0};class yW{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let c=n.srcEvent.target;for(;c&&c!==r.rootElement;){if(this._emit(r,c),r.handled)return;c=c.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,c=!1,h=!1){const{handlers:p,handlersByElement:s}=this;let v=Hv;typeof r=="string"||r&&r.addEventListener?v={...Hv,srcElement:r}:r&&(v={...Hv,...r});let E=s.get(v.srcElement);E||(E=[],s.set(v.srcElement,E));const M={type:e,handler:n,srcElement:v.srcElement,priority:v.priority};c&&(M.once=!0),h&&(M.passive=!0),p.push(M),this._active=this._active||!M.passive;let I=E.length-1;for(;I>=0&&!(E[I].priority>=M.priority);)I--;E.splice(I+1,0,M)}remove(e,n){const{handlers:r,handlersByElement:c}=this;for(let h=r.length-1;h>=0;h--){const p=r[h];if(p.type===e&&p.handler===n){r.splice(h,1);const s=c.get(p.srcElement);s.splice(s.indexOf(p),1),s.length===0&&c.delete(p.srcElement)}}this._active=r.some(h=>!h.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let c=!1;const h=()=>{e.handled=!0},p=()=>{e.handled=!0,c=!0},s=[];for(let v=0;v<r.length;v++){const{type:E,handler:M,once:I}=r[v];if(M({...e,type:E,stopPropagation:h,stopImmediatePropagation:p}),I&&s.push(r[v]),c)break}for(let v=0;v<s.length;v++){const{type:E,handler:M}=s[v];this.remove(E,M)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...gW(e),..._W(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const vW={events:null,recognizers:null,recognizerOptions:{},Manager:$H,touchAction:"none",tabIndex:0};class xW{constructor(e=null,n){this._onBasicInput=c=>{const{srcEvent:h}=c,p=qH[h.type];p&&this.manager.emit(p,c)},this._onOtherEvent=c=>{this.manager.emit(c.type,c)},this.options={...vW,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||HH}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(kS).forEach(c=>{const h=this.manager.get(c);h&&kS[c].forEach(p=>{h.recognizeWith(p)})});for(const c in n.recognizerOptions){const h=this.manager.get(c);if(h){const p=n.recognizerOptions[c];delete p.enable,h.set(p)}}this.wheelInput=new eW(e,this._onOtherEvent,{enable:!1}),this.moveInput=new nW(e,this._onOtherEvent,{enable:!1}),this.keyInput=new rW(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new sW(e,this._onOtherEvent,{enable:!1});for(const[c,h]of this.events)h.isEmpty()||(this._toggleRecognizer(h.recognizerName,!0),this.manager.on(c,h.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const c=r.get(e);if(c&&c.options.enable!==n){c.set({enable:n});const h=WH[e];h&&!this.options.recognizers&&h.forEach(p=>{const s=r.get(p);n?(s.requireFailure(e),c.dropRequireFailure(p)):s.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,c,h){if(typeof e!="string"){r=n;for(const M in e)this._addEventHandler(M,e[M],r,c,h);return}const{manager:p,events:s}=this,v=RS[e]||e;let E=s.get(v);E||(E=new yW(this),s.set(v,E),E.recognizerName=ZH[v]||v,p&&p.on(v,E.handleEvent)),E.add(e,n,r,c,h),E.isEmpty()||this._toggleRecognizer(E.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const p in e)this._removeEventHandler(p,e[p]);return}const{events:r}=this,c=RS[e]||e,h=r.get(c);if(!!h&&(h.remove(e,n),h.isEmpty())){const{recognizerName:p}=h;let s=!1;for(const v of r.values())if(v.recognizerName===p&&!v.isEmpty()){s=!0;break}s||this._toggleRecognizer(p,!1)}}}function Ic(){}const bW=({isDragging:t})=>t?"grabbing":"grab",IL={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Ic,onResize:Ic,onViewStateChange:Ic,onInteractionStateChange:Ic,onBeforeRender:Ic,onAfterRender:Ic,onLoad:Ic,onError:t=>Vi.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:bW,getTooltip:null,debug:!1,drawPickingColors:!1};class Fb{constructor(e){Y(this,"props",void 0),Y(this,"width",0),Y(this,"height",0),Y(this,"userData",{}),Y(this,"canvas",null),Y(this,"viewManager",null),Y(this,"layerManager",null),Y(this,"effectManager",null),Y(this,"deckRenderer",null),Y(this,"deckPicker",null),Y(this,"eventManager",null),Y(this,"tooltip",null),Y(this,"metrics",void 0),Y(this,"animationLoop",void 0),Y(this,"stats",void 0),Y(this,"viewState",void 0),Y(this,"cursorState",void 0),Y(this,"_needsRedraw",void 0),Y(this,"_pickRequest",void 0),Y(this,"_lastPointerDownInfo",null),Y(this,"_metricsCounter",void 0),Y(this,"_onPointerMove",n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const c=n.offsetCenter;if(!c)return;r.x=c.x,r.y=c.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n}),Y(this,"_onEvent",n=>{const r=yS[n.type],c=n.offsetCenter;if(!r||!c||!this.layerManager)return;const h=this.layerManager.getLayers(),p=this.deckPicker.getLastPickedObject({x:c.x,y:c.y,layers:h,viewports:this.getViewports(c)},this._lastPointerDownInfo),{layer:s}=p,v=s&&(s[r.handler]||s.props[r.handler]),E=this.props[r.handler];let M=!1;v&&(M=v.call(s,p,n)),!M&&E&&E(p,n)}),Y(this,"_onPointerDown",n=>{const r=n.offsetCenter,c=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=c.result[0]||c.emptyInfo}),this.props={...IL,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&Vi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),lC()==="IE"&&Vi.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new gb({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Nh.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,c,h,p,s;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(r=this.effectManager)===null||r===void 0||r.finalize(),this.effectManager=null,(c=this.deckRenderer)===null||c===void 0||c.finalize(),this.deckRenderer=null,(h=this.deckPicker)===null||h===void 0||h.finalize(),this.deckPicker=null,(p=this.eventManager)===null||p===void 0||p.destroy(),this.eventManager=null,(s=this.tooltip)===null||s===void 0||s.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var v;(v=this.canvas.parentElement)===null||v===void 0||v.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Vi.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Vi.removed("onLayerClick","onClick")(),e.initialViewState&&!Zh(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),c=this.layerManager.needsRedraw(e),h=this.effectManager.needsRedraw(e),p=this.deckRenderer.needsRedraw(e);return n=n||r||c||h||p,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return jr(this.viewManager),this.viewManager.views}getViewports(e){return jr(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_pick(e,n,r){jr(this.deckPicker);const{stats:c}=this;c.get("Pick Count").incrementCount(),c.get(n).timeStart();const h=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return c.get(n).timeEnd(),h}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),jr(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const h=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=h}if(r||r===0){var c;const h=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((c=e.style)===null||c===void 0?void 0:c.position)||"absolute",this.canvas.style.height=h}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const n=e.clientWidth||e.width,r=e.clientHeight||e.height;if(n!==this.width||r!==this.height){var c;this.width=n,this.height=r,(c=this.viewManager)===null||c===void 0||c.setProps({width:n,height:r}),this.props.onResize({width:n,height:r})}}_createAnimationLoop(e){const{width:n,height:r,gl:c,glOptions:h,debug:p,onError:s,onBeforeRender:v,onAfterRender:E,useDevicePixels:M}=e;return new mG({width:n,height:r,useDevicePixels:M,autoResizeViewport:!1,gl:c,onCreateContext:I=>MC({...h,...I,canvas:this.canvas,debug:p,onContextLost:()=>this._onContextLost()}),onInitialize:I=>this._setGLContext(I.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:v,onAfterRender:E,onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new zb({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:c}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let h=c,p=!1;for(const s of r){var n;h=s,p=((n=s.layer)===null||n===void 0?void 0:n.onHover(s,e.event))||p}if(!p&&this.props.onHover&&this.props.onHover(h,e.event),this.props.getTooltip&&this.tooltip){const s=this.props.getTooltip(h);this.tooltip.setTooltip(s,h.x,h.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Eb(e,{enable:!0,copyState:!0})),this.tooltip=new FH(this.canvas),Da(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new rL;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new xW(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const c in yS)this.eventManager.on(c,this._onEvent);this.viewManager=new tH({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new eH(e,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new AH,this.deckRenderer=new CH(e),this.deckPicker=new zH(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:r}=this.layerManager.context;Da(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Vi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=Nc.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}Y(Fb,"defaultProps",IL);Y(Fb,"VERSION",xV.VERSION);class Wv{constructor(e,n){Y(this,"opts",void 0),Y(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:r}=this.source,{size:c}=n;let h=r;if(r&&r.length!==c){h=new Float32Array(c);const p=n.elementOffset||0;for(let s=0;s<c;++s)h[s]=r[p+s]}return h}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function wW(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function h_(t){return t.stride||t.size*t.bytesPerElement}function CL(t,e){e.offset&&Vi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=h_(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,c=e.elementOffset||0,h=r*n+c*t.bytesPerElement+(t.offset||0);return{...e,offset:h,stride:n}}function EW(t,e){const n=CL(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class TW{constructor(e,n,r){Y(this,"gl",void 0),Y(this,"id",void 0),Y(this,"size",void 0),Y(this,"settings",void 0),Y(this,"value",void 0),Y(this,"doublePrecision",void 0),Y(this,"_buffer",void 0),Y(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const c=n.logicalType||n.type,h=c===5130;let{defaultValue:p}=n;p=Number.isFinite(p)?[p]:p||new Array(this.size).fill(0);let s;h?s=5126:!c&&n.isIndexed?s=e&&Hj(e,Ki.ELEMENT_INDEX_UINT32)?5125:5123:s=c||5126;let v=wW(c||s||5126);this.doublePrecision=h,h&&n.fp64===!1&&(v=Float32Array),this.value=null,this.settings={...n,defaultType:v,defaultValue:p,logicalType:c,type:s,size:this.size,bytesPerElement:v.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new Ui(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*h_(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Nh.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const r={},c=this.value instanceof Float64Array,h=EW(this.getAccessor(),n||{});return r[e]=new Wv(this,h.high),r["".concat(e,"64Low")]=c?new Wv(this,h.low):new Float32Array(this.size),r}if(n){const r=CL(this.getAccessor(),n);return{[e]:new Wv(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:c}=this,h=r*c;if(n&&h&&n.length>=h){const p=new Array(c).fill(1/0),s=new Array(c).fill(-1/0);for(let v=0;v<h;)for(let E=0;E<c;E++){const M=n[v++];M<p[E]&&(p[E]=M),M>s[E]&&(s[E]=M)}e=[p,s]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Ui?r={buffer:e}:r=e;const c={...this.settings,...r};if(n.bufferAccessor=c,n.bounds=null,r.constant){let h=r.value;if(h=this._normalizeValue(h,[],0),this.settings.normalized&&(h=this.normalizeConstant(h)),!(!n.constant||!this._areValuesEqual(h,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=h}else if(r.buffer){const h=r.buffer;n.externalBuffer=h,n.constant=!1,this.value=r.value||null;const p=r.value instanceof Float64Array;c.type=r.type||h.accessor.type,c.bytesPerElement=h.accessor.BYTES_PER_ELEMENT*(p?2:1),c.stride=h_(c)}else if(r.value){this._checkExternalBuffer(r);let h=r.value;n.externalBuffer=null,n.constant=!1,this.value=h,c.bytesPerElement=h.BYTES_PER_ELEMENT,c.stride=h_(c);const{buffer:p,byteOffset:s}=this;this.doublePrecision&&h instanceof Float64Array&&(h=Gv(h,c));const v=h.byteLength+s+c.stride*2;p.byteLength<v&&p.reallocate(v),p.setAccessor(null),p.subData({data:h,offset:s}),c.type=r.type||p.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:c}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?Gv(n,{size:this.size,startIndex:r,endIndex:c}):n.subarray(r,c),offset:r*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:r}=this,c=r.allocatedValue,h=Nh.allocate(c,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=h;const{buffer:p,byteOffset:s}=this;return p.byteLength<h.byteLength+s&&(p.reallocate(h.byteLength+s),n&&c&&p.subData({data:c instanceof Float64Array?Gv(c,this):c,offset:s})),r.allocatedValue=h,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let c=!1;if(this.doublePrecision&&(c=n.BYTES_PER_ELEMENT<4),c)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&Vi.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:c,size:h}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e)return n[r]=c[0],n;switch(h){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:c[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:c[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:c[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:c[0];break;default:let p=h;for(;--p>=0;)n[r+p]=Number.isFinite(e[p])?e[p]:c[p]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let c=0;c<r;c++)if(e[c]!==n[c])return!1;return!0}}const $S=[],HS=[];function LL(t,e=0,n=1/0){let r=$S;const c={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(HS.length=t.length,r=HS):r=$S,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),c.index=e-1),{iterable:r,objectInfo:c}}function kL(t){return t&&t[Symbol.asyncIterator]}function RL(t,e){const{size:n,stride:r,offset:c,startIndices:h,nested:p}=e,s=t.BYTES_PER_ELEMENT,v=r?r/s:n,E=c?c/s:0,M=Math.floor((t.length-E)/v);return(I,{index:R,target:N})=>{if(!h){const me=R*v+E;for(let we=0;we<n;we++)N[we]=t[me+we];return N}const $=h[R],Z=h[R+1]||M;let ne;if(p){ne=new Array(Z-$);for(let me=$;me<Z;me++){const we=me*v+E;N=new Array(n);for(let he=0;he<n;he++)N[he]=t[we+he];ne[me-$]=N}}else if(v===n)ne=t.subarray($*n+E,Z*n+E);else{ne=new t.constructor((Z-$)*n);let me=0;for(let we=$;we<Z;we++){const he=we*v+E;for(let Pe=0;Pe<n;Pe++)ne[me++]=t[he+Pe]}}return ne}}const AW=[],f_=[[0,1/0]];function SW(t,e){if(t===f_||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let c=0;for(let h=0;h<r;h++){const p=t[h];p[1]<e[0]?(n.push(p),c=h+1):p[0]>e[1]?n.push(p):e=[Math.min(p[0],e[0]),Math.max(p[1],e[1])]}return n.splice(c,0,e),n}function qv(t){const{source:e,target:n,start:r=0,size:c,getData:h}=t,p=t.end||n.length,s=e.length,v=p-r;if(s>v){n.set(e.subarray(0,v),r);return}if(n.set(e,r),!h)return;let E=s;for(;E<v;){const M=h(E,e);for(let I=0;I<c;I++)n[r+E]=M[I]||0,E++}}function MW({source:t,target:e,size:n,getData:r,sourceStartIndices:c,targetStartIndices:h}){if(!Array.isArray(h))return qv({source:t,target:e,size:n,getData:r}),e;let p=0,s=0;const v=r&&((M,I)=>r(M+s,I)),E=Math.min(c.length,h.length);for(let M=1;M<E;M++){const I=c[M]*n,R=h[M]*n;qv({source:t.subarray(p,I),target:e,start:s,end:R,size:n,getData:v}),p=I,s=R}return s<e.length&&qv({source:[],target:e,start:s,size:n,getData:v}),e}const PW={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function OL(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...PW[n],...e,...t,type:n}}function DL(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function zL(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function BL(t){t.push(t.shift())}function Nb(t,e){const{doublePrecision:n,settings:r,value:c,size:h}=t,p=n&&c instanceof Float64Array?2:1;return(r.noAlloc?c.length:e*h)*p}function FL({buffer:t,numInstances:e,attribute:n,fromLength:r,fromStartIndices:c,getData:h=p=>p}){const p=n.doublePrecision&&n.value instanceof Float64Array?2:1,s=n.size*p,v=n.byteOffset,E=n.startIndices,M=c&&E,I=Nb(n,e),R=n.isConstant;if(!M&&r>=I)return;const N=R?n.value:n.getBuffer().getData({srcByteOffset:v});if(n.settings.normalized&&!R){const me=h;h=(we,he)=>n.normalizeConstant(me(we,he))}const $=R?(me,we)=>h(N,we):(me,we)=>h(N.subarray(me,me+s),we),Z=t.getData({length:r}),ne=new Float32Array(I);MW({source:Z,target:ne,sourceStartIndices:c,targetStartIndices:E,size:s,getData:$}),t.byteLength<ne.byteLength+v&&t.reallocate(ne.byteLength+v),t.subData({data:ne,offset:v})}class Ub extends TW{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:f_}),Y(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,c=Array.isArray(n)?e[n.find(h=>e[h])]:e[n];return OL(c,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:c=1/0}=n;this.state.updateRanges=SW(this.state.updateRanges,[r,c])}else this.state.updateRanges=f_}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=AW}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==f_),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:c}){if(!this.needsUpdate())return!1;const{state:{updateRanges:h},settings:{update:p,noAlloc:s}}=this;let v=!0;if(p){for(const[E,M]of h)p.call(c,this,{data:n,startRow:E,endRow:M,props:r,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[E,M]of h){const I=Number.isFinite(E)?this.getVertexOffset(E):0,R=Number.isFinite(M)?this.getVertexOffset(M):s||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:I,endOffset:R})}this._checkAttributeArray()}else v=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),v}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:c}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(c.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),c.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const p=e;jr(ArrayBuffer.isView(p.value),"invalid ".concat(c.accessor));const s=Boolean(p.size)&&p.size!==this.size;return r.binaryAccessor=RL(p.value,{size:p.size||this.size,stride:p.stride,offset:p.offset,startIndices:n,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const r in e)Object.assign(n,super.getShaderAttributes(r,e[r]));return n}_autoUpdater(e,{data:n,startRow:r,endRow:c,props:h,numInstances:p}){if(e.constant)return;const{settings:s,state:v,value:E,size:M,startIndices:I}=e,{accessor:R,transform:N}=s,$=v.binaryAccessor||(typeof R=="function"?R:h[R]);jr(typeof $=="function",'accessor "'.concat(R,'" is not a function'));let Z=e.getVertexOffset(r);const{iterable:ne,objectInfo:me}=LL(n,r,c);for(const we of ne){me.index++;let he=$(we,me);if(N&&(he=N.call(this,he)),I){const Pe=(me.index<I.length-1?I[me.index+1]:p)-I[me.index];if(he&&Array.isArray(he[0])){let ge=Z;for(const nt of he)e._normalizeValue(nt,E,ge),ge+=M}else he&&he.length>M?E.set(he,Z):(e._normalizeValue(he,me.target,0),X$({target:E,source:me.target,start:Z,count:Pe}));Z+=Pe*M}else e._normalizeValue(he,E,Z),Z+=M}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class IW{constructor({gl:e,attribute:n,timeline:r}){Y(this,"gl",void 0),Y(this,"type","interpolation"),Y(this,"attributeInTransition",void 0),Y(this,"settings",void 0),Y(this,"attribute",void 0),Y(this,"transition",void 0),Y(this,"currentStartIndices",void 0),Y(this,"currentLength",void 0),Y(this,"transform",void 0),Y(this,"buffers",void 0),this.gl=e,this.transition=new zp(r),this.attribute=n,this.attributeInTransition=new Ub(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=LW(e,n);const c={byteLength:0,usage:35050};this.buffers=[new Ui(e,c),new Ui(e,c)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:c,attribute:h}=this;BL(c);const p={numInstances:n,attribute:h,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of c)FL({buffer:s,...p});this.currentStartIndices=h.startIndices,this.currentLength=Nb(h,n),this.attributeInTransition.setData({buffer:c[1],value:h.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/h.size),sourceBuffers:{aFrom:c[0],aTo:DL(r,h)},feedbackBuffers:{vCurrent:c[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:r}=this.settings,{time:c}=this.transition;let h=c/n;r&&(h=r(h)),this.transform.run({uniforms:{time:h}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const CW=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function LW(t,e){const n=zL(e.size);return new Lb(t,{vs:CW,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class kW{constructor({gl:e,attribute:n,timeline:r}){Y(this,"gl",void 0),Y(this,"type","spring"),Y(this,"attributeInTransition",void 0),Y(this,"settings",void 0),Y(this,"attribute",void 0),Y(this,"transition",void 0),Y(this,"currentStartIndices",void 0),Y(this,"currentLength",void 0),Y(this,"texture",void 0),Y(this,"framebuffer",void 0),Y(this,"transform",void 0),Y(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new zp(r),this.attribute=n,this.attributeInTransition=new Ub(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=OW(e),this.framebuffer=DW(e,this.texture),this.transform=RW(e,n,this.framebuffer);const c={byteLength:0,usage:35050};this.buffers=[new Ui(e,c),new Ui(e,c),new Ui(e,c)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:r,buffers:c,attribute:h}=this,p={numInstances:n,attribute:h,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of c)FL({buffer:s,...p});this.settings=e,this.currentStartIndices=h.startIndices,this.currentLength=Nb(h,n),this.attributeInTransition.setData({buffer:c[1],value:h.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/h.size),sourceBuffers:{aTo:DL(r,h)}})}update(){const{buffers:e,transform:n,framebuffer:r,transition:c}=this;if(!c.update())return!1;const p=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:p.stiffness,damping:p.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),BL(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Py(r)[0]>0||c.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function RW(t,e,n){const r=zL(e.size);return new Lb(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function OW(t){return new Ys(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function DW(t,e){return new br(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const zW={interpolation:IW,spring:kW};class BW{constructor(e,{id:n,timeline:r}){Y(this,"id",void 0),Y(this,"isSupported",void 0),Y(this,"gl",void 0),Y(this,"timeline",void 0),Y(this,"transitions",void 0),Y(this,"needsRedraw",void 0),Y(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Lb.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const c in e){const h=e[c],p=h.getTransitionSetting(n);!p||this._updateAttribute(c,h,p)}for(const c in this.transitions){const h=e[c];(!h||!h.getTransitionSetting(n))&&this._removeTransition(c)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,r){const c=this.transitions[e];let h=!c||c.type!==r.type;if(h){if(!this.isSupported){Vi.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}c&&this._removeTransition(e);const p=zW[r.type];p?this.transitions[e]=new p({attribute:n,timeline:this.timeline,gl:this.gl}):(Vi.error("unsupported transition type '".concat(r.type,"'"))(),h=!1)}(h||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const WS="attributeManager.invalidate",FW="attributeManager.updateStart",NW="attributeManager.updateEnd",UW="attribute.updateStart",VW="attribute.allocate",jW="attribute.updateEnd";class GW{constructor(e,{id:n="attribute-manager",stats:r,timeline:c}={}){Y(this,"id",void 0),Y(this,"gl",void 0),Y(this,"attributes",void 0),Y(this,"updateTriggers",void 0),Y(this,"needsRedraw",void 0),Y(this,"userData",void 0),Y(this,"stats",void 0),Y(this,"attributeTransitionManager",void 0),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new BW(e,{id:"".concat(n,"-transitions"),timeline:c}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);ds(WS,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);ds(WS,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:c,props:h={},buffers:p={},context:s={}}){let v=!1;ds(FW,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const E in this.attributes){const M=this.attributes[E],I=M.settings.accessor;M.startIndices=r,M.numInstances=n,h[E]&&Vi.removed("props.".concat(E),"data.attributes.".concat(E))(),M.setExternalBuffer(p[E])||M.setBinaryValue(typeof I=="string"?p[I]:void 0,e.startIndices)||typeof I=="string"&&!p[I]&&M.setConstantValue(h[I])||M.needsUpdate()&&(v=!0,this._updateAttribute({attribute:M,numInstances:n,data:e,props:h,context:s})),this.needsRedraw=this.needsRedraw||M.needsRedraw()}v&&ds(NW,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:c})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,c={...r.getAttributes()};for(const h in n){const p=n[h];p.needsRedraw(e)&&!r.hasAttribute(h)&&(c[h]=p)}return c}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const r={};for(const c in e)n[c]||Object.assign(r,e[c].getShaderAttributes());return r}_add(e,n={}){for(const r in e){const c=e[r];this.attributes[r]=this._createAttribute(r,c,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,r){const c={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:r.instanced?1:n.divisor||0};return new Ub(this.gl,c)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(c=>{e[c]||(e[c]=[]),e[c].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:c}=this,h=c[e];return h&&h.forEach(p=>{const s=r[p];s&&s.setNeedsUpdate(s.id,n)}),h}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(ds(UW,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&ds(VW,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,ds(jW,n,r))}}class $W extends zp{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:c,easing:h}}=this,p=h(e/c);this._value=V_(n,r,p)}}const qS=1e-5;function ZS(t,e,n,r,c){const h=e-t,s=(n-e)*c,v=-h*r;return s+v+h+e}function HW(t,e,n,r,c){if(Array.isArray(n)){const h=[];for(let p=0;p<n.length;p++)h[p]=ZS(t[p],e[p],n[p],r,c);return h}return ZS(t,e,n,r,c)}function XS(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const c=t[r]-e[r];n+=c*c}return Math.sqrt(n)}return Math.abs(t-e)}class WW extends zp{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:c}=this.settings,{_prevValue:h=e,_currValue:p=e}=this;let s=HW(h,p,n,r,c);const v=XS(s,n),E=XS(s,p);v<qS&&E<qS&&(s=n,this.end()),this._prevValue=p,this._currValue=s}}const qW={interpolation:$W,spring:WW};class ZW{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,c){const{transitions:h}=this;if(h.has(e)){const v=h.get(e),{value:E=v.settings.fromValue}=v;n=E,this.remove(e)}if(c=OL(c),!c)return;const p=qW[c.type];if(!p){Vi.error("unsupported transition type '".concat(c.type,"'"))();return}const s=new p(this.timeline);s.start({...c,fromValue:n,toValue:r}),h.set(e,s)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function XW(t){const e=Vb(t);for(const n in e){const r=e[n],{validate:c}=r;if(c&&!c(t[n],r))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function YW(t,e){const n=NL({newProps:t,oldProps:e,propTypes:Vb(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=JW(t,e);let c=!1;return r||(c=QW(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:c,extensionsChanged:eq(t,e),transitionsChanged:KW(t,e)}}function KW(t,e){if(!t.transitions)return!1;const n={},r=Vb(t);let c=!1;for(const h in t.transitions){const p=r[h],s=p&&p.type;(s==="number"||s==="color"||s==="array")&&f1(t[h],e[h],p)&&(n[h]=!0,c=!0)}return c?n:!1}function NL({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:c="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(c," changed shallowly");for(const h of Object.keys(t))if(!(h in n)){if(!(h in e))return"".concat(c,".").concat(h," added");const p=f1(t[h],e[h],r[h]);if(p)return"".concat(c,".").concat(h," ").concat(p)}for(const h of Object.keys(e))if(!(h in n)){if(!(h in t))return"".concat(c,".").concat(h," dropped");if(!Object.hasOwnProperty.call(t,h)){const p=f1(t[h],e[h],r[h]);if(p)return"".concat(c,".").concat(h," ").concat(p)}}return!1}function f1(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function JW(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:c}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&c&&(n=c(t.data,e.data)||n),n}function QW(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&YS(t,e,"all"))return{all:!0};const n={};let r=!1;for(const c in t.updateTriggers)c!=="all"&&YS(t,e,c)&&(n[c]=!0,r=!0);return r?n:!1}function eq(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let c=0;c<r.length;c++)if(!r[c].equals(n[c]))return!0;return!1}function YS(t,e,n){let r=t.updateTriggers[n];r=r??{};let c=e.updateTriggers[n];return c=c??{},NL({oldProps:c,newProps:r,triggerName:n})}function Vb(t){const e=t[Z_],n=e&&e.constructor;return n?n._propTypes:{}}const tq="count(): argument not an object",nq="count(): argument not a container";function iq(t){if(!sq(t))throw new Error(tq);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(rq(t))return Object.keys(t).length;throw new Error(nq)}function rq(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function sq(t){return t!==null&&typeof t=="object"}function oq(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(c=>c.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const c in e.inject)r[c]=(r[c]||"")+e.inject[c];n.inject=r}return n}const aq={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},d1={};function lq(t,e){const n=t.context&&t.context.gl;if(!n||!e)return null;if(e instanceof Ys)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let r=null;e.compressed&&(r={[10241]:e.data.length>1?9985:9729});const c=new Ys(n,{...e,parameters:{...aq,...r,...t.props.textureParameters}});return d1[c.id]=!0,c}function cq(t){!t||!(t instanceof Ys)||d1[t.id]&&(t.delete(),delete d1[t.id])}const uq={boolean:{validate(t,e){return!0},equal(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||dp(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Zv(t,e)}},accessor:{validate(t,e){const n=Y_(t);return n==="function"||n===Y_(e.value)},equal(t,e,n){return typeof e=="function"?!0:Zv(t,e)}},array:{validate(t,e){return e.optional&&!t||dp(t)},equal(t,e,n){return n.compare?Zv(t,e):t===e}},object:{equal(t,e,n){return n.compare?Zh(t,e):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:r}=n.props;return r&&t?r(t):t}},image:{transform:(t,e,n)=>lq(n,t),release:t=>{cq(t)}}};function Zv(t,e){if(t===e)return!0;if(!dp(t)||!dp(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}function hq(t){const e={},n={},r={};for(const[c,h]of Object.entries(t)){const p=h?.deprecatedFor;if(p)r[c]=Array.isArray(p)?p:[p];else{const s=fq(c,h);e[c]=s,n[c]=s.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function fq(t,e){switch(Y_(e)){case"object":return Ed(t,e);case"array":return Ed(t,{type:"array",value:e,compare:!1});case"boolean":return Ed(t,{type:"boolean",value:e});case"number":return Ed(t,{type:"number",value:e});case"function":return Ed(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Ed(t,e){return"type"in e?{name:t,...uq[e.type],...e}:"value"in e?{name:t,type:Y_(e.value),...e}:{name:t,type:"object",value:e}}function dp(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Y_(t){return dp(t)?"array":t===null?"null":typeof t}function dq(t,e){const n=UL(t.constructor),r=Object.create(n);r[Z_]=t,r[Xc]={},r[Il]={};for(let c=0;c<e.length;++c){const h=e[c];for(const p in h)r[p]=h[p]}return Object.freeze(r),r}function UL(t){const e=K_(t,"_mergedDefaultProps");return e||(pq(t),t._mergedDefaultProps)}function pq(t){if(!t.prototype)return;const n=Object.getPrototypeOf(t),r=UL(n),c=K_(t,"defaultProps")||{},h=hq(c),p=mq(h.defaultProps,r,t),s={...n._propTypes,...h.propTypes};_q(p,s);const v={...n._deprecatedProps,...h.deprecatedProps};gq(p,v),t._mergedDefaultProps=p,t._propTypes=s,t._deprecatedProps=v}function mq(t,e,n){const r=Object.create(null);Object.assign(r,e,t);const c=vq(n);return delete t.id,Object.defineProperties(r,{id:{writable:!0,value:c}}),r}function gq(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const c="".concat(this.id,": ").concat(n);for(const h of e[n])VL(this,h)||(this[h]=r);Vi.deprecated(c,e[n].join("/"))()}})}function _q(t,e){const n={},r={};for(const c in e){const h=e[c],{name:p,value:s}=h;h.async&&(n[p]=s,r[p]=yq(p))}t[_h]=n,t[Xc]={},Object.defineProperties(t,r)}function yq(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||kL(e)?this[Xc][t]=e:this[Il][t]=e},get(){if(this[Il]){if(t in this[Il])return this[Il][t]||this[_h][t];if(t in this[Xc]){const e=this[Z_]&&this[Z_].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[_h][t]}}return this[_h][t]}}}function VL(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function K_(t,e){return VL(t,e)&&t[e]}function vq(t){const e=K_(t,"layerName")||K_(t,"componentName");return e||Vi.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}let xq=0;class jb{constructor(...e){Y(this,"id",void 0),Y(this,"props",void 0),Y(this,"count",void 0),this.props=dq(this,e),this.id=this.props.id,this.count=xq++}clone(e){const{props:n}=this,r={};for(const c in n[_h])c in n[Il]?r[c]=n[Il][c]:c in n[Xc]&&(r[c]=n[Xc][c]);return new this.constructor({...n,...r,...e})}}Y(jb,"componentName","Component");Y(jb,"defaultProps",{});const bq=Object.freeze({});class wq{constructor(e){Y(this,"component",void 0),Y(this,"onAsyncPropUpdated",void 0),Y(this,"asyncProps",void 0),Y(this,"oldProps",void 0),Y(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||bq}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){const n=e[Il]||{},r=e[Xc]||e,c=e[_h]||{};for(const h in n){const p=n[h];this._createAsyncPropData(h,c[h]),this._updateAsyncProp(h,p),n[h]=this.getAsyncProp(h)}for(const h in r){const p=r[h];this._createAsyncPropData(h,c[h]),this._updateAsyncProp(h,p)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(!!this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(kL(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const c=this.asyncProps[e];c&&r>=c.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),c.resolvedValue=n,c.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const c=r.pendingLoadCount;n.then(h=>{h=this._postProcessValue(r,h),this._setAsyncPropValue(e,h,c),this._onResolve(e,h)}).catch(h=>{this._onError(e,h)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const c=r.pendingLoadCount;let h=[],p=0;for await(const s of n){const{dataTransform:v}=this.component.props;v?h=v(s,h):h=h.concat(s),Object.defineProperty(h,"__diff",{enumerable:!1,value:[{startRow:p,endRow:h.length}]}),p=h.length,this._setAsyncPropValue(e,h,c)}this._onResolve(e,h)}_postProcessValue(e,n){const r=e.type;return r&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const c=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:c&&c[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class Eq extends wq{constructor({attributeManager:e,layer:n}){super(n),Y(this,"attributeManager",void 0),Y(this,"needsRedraw",void 0),Y(this,"needsUpdate",void 0),Y(this,"subLayers",void 0),Y(this,"usesPickingColorCache",void 0),Y(this,"changeFlags",void 0),Y(this,"viewport",void 0),Y(this,"uniformTransitions",void 0),Y(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}_fetch(e,n){const r=this.component.props.fetch;return r?r(n,{propName:e,layer:this.layer}):super._fetch(e,n)}_onResolve(e,n){const r=this.component.props.onDataLoad;e==="data"&&r&&r(n,{propName:e,layer:this.layer})}_onError(e,n){this.layer.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const Tq="layer.changeFlag",Aq="layer.initialize",Sq="layer.update",Mq="layer.finalize",Pq="layer.matched",KS=2**24-1,Iq=Object.freeze([]),Cq=Iy(({oldViewport:t,viewport:e})=>t.equals(e));let ta=new Uint8ClampedArray(0);const Lq={data:{type:"data",value:Iq,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:c,signal:h})=>{const{resourceManager:p}=n.context;if(c=c||n.getLoadOptions(),r=r||n.props.loaders,h){var s;c={...c,fetch:{...(s=c)===null||s===void 0?void 0:s.fetch,signal:h}}}let v=p.contains(t);return!v&&!c&&(p.add({resourceId:t,data:jx(t,r),persistent:!1}),v=!0),v?p.subscribe({resourceId:t,onChange:E=>{var M;return(M=n.internalState)===null||M===void 0?void 0:M.reloadAsyncProp(e,E)},consumerId:n.id,requestId:e}):jx(t,r,c)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:Dp.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:Ti.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ry extends jb{constructor(...e){super(...e),Y(this,"internalState",null),Y(this,"lifecycle",sh.NO_STATE),Y(this,"context",void 0),Y(this,"state",void 0),Y(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){jr(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=yL(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[c,h,p]=dL(r,n.pixelProjectionMatrix);return e.length===2?[c,h]:[c,h,p]}unproject(e){return jr(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){jr(this.internalState);const r=this.internalState.viewport||this.context.viewport;return Z$(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ti.DEFAULT||e===Ti.LNGLAT||e===Ti.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){jr(e instanceof Uint8Array);const[n,r,c]=e;return n+r*256+c*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:iq(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;const n=this.getAttributeManager();if(!n)return null;const{positions:r,instancePositions:c}=n.attributes;return(e=r||c)===null||e===void 0?void 0:e.getBounds()}getShaders(e){for(const n of this.props.extensions)e=oq(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const v of r)n.invalidateAll(v);else n.invalidateAll();const{props:c,oldProps:h}=e,p=Number.isInteger(h.highlightedObjectIndex)||h.pickable,s=Number.isInteger(c.highlightedObjectIndex)||c.pickable;if(p!==s&&n){const{pickingColors:v,instancePickingColors:E}=n.attributes,M=v||E;M&&(s&&M.constant&&(M.constant=!1,n.invalidate(M.id)),!M.value&&!s&&(M.constant=!0,M.value=[0,0,0]))}}finalizeState(e){for(const r of this.getModels())r.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:c}=e;return c>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[c]),e}raiseError(e,n){var r,c;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((r=(c=this.props).onError)!==null&&r!==void 0&&r.call(c,e))){var h,p;(h=this.context)===null||h===void 0||(p=h.onError)===null||p===void 0||p.call(h,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!Cq({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();!n||(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),c=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:c,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const h=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(h)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const c in n)Object.defineProperty(r,c,{value:n[c]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(ta.length/3);if(this.internalState.usesPickingColorCache=!0,r<n){n>KS&&Vi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ta=Nh.allocate(ta,n,{size:3,copy:!0,maxCount:Math.max(n,KS)});const c=Math.floor(ta.length/3),h=[];for(let p=r;p<c;p++)this.encodePickingColor(p,h),ta[p*3+0]=h[0],ta[p*3+1]=h[1],ta[p*3+2]=h[2]}e.value=ta.subarray(0,n*3)}_setModelAttributes(e,n){const r=this.getAttributeManager(),c=e.userData.excludeAttributes||{},h=r.getShaderAttributes(n,c);e.setAttributes(h)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,c=n||r;if(!c)return;const h=c.getVertexOffset(e),p=c.getVertexOffset(e+1);c.buffer.subData({data:new Uint8Array(p-h),offset:h})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;!r||(this.internalState.usesPickingColorCache&&r.value.buffer!==ta.buffer&&(r.value=ta.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){jr(!this.internalState),jr(Number.isFinite(this.props.coordinateSystem)),ds(Aq,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Eq({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Vi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new ZW(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){ds(Pq,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.internalState.layer=this,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(ds(Sq,this,e),!e)return;const n=this.props,r=this.context,c=this.internalState,h=r.viewport,p=this._updateUniformTransition();c.propsInTransition=p,r.viewport=c.viewport||h,this.props=p;try{const s=this._getUpdateParams(),v=this.getModels();if(r.gl)this.updateState(s);else try{this.updateState(s)}catch{}for(const M of this.props.extensions)M.updateState.call(this,s,M);const E=this.getModels()[0]!==v[0];this._postUpdate(s,E)}finally{r.viewport=h,this.props=n,this._clearChangeFlags(),c.needsUpdate=!1,c.resetOldProps()}}_finalize(){ds(Mq,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const c=this.props,h=this.context;this.props=this.internalState.propsInTransition||c;const p=this.props.opacity;n.opacity=Math.pow(p,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:s}=this.props,v=s&&s(n)||[0,0];Da(h.gl,{polygonOffset:v}),oo(h.gl,r,()=>{const E={moduleParameters:e,uniforms:n,parameters:r,context:h};for(const M of this.props.extensions)M.draw.call(this,E,M);this.draw(E)})}finally{this.props=c}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const c in e)if(e[c]){let h=!1;switch(c){case"dataChanged":const p=e[c],s=n[c];p&&Array.isArray(s)&&(n.dataChanged=Array.isArray(p)?s.concat(p):p,h=!0);default:n[c]||(n[c]=e[c],h=!0)}h&&ds(Tq,this,c,e)}const r=Boolean(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const r=YW(e,n);if(r.updateTriggersChanged)for(const h in r.updateTriggersChanged)r.updateTriggersChanged[h]&&this.invalidateAttribute(h);if(r.transitionsChanged)for(const h in r.transitionsChanged){var c;this.internalState.uniformTransitions.add(h,n[h],e[h],(c=e.transitions)===null||c===void 0?void 0:c[h])}return this.setChangeFlags(r)}validateProps(){XW(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.pickingHighlightColor=r(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new GW(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:c}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:h}=this.state;h?.setInstanceCount(this.getNumInstances());const{autoHighlight:p,highlightedObjectIndex:s,highlightColor:v}=r;if(n||c.autoHighlight!==p||c.highlightedObjectIndex!==s||c.highlightColor!==v){const E={};p||(E.pickingSelectedColor=null),Array.isArray(v)&&(E.pickingHighlightColor=v),(n||s!==c.highlightedObjectIndex)&&(E.pickingSelectedColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setModuleParameters(E)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const r=this.getAttributeManager(),c=r?r.getNeedsRedraw(e):!1;return n=n||c,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Y(Ry,"defaultProps",Lq);Y(Ry,"layerName","Layer");class jL{constructor(e){Y(this,"opts",void 0),Y(this,"typedArrayManager",void 0),Y(this,"indexStarts",[0]),Y(this,"vertexStarts",[0]),Y(this,"vertexCount",0),Y(this,"instanceCount",0),Y(this,"attributes",void 0),Y(this,"_attributeDefs",void 0),Y(this,"data",void 0),Y(this,"getGeometry",void 0),Y(this,"geometryBuffer",void 0),Y(this,"buffers",void 0),Y(this,"positionSize",void 0),Y(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Nh,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:r={},getGeometry:c,geometryBuffer:h,positionFormat:p,dataChanged:s,normalize:v=!0}=this.opts;if(this.data=n,this.getGeometry=c,this.positionSize=h&&h.size||(p==="XY"?2:3),this.buffers=r,this.normalize=v,h&&(jr(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(h),v||(r.positions=h)),this.geometryBuffer=r.positions,Array.isArray(s))for(const E of s)this._rebuildGeometry(E);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?RL(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:r,buffers:c,_attributeDefs:h,typedArrayManager:p}=this;for(const s in h)if(s in c)p.release(r[s]),r[s]=null;else{const v=h[s];v.copy=n,r[s]=p.allocate(r[s],e,v)}}_forEachGeometry(e,n,r){const{data:c,getGeometry:h}=this,{iterable:p,objectInfo:s}=LL(c,n,r);for(const v of p){s.index++;const E=h?h(v,s):null;e(E,s.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:r,instanceCount:c}=this;const{data:h,geometryBuffer:p}=this,{startRow:s=0,endRow:v=1/0}=e||{},E={};if(e||(n=[0],r=[0]),this.normalize||!p)this._forEachGeometry((I,R)=>{const N=I&&this.normalizeGeometry(I);E[R]=N,r[R+1]=r[R]+(N?this.getGeometrySize(N):0)},s,v),c=r[r.length-1];else if(r=h.startIndices,c=r[h.length]||0,ArrayBuffer.isView(p))c=c||p.length/this.positionSize;else if(p instanceof Ui){const I=p.accessor.stride||this.positionSize*4;c=c||p.byteLength/I}else if(p.buffer){const I=p.stride||this.positionSize*4;c=c||p.buffer.byteLength/I}else if(p.value){const I=p.value,R=p.stride/I.BYTES_PER_ELEMENT||this.positionSize;c=c||I.length/R}this._allocate(c,Boolean(e)),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=c;const M={};this._forEachGeometry((I,R)=>{const N=E[R]||I;M.vertexStart=r[R],M.indexStart=n[R];const $=R<r.length-1?r[R+1]:c;M.geometrySize=$-r[R],M.geometryIndex=R,this.updateGeometryAttributes(N,M)},s,v),this.vertexCount=n[n.length-1]}}const GL={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function $L(t,e,n={}){return kq(t,n)!==e?(Oq(t,n),!0):!1}function kq(t,e={}){return Math.sign(Rq(t,e))}function Rq(t,e={}){const{start:n=0,end:r=t.length}=e,c=e.size||2;let h=0;for(let p=n,s=r-c;p<r;p+=c)h+=(t[p]-t[s])*(t[p+1]+t[s+1]),s=p;return h/2}function Oq(t,e){const{start:n=0,end:r=t.length,size:c=2}=e,h=(r-n)/c,p=Math.floor(h/2);for(let s=0;s<p;++s){const v=n+s*c,E=n+(h-1-s)*c;for(let M=0;M<c;++M){const I=t[v+M];t[v+M]=t[E+M],t[E+M]=I}}}function Po(t,e){const n=e.length,r=t.length;if(r>0){let c=!0;for(let h=0;h<n;h++)if(t[r-n+h]!==e[h]){c=!1;break}if(c)return!1}for(let c=0;c<n;c++)t[r+c]=e[c];return!0}function p1(t,e){const n=e.length;for(let r=0;r<n;r++)t[r]=e[r]}function pp(t,e,n,r,c=[]){const h=r+e*n;for(let p=0;p<n;p++)c[p]=t[h+p];return c}function m1(t,e,n,r,c=[]){let h,p;if(n&8)h=(r[3]-t[1])/(e[1]-t[1]),p=3;else if(n&4)h=(r[1]-t[1])/(e[1]-t[1]),p=1;else if(n&2)h=(r[2]-t[0])/(e[0]-t[0]),p=2;else if(n&1)h=(r[0]-t[0])/(e[0]-t[0]),p=0;else return null;for(let s=0;s<t.length;s++)c[s]=(p&1)===s?r[p]:h*(e[s]-t[s])+t[s];return c}function d_(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function HL(t,e){const{size:n=2,broken:r=!1,gridResolution:c=10,gridOffset:h=[0,0],startIndex:p=0,endIndex:s=t.length}=e||{},v=(s-p)/n;let E=[];const M=[E],I=pp(t,0,n,p);let R,N;const $=qL(I,c,h,[]),Z=[];Po(E,I);for(let ne=1;ne<v;ne++){for(R=pp(t,ne,n,p,R),N=d_(R,$);N;){m1(I,R,N,$,Z);const me=d_(Z,$);me&&(m1(I,Z,me,$,Z),N=me),Po(E,Z),p1(I,Z),zq($,c,N),r&&E.length>n&&(E=[],M.push(E),Po(E,I)),N=d_(R,$)}Po(E,R),p1(I,R)}return r?M:M[0]}const JS=0,Dq=1;function Vg(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function WL(t,e=null,n){if(!t.length)return[];const{size:r=2,gridResolution:c=10,gridOffset:h=[0,0],edgeTypes:p=!1}=n||{},s=[],v=[{pos:t,types:p?new Array(t.length/r).fill(Dq):null,holes:e||[]}],E=[[],[]];let M=[];for(;v.length;){const{pos:I,types:R,holes:N}=v.shift();Bq(I,r,N[0]||I.length,E),M=qL(E[0],c,h,M);const $=d_(E[1],M);if($){let Z=QS(I,R,r,0,N[0]||I.length,M,$);const ne={pos:Z[0].pos,types:Z[0].types,holes:[]},me={pos:Z[1].pos,types:Z[1].types,holes:[]};v.push(ne,me);for(let we=0;we<N.length;we++)Z=QS(I,R,r,N[we],N[we+1]||I.length,M,$),Z[0]&&(ne.holes.push(ne.pos.length),ne.pos=Vg(ne.pos,Z[0].pos),p&&(ne.types=Vg(ne.types,Z[0].types))),Z[1]&&(me.holes.push(me.pos.length),me.pos=Vg(me.pos,Z[1].pos),p&&(me.types=Vg(me.types,Z[1].types)))}else{const Z={positions:I};p&&(Z.edgeTypes=R),N.length&&(Z.holeIndices=N),s.push(Z)}}return s}function QS(t,e,n,r,c,h,p){const s=(c-r)/n,v=[],E=[],M=[],I=[],R=[];let N,$,Z;const ne=pp(t,s-1,n,r);let me=Math.sign(p&8?ne[1]-h[3]:ne[0]-h[2]),we=e&&e[s-1],he=0,Pe=0;for(let ge=0;ge<s;ge++)N=pp(t,ge,n,r,N),$=Math.sign(p&8?N[1]-h[3]:N[0]-h[2]),Z=e&&e[r/n+ge],$&&me&&me!==$&&(m1(ne,N,p,h,R),Po(v,R)&&M.push(we),Po(E,R)&&I.push(we)),$<=0?(Po(v,N)&&M.push(Z),he-=$):M.length&&(M[M.length-1]=JS),$>=0?(Po(E,N)&&I.push(Z),Pe+=$):I.length&&(I[I.length-1]=JS),p1(ne,N),me=$,we=Z;return[he?{pos:v,types:e&&M}:null,Pe?{pos:E,types:e&&I}:null]}function qL(t,e,n,r){const c=Math.floor((t[0]-n[0])/e)*e+n[0],h=Math.floor((t[1]-n[1])/e)*e+n[1];return r[0]=c,r[1]=h,r[2]=c+e,r[3]=h+e,r}function zq(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function Bq(t,e,n,r){let c=1/0,h=-1/0,p=1/0,s=-1/0;for(let v=0;v<n;v+=e){const E=t[v],M=t[v+1];c=E<c?E:c,h=E>h?E:h,p=M<p?M:p,s=M>s?M:s}return r[0][0]=c,r[0][1]=p,r[1][0]=h,r[1][1]=s,r}const Fq=85.051129;function Nq(t,e){const{size:n=2,startIndex:r=0,endIndex:c=t.length,normalize:h=!0}=e||{},p=t.slice(r,c);ZL(p,n,0,c-r);const s=HL(p,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(h)for(const v of s)XL(v,n);return s}function Uq(t,e=null,n){const{size:r=2,normalize:c=!0,edgeTypes:h=!1}=n||{};e=e||[];const p=[],s=[];let v=0,E=0;for(let I=0;I<=e.length;I++){const R=e[I]||t.length,N=E,$=Vq(t,r,v,R);for(let Z=$;Z<R;Z++)p[E++]=t[Z];for(let Z=v;Z<$;Z++)p[E++]=t[Z];ZL(p,r,N,E),jq(p,r,N,E,n?.maxLatitude),v=R,s[I]=E}s.pop();const M=WL(p,s,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:h});if(c)for(const I of M)XL(I.positions,r);return M}function Vq(t,e,n,r){let c=-1,h=-1;for(let p=n+1;p<r;p+=e){const s=Math.abs(t[p]);s>c&&(c=s,h=p-1)}return h}function jq(t,e,n,r,c=Fq){const h=t[n],p=t[r-e];if(Math.abs(h-p)>180){const s=pp(t,0,e,n);s[0]+=Math.round((p-h)/360)*360,Po(t,s),s[1]=Math.sign(s[1])*c,Po(t,s),s[0]=h,Po(t,s)}}function ZL(t,e,n,r){let c=t[0],h;for(let p=n;p<r;p+=e){h=t[p];const s=h-c;(s>180||s<-180)&&(h-=Math.round(s/360)*360),t[p]=c=h}}function XL(t,e){let n;const r=t.length/e;for(let h=0;h<r&&(n=t[h*e],(n+180)%360===0);h++);const c=-Math.round(n/360)*360;if(c!==0)for(let h=0;h<r;h++)t[h*e]+=c}function Gq(t,e,n,r){let c;if(Array.isArray(t[0])){const h=t.length*e;c=new Array(h);for(let p=0;p<t.length;p++)for(let s=0;s<e;s++)c[p*e+s]=t[p][s]||0}else c=t;return n?HL(c,{size:e,gridResolution:n}):r?Nq(c,{size:e}):c}const $q=1,Hq=2,Xv=4;class Wq extends jL{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?Gq(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(eM(e)){let r=0;for(const c of e)r+=this.getGeometrySize(c);return r}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&eM(e))for(const r of e){const c=this.getGeometrySize(r);n.geometrySize=c,this.updateGeometryAttributes(r,n),n.vertexStart+=c}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const r=this.attributes.segmentTypes,c=e?this.isClosed(e):!1,{vertexStart:h,geometrySize:p}=n;r.fill(0,h,h+p),c?(r[h]=Xv,r[h+p-2]=Xv):(r[h]+=$q,r[h+p-2]+=Hq),r[h+p-1]=Xv}_updatePositions(e,n){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:c,geometrySize:h}=n,p=new Array(3);for(let s=c,v=0;v<h;s++,v++)this.getPointOnPath(e,v,p),r[s*3]=p[0],r[s*3+1]=p[1],r[s*3+2]=p[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,r=[]){const{positionSize:c}=this;n*c>=e.length&&(n+=1-e.length/c);const h=n*c;return r[0]=e[h],r[1]=e[h+1],r[2]=c===3&&e[h+2]||0,r}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:n}=this,r=e.length-n;return e[0]===e[r]&&e[1]===e[r+1]&&(n===2||e[2]===e[r+2])}}function eM(t){return Array.isArray(t[0])}const qq=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}

// calculate line join positions
vec3 lineJoin(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  // side of the segment - -1: left, 0: center, 1: right
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);

  // tangent of the corner
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  // direction of the corner
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  // direction of the segment
  vec2 dir = isEnd ? dirA : dirB;
  // direction of the extrusion
  vec2 perp = isEnd ? perpA : perpB;
  // length of the segment
  float L = isEnd ? lenA : lenB;

  // A = angle of the corner
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));

  // -1: right, 1: left
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);

  // relative position to the corner:
  // -1: inside (smaller side of the angle)
  // 0: center
  // 1: outside (bigger side of the angle)
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  // trim if inside corner extends further than the line segment
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);

  // special treatment for start cap and end cap
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;

  // extend out a triangle to envelope the round cap
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }

  // Generate variables for fragment shader
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return currPoint + offset;
}

// In clipspace extrusion, if a line extends behind the camera, clip it to avoid visual artifacts
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    // Extrude in clipspace
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 pos = lineJoin(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);
  } else {
    // Extrude in commonspace
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec4 pos = vec4(
      lineJoin(prevPosition, currPosition, nextPosition, width.xy),
      1.0);
    geometry.position = pos;
    gl_Position = project_common_position_to_clipspace(pos);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Zq=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
/*
 * vPathPosition represents the relative coordinates of the current fragment on the path segment.
 * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.
 * vPathPosition.y - position along the length of the path, between [0, L / width].
 */
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    // if joint is rounded, test distance from the corner
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    // trim miter
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,YL=[0,0,0,255],Xq={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:YL},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Yv={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Gb extends Ry{constructor(...e){super(...e),Y(this,"state",void 0)}getShaders(){return super.getShaders({vs:qq,fs:Zq,modules:[cL,mL]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:Yv,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Yv,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:Yv,defaultValue:YL},instancePickingColors:{size:3,type:5121,accessor:(r,{index:c,target:h})=>this.encodePickingColor(r&&r.__source?r.__source.index:c,h)}}),this.setState({pathTesselator:new Wq({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:r}=e,c=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:s}=this.state,v=n.data.attributes||{};s.updateGeometry({data:n.data,geometryBuffer:v.getPath,buffers:v,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),r.dataChanged||c.invalidateAll()}if(r.extensionsChanged){var p;const{gl:s}=this.context;(p=this.state.model)===null||p===void 0||p.delete(),this.state.model=this._getModel(s),c.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,{data:c}=this.props;return c[0]&&c[0].__source&&(n.object=c.find(h=>h.__source.index===r)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else this._disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:r,billboard:c,miterLimit:h,widthUnits:p,widthScale:s,widthMinPixels:v,widthMaxPixels:E}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(r),billboard:c,widthUnits:n1[p],widthScale:s,miterLimit:h,widthMinPixels:v,widthMaxPixels:E}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new $_(e,{...this.getShaders(),id:this.props.id,geometry:new iL({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}Y(Gb,"defaultProps",Xq);Y(Gb,"layerName","PathLayer");var $b={exports:{}};$b.exports=Oy;$b.exports.default=Oy;function Oy(t,e,n){n=n||2;var r=e&&e.length,c=r?e[0]*n:t.length,h=KL(t,0,c,n,!0),p=[];if(!h||h.next===h.prev)return p;var s,v,E,M,I,R,N;if(r&&(h=eZ(t,e,h,n)),t.length>80*n){s=E=t[0],v=M=t[1];for(var $=n;$<c;$+=n)I=t[$],R=t[$+1],I<s&&(s=I),R<v&&(v=R),I>E&&(E=I),R>M&&(M=R);N=Math.max(E-s,M-v),N=N!==0?32767/N:0}return mp(h,p,n,s,v,N,0),p}function KL(t,e,n,r,c){var h,p;if(c===y1(t,e,n,r)>0)for(h=e;h<n;h+=r)p=tM(h,t[h],t[h+1],p);else for(h=n-r;h>=e;h-=r)p=tM(h,t[h],t[h+1],p);return p&&Dy(p,p.next)&&(_p(p),p=p.next),p}function Yc(t,e){if(!t)return t;e||(e=t);var n=t,r;do if(r=!1,!n.steiner&&(Dy(n,n.next)||ur(n.prev,n,n.next)===0)){if(_p(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function mp(t,e,n,r,c,h,p){if(!!t){!p&&h&&sZ(t,r,c,h);for(var s=t,v,E;t.prev!==t.next;){if(v=t.prev,E=t.next,h?Kq(t,r,c,h):Yq(t)){e.push(v.i/n|0),e.push(t.i/n|0),e.push(E.i/n|0),_p(t),t=E.next,s=E.next;continue}if(t=E,t===s){p?p===1?(t=Jq(Yc(t),e,n),mp(t,e,n,r,c,h,2)):p===2&&Qq(t,e,n,r,c,h):mp(Yc(t),e,n,r,c,h,1);break}}}}function Yq(t){var e=t.prev,n=t,r=t.next;if(ur(e,n,r)>=0)return!1;for(var c=e.x,h=n.x,p=r.x,s=e.y,v=n.y,E=r.y,M=c<h?c<p?c:p:h<p?h:p,I=s<v?s<E?s:E:v<E?v:E,R=c>h?c>p?c:p:h>p?h:p,N=s>v?s>E?s:E:v>E?v:E,$=r.next;$!==e;){if($.x>=M&&$.x<=R&&$.y>=I&&$.y<=N&&ch(c,s,h,v,p,E,$.x,$.y)&&ur($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function Kq(t,e,n,r){var c=t.prev,h=t,p=t.next;if(ur(c,h,p)>=0)return!1;for(var s=c.x,v=h.x,E=p.x,M=c.y,I=h.y,R=p.y,N=s<v?s<E?s:E:v<E?v:E,$=M<I?M<R?M:R:I<R?I:R,Z=s>v?s>E?s:E:v>E?v:E,ne=M>I?M>R?M:R:I>R?I:R,me=g1(N,$,e,n,r),we=g1(Z,ne,e,n,r),he=t.prevZ,Pe=t.nextZ;he&&he.z>=me&&Pe&&Pe.z<=we;){if(he.x>=N&&he.x<=Z&&he.y>=$&&he.y<=ne&&he!==c&&he!==p&&ch(s,M,v,I,E,R,he.x,he.y)&&ur(he.prev,he,he.next)>=0||(he=he.prevZ,Pe.x>=N&&Pe.x<=Z&&Pe.y>=$&&Pe.y<=ne&&Pe!==c&&Pe!==p&&ch(s,M,v,I,E,R,Pe.x,Pe.y)&&ur(Pe.prev,Pe,Pe.next)>=0))return!1;Pe=Pe.nextZ}for(;he&&he.z>=me;){if(he.x>=N&&he.x<=Z&&he.y>=$&&he.y<=ne&&he!==c&&he!==p&&ch(s,M,v,I,E,R,he.x,he.y)&&ur(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;Pe&&Pe.z<=we;){if(Pe.x>=N&&Pe.x<=Z&&Pe.y>=$&&Pe.y<=ne&&Pe!==c&&Pe!==p&&ch(s,M,v,I,E,R,Pe.x,Pe.y)&&ur(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.nextZ}return!0}function Jq(t,e,n){var r=t;do{var c=r.prev,h=r.next.next;!Dy(c,h)&&JL(c,r,r.next,h)&&gp(c,h)&&gp(h,c)&&(e.push(c.i/n|0),e.push(r.i/n|0),e.push(h.i/n|0),_p(r),_p(r.next),r=t=h),r=r.next}while(r!==t);return Yc(r)}function Qq(t,e,n,r,c,h){var p=t;do{for(var s=p.next.next;s!==p.prev;){if(p.i!==s.i&&lZ(p,s)){var v=QL(p,s);p=Yc(p,p.next),v=Yc(v,v.next),mp(p,e,n,r,c,h,0),mp(v,e,n,r,c,h,0);return}s=s.next}p=p.next}while(p!==t)}function eZ(t,e,n,r){var c=[],h,p,s,v,E;for(h=0,p=e.length;h<p;h++)s=e[h]*r,v=h<p-1?e[h+1]*r:t.length,E=KL(t,s,v,r,!1),E===E.next&&(E.steiner=!0),c.push(aZ(E));for(c.sort(tZ),h=0;h<c.length;h++)n=nZ(c[h],n);return n}function tZ(t,e){return t.x-e.x}function nZ(t,e){var n=iZ(t,e);if(!n)return e;var r=QL(n,t);return Yc(r,r.next),Yc(n,n.next)}function iZ(t,e){var n=e,r=t.x,c=t.y,h=-1/0,p;do{if(c<=n.y&&c>=n.next.y&&n.next.y!==n.y){var s=n.x+(c-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>h&&(h=s,p=n.x<n.next.x?n:n.next,s===r))return p}n=n.next}while(n!==e);if(!p)return null;var v=p,E=p.x,M=p.y,I=1/0,R;n=p;do r>=n.x&&n.x>=E&&r!==n.x&&ch(c<M?r:h,c,E,M,c<M?h:r,c,n.x,n.y)&&(R=Math.abs(c-n.y)/(r-n.x),gp(n,t)&&(R<I||R===I&&(n.x>p.x||n.x===p.x&&rZ(p,n)))&&(p=n,I=R)),n=n.next;while(n!==v);return p}function rZ(t,e){return ur(t.prev,t,e.prev)<0&&ur(e.next,t,t.next)<0}function sZ(t,e,n,r){var c=t;do c.z===0&&(c.z=g1(c.x,c.y,e,n,r)),c.prevZ=c.prev,c.nextZ=c.next,c=c.next;while(c!==t);c.prevZ.nextZ=null,c.prevZ=null,oZ(c)}function oZ(t){var e,n,r,c,h,p,s,v,E=1;do{for(n=t,t=null,h=null,p=0;n;){for(p++,r=n,s=0,e=0;e<E&&(s++,r=r.nextZ,!!r);e++);for(v=E;s>0||v>0&&r;)s!==0&&(v===0||!r||n.z<=r.z)?(c=n,n=n.nextZ,s--):(c=r,r=r.nextZ,v--),h?h.nextZ=c:t=c,c.prevZ=h,h=c;n=r}h.nextZ=null,E*=2}while(p>1);return t}function g1(t,e,n,r,c){return t=(t-n)*c|0,e=(e-r)*c|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function aZ(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function ch(t,e,n,r,c,h,p,s){return(c-p)*(e-s)>=(t-p)*(h-s)&&(t-p)*(r-s)>=(n-p)*(e-s)&&(n-p)*(h-s)>=(c-p)*(r-s)}function lZ(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!cZ(t,e)&&(gp(t,e)&&gp(e,t)&&uZ(t,e)&&(ur(t.prev,t,e.prev)||ur(t,e.prev,e))||Dy(t,e)&&ur(t.prev,t,t.next)>0&&ur(e.prev,e,e.next)>0)}function ur(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Dy(t,e){return t.x===e.x&&t.y===e.y}function JL(t,e,n,r){var c=Gg(ur(t,e,n)),h=Gg(ur(t,e,r)),p=Gg(ur(n,r,t)),s=Gg(ur(n,r,e));return!!(c!==h&&p!==s||c===0&&jg(t,n,e)||h===0&&jg(t,r,e)||p===0&&jg(n,t,r)||s===0&&jg(n,e,r))}function jg(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Gg(t){return t>0?1:t<0?-1:0}function cZ(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&JL(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function gp(t,e){return ur(t.prev,t,t.next)<0?ur(t,e,t.next)>=0&&ur(t,t.prev,e)>=0:ur(t,e,t.prev)<0||ur(t,t.next,e)<0}function uZ(t,e){var n=t,r=!1,c=(t.x+e.x)/2,h=(t.y+e.y)/2;do n.y>h!=n.next.y>h&&n.next.y!==n.y&&c<(n.next.x-n.x)*(h-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function QL(t,e){var n=new _1(t.i,t.x,t.y),r=new _1(e.i,e.x,e.y),c=t.next,h=e.prev;return t.next=e,e.prev=t,n.next=c,c.prev=n,r.next=n,n.prev=r,h.next=r,r.prev=h,r}function tM(t,e,n,r){var c=new _1(t,e,n);return r?(c.next=r.next,c.prev=r,r.next.prev=c,r.next=c):(c.prev=c,c.next=c),c}function _p(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function _1(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Oy.deviation=function(t,e,n,r){var c=e&&e.length,h=c?e[0]*n:t.length,p=Math.abs(y1(t,0,h,n));if(c)for(var s=0,v=e.length;s<v;s++){var E=e[s]*n,M=s<v-1?e[s+1]*n:t.length;p-=Math.abs(y1(t,E,M,n))}var I=0;for(s=0;s<r.length;s+=3){var R=r[s]*n,N=r[s+1]*n,$=r[s+2]*n;I+=Math.abs((t[R]-t[$])*(t[N+1]-t[R+1])-(t[R]-t[N])*(t[$+1]-t[R+1]))}return p===0&&I===0?0:Math.abs((I-p)/p)};function y1(t,e,n,r){for(var c=0,h=e,p=n-r;h<n;h+=r)c+=(t[p]-t[h])*(t[h+1]+t[p+1]),p=h;return c}Oy.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,c=0;c<t.length;c++){for(var h=0;h<t[c].length;h++)for(var p=0;p<e;p++)n.vertices.push(t[c][h][p]);c>0&&(r+=t[c-1].length,n.holes.push(r))}return n};const $g=GL.CLOCKWISE,nM=GL.COUNTER_CLOCKWISE,Cl={isClosed:!0};function hZ(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Id(t){return"positions"in t?t.positions:t}function p_(t){return"holeIndices"in t?t.holeIndices:null}function fZ(t){return Array.isArray(t[0])}function dZ(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function pZ(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function mZ(t,e,n,r){for(let c=0;c<e;c++)if(t[n+c]!==t[r-e+c])return!1;return!0}function iM(t,e,n,r,c){let h=e;const p=n.length;for(let s=0;s<p;s++)for(let v=0;v<r;v++)t[h++]=n[s][v]||0;if(!pZ(n))for(let s=0;s<r;s++)t[h++]=n[0][s]||0;return Cl.start=e,Cl.end=h,Cl.size=r,$L(t,c,Cl),h}function rM(t,e,n,r,c=0,h,p){h=h||n.length;const s=h-c;if(s<=0)return e;let v=e;for(let E=0;E<s;E++)t[v++]=n[c+E];if(!mZ(n,r,c,h))for(let E=0;E<r;E++)t[v++]=n[c+E];return Cl.start=e,Cl.end=v,Cl.size=r,$L(t,p,Cl),v}function gZ(t,e){hZ(t);const n=[],r=[];if("positions"in t){const{positions:c,holeIndices:h}=t;if(h){let p=0;for(let s=0;s<=h.length;s++)p=rM(n,p,c,e,h[s-1],h[s],s===0?$g:nM),r.push(p);return r.pop(),{positions:n,holeIndices:r}}t=c}if(!fZ(t))return rM(n,0,t,e,0,n.length,$g),n;if(!dZ(t)){let c=0;for(const[h,p]of t.entries())c=iM(n,c,p,e,h===0?$g:nM),r.push(c);return r.pop(),{positions:n,holeIndices:r}}return iM(n,0,t,e,$g),n}function _Z(t,e,n){let r=p_(t);r&&(r=r.map(h=>h/e));let c=Id(t);if(n){const h=c.length;c=c.slice();const p=[];for(let s=0;s<h;s+=e){p[0]=c[s],p[1]=c[s+1];const v=n(p);c[s]=v[0],c[s+1]=v[1]}}return $b.exports(c,r,e)}class yZ extends jL{constructor(e){const{fp64:n,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=gZ(e,this.positionSize);return this.opts.resolution?WL(Id(n),p_(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?Uq(Id(n),p_(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(sM(e)){let n=0;for(const r of e)n+=this.getGeometrySize(r);return n}return Id(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&sM(e))for(const r of e){const c=this.getGeometrySize(r);n.geometrySize=c,this.updateGeometryAttributes(r,n),n.vertexStart+=c,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:r,indexStart:c}){const{attributes:h,indexStarts:p,typedArrayManager:s}=this;let v=h.indices;if(!v||!e)return;let E=c;const M=_Z(e,this.positionSize,this.opts.preproject);v=s.allocate(v,c+M.length,{copy:!0});for(let I=0;I<M.length;I++)v[E++]=M[I]+r;p[n+1]=c+M.length,h.indices=v}_updatePositions(e,{vertexStart:n,geometrySize:r}){const{attributes:{positions:c},positionSize:h}=this;if(!c||!e)return;const p=Id(e);for(let s=n,v=0;v<r;s++,v++){const E=p[v*h],M=p[v*h+1],I=h>2?p[v*h+2]:0;c[s*3]=E,c[s*3+1]=M,c[s*3+2]=I}}_updateVertexValid(e,{vertexStart:n,geometrySize:r}){const{positionSize:c}=this,h=this.attributes.vertexValid,p=e&&p_(e);if(e&&e.edgeTypes?h.set(e.edgeTypes,n):h.fill(1,n,n+r),p)for(let s=0;s<p.length;s++)h[n+p[s]/c-1]=0;h[n+r-1]=0}}function sM(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const e3=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,vZ=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(e3,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),xZ=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(e3,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),bZ=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,J_=[0,0,0,255],wZ={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:J_},getLineColor:{type:"accessor",value:J_},material:!0},Hg={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Hb extends Ry{constructor(...e){super(...e),Y(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?vZ:xZ,fs:bZ,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[cL,u9,mL]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:r}=this.props;n.isGeospatial&&r===Ti.DEFAULT&&(r=Ti.LNGLAT),this.setState({numInstances:0,polygonTesselator:new yZ({preproject:r===Ti.LNGLAT&&n.projectFlat.bind(n),fp64:this.use64bitPositions(),IndexType:!e||Sb(e,Ki.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const c=this.getAttributeManager(),h=!0;c.remove(["instancePickingColors"]),c.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:h},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:Hg,accessor:"getPolygon",update:this.calculatePositions,noAlloc:h,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:h},elevations:{size:1,transition:Hg,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Hg,accessor:"getFillColor",defaultValue:J_,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Hg,accessor:"getLineColor",defaultValue:J_,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(p,{index:s,target:v})=>this.encodePickingColor(p&&p.__source?p.__source.index:s,v),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,{data:c}=this.props;return c[0]&&c[0].__source&&(n.object=c.find(h=>h.__source.index===r)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else this._disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:r,wireframe:c,elevationScale:h}=this.props,{topModel:p,sideModel:s,polygonTesselator:v}=this.state,E={...e,extruded:Boolean(n),elevationScale:h};s&&(s.setInstanceCount(v.instanceCount-1),s.setUniforms(E),c&&(s.setDrawMode(3),s.setUniforms({isWireframe:!0}).draw()),r&&(s.setDrawMode(6),s.setUniforms({isWireframe:!1}).draw())),p&&(p.setVertexCount(v.vertexCount),p.setUniforms(E).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:r,changeFlags:c}=e,h=this.getAttributeManager();if(c.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded){var s;(s=this.state.models)===null||s===void 0||s.forEach(v=>v.delete()),this.setState(this._getModels(this.context.gl)),h.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:h}=this.state,p=e.data.attributes||{};h.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:p.getPolygon,buffers:p,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged}),this.setState({numInstances:h.instanceCount,startIndices:h.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:r,extruded:c}=this.props;let h,p;if(r){const s=this.getShaders("top");s.defines.NON_INSTANCED_MODEL=1,h=new $_(e,{...s,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return c&&(p=new $_(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new iL({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),p.userData.excludeAttributes={indices:!0}),{models:[p,h].filter(Boolean),topModel:h,sideModel:p}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}Y(Hb,"defaultProps",wZ);Y(Hb,"layerName","SolidPolygonLayer");function m_(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function EZ(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function t3(t){let e,n,r;t.length!==2?(e=m_,n=(s,v)=>m_(t(s),v),r=(s,v)=>t(s)-v):(e=t===m_||t===EZ?t:TZ,n=t,r=t);function c(s,v,E=0,M=s.length){if(E<M){if(e(v,v)!==0)return M;do{const I=E+M>>>1;n(s[I],v)<0?E=I+1:M=I}while(E<M)}return E}function h(s,v,E=0,M=s.length){if(E<M){if(e(v,v)!==0)return M;do{const I=E+M>>>1;n(s[I],v)<=0?E=I+1:M=I}while(E<M)}return E}function p(s,v,E=0,M=s.length){const I=c(s,v,E,M-1);return I>E&&r(s[I-1],v)>-r(s[I],v)?I-1:I}return{left:c,center:p,right:h}}function TZ(){return 0}function AZ(t){return t===null?NaN:+t}const SZ=t3(m_),MZ=SZ.right;t3(AZ).center;const PZ=MZ,IZ=Math.sqrt(50),CZ=Math.sqrt(10),LZ=Math.sqrt(2);function Q_(t,e,n){const r=(e-t)/Math.max(0,n),c=Math.floor(Math.log10(r)),h=r/Math.pow(10,c),p=h>=IZ?10:h>=CZ?5:h>=LZ?2:1;let s,v,E;return c<0?(E=Math.pow(10,-c)/p,s=Math.round(t*E),v=Math.round(e*E),s/E<t&&++s,v/E>e&&--v,E=-E):(E=Math.pow(10,c)*p,s=Math.round(t/E),v=Math.round(e/E),s*E<t&&++s,v*E>e&&--v),v<s&&.5<=n&&n<2?Q_(t,e,n*2):[s,v,E]}function kZ(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[c,h,p]=r?Q_(e,t,n):Q_(t,e,n);if(!(h>=c))return[];const s=h-c+1,v=new Array(s);if(r)if(p<0)for(let E=0;E<s;++E)v[E]=(h-E)/-p;else for(let E=0;E<s;++E)v[E]=(h-E)*p;else if(p<0)for(let E=0;E<s;++E)v[E]=(c+E)/-p;else for(let E=0;E<s;++E)v[E]=(c+E)*p;return v}function v1(t,e,n){return e=+e,t=+t,n=+n,Q_(t,e,n)[2]}function RZ(t,e,n){e=+e,t=+t,n=+n;const r=e<t,c=r?v1(e,t,n):v1(t,e,n);return(r?-1:1)*(c<0?1/-c:c)}function Wb(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function n3(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Bp(){}var yp=.7,ey=1/yp,yh="\\s*([+-]?\\d+)\\s*",vp="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",la="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",OZ=/^#([0-9a-f]{3,8})$/,DZ=new RegExp(`^rgb\\(${yh},${yh},${yh}\\)$`),zZ=new RegExp(`^rgb\\(${la},${la},${la}\\)$`),BZ=new RegExp(`^rgba\\(${yh},${yh},${yh},${vp}\\)$`),FZ=new RegExp(`^rgba\\(${la},${la},${la},${vp}\\)$`),NZ=new RegExp(`^hsl\\(${vp},${la},${la}\\)$`),UZ=new RegExp(`^hsla\\(${vp},${la},${la},${vp}\\)$`),oM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Wb(Bp,Uh,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:aM,formatHex:aM,formatHex8:VZ,formatHsl:jZ,formatRgb:lM,toString:lM});function aM(){return this.rgb().formatHex()}function VZ(){return this.rgb().formatHex8()}function jZ(){return i3(this).formatHsl()}function lM(){return this.rgb().formatRgb()}function Uh(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=OZ.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?cM(e):n===3?new Ls(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Wg(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Wg(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=DZ.exec(t))?new Ls(e[1],e[2],e[3],1):(e=zZ.exec(t))?new Ls(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=BZ.exec(t))?Wg(e[1],e[2],e[3],e[4]):(e=FZ.exec(t))?Wg(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=NZ.exec(t))?fM(e[1],e[2]/100,e[3]/100,1):(e=UZ.exec(t))?fM(e[1],e[2]/100,e[3]/100,e[4]):oM.hasOwnProperty(t)?cM(oM[t]):t==="transparent"?new Ls(NaN,NaN,NaN,0):null}function cM(t){return new Ls(t>>16&255,t>>8&255,t&255,1)}function Wg(t,e,n,r){return r<=0&&(t=e=n=NaN),new Ls(t,e,n,r)}function GZ(t){return t instanceof Bp||(t=Uh(t)),t?(t=t.rgb(),new Ls(t.r,t.g,t.b,t.opacity)):new Ls}function ty(t,e,n,r){return arguments.length===1?GZ(t):new Ls(t,e,n,r??1)}function Ls(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Wb(Ls,ty,n3(Bp,{brighter(t){return t=t==null?ey:Math.pow(ey,t),new Ls(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?yp:Math.pow(yp,t),new Ls(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Ls(Wc(this.r),Wc(this.g),Wc(this.b),ny(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:uM,formatHex:uM,formatHex8:$Z,formatRgb:hM,toString:hM}));function uM(){return`#${Uc(this.r)}${Uc(this.g)}${Uc(this.b)}`}function $Z(){return`#${Uc(this.r)}${Uc(this.g)}${Uc(this.b)}${Uc((isNaN(this.opacity)?1:this.opacity)*255)}`}function hM(){const t=ny(this.opacity);return`${t===1?"rgb(":"rgba("}${Wc(this.r)}, ${Wc(this.g)}, ${Wc(this.b)}${t===1?")":`, ${t})`}`}function ny(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Wc(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Uc(t){return t=Wc(t),(t<16?"0":"")+t.toString(16)}function fM(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Ao(t,e,n,r)}function i3(t){if(t instanceof Ao)return new Ao(t.h,t.s,t.l,t.opacity);if(t instanceof Bp||(t=Uh(t)),!t)return new Ao;if(t instanceof Ao)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,c=Math.min(e,n,r),h=Math.max(e,n,r),p=NaN,s=h-c,v=(h+c)/2;return s?(e===h?p=(n-r)/s+(n<r)*6:n===h?p=(r-e)/s+2:p=(e-n)/s+4,s/=v<.5?h+c:2-h-c,p*=60):s=v>0&&v<1?0:p,new Ao(p,s,v,t.opacity)}function HZ(t,e,n,r){return arguments.length===1?i3(t):new Ao(t,e,n,r??1)}function Ao(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Wb(Ao,HZ,n3(Bp,{brighter(t){return t=t==null?ey:Math.pow(ey,t),new Ao(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?yp:Math.pow(yp,t),new Ao(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,c=2*n-r;return new Ls(Kv(t>=240?t-240:t+120,c,r),Kv(t,c,r),Kv(t<120?t+240:t-120,c,r),this.opacity)},clamp(){return new Ao(dM(this.h),qg(this.s),qg(this.l),ny(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=ny(this.opacity);return`${t===1?"hsl(":"hsla("}${dM(this.h)}, ${qg(this.s)*100}%, ${qg(this.l)*100}%${t===1?")":`, ${t})`}`}}));function dM(t){return t=(t||0)%360,t<0?t+360:t}function qg(t){return Math.max(0,Math.min(1,t||0))}function Kv(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}function WZ(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function r3(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}function qZ(t,e,n,r,c){var h=t*t,p=h*t;return((1-3*t+3*h-p)*e+(4-6*h+3*p)*n+(1+3*t+3*h-3*p)*r+p*c)/6}function ZZ(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),c=t[r],h=t[r+1],p=r>0?t[r-1]:2*c-h,s=r<e-1?t[r+2]:2*h-c;return qZ((n-r/e)*e,p,c,h,s)}}const qb=t=>()=>t;function XZ(t,e){return function(n){return t+n*e}}function YZ(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function KZ(t){return(t=+t)==1?s3:function(e,n){return n-e?YZ(e,n,t):qb(isNaN(e)?n:e)}}function s3(t,e){var n=e-t;return n?XZ(t,n):qb(isNaN(t)?e:t)}const pM=function t(e){var n=KZ(e);function r(c,h){var p=n((c=ty(c)).r,(h=ty(h)).r),s=n(c.g,h.g),v=n(c.b,h.b),E=s3(c.opacity,h.opacity);return function(M){return c.r=p(M),c.g=s(M),c.b=v(M),c.opacity=E(M),c+""}}return r.gamma=t,r}(1);function JZ(t){return function(e){var n=e.length,r=new Array(n),c=new Array(n),h=new Array(n),p,s;for(p=0;p<n;++p)s=ty(e[p]),r[p]=s.r||0,c[p]=s.g||0,h[p]=s.b||0;return r=t(r),c=t(c),h=t(h),s.opacity=1,function(v){return s.r=r(v),s.g=c(v),s.b=h(v),s+""}}}var QZ=JZ(ZZ);function eX(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),c;return function(h){for(c=0;c<n;++c)r[c]=t[c]*(1-h)+e[c]*h;return r}}function tX(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function nX(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,c=new Array(r),h=new Array(n),p;for(p=0;p<r;++p)c[p]=Yh(t[p],e[p]);for(;p<n;++p)h[p]=e[p];return function(s){for(p=0;p<r;++p)h[p]=c[p](s);return h}}function iX(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function iy(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function rX(t,e){var n={},r={},c;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(c in e)c in t?n[c]=Yh(t[c],e[c]):r[c]=e[c];return function(h){for(c in n)r[c]=n[c](h);return r}}var x1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Jv=new RegExp(x1.source,"g");function sX(t){return function(){return t}}function oX(t){return function(e){return t(e)+""}}function aX(t,e){var n=x1.lastIndex=Jv.lastIndex=0,r,c,h,p=-1,s=[],v=[];for(t=t+"",e=e+"";(r=x1.exec(t))&&(c=Jv.exec(e));)(h=c.index)>n&&(h=e.slice(n,h),s[p]?s[p]+=h:s[++p]=h),(r=r[0])===(c=c[0])?s[p]?s[p]+=c:s[++p]=c:(s[++p]=null,v.push({i:p,x:iy(r,c)})),n=Jv.lastIndex;return n<e.length&&(h=e.slice(n),s[p]?s[p]+=h:s[++p]=h),s.length<2?v[0]?oX(v[0].x):sX(e):(e=v.length,function(E){for(var M=0,I;M<e;++M)s[(I=v[M]).i]=I.x(E);return s.join("")})}function Yh(t,e){var n=typeof e,r;return e==null||n==="boolean"?qb(e):(n==="number"?iy:n==="string"?(r=Uh(e))?(e=r,pM):aX:e instanceof Uh?pM:e instanceof Date?iX:tX(e)?eX:Array.isArray(e)?nX:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?rX:iy)(t,e)}function Zb(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function lX(t,e){e===void 0&&(e=t,t=Yh);for(var n=0,r=e.length-1,c=e[0],h=new Array(r<0?0:r);n<r;)h[n]=t(c,c=e[++n]);return function(p){var s=Math.max(0,Math.min(r-1,Math.floor(p*=r)));return h[s](p-s)}}function cX(t){return function(){return t}}function uX(t){return+t}var mM=[0,1];function oa(t){return t}function b1(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:cX(isNaN(e)?NaN:.5)}function hX(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function fX(t,e,n){var r=t[0],c=t[1],h=e[0],p=e[1];return c<r?(r=b1(c,r),h=n(p,h)):(r=b1(r,c),h=n(h,p)),function(s){return h(r(s))}}function dX(t,e,n){var r=Math.min(t.length,e.length)-1,c=new Array(r),h=new Array(r),p=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++p<r;)c[p]=b1(t[p],t[p+1]),h[p]=n(e[p],e[p+1]);return function(s){var v=PZ(t,s,1,r)-1;return h[v](c[v](s))}}function pX(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function mX(){var t=mM,e=mM,n=Yh,r,c,h,p=oa,s,v,E;function M(){var R=Math.min(t.length,e.length);return p!==oa&&(p=hX(t[0],t[R-1])),s=R>2?dX:fX,v=E=null,I}function I(R){return R==null||isNaN(R=+R)?h:(v||(v=s(t.map(r),e,n)))(r(p(R)))}return I.invert=function(R){return p(c((E||(E=s(e,t.map(r),iy)))(R)))},I.domain=function(R){return arguments.length?(t=Array.from(R,uX),M()):t.slice()},I.range=function(R){return arguments.length?(e=Array.from(R),M()):e.slice()},I.rangeRound=function(R){return e=Array.from(R),n=Zb,M()},I.clamp=function(R){return arguments.length?(p=R?!0:oa,M()):p!==oa},I.interpolate=function(R){return arguments.length?(n=R,M()):n},I.unknown=function(R){return arguments.length?(h=R,I):h},function(R,N){return r=R,c=N,M()}}function gX(){return mX()(oa,oa)}function _X(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function ry(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Vh(t){return t=ry(Math.abs(t)),t?t[1]:NaN}function yX(t,e){return function(n,r){for(var c=n.length,h=[],p=0,s=t[0],v=0;c>0&&s>0&&(v+s+1>r&&(s=Math.max(1,r-v)),h.push(n.substring(c-=s,c+s)),!((v+=s+1)>r));)s=t[p=(p+1)%t.length];return h.reverse().join(e)}}function vX(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var xX=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function sy(t){if(!(e=xX.exec(t)))throw new Error("invalid format: "+t);var e;return new Xb({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}sy.prototype=Xb.prototype;function Xb(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Xb.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function bX(t){e:for(var e=t.length,n=1,r=-1,c;n<e;++n)switch(t[n]){case".":r=c=n;break;case"0":r===0&&(r=n),c=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(c+1):t}var o3;function wX(t,e){var n=ry(t,e);if(!n)return t+"";var r=n[0],c=n[1],h=c-(o3=Math.max(-8,Math.min(8,Math.floor(c/3)))*3)+1,p=r.length;return h===p?r:h>p?r+new Array(h-p+1).join("0"):h>0?r.slice(0,h)+"."+r.slice(h):"0."+new Array(1-h).join("0")+ry(t,Math.max(0,e+h-1))[0]}function gM(t,e){var n=ry(t,e);if(!n)return t+"";var r=n[0],c=n[1];return c<0?"0."+new Array(-c).join("0")+r:r.length>c+1?r.slice(0,c+1)+"."+r.slice(c+1):r+new Array(c-r.length+2).join("0")}const _M={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:_X,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>gM(t*100,e),r:gM,s:wX,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function yM(t){return t}var vM=Array.prototype.map,xM=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function EX(t){var e=t.grouping===void 0||t.thousands===void 0?yM:yX(vM.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",c=t.decimal===void 0?".":t.decimal+"",h=t.numerals===void 0?yM:vX(vM.call(t.numerals,String)),p=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"\u2212":t.minus+"",v=t.nan===void 0?"NaN":t.nan+"";function E(I){I=sy(I);var R=I.fill,N=I.align,$=I.sign,Z=I.symbol,ne=I.zero,me=I.width,we=I.comma,he=I.precision,Pe=I.trim,ge=I.type;ge==="n"?(we=!0,ge="g"):_M[ge]||(he===void 0&&(he=12),Pe=!0,ge="g"),(ne||R==="0"&&N==="=")&&(ne=!0,R="0",N="=");var nt=Z==="$"?n:Z==="#"&&/[boxX]/.test(ge)?"0"+ge.toLowerCase():"",Tt=Z==="$"?r:/[%p]/.test(ge)?p:"",Rt=_M[ge],ke=/[defgprs%]/.test(ge);he=he===void 0?6:/[gprs]/.test(ge)?Math.max(1,Math.min(21,he)):Math.max(0,Math.min(20,he));function It(xt){var gn=nt,an=Tt,ln,$t,Mn;if(ge==="c")an=Rt(xt)+an,xt="";else{xt=+xt;var yn=xt<0||1/xt<0;if(xt=isNaN(xt)?v:Rt(Math.abs(xt),he),Pe&&(xt=bX(xt)),yn&&+xt==0&&$!=="+"&&(yn=!1),gn=(yn?$==="("?$:s:$==="-"||$==="("?"":$)+gn,an=(ge==="s"?xM[8+o3/3]:"")+an+(yn&&$==="("?")":""),ke){for(ln=-1,$t=xt.length;++ln<$t;)if(Mn=xt.charCodeAt(ln),48>Mn||Mn>57){an=(Mn===46?c+xt.slice(ln+1):xt.slice(ln))+an,xt=xt.slice(0,ln);break}}}we&&!ne&&(xt=e(xt,1/0));var vn=gn.length+xt.length+an.length,Bn=vn<me?new Array(me-vn+1).join(R):"";switch(we&&ne&&(xt=e(Bn+xt,Bn.length?me-an.length:1/0),Bn=""),N){case"<":xt=gn+xt+an+Bn;break;case"=":xt=gn+Bn+xt+an;break;case"^":xt=Bn.slice(0,vn=Bn.length>>1)+gn+xt+an+Bn.slice(vn);break;default:xt=Bn+gn+xt+an;break}return h(xt)}return It.toString=function(){return I+""},It}function M(I,R){var N=E((I=sy(I),I.type="f",I)),$=Math.max(-8,Math.min(8,Math.floor(Vh(R)/3)))*3,Z=Math.pow(10,-$),ne=xM[8+$/3];return function(me){return N(Z*me)+ne}}return{format:E,formatPrefix:M}}var Zg,a3,l3;TX({thousands:",",grouping:[3],currency:["$",""]});function TX(t){return Zg=EX(t),a3=Zg.format,l3=Zg.formatPrefix,Zg}function AX(t){return Math.max(0,-Vh(Math.abs(t)))}function SX(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Vh(e)/3)))*3-Vh(Math.abs(t)))}function MX(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Vh(e)-Vh(t))+1}function PX(t,e,n,r){var c=RZ(t,e,n),h;switch(r=sy(r??",f"),r.type){case"s":{var p=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(h=SX(c,p))&&(r.precision=h),l3(r,p)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(h=MX(c,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=h-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(h=AX(c))&&(r.precision=h-(r.type==="%")*2);break}}return a3(r)}function Yb(t){var e=t.domain;return t.ticks=function(n){var r=e();return kZ(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var c=e();return PX(c[0],c[c.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),c=0,h=r.length-1,p=r[c],s=r[h],v,E,M=10;for(s<p&&(E=p,p=s,s=E,E=c,c=h,h=E);M-- >0;){if(E=v1(p,s,n),E===v)return r[c]=p,r[h]=s,e(r);if(E>0)p=Math.floor(p/E)*E,s=Math.ceil(s/E)*E;else if(E<0)p=Math.ceil(p*E)/E,s=Math.floor(s*E)/E;else break;v=E}return t},t}function c3(){var t=gX();return t.copy=function(){return pX(t,c3())},WZ.apply(t,arguments),Yb(t)}function IX(){var t=0,e=1,n,r,c,h,p=oa,s=!1,v;function E(I){return I==null||isNaN(I=+I)?v:p(c===0?.5:(I=(h(I)-n)*c,s?Math.max(0,Math.min(1,I)):I))}E.domain=function(I){return arguments.length?([t,e]=I,n=h(t=+t),r=h(e=+e),c=n===r?0:1/(r-n),E):[t,e]},E.clamp=function(I){return arguments.length?(s=!!I,E):s},E.interpolator=function(I){return arguments.length?(p=I,E):p};function M(I){return function(R){var N,$;return arguments.length?([N,$]=R,p=I(N,$),E):[p(0),p(1)]}}return E.range=M(Yh),E.rangeRound=M(Zb),E.unknown=function(I){return arguments.length?(v=I,E):v},function(I){return h=I,n=I(t),r=I(e),c=n===r?0:1/(r-n),E}}function u3(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function h3(){var t=Yb(IX()(oa));return t.copy=function(){return u3(t,h3())},r3.apply(t,arguments)}function CX(){var t=0,e=.5,n=1,r=1,c,h,p,s,v,E=oa,M,I=!1,R;function N(Z){return isNaN(Z=+Z)?R:(Z=.5+((Z=+M(Z))-h)*(r*Z<r*h?s:v),E(I?Math.max(0,Math.min(1,Z)):Z))}N.domain=function(Z){return arguments.length?([t,e,n]=Z,c=M(t=+t),h=M(e=+e),p=M(n=+n),s=c===h?0:.5/(h-c),v=h===p?0:.5/(p-h),r=h<c?-1:1,N):[t,e,n]},N.clamp=function(Z){return arguments.length?(I=!!Z,N):I},N.interpolator=function(Z){return arguments.length?(E=Z,N):E};function $(Z){return function(ne){var me,we,he;return arguments.length?([me,we,he]=ne,E=lX(Z,[me,we,he]),N):[E(0),E(.5),E(1)]}}return N.range=$(Yh),N.rangeRound=$(Zb),N.unknown=function(Z){return arguments.length?(R=Z,N):R},function(Z){return M=Z,c=Z(t),h=Z(e),p=Z(n),s=c===h?0:.5/(h-c),v=h===p?0:.5/(p-h),r=h<c?-1:1,N}}function w1(){var t=Yb(CX()(oa));return t.copy=function(){return u3(t,w1())},r3.apply(t,arguments)}const ih="https://basemaps.cartocdn.com/gl/{basemap}-gl-style/style.json",Qv={VOYAGER:ih.replace("{basemap}","voyager"),POSITRON:ih.replace("{basemap}","positron"),DARK_MATTER:ih.replace("{basemap}","dark-matter"),VOYAGER_NOLABELS:ih.replace("{basemap}","voyager-nolabels"),POSITRON_NOLABELS:ih.replace("{basemap}","positron-nolabels"),DARK_MATTER_NOLABELS:ih.replace("{basemap}","dark-matter-nolabels")};function LX({map:t,gl:e,deck:n}){if(t.__deck)return t.__deck;const r=n?.props._customRender,c=kX({...n?.props,_customRender:()=>{t.triggerRepaint(),r?.("")}});let h;return(!n||n.props.gl===e)&&(Object.assign(c,{gl:e,width:null,height:null,touchAction:"unset",viewState:Kb(t)}),t.on("move",()=>NX(h,t))),n?(h=n,n.setProps(c),n.userData.isExternal=!0):(h=new Fb(c),t.on("remove",()=>{h.finalize(),t.__deck=null})),h.userData.mapboxLayers=new Set,h.userData.mapboxVersion=BX(t),t.__deck=h,t.on("render",()=>{h.isInitialized&&FX(h,t)}),h}function kX(t){const e="useDevicePixels"in t?t.useDevicePixels:!0;return{...t,useDevicePixels:e,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...t.parameters},views:t.views||[new zb({id:"mapbox"})]}}function RX(t,e){t.userData.mapboxLayers.add(e),Jb(t)}function OX(t,e){t.userData.mapboxLayers.delete(e),Jb(t)}function DX(t,e){Jb(t)}function zX(t,e,n){let{currentViewport:r}=t.userData,c=!1;r||(r=f3(t,e,!0),t.userData.currentViewport=r,c=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:({layer:h})=>n.id===h.id,clearStack:c,clearCanvas:!1})}function Kb(t){const{lng:e,lat:n}=t.getCenter();return{longitude:(e+540)%360-180,latitude:n,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()}}function BX(t){let e=0,n=0;const r=t.version;return r&&([e,n]=r.split(".").slice(0,2).map(Number)),{major:e,minor:n}}function f3(t,e,n=!0){const{mapboxVersion:r}=t.userData;return new Ba(Object.assign({id:"mapbox",x:0,y:0,width:t.width,height:t.height},Kb(e),n?{nearZMultiplier:r.major===1&&r.minor>=3||r.major>=2?.02:1/(t.height||1)}:{nearZMultiplier:.1}))}function FX(t,e){const{mapboxLayers:n,isExternal:r}=t.userData;if(r){const c=Array.from(n,M=>M.id),p=Ob(t.props.layers,Boolean).some(M=>M&&!c.includes(M.id));let s=t.getViewports();const v=s.findIndex(M=>M.id==="mapbox"),E=s.length>1||v<0;(p||E)&&(v>=0&&(s=s.slice(),s[v]=f3(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:s,layerFilter:M=>(!t.props.layerFilter||t.props.layerFilter(M))&&(M.viewport.id!=="mapbox"||!c.includes(M.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function NX(t,e){t.setProps({viewState:Kb(e)}),t.needsRedraw({clearRedrawFlags:!0})}function Jb(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(n=>{const r=n.props.type,c=new r(n.props);e.push(c)}),t.setProps({layers:e})}class bM{constructor(e){if(Y(this,"id",void 0),Y(this,"type",void 0),Y(this,"renderingMode",void 0),Y(this,"map",void 0),Y(this,"deck",void 0),Y(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,n){this.map=e,this.deck=LX({map:e,gl:n,deck:this.props.deck}),RX(this.deck,this)}onRemove(){this.deck&&OX(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&DX(this.deck)}render(){zX(this.deck,this.map,this)}}var wM={},ex={},tx=34,Td=10,nx=13;function d3(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function UX(t,e){var n=d3(t);return function(r,c){return e(n(r),c,t)}}function EM(t){var e=Object.create(null),n=[];return t.forEach(function(r){for(var c in r)c in e||n.push(e[c]=c)}),n}function Ms(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function VX(t){return t<0?"-"+Ms(-t,6):t>9999?"+"+Ms(t,6):Ms(t,4)}function jX(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),c=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":VX(t.getUTCFullYear())+"-"+Ms(t.getUTCMonth()+1,2)+"-"+Ms(t.getUTCDate(),2)+(c?"T"+Ms(e,2)+":"+Ms(n,2)+":"+Ms(r,2)+"."+Ms(c,3)+"Z":r?"T"+Ms(e,2)+":"+Ms(n,2)+":"+Ms(r,2)+"Z":n||e?"T"+Ms(e,2)+":"+Ms(n,2)+"Z":"")}function GX(t){var e=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function r(I,R){var N,$,Z=c(I,function(ne,me){if(N)return N(ne,me-1);$=ne,N=R?UX(ne,R):d3(ne)});return Z.columns=$||[],Z}function c(I,R){var N=[],$=I.length,Z=0,ne=0,me,we=$<=0,he=!1;I.charCodeAt($-1)===Td&&--$,I.charCodeAt($-1)===nx&&--$;function Pe(){if(we)return ex;if(he)return he=!1,wM;var nt,Tt=Z,Rt;if(I.charCodeAt(Tt)===tx){for(;Z++<$&&I.charCodeAt(Z)!==tx||I.charCodeAt(++Z)===tx;);return(nt=Z)>=$?we=!0:(Rt=I.charCodeAt(Z++))===Td?he=!0:Rt===nx&&(he=!0,I.charCodeAt(Z)===Td&&++Z),I.slice(Tt+1,nt-1).replace(/""/g,'"')}for(;Z<$;){if((Rt=I.charCodeAt(nt=Z++))===Td)he=!0;else if(Rt===nx)he=!0,I.charCodeAt(Z)===Td&&++Z;else if(Rt!==n)continue;return I.slice(Tt,nt)}return we=!0,I.slice(Tt,$)}for(;(me=Pe())!==ex;){for(var ge=[];me!==wM&&me!==ex;)ge.push(me),me=Pe();R&&(ge=R(ge,ne++))==null||N.push(ge)}return N}function h(I,R){return I.map(function(N){return R.map(function($){return M(N[$])}).join(t)})}function p(I,R){return R==null&&(R=EM(I)),[R.map(M).join(t)].concat(h(I,R)).join(`
`)}function s(I,R){return R==null&&(R=EM(I)),h(I,R).join(`
`)}function v(I){return I.map(E).join(`
`)}function E(I){return I.map(M).join(t)}function M(I){return I==null?"":I instanceof Date?jX(I):e.test(I+="")?'"'+I.replace(/"/g,'""')+'"':I}return{parse:r,parseRows:c,format:p,formatBody:s,formatRows:v,formatRow:E,formatValue:M}}var $X=GX(","),HX=$X.parse;function WX(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function qX(t,e){return fetch(t,e).then(WX)}function ZX(t){return function(e,n,r){return arguments.length===2&&typeof n=="function"&&(r=n,n=void 0),qX(e,n).then(function(c){return t(c,r)})}}var p3=ZX(HX);function Fp(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}const XX=t=>QZ(t[t.length-1]);var YX=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(Fp);const KX=XX(YX);function zy(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}zy(Fp("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var JX=zy(Fp("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));zy(Fp("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));zy(Fp("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function uh(t,e,n){this.k=t,this.x=e,this.y=n}uh.prototype={constructor:uh,scale:function(t){return t===1?this:new uh(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new uh(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};new uh(1,0,0);uh.prototype;const QX=(t,e)=>n=>t(e(n)),TM=t=>{const e=Uh(t),n=Math.trunc(e.opacity);return[e.r/255,e.g/255,e.b/255,n]},eY=(t,e)=>{const n=e-t;return()=>t+Math.random()*n},tY=(t,e)=>{const n=eY(t,e);return()=>Math.floor(n())},nY=t=>{const e=tY(0,t.length);return()=>t[e()]},iY=t=>e=>e.geometry.type==t,m3=async t=>await(await fetch(t)).json(),Qb=t=>async e=>(await m3(e)).features.filter(iY(t)),rY=Qb("Point"),sY=Qb("LineString"),oY=Qb("Polygon"),aY=async t=>{console.log("loadNetworkNodes",t);const e=await rY(t+"/nodes.geojson");return console.log("Number of Nodes:",e.length),e},lY=async t=>{console.log("loadNetworkEdges",t);const e=await sY(t+"/edges.geojson");return console.log("Number of Edges:",e.length),e},cY=async t=>{console.log("loadNetworkZones",t);const e=await oY(t+"/aggrid_polygon.geojson");return console.log("Number of Zones:",e.length),e},uY=(t,e)=>t.from==e.from&&t.to==e.to,hY=(t,e)=>{const n=r=>Math.trunc(parseFloat(r));return n(t.fishnetid)==n(e.fishnetid)},fY=uY,dY=hY,By="/RapidexVis/data",ew=({networkId:t})=>`${By}/networks/${t}`,pY=({networkId:t,modelId:e})=>`${By}/networks/${t}/models/${e}`,g3=({networkId:t,modelId:e,assignmentId:n})=>`${By}/networks/${t}/models/${e}/assignments/${n}`;async function mY(t){return await aY(ew(t))}async function gY(t){return await lY(ew(t))}async function _Y(t){return await cY(ew(t))}async function yY(t,e,n){const{modelId:r,assignmentId:c}=t;return e.every((h,p)=>{const s=h.properties,E=n({},h);return db(s,["models",r,"assignments",c],E),!0}),e}async function vY(t,e,n){const{modelId:r,assignmentId:c}=t,h=await p3(`${g3(t)}/link_emissions.csv`,KI);return e.every((p,s)=>{const v=p.properties,E=h[s];if(!fY(v,E))return console.error(`Mismatched link at ${s}.`,v,E),!1;const M=n(E,p);return db(v,["models",r,"assignments",c],M),!0}),e}async function xY(t,e,n){const{modelId:r,assignmentId:c}=t,h=await p3(`${g3(t)}/zone_emissions.csv`,KI);return e.every((p,s)=>{const v=p.properties,E=h[s];if(!dY(v,E))return console.error(`Mismatched zone at ${s}.`,v,E),!1;const M=n(E,p);return db(v,["models",r,"assignments",c],M),!0}),e}const ix={nodes:mY,links:gY,zones:_Y},rx={nodes:yY,links:vY,zones:xY},bY={nodes:(t,e)=>t,links:(t,e)=>{const n=e.properties;t.volume=parseFloat(t.volume);const r=t.volume/n.capacity;return t.volume_capacity={ratio:r},t},zones:(t,e)=>(e.properties,t.emissions=parseFloat(t.co2psqkm),t)};async function*wY(t,e,n=bY){const c=await(await fetch(`${pY(t)}/assignments/index.json`)).json();for(const{path:h}of c){const[p,s]=E4(h),v={...t,assignmentId:s};await Promise.all([rx.nodes(v,e.nodes,n.nodes),rx.links(v,e.links,n.links),rx.zones(v,e.zones,n.zones)]),yield v}}async function EY(t){const[e,n,r]=await Promise.all([ix.nodes(t),ix.links(t),ix.zones(t)]);return{nodes:e,links:n,zones:r}}const cs=t=>(rD("data-v-30fee287"),t=t(),sD(),t),TY={class:"flex-grow flex flex-row"},AY={class:"flex-grow flex flex-col"},SY={key:0,class:"flex flex-row h-8 p-2 bg-slate-700 text-slate-400 items-center"},MY={class:"flex-grow bg-slate-200 relative"},PY={class:"absolute top-auto bottom-0 left-1/2 transform -translate-x-1/2 flex flex-row items-center p-4 md:top-0 md:bottom-auto md:left-0 md:transform-none"},IY={class:"absolute top-0 left-1/2 transform -translate-x-1/2 text-slate-200"},CY={class:"flex flex-row items-center my-6 gap-4"},LY={id:"dropdownDefaultButton","data-dropdown-toggle":"dropdown",class:"bg-neutral-900/80 rounded-lg text-white text-3xl px-4 py-2 text-center inline-flex items-center",type:"button"},kY={class:"mx-2"},RY={id:"dropdown",class:"z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-64 dark:bg-gray-700"},OY={class:"py-2 text-2xl text-gray-700 dark:text-gray-200","aria-labelledby":"dropdownDefaultButton"},DY=["onClick"],zY={class:"opacity-50 hover:opacity-100",type:"button","data-modal-toggle":"modal","data-modal-target":"modal"},BY={class:"absolute top-0 right-0 px-2 py-6 mt-24"},FY={class:"flex flex-col items-center gap-4"},NY=cs(()=>en("img",{class:"h-9 w-9 opacity-75 hover:opacity-100",src:S4,alt:"Orbit"},null,-1)),UY=[NY],VY={key:0,class:"absolute top-0 w-full"},jY=cs(()=>en("div",{class:"relative overflow-hidden h-1 bg-slate-700"},[en("div",{class:"absolute bottom-0 top-0 bg-slate-500 w-1/2 animate-indeterminate-progress"})],-1)),GY=[jY],$Y={class:"flex flex-row h-16 p-2 bg-slate-700 items-center overflow-hidden"},HY=cs(()=>en("img",{class:"h-14 w-14",src:M4,alt:"Nachfrage Verringern"},null,-1)),WY=[HY],qY=cs(()=>en("img",{class:"h-14 w-14",src:P4,alt:"Nachfrage Erh\xF6hen"},null,-1)),ZY=[qY],XY={id:"modal",tabindex:"-1","aria-hidden":"true",class:"dlg hidden h-[calc(100%-1rem)] md:h-full"},YY={class:"relative w-full h-full max-w-2xl md:h-auto"},KY={class:"relative bg-white rounded-lg shadow dark:bg-gray-700"},JY={class:"flex items-start justify-between p-5 border-b rounded-t dark:border-gray-600"},QY=["textContent"],eK={id:"closeButton","data-modal-hide":"modal",type:"button",class:"text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white"},tK={class:"p-6 space-y-6"},nK=["innerHTML"],iK={key:0,class:"flex flex-col gap-y-2 h-full w-64 bg-slate-400 p-2 overflow-hidden"},rK=cs(()=>en("h4",null,"General",-1)),sK={class:"lbl",for:"general-style"},oK=["value"],aK=cs(()=>en("h4",null,"Idle",-1)),lK={class:"lbl",for:"general-idle-duration"},cK={class:"lbl",for:"general-idle-wait"},uK=cs(()=>en("h4",null,"Nodes",-1)),hK=["disabled"],fK=cs(()=>en("label",{class:"m-2",for:"checkbox"},"Visible",-1)),dK=cs(()=>en("h4",null,"Links",-1)),pK=cs(()=>en("label",{class:"lbl",for:"link-scale"},"Scale",-1)),mK=cs(()=>en("label",{class:"lbl",for:"link-min-size"},"Size",-1)),gK={class:"flex flex-row gap-2"},_K=["disabled"],yK=cs(()=>en("label",{class:"m-2",for:"links-visible"},"Visible",-1)),vK=cs(()=>en("h4",null,"Zones",-1)),xK=["disabled"],bK=cs(()=>en("label",{class:"m-2",for:"zones-visible"},"Visible",-1)),wK=cs(()=>en("h4",null,"Interactions",-1)),EK=cs(()=>en("button",{class:"btn mx-2",type:"button","data-modal-toggle":"modal","data-modal-target":"modal"},"Show Info",-1)),TK={__name:"CosmoView",props:{networkId:{type:String,required:!0},modelId:{type:String,required:!1}},setup(t){const e=t,n=BB(),r=$r(n.query.debug),c={overlay:!1,interleaved:!1,preserveDrawingBuffer:!1,useWebGL2:!0},h=[{title:"Athens",params:{networkId:"Athens",modelId:"2023"}},{title:"Auckland",params:{networkId:"Auckland",modelId:"2021"}},{title:"Buenos Aires",params:{networkId:"Buenos_Aires",modelId:"2021"}},{title:"Chios",params:{networkId:"Chios",modelId:"2023"}},{title:"Dresden",params:{networkId:"Dresden",modelId:"2023"}},{title:"Dubai",params:{networkId:"Dubai",modelId:"2021"}},{title:"Hong Kong",params:{networkId:"Hong_Kong",modelId:"2021"}},{title:"London",params:{networkId:"London",modelId:"2021"}},{title:"Manila",params:{networkId:"Manila",modelId:"2021"}},{title:"Montreal",params:{networkId:"Montreal",modelId:"2021"}},{title:"Paris",params:{networkId:"Paris",modelId:"2021"}}],p={position:[0,0],color:[1,1,1,1],size:1,value:0},s={position:[0,0],color:[1,1,1,.1],size:1,value:0},v=[1,5],E={links:{volume_capacity:[v[1],v[0],0],traveltime_ratio:[3,1.5,.75]},zones:{emissions:[0,15e6]}},I={empty:()=>[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],append:(et,J)=>[Math.min(et[0],J[0]),Math.max(et[1],J[1])]},R={traveltime_ratio:I.empty(),volume_capacity:I.empty(),emissions:I.empty()},N={projection:"mercator",style:"mapbox://styles/mapbox/dark-v11",viewState:{longitude:13.79,latitude:51.07,zoom:11,pitch:0,bearing:0}},$=zB(),Z=$r(null);$r(null);const ne=ua({values:[{nodes:{meta:{},data:[]},links:{meta:{},data:[]},zones:{meta:{},data:[]}}],progress:{options:{range:{min:0,max:100},start:50,step:.1},value:50},index:{value:Ri(()=>{const et=ne.progress,J=et.options.range,G=J.max-J.min,Fe=et.value-J.min,gt=ne.values.length-1;return Math.trunc(gt*(Fe/G))})},currentValue:Ri(()=>ne.values[ne.index.value]),currentNodeMeta:Ri(()=>ne.currentValue.nodes.meta),currentNodeData:Ri(()=>ne.currentValue.nodes.data),currentLinkMeta:Ri(()=>ne.currentValue.links.meta),currentLinkData:Ri(()=>ne.currentValue.links.data),currentZoneMeta:Ri(()=>ne.currentValue.zones.meta),currentZoneData:Ri(()=>ne.currentValue.zones.data)}),me={_pathType:"open",widthScale:10,widthMinPixels:3,widthMaxPixels:100,visible:!0},we={pickable:!0,extruded:!1,elevationScale:1e4,_normalize:!1,visible:!1},Pe=[fN(pb.exports.NavigationControl)],ge={nodes:{instance:void 0,props:{}},links:{instance:void 0,props:{}},zones:{instance:void 0,props:{}}};ge.links=aA(bM,{...me,type:Gb,id:"edge-layer",data:Eo(ne,"currentLinkData")}),ge.zones=aA(bM,{...we,type:Hb,id:"zone-layer",data:Eo(ne,"currentZoneData")});const nt=(et,J)=>{const G=J.find(sn=>sn.type==="symbol").id,Fe=.25,gt=15,ct=gt+Fe;et.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:gt,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","min_height"],"fill-extrusion-opacity":["interpolate",["linear"],["zoom"],gt,0,ct,.6]}},G)},Tt=(et,J)=>{for(const G of J)G.type==="symbol"&&G.layout["text-field"]&&et.removeLayer(G.id)},Rt=dN({container:Z,projection:N.projection,style:N.style,viewState:{...N.viewState},controls:Pe,on:{load:()=>{const et=Rt.instance.value,J=et.getStyle().layers;nt(et,J),Tt(et,J),et.addLayer(ge.zones.instance.value),et.addLayer(ge.links.instance.value)}},touchPitch:!0,touchZoomRotate:!0,preserveDrawingBuffer:c.preserveDrawingBuffer,useWebGL2:c.useWebGL2}),ke=ua({networks:h,locale:"en",info:{de:{},en:{}},localInfo:Ri(()=>ke.info[ke.locale]),options:{style:{label:"Style",value:Eo(Rt.props,"style"),options:[{title:"Dark Matter",value:Qv.DARK_MATTER_NOLABELS},{title:"Positron",value:Qv.POSITRON_NOLABELS},{title:"Voyager",value:Qv.VOYAGER_NOLABELS},{title:"Mapbox Light",value:"mapbox://styles/mapbox/light-v11"},{title:"Mapbox Dark",value:"mapbox://styles/mapbox/dark-v11"},{title:"Custom",value:"mapbox://styles/filonik-tud/cle8nbyfg00cv01tea1x4jz3u"}]},idle:{duration:{label:"Duration",value:60*5},wait:{label:"Wait",value:60*5}},nodes:{visible:{label:"Visible",value:Eo(ge.nodes.props,"visible")},disabled:{value:Ri(()=>!ne.currentNodeData)}},links:{width:{scale:{value:Eo(ge.links.props,"widthScale")},pixels:{range:{0:Eo(ge.links.props,"widthMinPixels"),1:Eo(ge.links.props,"widthMaxPixels")}},minPixels:{value:Eo(ge.links.props,"widthMinPixels")},maxPixels:{value:Eo(ge.links.props,"widthMaxPixels")}},filter:{min:0,max:9,step:.01,range:Eo(ge.links.props,"filterRange")},visible:{label:"Visible",value:Ri({get:()=>ge.links.props.visible,set:et=>{ge.links.props.visible=et,ge.zones.props.visible=!et}})},disabled:{value:Ri(()=>!ne.currentLinkData)}},zones:{visible:{label:"Visible",value:Ri({get:()=>ge.zones.props.visible,set:et=>{ge.links.props.visible=!et,ge.zones.props.visible=et}})},disabled:{value:Ri(()=>!ne.currentZoneData)}}},animateOrbit:!1,animateTimeline:!1,progress:Eo(ne,"progress"),loading:!1}),It={position:et=>["getPath",{value:new Float32Array(et.flat(2)),size:et[0]?.[0]?.length??2}],color:et=>["getColor",{value:new Float32Array(et.flat(2)),size:et[0]?.[0]?.length??4}],size:et=>["getWidth",{value:new Float32Array(et.flat(1)),size:1}],value:et=>["getFilterValue",{value:new Float32Array(et.flat(1)),size:1}]},xt={position:et=>["getPolygon",{value:new Float32Array(et.flat(3)),size:et[0]?.[0]?.[0]?.length??2}],color:et=>["getFillColor",{value:new Float32Array(et.flat(3)),size:et[0]?.[0]?.[0]?.length??4}],size:et=>["getElevation",{value:new Float32Array(et.flat(2)),size:1}],value:et=>["getFilterValue",{value:new Float32Array(et.flat(2)),size:1}]},gn=D_(([et,J])=>It[et](J)),an=D_(([et,J])=>xt[et](J)),ln=et=>J=>ap(Fe=>et.map((gt,ct)=>gt.geometry.coordinates.map(Fe(gt,ct))))(J),$t=et=>J=>ap(Fe=>et.map((gt,ct)=>gt.geometry.coordinates.map((sn,fn)=>sn.map(Fe(gt,ct)))))(J),Mn=et=>J=>{const G=ln(et)(J),Fe=new Uint32Array(et.reduce((ct,sn)=>{const fn=sn.geometry.coordinates,$n=ct[ct.length-1],nn=fn.length;return ct.push($n+nn),ct},[0]));return{length:et.length,startIndices:Fe,attributes:gn(G)}},yn=et=>J=>{const G=$t(et)(J),Fe=new Uint32Array(et.reduce((ct,sn)=>(sn.geometry.coordinates.forEach((fn,$n)=>{const nn=ct[ct.length-1],ei=fn.length;ct.push(nn+ei)}),ct),[0]));return{length:et.length,startIndices:Fe,attributes:an(G)}},vn=et=>J=>({...et,attributes:{...et.attributes,...J}}),Bn=et=>J=>G=>{const Fe=ln(J)(G);return vn(et)(gn(Fe))},Wn=et=>J=>G=>{const Fe=$t(J)(G);return vn(et)(an(Fe))},pi=et=>J=>QX(et,J),Kn=pi(TM)(KX),Ii=pi(TM)(JX),vi=h3(Ii).domain(E.zones.emissions),lt=c3().range([.1,.4]).domain(E.zones.emissions),zt=(et,J)=>G=>{const Fe=et(G),gt=J(G);return[Fe[0],Fe[1],Fe[2],gt]},yt={colors:{traveltime_ratio:w1(Kn).domain(E.links.traveltime_ratio),volume_capacity:w1(Kn).domain(E.links.volume_capacity),emissions:zt(vi,lt)}},Ft=et=>J=>G=>(R[et]=I.append(R[et],[G,G]),J(G));r.value&&(yt.colors.traveltime_ratio=Ft("traveltime_ratio")(yt.colors.traveltime_ratio),yt.colors.volume_capacity=Ft("volume_capacity")(yt.colors.volume_capacity),yt.colors.emissions=Ft("emissions")(yt.colors.emissions)),$r(null);const Jt={nodes:{},links:{color:{volume_capacity:({modelId:et,assignmentId:J})=>G=>{const Fe=G.properties.models[et].assignments[J].volume_capacity.ratio,gt=yt.colors.volume_capacity(Fe);return ct=>gt}}},zones:{color:{emissions:({modelId:et,assignmentId:J})=>G=>{const Fe=G.properties.models[et].assignments[J].emissions,gt=yt.colors.emissions(Fe);return ct=>gt}}}};qc(()=>{jI(),GI()});const xn=({networkId:et})=>`${By}/networks/${et}/info.json`;qc(async()=>{ke.info=await m3(xn(e)),N.viewState.longitude=(ke.info.bounds[0]+ke.info.bounds[2])/2,N.viewState.latitude=(ke.info.bounds[1]+ke.info.bounds[3])/2,dn(),ke.loading=!0;const et=await EY(e),J=void 0,G=Mn(et.links)({position:ct=>sn=>sn,color:ct=>sn=>p.color,size:ct=>sn=>p.size,value:ct=>sn=>p.value}),Fe=yn(et.zones)({position:ct=>sn=>sn,color:ct=>sn=>s.color,size:ct=>sn=>s.size,value:ct=>sn=>s.value});ne.values=Cd([{nodes:{meta:{},data:J},links:{meta:{},data:G},zones:{meta:{},data:Fe}}]);const gt=[];for await(const ct of wY(e,et)){const fn=Bn(G)(et.links)({color:Jt.links.color.volume_capacity(ct)}),$n=Wn(Fe)(et.zones)({color:Jt.zones.color.emissions(ct)});gt.push({nodes:{meta:ct,data:void 0},links:{meta:ct,data:fn},zones:{meta:ct,data:$n}}),ne.values=Cd([]),ne.values=Cd(gt)}console.log("Loaded",R),ke.loading=!1});const wn=et=>{ke.progress.value=et,ke.progress.options.start=et},ue={to:[50,100,50,0,50],duration:15e3,ease:[kx,rp,kx,rp],repeat:1/0,repeatDelay:500,repeatType:"mirror",onUpdate:wn};let Me;const Ve={from:0,to:1,duration:12e4,ease:eb,repeat:1/0,onPlay:()=>{Me=Rt.viewState.value},onUpdate:et=>{const J=Me.bearing+et*1e3%360;Rt.viewState.value={...Me,bearing:J}}},Qe={orbit:{playback:void 0,play:()=>{Qe.orbit.playback||(Qe.orbit.playback=E_(Ve))},stop:()=>{Qe.orbit.playback&&(Qe.orbit.playback.stop(),Qe.orbit.playback=void 0)}},timeline:{playback:void 0,play:()=>{Qe.timeline.playback||(Qe.timeline.playback=E_(ue))},stop:()=>{Qe.timeline.playback&&(Qe.timeline.playback.stop(),Qe.timeline.playback=void 0)}}},st=()=>{ke.animateOrbit=!ke.animateOrbit,ke.animateOrbit?Qe.orbit.play():Qe.orbit.stop()},St=()=>{ke.animateTimeline=!ke.animateTimeline,ke.animateTimeline?Qe.timeline.play():Qe.timeline.stop()},Dt=()=>{ke.animateOrbit=!1,Qe.orbit.stop(),ke.animateTimeline=!1,Qe.timeline.stop()},Pt=()=>{Dt()},Mt=async et=>{await $.push({name:"model",params:et}),$.go(0)},ht=nY(h),Zt=async()=>{const et=ht();Mt(et.params)},jt=()=>{const et=ke.progress.value-ke.progress.options.step*50;wn(Math.max(et,ke.progress.options.range.min))},tn=()=>{const et=ke.progress.value+ke.progress.options.step*50;wn(Math.min(et,ke.progress.options.range.max))},dn=()=>{Dt(),Rt.props.viewState={...N.viewState}};return(et,J)=>{const G=TD("v-idle");return Kr(),Is("div",TY,[en("div",AY,[r.value?(Kr(),Is("aside",SY,[en("pre",null,pl(ne.currentLinkMeta.assignmentId),1)])):sv("",!0),en("main",MY,[en("div",AP({class:"bg-stone-800 h-full w-full",ref_key:"containerRef",ref:Z},PD({mousedown:Pt,touchstart:Pt,wheel:Pt},!0),{onContextmenu:J[0]||(J[0]=Mz(()=>{},["prevent"]))}),null,16),en("div",PY,[gr(oA,{class:"mx-4 opacity-75 hover:opacity-100",modelValue:ke.options.links.visible.value,"onUpdate:modelValue":J[1]||(J[1]=Fe=>ke.options.links.visible.value=Fe)},{default:hx(({value:Fe})=>[en("img",{class:vh(["h-16 w-16",[Fe?"opacity-100":"opacity-25"]]),src:T4,alt:"Auslastung"},null,2)]),_:1},8,["modelValue"]),gr(oA,{class:"mx-2 opacity-75 hover:opacity-100",modelValue:ke.options.zones.visible.value,"onUpdate:modelValue":J[2]||(J[2]=Fe=>ke.options.zones.visible.value=Fe)},{default:hx(({value:Fe})=>[en("img",{class:vh(["h-16 w-16",[Fe?"opacity-100":"opacity-25"]]),src:A4,alt:"Emissionen"},null,2)]),_:1},8,["modelValue"])]),en("div",IY,[en("div",CY,[en("button",LY,[en("span",kY,pl(ke.localInfo.title),1),gr(hr(W6),{class:"text-white h-8 w-8"})]),en("div",RY,[en("ul",OY,[(Kr(!0),Is(Hs,null,HT(ke.networks,(Fe,gt)=>(Kr(),Is("li",{key:gt},[en("button",{class:"block w-full px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-600 dark:hover:text-white",onClick:ct=>Mt(Fe.params)},pl(Fe.title),9,DY)]))),128))])]),en("button",zY,[gr(hr(H6),{class:"text-white h-10 w-10"})]),gr(G,{events:["mousedown","touchstart","wheel"],onIdle:Zt,duration:ke.options.idle.duration.value,wait:ke.options.idle.wait.value},null,8,["duration","wait"])])]),en("div",BY,[en("div",FY,[en("button",{class:"opacity-50 hover:opacity-100",onClick:dn,type:"button"},[gr(hr(kz),{class:"text-white h-8 w-8"})]),en("button",{class:"opacity-50 hover:opacity-100",onClick:st,type:"button"},UY)])]),ke.loading?(Kr(),Is("div",VY,GY)):sv("",!0)]),en("aside",$Y,[en("button",{class:"opacity-50 hover:opacity-100",onClick:jt,type:"button"},WY),gr(lN,{class:"flex-grow mx-4 bg-gradient",modelValue:ke.progress.value,"onUpdate:modelValue":J[3]||(J[3]=Fe=>ke.progress.value=Fe),options:ke.progress.options},null,8,["modelValue","options"]),en("button",{class:"opacity-50 hover:opacity-100",onClick:tn,type:"button"},ZY)]),en("div",XY,[en("div",YY,[en("div",KY,[en("div",JY,[en("h3",{class:"text-xl font-semibold text-gray-900 lg:text-2xl dark:text-white",textContent:pl(ke.localInfo.title)},null,8,QY),en("button",eK,[gr(hr(Rz),{class:"h-8 w-8"})])]),en("div",tK,[en("p",{class:"text-base leading-relaxed text-gray-500 dark:text-gray-400 [&>p]:mb-4",innerHTML:ke.localInfo.description},null,8,nK)])])])])]),r.value?(Kr(),Is("aside",iK,[rK,en("label",sK,pl(ke.options.style.label),1),Ma(en("select",{"onUpdate:modelValue":J[4]||(J[4]=Fe=>ke.options.style.value=Fe)},[(Kr(!0),Is(Hs,null,HT(ke.options.style.options,Fe=>(Kr(),Is("option",{value:Fe.value},pl(Fe.title),9,oK))),256))],512),[[Tz,ke.options.style.value]]),aK,en("label",lK,pl(ke.options.idle.duration.label),1),Ma(en("input",{type:"number",id:"general-idle-duration","onUpdate:modelValue":J[5]||(J[5]=Fe=>ke.options.idle.duration.value=Fe)},null,512),[[md,ke.options.idle.duration.value,void 0,{number:!0}]]),en("label",cK,pl(ke.options.idle.wait.label),1),Ma(en("input",{type:"number",id:"general-idle-wait","onUpdate:modelValue":J[6]||(J[6]=Fe=>ke.options.idle.wait.value=Fe)},null,512),[[md,ke.options.idle.wait.value,void 0,{number:!0}]]),uK,en("div",null,[Ma(en("input",{type:"checkbox","onUpdate:modelValue":J[7]||(J[7]=Fe=>ke.options.nodes.visible.value=Fe),disabled:ke.options.nodes.disabled.value},null,8,hK),[[lv,ke.options.nodes.visible.value]]),fK]),dK,pK,Ma(en("input",{type:"number",id:"link-scale","onUpdate:modelValue":J[8]||(J[8]=Fe=>ke.options.links.width.scale.value=Fe)},null,512),[[md,ke.options.links.width.scale.value,void 0,{number:!0}]]),mK,en("div",gK,[Ma(en("input",{class:"flex-1 w-16 basis-1/2",type:"number",id:"link-min-size","onUpdate:modelValue":J[9]||(J[9]=Fe=>ke.options.links.width.pixels.range[0]=Fe)},null,512),[[md,ke.options.links.width.pixels.range[0],void 0,{number:!0}]]),Ma(en("input",{class:"flex-1 w-16 basis-1/2",type:"number",id:"link-max-size","onUpdate:modelValue":J[10]||(J[10]=Fe=>ke.options.links.width.pixels.range[1]=Fe)},null,512),[[md,ke.options.links.width.pixels.range[1],void 0,{number:!0}]])]),en("div",null,[Ma(en("input",{type:"checkbox",id:"links-visible","onUpdate:modelValue":J[11]||(J[11]=Fe=>ke.options.links.visible.value=Fe),disabled:ke.options.links.disabled.value},null,8,_K),[[lv,ke.options.links.visible.value]]),yK]),vK,en("div",null,[Ma(en("input",{type:"checkbox",id:"zones-visible","onUpdate:modelValue":J[12]||(J[12]=Fe=>ke.options.zones.visible.value=Fe),disabled:ke.options.zones.disabled.value},null,8,xK),[[lv,ke.options.zones.visible.value]]),bK]),wK,EK,en("button",{class:"btn mx-2",type:"button",onClick:St},"Timeline"),en("button",{class:"btn mx-2",type:"button",onClick:st},"Orbit"),en("button",{class:"btn mx-2",type:"button",onClick:dn},"Reset")])):sv("",!0)])}}},AK=VP(TK,[["__scopeId","data-v-30fee287"]]),SK=OB({history:Kz("/RapidexVis/"),routes:[{path:"/networks/:networkId/models/:modelId",name:"model",component:AK,props:!0}]});var Xg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function MK(t){return t}var _3=MK;function PK(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}var IK=PK,CK=IK,AM=Math.max;function LK(t,e,n){return e=AM(e===void 0?t.length-1:e,0),function(){for(var r=arguments,c=-1,h=AM(r.length-e,0),p=Array(h);++c<h;)p[c]=r[e+c];c=-1;for(var s=Array(e+1);++c<e;)s[c]=r[c];return s[e]=n(p),CK(t,this,s)}}var kK=LK;function RK(t){return function(){return t}}var OK=RK,DK=typeof Xg=="object"&&Xg&&Xg.Object===Object&&Xg,y3=DK,zK=y3,BK=typeof self=="object"&&self&&self.Object===Object&&self,FK=zK||BK||Function("return this")(),tw=FK,NK=tw,UK=NK.Symbol,v3=UK,SM=v3,x3=Object.prototype,VK=x3.hasOwnProperty,jK=x3.toString,Ad=SM?SM.toStringTag:void 0;function GK(t){var e=VK.call(t,Ad),n=t[Ad];try{t[Ad]=void 0;var r=!0}catch{}var c=jK.call(t);return r&&(e?t[Ad]=n:delete t[Ad]),c}var $K=GK,HK=Object.prototype,WK=HK.toString;function qK(t){return WK.call(t)}var ZK=qK,MM=v3,XK=$K,YK=ZK,KK="[object Null]",JK="[object Undefined]",PM=MM?MM.toStringTag:void 0;function QK(t){return t==null?t===void 0?JK:KK:PM&&PM in Object(t)?XK(t):YK(t)}var nw=QK;function eJ(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Fy=eJ,tJ=nw,nJ=Fy,iJ="[object AsyncFunction]",rJ="[object Function]",sJ="[object GeneratorFunction]",oJ="[object Proxy]";function aJ(t){if(!nJ(t))return!1;var e=tJ(t);return e==rJ||e==sJ||e==iJ||e==oJ}var b3=aJ,lJ=tw,cJ=lJ["__core-js_shared__"],uJ=cJ,sx=uJ,IM=function(){var t=/[^.]+$/.exec(sx&&sx.keys&&sx.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function hJ(t){return!!IM&&IM in t}var fJ=hJ,dJ=Function.prototype,pJ=dJ.toString;function mJ(t){if(t!=null){try{return pJ.call(t)}catch{}try{return t+""}catch{}}return""}var gJ=mJ,_J=b3,yJ=fJ,vJ=Fy,xJ=gJ,bJ=/[\\^$.*+?()[\]{}|]/g,wJ=/^\[object .+?Constructor\]$/,EJ=Function.prototype,TJ=Object.prototype,AJ=EJ.toString,SJ=TJ.hasOwnProperty,MJ=RegExp("^"+AJ.call(SJ).replace(bJ,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function PJ(t){if(!vJ(t)||yJ(t))return!1;var e=_J(t)?MJ:wJ;return e.test(xJ(t))}var IJ=PJ;function CJ(t,e){return t?.[e]}var LJ=CJ,kJ=IJ,RJ=LJ;function OJ(t,e){var n=RJ(t,e);return kJ(n)?n:void 0}var DJ=OJ,zJ=DJ,BJ=function(){try{var t=zJ(Object,"defineProperty");return t({},"",{}),t}catch{}}(),FJ=BJ,NJ=OK,CM=FJ,UJ=_3,VJ=CM?function(t,e){return CM(t,"toString",{configurable:!0,enumerable:!1,value:NJ(e),writable:!0})}:UJ,jJ=VJ,GJ=800,$J=16,HJ=Date.now;function WJ(t){var e=0,n=0;return function(){var r=HJ(),c=$J-(r-n);if(n=r,c>0){if(++e>=GJ)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var qJ=WJ,ZJ=jJ,XJ=qJ,YJ=XJ(ZJ),KJ=YJ,JJ=_3,QJ=kK,eQ=KJ;function tQ(t,e){return eQ(QJ(t,e,JJ),t+"")}var nQ=tQ;function iQ(t,e){return t===e||t!==t&&e!==e}var w3=iQ,rQ=9007199254740991;function sQ(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=rQ}var E3=sQ,oQ=b3,aQ=E3;function lQ(t){return t!=null&&aQ(t.length)&&!oQ(t)}var T3=lQ,cQ=9007199254740991,uQ=/^(?:0|[1-9]\d*)$/;function hQ(t,e){var n=typeof t;return e=e??cQ,!!e&&(n=="number"||n!="symbol"&&uQ.test(t))&&t>-1&&t%1==0&&t<e}var A3=hQ,fQ=w3,dQ=T3,pQ=A3,mQ=Fy;function gQ(t,e,n){if(!mQ(n))return!1;var r=typeof e;return(r=="number"?dQ(n)&&pQ(e,n.length):r=="string"&&e in n)?fQ(n[e],t):!1}var _Q=gQ;function yQ(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var vQ=yQ;function xQ(t){return t!=null&&typeof t=="object"}var iw=xQ,bQ=nw,wQ=iw,EQ="[object Arguments]";function TQ(t){return wQ(t)&&bQ(t)==EQ}var AQ=TQ,LM=AQ,SQ=iw,S3=Object.prototype,MQ=S3.hasOwnProperty,PQ=S3.propertyIsEnumerable,IQ=LM(function(){return arguments}())?LM:function(t){return SQ(t)&&MQ.call(t,"callee")&&!PQ.call(t,"callee")},CQ=IQ,LQ=Array.isArray,kQ=LQ,E1={exports:{}};function RQ(){return!1}var OQ=RQ;(function(t,e){var n=tw,r=OQ,c=e&&!e.nodeType&&e,h=c&&!0&&t&&!t.nodeType&&t,p=h&&h.exports===c,s=p?n.Buffer:void 0,v=s?s.isBuffer:void 0,E=v||r;t.exports=E})(E1,E1.exports);var DQ=nw,zQ=E3,BQ=iw,FQ="[object Arguments]",NQ="[object Array]",UQ="[object Boolean]",VQ="[object Date]",jQ="[object Error]",GQ="[object Function]",$Q="[object Map]",HQ="[object Number]",WQ="[object Object]",qQ="[object RegExp]",ZQ="[object Set]",XQ="[object String]",YQ="[object WeakMap]",KQ="[object ArrayBuffer]",JQ="[object DataView]",QQ="[object Float32Array]",eee="[object Float64Array]",tee="[object Int8Array]",nee="[object Int16Array]",iee="[object Int32Array]",ree="[object Uint8Array]",see="[object Uint8ClampedArray]",oee="[object Uint16Array]",aee="[object Uint32Array]",Ji={};Ji[QQ]=Ji[eee]=Ji[tee]=Ji[nee]=Ji[iee]=Ji[ree]=Ji[see]=Ji[oee]=Ji[aee]=!0;Ji[FQ]=Ji[NQ]=Ji[KQ]=Ji[UQ]=Ji[JQ]=Ji[VQ]=Ji[jQ]=Ji[GQ]=Ji[$Q]=Ji[HQ]=Ji[WQ]=Ji[qQ]=Ji[ZQ]=Ji[XQ]=Ji[YQ]=!1;function lee(t){return BQ(t)&&zQ(t.length)&&!!Ji[DQ(t)]}var cee=lee;function uee(t){return function(e){return t(e)}}var hee=uee,T1={exports:{}};(function(t,e){var n=y3,r=e&&!e.nodeType&&e,c=r&&!0&&t&&!t.nodeType&&t,h=c&&c.exports===r,p=h&&n.process,s=function(){try{var v=c&&c.require&&c.require("util").types;return v||p&&p.binding&&p.binding("util")}catch{}}();t.exports=s})(T1,T1.exports);var fee=cee,dee=hee,kM=T1.exports,RM=kM&&kM.isTypedArray,pee=RM?dee(RM):fee,mee=pee,gee=vQ,_ee=CQ,yee=kQ,vee=E1.exports,xee=A3,bee=mee,wee=Object.prototype,Eee=wee.hasOwnProperty;function Tee(t,e){var n=yee(t),r=!n&&_ee(t),c=!n&&!r&&vee(t),h=!n&&!r&&!c&&bee(t),p=n||r||c||h,s=p?gee(t.length,String):[],v=s.length;for(var E in t)(e||Eee.call(t,E))&&!(p&&(E=="length"||c&&(E=="offset"||E=="parent")||h&&(E=="buffer"||E=="byteLength"||E=="byteOffset")||xee(E,v)))&&s.push(E);return s}var Aee=Tee,See=Object.prototype;function Mee(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||See;return t===n}var Pee=Mee;function Iee(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var Cee=Iee,Lee=Fy,kee=Pee,Ree=Cee,Oee=Object.prototype,Dee=Oee.hasOwnProperty;function zee(t){if(!Lee(t))return Ree(t);var e=kee(t),n=[];for(var r in t)r=="constructor"&&(e||!Dee.call(t,r))||n.push(r);return n}var Bee=zee,Fee=Aee,Nee=Bee,Uee=T3;function Vee(t){return Uee(t)?Fee(t,!0):Nee(t)}var jee=Vee,Gee=nQ,$ee=w3,Hee=_Q,Wee=jee,M3=Object.prototype,qee=M3.hasOwnProperty,Zee=Gee(function(t,e){t=Object(t);var n=-1,r=e.length,c=r>2?e[2]:void 0;for(c&&Hee(e[0],e[1],c)&&(r=1);++n<r;)for(var h=e[n],p=Wee(h),s=-1,v=p.length;++s<v;){var E=p[s],M=t[E];(M===void 0||$ee(M,M3[E])&&!qee.call(t,E))&&(t[E]=h[E])}return t}),Xee=Zee;const Yee=U1({render(){return H1("div",{class:"v-idle"},this.display)},emits:["idle","remind"],props:{duration:{type:Number,default:60*5},events:{type:Array,default:()=>["mousemove","keypress"]},loop:{type:Boolean,default:!1},reminders:{type:Array,default:()=>[]},wait:{type:Number,default:0}},data(){return{display:"",timer:void 0,start:0,counter:void 0,diff:0,minutes:"",seconds:""}},mounted(){setTimeout(()=>{this.start=Date.now(),this.setDisplay(),this.$nextTick(()=>{this.setTimer();for(let t=this.events.length-1;t>=0;t-=1)window.addEventListener(this.events[t],this.clearTimer)})},this.wait*1e3)},methods:{setDisplay(){if(this.diff=this.duration-((Date.now()-this.start)/1e3|0),this.diff<0&&!this.loop)return;this.shouldRemind();const t=this.diff/60|0,e=this.diff%60|0;this.minutes=`${t<10?"0"+t:t}`,this.seconds=`${e<10?"0"+e:e}`,this.display=`${this.minutes}:${this.seconds}`},shouldRemind(){this.reminders.length>0&&this.reminders.includes(this.diff)&&this.remind()},countdown(){this.setDisplay(),this.diff<=0&&this.clearTimer(this.loop)},idle(){this.$emit("idle")},remind(){this.$emit("remind",this.diff)},setTimer(){this.timer=window.setInterval(this.idle,this.duration*1e3),this.counter=window.setInterval(this.countdown,1e3)},clearTimer(t=!1){window.clearInterval(this.timer),window.clearInterval(this.counter),t&&(this.start=Date.now(),this.diff=0,this.setDisplay(),this.setTimer())}},beforeUnmount(){clearInterval(this.timer),clearInterval(this.counter);for(let t=this.events.length-1;t>=0;t-=1)window.removeEventListener(this.events[t],this.clearTimer)}});var Kee={install(t,{name:e="v-idle"}={}){t.component(e,Xee(Yee,{name:e}))}};const Ny=Cz(NB);Ny.use(w4);Ny.use(SK);Ny.use(Kee);Ny.mount("#app");
